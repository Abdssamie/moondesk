# Files

## File: repomix-output.1.xml
````xml
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  workflows/
    ci.yml
.husky/
  commit-msg
  pre-commit
  pre-push
apps/
  docs/
    app/
      fonts/
        GeistMonoVF.woff
        GeistVF.woff
      favicon.ico
      globals.css
      layout.tsx
      page.module.css
      page.tsx
    public/
      file-text.svg
      globe.svg
      next.svg
      turborepo-dark.svg
      turborepo-light.svg
      vercel.svg
      window.svg
    .gitignore
    eslint.config.js
    next.config.js
    package.json
    README.md
    tsconfig.json
  edge-simulator/
    src/
      __tests__/
        generators.test.ts
        presets.test.ts
      generators.ts
      main.ts
      mqtt-publisher.ts
      presets.ts
      simulation-engine.ts
      types.ts
    Dockerfile
    eslint.config.mjs
    package.json
    tsconfig.json
    tsup.config.ts
  moondesk-dash/
    .husky/
      pre-commit
    media/
      dashboard.png
    public/
      avatars/
        arhamkhnz.png
    src/
      app/
        (external)/
          page.tsx
        (main)/
          auth/
            _components/
              social-auth/
                google-button.tsx
              login-form.tsx
              register-form.tsx
            v1/
              login/
                page.tsx
              register/
                page.tsx
            v2/
              login/
                page.tsx
              register/
                page.tsx
              layout.tsx
          dashboard/
            _components/
              sidebar/
                account-switcher.tsx
                app-sidebar.tsx
                clerk-auth.tsx
                layout-controls.tsx
                nav-documents.tsx
                nav-main.tsx
                nav-secondary.tsx
                nav-user-clerk.tsx
                nav-user.tsx
                search-dialog.tsx
                theme-switcher.tsx
            [...not-found]/
              page.tsx
            analytics/
              _components/
                data-usage.tsx
                energy-consumption.tsx
                performance-metrics.tsx
                system-health.tsx
              page.tsx
            assets/
              _components/
                asset-insight-cards.tsx
              [assetId]/
                page.tsx
              page.tsx
            coming-soon/
              page.tsx
            overview/
              _components/
                chart-area-interactive.tsx
                columns.tsx
                data-table.tsx
                schema.ts
                section-cards.tsx
                table-cell-viewer.tsx
              page.tsx
            layout.tsx
            page.tsx
          unauthorized/
            page.tsx
        organization/
          [[...organization]]/
            page.tsx
        sentry-example-page/
          page.tsx
        sso-callback/
          page.tsx
        favicon.ico
        global-error.tsx
        globals.css
        layout.tsx
        not-found.tsx
      components/
        data-table/
          data-table-column-header.tsx
          data-table-pagination.tsx
          data-table-view-options.tsx
          data-table.tsx
          drag-column.tsx
          draggable-row.tsx
          table-utils.ts
        providers/
          query-provider.tsx
        ui/
          accordion.tsx
          alert-dialog.tsx
          alert.tsx
          aspect-ratio.tsx
          avatar.tsx
          badge.tsx
          breadcrumb.tsx
          button-group.tsx
          button.tsx
          calendar.tsx
          card.tsx
          carousel.tsx
          chart.tsx
          checkbox.tsx
          collapsible.tsx
          command.tsx
          context-menu.tsx
          dialog.tsx
          drawer.tsx
          dropdown-menu.tsx
          empty.tsx
          field.tsx
          form.tsx
          hover-card.tsx
          input-group.tsx
          input-otp.tsx
          input.tsx
          item.tsx
          kbd.tsx
          label.tsx
          menubar.tsx
          navigation-menu.tsx
          pagination.tsx
          popover.tsx
          progress.tsx
          radio-group.tsx
          resizable.tsx
          scroll-area.tsx
          select.tsx
          separator.tsx
          sheet.tsx
          sidebar.tsx
          skeleton.tsx
          slider.tsx
          sonner.tsx
          spinner.tsx
          switch.tsx
          table.tsx
          tabs.tsx
          textarea.tsx
          toggle-group.tsx
          toggle.tsx
          tooltip.tsx
        simple-icon.tsx
      hooks/
        __tests__/
          use-signalr.test.ts
        use-data-table-instance.ts
        use-mobile.ts
        use-signalr.ts
      lib/
        adapters/
          __tests__/
            dashboard-adapter.test.ts
          dashboard-adapter.ts
        mock-data/
          iot-data.ts
        layout-utils.ts
        theme-utils.ts
        utils.ts
      navigation/
        sidebar/
          sidebar-items.ts
      scripts/
        generate-theme-presets.ts
      server/
        server-actions.ts
      services/
        api-client.ts
        device-service.ts
      stores/
        preferences/
          preferences-provider.tsx
          preferences-store.ts
      styles/
        presets/
          brutalist.css
          soft-pop.css
          tangerine.css
        clerk-custom.css
      test/
        setup.ts
        utils.tsx
      types/
        preferences/
          layout.ts
          theme.ts
        iot.ts
      config.ts
      instrumentation-client.ts
      instrumentation.ts
      proxy.disabled.ts
      proxy.ts
    .env.local.example
    .gitignore
    .prettierignore
    .prettierrc
    CLERK_AUTH_INTEGRATION.md
    CLERK_SETUP.md
    components.json
    CONTRIBUTING.md
    eslint.config.mjs
    IIOT_DASHBOARD_SPEC.md
    LICENSE
    next.config.mjs
    package.json
    postcss.config.mjs
    README.md
    sentry.edge.config.ts
    sentry.server.config.ts
    tsconfig.json
    vitest.config.ts
  mqtt-worker/
    src/
      api-broadcaster.test.ts
      api-broadcaster.ts
      index.ts
      ingestion-handler.test.ts
      ingestion-handler.ts
      mqtt-client.ts
      parser.ts
    Dockerfile
    eslint.config.mjs
    package.json
    tsconfig.json
    tsup.config.ts
docker/
  mosquitto/
    config/
      mosquitto.conf
packages/
  config/
    src/
      app.ts
      database.ts
      env.ts
      index.ts
      mqtt.ts
    eslint.config.mjs
    package.json
    README.md
    tsconfig.json
  database/
    src/
      migrations/
        meta/
          _journal.json
          0000_snapshot.json
        0000_tranquil_shotgun.sql
      repositories/
        alert.repository.ts
        asset.repository.ts
        command.repository.ts
        connection-credential.repository.ts
        index.ts
        organization.repository.ts
        reading.repository.ts
        sensor.repository.ts
        user.repository.ts
      schema/
        alerts.ts
        assets.ts
        commands.ts
        connection-credentials.ts
        index.ts
        organizations.ts
        readings.ts
        sensors.ts
        users.ts
      client.ts
      index.ts
    drizzle.config.ts
    eslint.config.mjs
    package.json
    tsconfig.json
  domain/
    src/
      enums/
        alert-severity.ts
        asset-status.ts
        command-status.ts
        index.ts
        parameter.ts
        protocol.ts
        reading-quality.ts
        sensor-type.ts
        user-role.ts
      errors/
        index.ts
      interfaces/
        repositories/
          alert.repository.ts
          asset.repository.ts
          command.repository.ts
          connection-credential.repository.ts
          index.ts
          organization.repository.ts
          reading.repository.ts
          sensor.repository.ts
          user.repository.ts
        services/
          encryption.service.ts
          index.ts
          notification.service.ts
        index.ts
      models/
        alert.ts
        asset.ts
        command.ts
        connection-credential.ts
        index.ts
        organization.ts
        reading.ts
        sensor.ts
        user.ts
      schemas/
        index.ts
      index.ts
    eslint.config.mjs
    package.json
    tsconfig.json
  eslint-config/
    base.js
    next.js
    package.json
    react-internal.js
    README.md
  logger/
    src/
      index.ts
    eslint.config.mjs
    package.json
    tsconfig.json
  typescript-config/
    base.json
    nextjs.json
    package.json
    react-library.json
  ui/
    src/
      button.tsx
      card.tsx
      code.tsx
    eslint.config.mjs
    package.json
    tsconfig.json
.env.example
.gitignore
AGENTS.md
docker-compose.yml
package.json
pnpm-workspace.yaml
README.md
turbo.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".env.example">
# === Backend / General ===
NODE_ENV=development

# Database (Defaults for local Docker)
DB_HOST=localhost
DB_PORT=5435
DB_USER=moondeskdb
DB_NAME=moondeskdb
# Secret: Provide in Jules/Env
DB_PASSWORD=

# MQTT (Mosquitto)
MQTT_HOST=localhost
MQTT_PORT=1883
# Secrets: Leave blank if using anonymous or provide in Jules
MQTT_USERNAME=
MQTT_PASSWORD=

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# Internal Service Auth
# Secret: Used for Worker <-> API communication
INTERNAL_SERVICE_TOKEN=

# === Frontend (Next.js) / Auth ===
# Secret: Clerk Keys
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=
CLERK_SECRET_KEY=

# Clerk Routes (Standard Defaults)
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/auth/v2/login
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/auth/v2/register
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_ORGANIZATION_PROFILE_URL=/organization

# API URL
NEXT_PUBLIC_API_URL=http://localhost:3000/api/v1
</file>

<file path=".husky/pre-commit">
#!/bin/sh
branch_name=$(git symbolic-ref --short HEAD)

if [ "$branch_name" = "main" ] || [ "$branch_name" = "master" ]; then
  echo "❌ Error: Direct commits to $branch_name are not allowed."
  echo "Please create a new branch following the convention: mndsk-<number>-<title>"
  exit 1
fi

if ! echo "$branch_name" | grep -qE '^mndsk-[0-9]+-.+$'; then
  echo "❌ Error: Branch name '$branch_name' does not follow the convention."
  echo "Required format: mndsk-<number>-<title> (e.g., mndsk-38-data-repositories)"
  echo "This naming convention is required to link commits to Linear tickets."
  exit 1
fi
</file>

<file path=".husky/pre-push">
#!/bin/sh
while read local_ref local_sha remote_ref remote_sha
do
    if [ "$remote_ref" = "refs/heads/main" ] || [ "$remote_ref" = "refs/heads/master" ]; then
        echo "❌ Error: Direct pushes to main/master are not allowed."
        echo "Please push to a feature branch and create a Pull Request."
        exit 1
    fi
done

exit 0
</file>

<file path="apps/docs/app/globals.css">
:root {
  --background: #ffffff;
  --foreground: #171717;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
}

body {
  color: var(--foreground);
  background: var(--background);
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

.imgDark {
  display: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }

  .imgLight {
    display: none;
  }
  .imgDark {
    display: unset;
  }
}
</file>

<file path="apps/docs/app/layout.tsx">
import type { Metadata } from "next";
import localFont from "next/font/local";
import "./globals.css";

const geistSans = localFont({
  src: "./fonts/GeistVF.woff",
  variable: "--font-geist-sans",
});
const geistMono = localFont({
  src: "./fonts/GeistMonoVF.woff",
  variable: "--font-geist-mono",
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={`${geistSans.variable} ${geistMono.variable}`}>
        {children}
      </body>
    </html>
  );
}
</file>

<file path="apps/docs/app/page.module.css">
.page {
  padding: 2rem;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
  line-height: 1.6;
}

.main {
  max-width: 800px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.header {
  border-bottom: 1px solid #eaeaea;
  padding-bottom: 1rem;
}

.header h1 {
  font-size: 2.5rem;
  margin: 0;
}

.section {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.section h2 {
  font-size: 2rem;
  margin: 0;
  border-bottom: 1px solid #ccc;
  padding-bottom: 0.5rem;
}

.section h3 {
  font-size: 1.5rem;
  margin: 0;
}

.section ul,
.section ol {
  padding-left: 20px;
  margin: 0;
}

.section ul ul {
  padding-left: 20px;
  margin-top: 0.5rem;
}

.section li {
  margin-bottom: 0.5rem;
}

.section p,
.section li {
  color: #333;
}

@media (prefers-color-scheme: dark) {
  .page {
    background-color: #1a1a1a;
    color: #f0f0f0;
  }

  .header {
    border-bottom-color: #333;
  }

  .section h2 {
    border-bottom-color: #444;
  }

  .section p,
  .section li {
    color: #ccc;
  }
}
</file>

<file path="apps/docs/app/page.tsx">
import styles from "./page.module.css";

export default function Home() {
  return (
    <div className={styles.page}>
      <main className={styles.main}>
        <header className={styles.header}>
          <h1>Moondesk Documentation</h1>
          <p>
            Welcome to the official documentation for Moondesk, a scalable,
            protocol-agnostic IoT platform.
          </p>
        </header>

        <section id="overview" className={styles.section}>
          <h2>Project Overview</h2>
          <p>
            Moondesk is designed to handle high-throughput data ingestion,
            real-time analytics, and device management for IoT ecosystems.
          </p>
        </section>

        <section id="architecture" className={styles.section}>
          <h2>System Architecture</h2>
          <p>
            The system follows an event-driven microservices architecture. Below
            is a brief overview of the key components:
          </p>
          <ul>
            <li>
              <strong>Edge Devices</strong>: Simulate or real devices sending
              data via MQTT.
            </li>
            <li>
              <strong>Broker (Mosquitto)</strong>: Handles MQTT messsaging.
            </li>
            <li>
              <strong>Worker (MQTT Worker)</strong>: Subscribes to broker,
              processes ingestion, and broadcasts &quot;hot&quot; data to API.
            </li>
            <li>
              <strong>API (Fastify)</strong>: REST & WebSocket API for frontend
              clients. Handles command dispatching and real-time updates.
            </li>
            <li>
              <strong>Storage</strong>:
              <ul>
                <li>
                  <strong>TimescaleDB (PostgreSQL)</strong>: Time-series data
                  (sensor readings).
                </li>
                <li>
                  <strong>Redis</strong>: Caching, pub/sub for scaling
                  WebSockets, and short-term state.
                </li>
              </ul>
            </li>
            <li>
              <strong>Frontend (Next.js)</strong>: Dashboard for visualization
              and admin controls.
            </li>
          </ul>
        </section>

        <section id="repo-structure" className={styles.section}>
          <h2>Repository Structure</h2>
          <p>
            This is a Monorepo managed by <strong>Turbo</strong> and{" "}
            <strong>pnpm</strong> workspaces.
          </p>
          <h3>apps/</h3>
          <ul>
            <li>
              <strong>api</strong>: Fastify backend.
            </li>
            <li>
              <strong>mqtt-worker</strong>: Node.js worker for MQTT traffic.
            </li>
            <li>
              <strong>edge-simulator</strong>: Tool to generate synthetic load.
            </li>
            <li>
              <strong>moondesk-dash</strong>: Next.js frontend application.
            </li>
            <li>
              <strong>docs</strong>: This documentation site.
            </li>
          </ul>
          <h3>packages/</h3>
          <ul>
            <li>
              <strong>config</strong>: Shared configuration (env vars, schemas).
            </li>
            <li>
              <strong>database</strong>: Drizzle ORM schemas.
            </li>
            <li>
              <strong>domain</strong>: Shared interfaces, types, and Models.
            </li>
            <li>
              <strong>logger</strong>: Standardized Pino logger.
            </li>
            <li>
              <strong>ui</strong>: Shared React UI components.
            </li>
            <li>
              <strong>typescript-config</strong>: Shared `tsconfig.json` bases.
            </li>
          </ul>
        </section>

        <section id="tech-stack" className={styles.section}>
          <h2>Technology Stack</h2>
          <ul>
            <li>
              <strong>Runtime</strong>: Node.js (v20+), strictly TypeScript.
            </li>
            <li>
              <strong>Package Manager</strong>: pnpm (Corepack enabled).
            </li>
            <li>
              <strong>Build System</strong>: Turbo and tsup.
            </li>
            <li>
              <strong>Database</strong>: PostgreSQL with TimescaleDB.
            </li>
            <li>
              <strong>ORM</strong>: Drizzle ORM.
            </li>
            <li>
              <strong>Auth</strong>: Clerk and Internal Tokens.
            </li>
            <li>
              <strong>Infrastructure</strong>: Docker Compose.
            </li>
          </ul>
        </section>

        <section id="dev-philosophy" className={styles.section}>
          <h2>Development Philosophy</h2>
          <ol>
            <li>
              <strong>Strict Types</strong>: No `any` is allowed.
            </li>
            <li>
              <strong>Docker First</strong>: The entire backend stack runs in
              Docker.
            </li>
            <li>
              <strong>Branch Protection</strong>: `main` is protected. Work on
              `develop` or feature branches.
            </li>
            <li>
              <strong>Environment Variables</strong>: Validated with Zod.
            </li>
          </ol>
        </section>
      </main>
    </div>
  );
}
</file>

<file path="apps/docs/public/file-text.svg">
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 13.5V6.5V5.41421C14.5 5.149 14.3946 4.89464 14.2071 4.70711L9.79289 0.292893C9.60536 0.105357 9.351 0 9.08579 0H8H3H1.5V1.5V13.5C1.5 14.8807 2.61929 16 4 16H12C13.3807 16 14.5 14.8807 14.5 13.5ZM13 13.5V6.5H9.5H8V5V1.5H3V13.5C3 14.0523 3.44772 14.5 4 14.5H12C12.5523 14.5 13 14.0523 13 13.5ZM9.5 5V2.12132L12.3787 5H9.5ZM5.13 5.00062H4.505V6.25062H5.13H6H6.625V5.00062H6H5.13ZM4.505 8H5.13H11H11.625V9.25H11H5.13H4.505V8ZM5.13 11H4.505V12.25H5.13H11H11.625V11H11H5.13Z" fill="#666666"/>
</svg>
</file>

<file path="apps/docs/public/globe.svg">
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_868_525)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.268 14.0934C11.9051 13.4838 13.2303 12.2333 13.9384 10.6469C13.1192 10.7941 12.2138 10.9111 11.2469 10.9925C11.0336 12.2005 10.695 13.2621 10.268 14.0934ZM8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM8.48347 14.4823C8.32384 14.494 8.16262 14.5 8 14.5C7.83738 14.5 7.67616 14.494 7.51654 14.4823C7.5132 14.4791 7.50984 14.4759 7.50647 14.4726C7.2415 14.2165 6.94578 13.7854 6.67032 13.1558C6.41594 12.5744 6.19979 11.8714 6.04101 11.0778C6.67605 11.1088 7.33104 11.125 8 11.125C8.66896 11.125 9.32395 11.1088 9.95899 11.0778C9.80021 11.8714 9.58406 12.5744 9.32968 13.1558C9.05422 13.7854 8.7585 14.2165 8.49353 14.4726C8.49016 14.4759 8.4868 14.4791 8.48347 14.4823ZM11.4187 9.72246C12.5137 9.62096 13.5116 9.47245 14.3724 9.28806C14.4561 8.87172 14.5 8.44099 14.5 8C14.5 7.55901 14.4561 7.12828 14.3724 6.71194C13.5116 6.52755 12.5137 6.37904 11.4187 6.27753C11.4719 6.83232 11.5 7.40867 11.5 8C11.5 8.59133 11.4719 9.16768 11.4187 9.72246ZM10.1525 6.18401C10.2157 6.75982 10.25 7.36805 10.25 8C10.25 8.63195 10.2157 9.24018 10.1525 9.81598C9.46123 9.85455 8.7409 9.875 8 9.875C7.25909 9.875 6.53877 9.85455 5.84749 9.81598C5.7843 9.24018 5.75 8.63195 5.75 8C5.75 7.36805 5.7843 6.75982 5.84749 6.18401C6.53877 6.14545 7.25909 6.125 8 6.125C8.74091 6.125 9.46123 6.14545 10.1525 6.18401ZM11.2469 5.00748C12.2138 5.08891 13.1191 5.20593 13.9384 5.35306C13.2303 3.7667 11.9051 2.51622 10.268 1.90662C10.695 2.73788 11.0336 3.79953 11.2469 5.00748ZM8.48347 1.51771C8.4868 1.52089 8.49016 1.52411 8.49353 1.52737C8.7585 1.78353 9.05422 2.21456 9.32968 2.84417C9.58406 3.42562 9.80021 4.12856 9.95899 4.92219C9.32395 4.89118 8.66896 4.875 8 4.875C7.33104 4.875 6.67605 4.89118 6.04101 4.92219C6.19978 4.12856 6.41594 3.42562 6.67032 2.84417C6.94578 2.21456 7.2415 1.78353 7.50647 1.52737C7.50984 1.52411 7.51319 1.52089 7.51653 1.51771C7.67615 1.50597 7.83738 1.5 8 1.5C8.16262 1.5 8.32384 1.50597 8.48347 1.51771ZM5.73202 1.90663C4.0949 2.51622 2.76975 3.7667 2.06159 5.35306C2.88085 5.20593 3.78617 5.08891 4.75309 5.00748C4.96639 3.79953 5.30497 2.73788 5.73202 1.90663ZM4.58133 6.27753C3.48633 6.37904 2.48837 6.52755 1.62761 6.71194C1.54392 7.12828 1.5 7.55901 1.5 8C1.5 8.44099 1.54392 8.87172 1.62761 9.28806C2.48837 9.47245 3.48633 9.62096 4.58133 9.72246C4.52807 9.16768 4.5 8.59133 4.5 8C4.5 7.40867 4.52807 6.83232 4.58133 6.27753ZM4.75309 10.9925C3.78617 10.9111 2.88085 10.7941 2.06159 10.6469C2.76975 12.2333 4.0949 13.4838 5.73202 14.0934C5.30497 13.2621 4.96639 12.2005 4.75309 10.9925Z" fill="#666666"/>
</g>
<defs>
<clipPath id="clip0_868_525">
<rect width="16" height="16" fill="white"/>
</clipPath>
</defs>
</svg>
</file>

<file path="apps/docs/public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="apps/docs/public/turborepo-dark.svg">
<svg width="473" height="76" viewBox="0 0 473 76" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M130.998 30.6565V22.3773H91.0977V30.6565H106.16V58.1875H115.935V30.6565H130.998Z" fill="black"/>
<path d="M153.542 58.7362C165.811 58.7362 172.544 52.5018 172.544 42.2275V22.3773H162.768V41.2799C162.768 47.0155 159.776 50.2574 153.542 50.2574C147.307 50.2574 144.315 47.0155 144.315 41.2799V22.3773H134.539V42.2275C134.539 52.5018 141.272 58.7362 153.542 58.7362Z" fill="black"/>
<path d="M187.508 46.3173H197.234L204.914 58.1875H216.136L207.458 45.2699C212.346 43.5243 215.338 39.634 215.338 34.3473C215.338 26.6665 209.603 22.3773 200.874 22.3773H177.732V58.1875H187.508V46.3173ZM187.508 38.5867V30.5568H200.376C203.817 30.5568 205.712 32.053 205.712 34.5967C205.712 36.9907 203.817 38.5867 200.376 38.5867H187.508Z" fill="black"/>
<path d="M219.887 58.1875H245.472C253.452 58.1875 258.041 54.397 258.041 48.0629C258.041 43.8235 255.348 40.9308 252.156 39.634C254.35 38.5867 257.043 36.0929 257.043 32.1528C257.043 25.8187 252.555 22.3773 244.625 22.3773H219.887V58.1875ZM229.263 36.3922V30.3074H243.627C246.32 30.3074 247.817 31.3548 247.817 33.3498C247.817 35.3448 246.32 36.3922 243.627 36.3922H229.263ZM229.263 43.7238H244.525C247.168 43.7238 248.615 45.0205 248.615 46.9657C248.615 48.9108 247.168 50.2075 244.525 50.2075H229.263V43.7238Z" fill="black"/>
<path d="M281.942 21.7788C269.423 21.7788 260.396 29.6092 260.396 40.2824C260.396 50.9557 269.423 58.786 281.942 58.786C294.461 58.786 303.438 50.9557 303.438 40.2824C303.438 29.6092 294.461 21.7788 281.942 21.7788ZM281.942 30.2575C288.525 30.2575 293.463 34.1478 293.463 40.2824C293.463 46.417 288.525 50.3073 281.942 50.3073C275.359 50.3073 270.421 46.417 270.421 40.2824C270.421 34.1478 275.359 30.2575 281.942 30.2575Z" fill="black"/>
<path d="M317.526 46.3173H327.251L334.932 58.1875H346.154L337.476 45.2699C342.364 43.5243 345.356 39.634 345.356 34.3473C345.356 26.6665 339.62 22.3773 330.892 22.3773H307.75V58.1875H317.526V46.3173ZM317.526 38.5867V30.5568H330.394C333.835 30.5568 335.73 32.053 335.73 34.5967C335.73 36.9907 333.835 38.5867 330.394 38.5867H317.526Z" fill="black"/>
<path d="M349.904 22.3773V58.1875H384.717V49.9083H359.48V44.0729H381.874V35.9932H359.48V30.6565H384.717V22.3773H349.904Z" fill="black"/>
<path d="M399.204 46.7662H412.221C420.95 46.7662 426.685 42.5767 426.685 34.5967C426.685 26.5668 420.95 22.3773 412.221 22.3773H389.428V58.1875H399.204V46.7662ZM399.204 38.6365V30.5568H411.673C415.164 30.5568 417.059 32.053 417.059 34.5967C417.059 37.0904 415.164 38.6365 411.673 38.6365H399.204Z" fill="black"/>
<path d="M450.948 21.7788C438.43 21.7788 429.402 29.6092 429.402 40.2824C429.402 50.9557 438.43 58.786 450.948 58.786C463.467 58.786 472.444 50.9557 472.444 40.2824C472.444 29.6092 463.467 21.7788 450.948 21.7788ZM450.948 30.2575C457.532 30.2575 462.469 34.1478 462.469 40.2824C462.469 46.417 457.532 50.3073 450.948 50.3073C444.365 50.3073 439.427 46.417 439.427 40.2824C439.427 34.1478 444.365 30.2575 450.948 30.2575Z" fill="black"/>
<path d="M38.5017 18.0956C27.2499 18.0956 18.0957 27.2498 18.0957 38.5016C18.0957 49.7534 27.2499 58.9076 38.5017 58.9076C49.7535 58.9076 58.9077 49.7534 58.9077 38.5016C58.9077 27.2498 49.7535 18.0956 38.5017 18.0956ZM38.5017 49.0618C32.6687 49.0618 27.9415 44.3346 27.9415 38.5016C27.9415 32.6686 32.6687 27.9414 38.5017 27.9414C44.3347 27.9414 49.0619 32.6686 49.0619 38.5016C49.0619 44.3346 44.3347 49.0618 38.5017 49.0618Z" fill="black"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M40.2115 14.744V7.125C56.7719 8.0104 69.9275 21.7208 69.9275 38.5016C69.9275 55.2824 56.7719 68.989 40.2115 69.8782V62.2592C52.5539 61.3776 62.3275 51.0644 62.3275 38.5016C62.3275 25.9388 52.5539 15.6256 40.2115 14.744ZM20.5048 54.0815C17.233 50.3043 15.124 45.4935 14.7478 40.2115H7.125C7.5202 47.6025 10.4766 54.3095 15.1088 59.4737L20.501 54.0815H20.5048ZM36.7916 69.8782V62.2592C31.5058 61.883 26.695 59.7778 22.9178 56.5022L17.5256 61.8944C22.6936 66.5304 29.4006 69.483 36.7878 69.8782H36.7916Z" fill="url(#paint0_linear_2028_278)"/>
<defs>
<linearGradient id="paint0_linear_2028_278" x1="41.443" y1="11.5372" x2="10.5567" y2="42.4236" gradientUnits="userSpaceOnUse">
<stop stop-color="#0096FF"/>
<stop offset="1" stop-color="#FF1E56"/>
</linearGradient>
</defs>
</svg>
</file>

<file path="apps/docs/public/turborepo-light.svg">
<svg width="473" height="76" viewBox="0 0 473 76" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M130.998 30.6566V22.3773H91.0977V30.6566H106.16V58.1876H115.935V30.6566H130.998Z" fill="white"/>
<path d="M153.542 58.7362C165.811 58.7362 172.544 52.5018 172.544 42.2276V22.3773H162.768V41.2799C162.768 47.0156 159.776 50.2574 153.542 50.2574C147.307 50.2574 144.315 47.0156 144.315 41.2799V22.3773H134.539V42.2276C134.539 52.5018 141.272 58.7362 153.542 58.7362Z" fill="white"/>
<path d="M187.508 46.3173H197.234L204.914 58.1876H216.136L207.458 45.2699C212.346 43.5243 215.338 39.6341 215.338 34.3473C215.338 26.6666 209.603 22.3773 200.874 22.3773H177.732V58.1876H187.508V46.3173ZM187.508 38.5867V30.5568H200.376C203.817 30.5568 205.712 32.0531 205.712 34.5967C205.712 36.9907 203.817 38.5867 200.376 38.5867H187.508Z" fill="white"/>
<path d="M219.887 58.1876H245.472C253.452 58.1876 258.041 54.3971 258.041 48.0629C258.041 43.8236 255.348 40.9308 252.156 39.6341C254.35 38.5867 257.043 36.0929 257.043 32.1528C257.043 25.8187 252.555 22.3773 244.625 22.3773H219.887V58.1876ZM229.263 36.3922V30.3074H243.627C246.32 30.3074 247.817 31.3548 247.817 33.3498C247.817 35.3448 246.32 36.3922 243.627 36.3922H229.263ZM229.263 43.7238H244.525C247.168 43.7238 248.615 45.0206 248.615 46.9657C248.615 48.9108 247.168 50.2076 244.525 50.2076H229.263V43.7238Z" fill="white"/>
<path d="M281.942 21.7788C269.423 21.7788 260.396 29.6092 260.396 40.2824C260.396 50.9557 269.423 58.7861 281.942 58.7861C294.461 58.7861 303.438 50.9557 303.438 40.2824C303.438 29.6092 294.461 21.7788 281.942 21.7788ZM281.942 30.2576C288.525 30.2576 293.463 34.1478 293.463 40.2824C293.463 46.4171 288.525 50.3073 281.942 50.3073C275.359 50.3073 270.421 46.4171 270.421 40.2824C270.421 34.1478 275.359 30.2576 281.942 30.2576Z" fill="white"/>
<path d="M317.526 46.3173H327.251L334.932 58.1876H346.154L337.476 45.2699C342.364 43.5243 345.356 39.6341 345.356 34.3473C345.356 26.6666 339.62 22.3773 330.892 22.3773H307.75V58.1876H317.526V46.3173ZM317.526 38.5867V30.5568H330.394C333.835 30.5568 335.73 32.0531 335.73 34.5967C335.73 36.9907 333.835 38.5867 330.394 38.5867H317.526Z" fill="white"/>
<path d="M349.904 22.3773V58.1876H384.717V49.9083H359.48V44.0729H381.874V35.9932H359.48V30.6566H384.717V22.3773H349.904Z" fill="white"/>
<path d="M399.204 46.7662H412.221C420.95 46.7662 426.685 42.5767 426.685 34.5967C426.685 26.5668 420.95 22.3773 412.221 22.3773H389.428V58.1876H399.204V46.7662ZM399.204 38.6366V30.5568H411.673C415.164 30.5568 417.059 32.0531 417.059 34.5967C417.059 37.0904 415.164 38.6366 411.673 38.6366H399.204Z" fill="white"/>
<path d="M450.948 21.7788C438.43 21.7788 429.402 29.6092 429.402 40.2824C429.402 50.9557 438.43 58.7861 450.948 58.7861C463.467 58.7861 472.444 50.9557 472.444 40.2824C472.444 29.6092 463.467 21.7788 450.948 21.7788ZM450.948 30.2576C457.532 30.2576 462.469 34.1478 462.469 40.2824C462.469 46.4171 457.532 50.3073 450.948 50.3073C444.365 50.3073 439.427 46.4171 439.427 40.2824C439.427 34.1478 444.365 30.2576 450.948 30.2576Z" fill="white"/>
<path d="M38.5017 18.0956C27.2499 18.0956 18.0957 27.2498 18.0957 38.5016C18.0957 49.7534 27.2499 58.9076 38.5017 58.9076C49.7535 58.9076 58.9077 49.7534 58.9077 38.5016C58.9077 27.2498 49.7535 18.0956 38.5017 18.0956ZM38.5017 49.0618C32.6687 49.0618 27.9415 44.3346 27.9415 38.5016C27.9415 32.6686 32.6687 27.9414 38.5017 27.9414C44.3347 27.9414 49.0619 32.6686 49.0619 38.5016C49.0619 44.3346 44.3347 49.0618 38.5017 49.0618Z" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M40.2115 14.744V7.125C56.7719 8.0104 69.9275 21.7208 69.9275 38.5016C69.9275 55.2824 56.7719 68.989 40.2115 69.8782V62.2592C52.5539 61.3776 62.3275 51.0644 62.3275 38.5016C62.3275 25.9388 52.5539 15.6256 40.2115 14.744ZM20.5048 54.0815C17.233 50.3043 15.124 45.4935 14.7478 40.2115H7.125C7.5202 47.6025 10.4766 54.3095 15.1088 59.4737L20.501 54.0815H20.5048ZM36.7916 69.8782V62.2592C31.5058 61.883 26.695 59.7778 22.9178 56.5022L17.5256 61.8944C22.6936 66.5304 29.4006 69.483 36.7878 69.8782H36.7916Z" fill="url(#paint0_linear_2028_477)"/>
<defs>
<linearGradient id="paint0_linear_2028_477" x1="41.443" y1="11.5372" x2="10.5567" y2="42.4236" gradientUnits="userSpaceOnUse">
<stop stop-color="#0096FF"/>
<stop offset="1" stop-color="#FF1E56"/>
</linearGradient>
</defs>
</svg>
</file>

<file path="apps/docs/public/vercel.svg">
<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_977_547)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 3L18.5 17H2.5L10.5 3Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_977_547">
<rect width="16" height="16" fill="white" transform="translate(2.5 2)"/>
</clipPath>
</defs>
</svg>
</file>

<file path="apps/docs/public/window.svg">
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5H14.5V12.5C14.5 13.0523 14.0523 13.5 13.5 13.5H2.5C1.94772 13.5 1.5 13.0523 1.5 12.5V2.5ZM0 1H1.5H14.5H16V2.5V12.5C16 13.8807 14.8807 15 13.5 15H2.5C1.11929 15 0 13.8807 0 12.5V2.5V1ZM3.75 5.5C4.16421 5.5 4.5 5.16421 4.5 4.75C4.5 4.33579 4.16421 4 3.75 4C3.33579 4 3 4.33579 3 4.75C3 5.16421 3.33579 5.5 3.75 5.5ZM7 4.75C7 5.16421 6.66421 5.5 6.25 5.5C5.83579 5.5 5.5 5.16421 5.5 4.75C5.5 4.33579 5.83579 4 6.25 4C6.66421 4 7 4.33579 7 4.75ZM8.75 5.5C9.16421 5.5 9.5 5.16421 9.5 4.75C9.5 4.33579 9.16421 4 8.75 4C8.33579 4 8 4.33579 8 4.75C8 5.16421 8.33579 5.5 8.75 5.5Z" fill="#666666"/>
</svg>
</file>

<file path="apps/docs/.gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js
.yarn/install-state.gz

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# env files (can opt-in for commiting if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="apps/docs/eslint.config.js">
import { nextJsConfig } from "@moondesk/eslint-config/next-js";

/** @type {import("eslint").Linter.Config[]} */
export default nextJsConfig;
</file>

<file path="apps/docs/next.config.js">
/** @type {import('next').NextConfig} */
const nextConfig = {};

export default nextConfig;
</file>

<file path="apps/docs/package.json">
{
  "name": "docs",
  "version": "0.1.0",
  "type": "module",
  "private": true,
  "scripts": {
    "dev": "next dev --port 3001",
    "build": "next build",
    "start": "next start",
    "lint": "eslint --max-warnings 0",
    "check-types": "next typegen && tsc --noEmit"
  },
  "dependencies": {
    "@moondesk/ui": "workspace:*",
    "next": "^16.0.1",
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:*",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "@types/react": "19.2.2",
    "@types/react-dom": "19.2.2",
    "eslint": "^9.39.1",
    "typescript": "5.9.2"
  }
}
</file>

<file path="apps/docs/README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load Inter, a custom Google Font.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="apps/docs/tsconfig.json">
{
  "extends": "@moondesk/typescript-config/nextjs.json",
  "compilerOptions": {
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": [
    "**/*.ts",
    "**/*.tsx",
    "next-env.d.ts",
    "next.config.js",
    ".next/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
</file>

<file path="apps/edge-simulator/Dockerfile">
FROM node:22-alpine AS base
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable

FROM base AS builder
RUN apk add --no-cache libc6-compat
WORKDIR /app
COPY . .
RUN pnpm install --frozen-lockfile
RUN pnpm --filter @moondesk/edge-simulator build

FROM base AS runner
WORKDIR /app

# Copy root config files
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/pnpm-lock.yaml ./pnpm-lock.yaml
COPY --from=builder /app/pnpm-workspace.yaml ./pnpm-workspace.yaml

# Copy shared packages
COPY --from=builder /app/packages ./packages

# Copy app source and build
COPY --from=builder /app/apps/edge-simulator ./apps/edge-simulator

# Install production dependencies
RUN pnpm install --prod --frozen-lockfile

ENV NODE_ENV=production
WORKDIR /app/apps/edge-simulator

CMD ["node", "dist/main.js"]
</file>

<file path="apps/edge-simulator/eslint.config.mjs">
import { config } from "@moondesk/eslint-config/base";

export default [...config];
</file>

<file path="apps/edge-simulator/tsconfig.json">
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "outDir": "dist",
        "rootDir": "src"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
</file>

<file path="apps/moondesk-dash/.husky/pre-commit">
npm run generate:presets
git add src/types/preferences/theme.ts
npx lint-staged
</file>

<file path="apps/moondesk-dash/src/app/(external)/page.tsx">
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Factory, Gauge, Zap } from "lucide-react";

import { Button } from "@/components/ui/button";

export default async function Home() {
  const { userId } = await auth();

  // If user is signed in, redirect to dashboard
  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900">
      <div className="container mx-auto px-4 text-center">
        <div className="mb-8 flex justify-center gap-4">
          <Factory className="h-12 w-12 text-slate-700 dark:text-slate-300" />
          <Gauge className="h-12 w-12 text-slate-700 dark:text-slate-300" />
          <Zap className="h-12 w-12 text-slate-700 dark:text-slate-300" />
        </div>

        <h1 className="mb-4 text-4xl font-bold tracking-tight text-slate-900 sm:text-6xl dark:text-slate-100">
          Industrial IoT Dashboard
        </h1>

        <p className="mb-8 text-lg text-slate-600 sm:text-xl dark:text-slate-400">
          Monitor and manage your industrial assets in real-time.
          <br />
          Solar Panels, PLCs, Sensors, and more.
        </p>

        <div className="flex flex-col items-center justify-center gap-4 sm:flex-row">
          <Link href="/auth/v2/login">
            <Button size="lg" variant="outline" className="min-w-[140px]">
              Sign In
            </Button>
          </Link>
          <Link href="/auth/v2/register">
            <Button size="lg" className="min-w-[140px]">
              Get Started
            </Button>
          </Link>
        </div>

        <div className="mt-16 grid gap-8 sm:grid-cols-3">
          <div className="rounded-lg border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900">
            <Factory className="mx-auto mb-4 h-8 w-8 text-slate-700 dark:text-slate-300" />
            <h3 className="mb-2 font-semibold text-slate-900 dark:text-slate-100">Device Management</h3>
            <p className="text-sm text-slate-600 dark:text-slate-400">
              Provision and monitor industrial devices with ease
            </p>
          </div>

          <div className="rounded-lg border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900">
            <Gauge className="mx-auto mb-4 h-8 w-8 text-slate-700 dark:text-slate-300" />
            <h3 className="mb-2 font-semibold text-slate-900 dark:text-slate-100">Real-time Monitoring</h3>
            <p className="text-sm text-slate-600 dark:text-slate-400">
              Track telemetry data and device status in real-time
            </p>
          </div>

          <div className="rounded-lg border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900">
            <Zap className="mx-auto mb-4 h-8 w-8 text-slate-700 dark:text-slate-300" />
            <h3 className="mb-2 font-semibold text-slate-900 dark:text-slate-100">Multi-tenancy</h3>
            <p className="text-sm text-slate-600 dark:text-slate-400">
              Manage multiple organizations and teams securely
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/_components/social-auth/google-button.tsx">
"use client";

import { useSignIn } from "@clerk/nextjs";
import { siGoogle } from "simple-icons";
import { toast } from "sonner";

import { SimpleIcon } from "@/components/simple-icon";
import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";

export function GoogleButton({ className, ...props }: React.ComponentProps<typeof Button>) {
  const { signIn, isLoaded } = useSignIn();

  const signInWithGoogle = async () => {
    if (!isLoaded) return;

    try {
      await signIn.authenticateWithRedirect({
        strategy: "oauth_google",
        redirectUrl: "/sso-callback",
        redirectUrlComplete: "/dashboard/iiot",
      });
    } catch (err: unknown) {
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Failed to sign in with Google");
    }
  };

  return (
    <Button variant="secondary" className={cn(className)} onClick={signInWithGoogle} {...props}>
      <SimpleIcon icon={siGoogle} className="size-4" />
      Continue with Google
    </Button>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/_components/login-form.tsx">
"use client";

import { useState } from "react";

import { useRouter } from "next/navigation";

import { useSignIn } from "@clerk/nextjs";
import { zodResolver } from "@hookform/resolvers/zod";
import { useForm } from "react-hook-form";
import { toast } from "sonner";
import { z } from "zod";

import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";

const FormSchema = z.object({
  email: z.string().email({ message: "Please enter a valid email address." }),
  password: z.string().min(6, { message: "Password must be at least 6 characters." }),
  remember: z.boolean().optional(),
});

export function LoginForm() {
  const { isLoaded, signIn, setActive } = useSignIn();
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);

  const form = useForm<z.infer<typeof FormSchema>>({
    resolver: zodResolver(FormSchema),
    defaultValues: {
      email: "",
      password: "",
      remember: false,
    },
  });

  const onSubmit = async (data: z.infer<typeof FormSchema>) => {
    if (!isLoaded) return;

    setIsLoading(true);
    try {
      const result = await signIn.create({
        identifier: data.email,
        password: data.password,
      });

      if (result.status === "complete") {
        await setActive({ session: result.createdSessionId });
        toast.success("Welcome back!");
        router.push("/dashboard/iiot");
      }
    } catch (err: unknown) {
      // Clerk errors usually follow this structure
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Invalid email or password");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email Address</FormLabel>
              <FormControl>
                <Input id="email" type="email" placeholder="you@example.com" autoComplete="email" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="password"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Password</FormLabel>
              <FormControl>
                <Input
                  id="password"
                  type="password"
                  placeholder="••••••••"
                  autoComplete="current-password"
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="remember"
          render={({ field }) => (
            <FormItem className="flex flex-row items-center">
              <FormControl>
                <Checkbox
                  id="login-remember"
                  checked={field.value}
                  onCheckedChange={field.onChange}
                  className="size-4"
                />
              </FormControl>
              <FormLabel htmlFor="login-remember" className="text-muted-foreground ml-1 text-sm font-medium">
                Remember me for 30 days
              </FormLabel>
            </FormItem>
          )}
        />
        <Button className="w-full" type="submit" disabled={isLoading}>
          {isLoading ? "Logging in..." : "Login"}
        </Button>
      </form>
    </Form>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/_components/register-form.tsx">
"use client";

import { useState } from "react";

import { useRouter } from "next/navigation";

import { useSignUp } from "@clerk/nextjs";
import { zodResolver } from "@hookform/resolvers/zod";
import { useForm } from "react-hook-form";
import { toast } from "sonner";
import { z } from "zod";

import { Button } from "@/components/ui/button";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";

const FormSchema = z
  .object({
    email: z.string().email({ message: "Please enter a valid email address." }),
    password: z.string().min(8, { message: "Password must be at least 8 characters." }),
    confirmPassword: z.string().min(8, { message: "Confirm Password must be at least 8 characters." }),
  })
  .refine((data) => data.password === data.confirmPassword, {
    message: "Passwords do not match.",
    path: ["confirmPassword"],
  });

export function RegisterForm() {
  const { isLoaded, signUp, setActive } = useSignUp();
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  const [pendingVerification, setPendingVerification] = useState(false);
  const [code, setCode] = useState("");

  const form = useForm<z.infer<typeof FormSchema>>({
    resolver: zodResolver(FormSchema),
    defaultValues: {
      email: "",
      password: "",
      confirmPassword: "",
    },
  });

  const onSubmit = async (data: z.infer<typeof FormSchema>) => {
    if (!isLoaded) return;

    setIsLoading(true);
    try {
      await signUp.create({
        emailAddress: data.email,
        password: data.password,
      });

      await signUp.prepareEmailAddressVerification({ strategy: "email_code" });
      setPendingVerification(true);
      toast.success("Verification code sent to your email");
    } catch (err: unknown) {
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Failed to create account");
    } finally {
      setIsLoading(false);
    }
  };

  const onVerify = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!isLoaded) return;

    setIsLoading(true);
    try {
      const result = await signUp.attemptEmailAddressVerification({ code });

      if (result.status === "complete") {
        await setActive({ session: result.createdSessionId });
        toast.success("Account created successfully!");
        router.push("/dashboard/iiot");
      }
    } catch (err: unknown) {
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Invalid verification code");
    } finally {
      setIsLoading(false);
    }
  };

  if (pendingVerification) {
    return (
      <form onSubmit={onVerify} className="space-y-4">
        <div className="space-y-2">
          <label htmlFor="code" className="text-sm font-medium">
            Verification Code
          </label>
          <Input
            id="code"
            value={code}
            onChange={(e) => setCode(e.target.value)}
            placeholder="Enter verification code"
          />
          <p className="text-muted-foreground text-xs">Check your email for the verification code</p>
        </div>
        <Button className="w-full" type="submit" disabled={isLoading}>
          {isLoading ? "Verifying..." : "Verify Email"}
        </Button>
      </form>
    );
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email Address</FormLabel>
              <FormControl>
                <Input id="email" type="email" placeholder="you@example.com" autoComplete="email" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="password"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Password</FormLabel>
              <FormControl>
                <Input id="password" type="password" placeholder="••••••••" autoComplete="new-password" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="confirmPassword"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Confirm Password</FormLabel>
              <FormControl>
                <Input
                  id="confirmPassword"
                  type="password"
                  placeholder="••••••••"
                  autoComplete="new-password"
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <Button className="w-full" type="submit" disabled={isLoading}>
          {isLoading ? "Creating account..." : "Register"}
        </Button>
      </form>
    </Form>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/v1/login/page.tsx">
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Factory } from "lucide-react";

import { LoginForm } from "../../_components/login-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function LoginV1() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <div className="flex h-dvh">
      <div className="bg-primary hidden lg:block lg:w-1/3">
        <div className="flex h-full flex-col items-center justify-center p-12 text-center">
          <div className="space-y-6">
            <Factory className="text-primary-foreground mx-auto size-12" />
            <div className="space-y-2">
              <h1 className="text-primary-foreground text-5xl font-light">Hello again</h1>
              <p className="text-primary-foreground/80 text-xl">Login to continue</p>
            </div>
          </div>
        </div>
      </div>

      <div className="bg-background flex w-full items-center justify-center p-8 lg:w-2/3">
        <div className="w-full max-w-md space-y-10 py-24 lg:py-32">
          <div className="space-y-4 text-center">
            <div className="font-medium tracking-tight">Login</div>
            <div className="text-muted-foreground mx-auto max-w-xl">
              Welcome back to Moondesk. Monitor your industrial assets in real-time.
            </div>
          </div>
          <div className="space-y-4">
            <LoginForm />
            <GoogleButton className="w-full" variant="outline" />
            <p className="text-muted-foreground text-center text-xs">
              Don&apos;t have an account?{" "}
              <Link href="register" className="text-primary">
                Register
              </Link>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/v1/register/page.tsx">
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Factory } from "lucide-react";

import { RegisterForm } from "../../_components/register-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function RegisterV1() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <div className="flex h-dvh">
      <div className="bg-background flex w-full items-center justify-center p-8 lg:w-2/3">
        <div className="w-full max-w-md space-y-10 py-24 lg:py-32">
          <div className="space-y-4 text-center">
            <div className="font-medium tracking-tight">Register</div>
            <div className="text-muted-foreground mx-auto max-w-xl">
              Create your Moondesk account and start monitoring your industrial assets.
            </div>
          </div>
          <div className="space-y-4">
            <RegisterForm />
            <GoogleButton className="w-full" variant="outline" />
            <p className="text-muted-foreground text-center text-xs">
              Already have an account?{" "}
              <Link href="login" className="text-primary">
                Login
              </Link>
            </p>
          </div>
        </div>
      </div>

      <div className="bg-primary hidden lg:block lg:w-1/3">
        <div className="flex h-full flex-col items-center justify-center p-12 text-center">
          <div className="space-y-6">
            <Factory className="text-primary-foreground mx-auto size-12" />
            <div className="space-y-2">
              <h1 className="text-primary-foreground text-5xl font-light">Welcome!</h1>
              <p className="text-primary-foreground/80 text-xl">You&apos;re in the right place.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/v2/login/page.tsx">
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Globe } from "lucide-react";

import { APP_CONFIG } from "@/config";

import { LoginForm } from "../../_components/login-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function LoginV2() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <>
      <div className="mx-auto flex w-full flex-col justify-center space-y-8 sm:w-[350px]">
        <div className="space-y-2 text-center">
          <h1 className="text-3xl font-medium">Login to your account</h1>
          <p className="text-muted-foreground text-sm">Please enter your details to login.</p>
        </div>
        <div className="space-y-4">
          <GoogleButton className="w-full" />
          <div className="after:border-border relative text-center text-sm after:absolute after:inset-0 after:top-1/2 after:z-0 after:flex after:items-center after:border-t">
            <span className="bg-background text-muted-foreground relative z-10 px-2">Or continue with</span>
          </div>
          <LoginForm />
        </div>
      </div>

      <div className="absolute top-5 flex w-full justify-end px-10">
        <div className="text-muted-foreground text-sm">
          Don&apos;t have an account?{" "}
          <Link className="text-foreground" href="register">
            Register
          </Link>
        </div>
      </div>

      <div className="absolute bottom-5 flex w-full justify-between px-10">
        <div className="text-sm">{APP_CONFIG.copyright}</div>
        <div className="flex items-center gap-1 text-sm">
          <Globe className="text-muted-foreground size-4" />
          ENG
        </div>
      </div>
    </>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/v2/register/page.tsx">
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Globe } from "lucide-react";

import { APP_CONFIG } from "@/config";

import { RegisterForm } from "../../_components/register-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function RegisterV2() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <>
      <div className="mx-auto flex w-full flex-col justify-center space-y-8 sm:w-[350px]">
        <div className="space-y-2 text-center">
          <h1 className="text-3xl font-medium">Create your account</h1>
          <p className="text-muted-foreground text-sm">Please enter your details to register.</p>
        </div>
        <div className="space-y-4">
          <GoogleButton className="w-full" />
          <div className="after:border-border relative text-center text-sm after:absolute after:inset-0 after:top-1/2 after:z-0 after:flex after:items-center after:border-t">
            <span className="bg-background text-muted-foreground relative z-10 px-2">Or continue with</span>
          </div>
          <RegisterForm />
        </div>
      </div>

      <div className="absolute top-5 flex w-full justify-end px-10">
        <div className="text-muted-foreground text-sm">
          Already have an account?{" "}
          <Link className="text-foreground" href="login">
            Login
          </Link>
        </div>
      </div>

      <div className="absolute bottom-5 flex w-full justify-between px-10">
        <div className="text-sm">{APP_CONFIG.copyright}</div>
        <div className="flex items-center gap-1 text-sm">
          <Globe className="text-muted-foreground size-4" />
          ENG
        </div>
      </div>
    </>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/auth/v2/layout.tsx">
import { ReactNode } from "react";

import { Factory } from "lucide-react";

import { Separator } from "@/components/ui/separator";
import { APP_CONFIG } from "@/config";

export default function Layout({ children }: Readonly<{ children: ReactNode }>) {
  return (
    <main>
      <div className="grid h-dvh justify-center p-2 lg:grid-cols-2">
        <div className="bg-primary relative order-2 hidden h-full rounded-3xl lg:flex">
          <div className="text-primary-foreground absolute top-10 space-y-1 px-10">
            <Factory className="size-10" />
            <h1 className="text-2xl font-medium">{APP_CONFIG.name}</h1>
            <p className="text-sm">Industrial IoT Dashboard</p>
          </div>

          <div className="absolute bottom-10 flex w-full justify-between px-10">
            <div className="text-primary-foreground flex-1 space-y-1">
              <h2 className="font-medium">Real-time Monitoring</h2>
              <p className="text-sm">Track your solar panels, PLCs, sensors, and industrial devices in real-time.</p>
            </div>
            <Separator orientation="vertical" className="mx-3 !h-auto" />
            <div className="text-primary-foreground flex-1 space-y-1">
              <h2 className="font-medium">Multi-tenancy</h2>
              <p className="text-sm">
                Secure organization-based access control for managing multiple teams and assets.
              </p>
            </div>
          </div>
        </div>
        <div className="relative order-1 flex h-full">{children}</div>
      </div>
    </main>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/account-switcher.tsx">
"use client";

import { useState } from "react";

import { BadgeCheck, Bell, CreditCard, LogOut } from "lucide-react";

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
  DropdownMenuGroup,
} from "@/components/ui/dropdown-menu";
import { cn, getInitials } from "@/lib/utils";

export function AccountSwitcher({
  users,
}: {
  readonly users: ReadonlyArray<{
    readonly id: string;
    readonly name: string;
    readonly email: string;
    readonly avatar: string;
    readonly role: string;
  }>;
}) {
  const [activeUser, setActiveUser] = useState(users[0]);

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Avatar className="size-9 rounded-lg">
          <AvatarImage src={activeUser.avatar || undefined} alt={activeUser.name} />
          <AvatarFallback className="rounded-lg">{getInitials(activeUser.name)}</AvatarFallback>
        </Avatar>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="min-w-56 space-y-1 rounded-lg" side="bottom" align="end" sideOffset={4}>
        {users.map((user) => (
          <DropdownMenuItem
            key={user.email}
            className={cn("p-0", user.id === activeUser.id && "bg-accent/50 border-l-primary border-l-2")}
            onClick={() => setActiveUser(user)}
          >
            <div className="flex w-full items-center justify-between gap-2 px-1 py-1.5">
              <Avatar className="size-9 rounded-lg">
                <AvatarImage src={user.avatar || undefined} alt={user.name} />
                <AvatarFallback className="rounded-lg">{getInitials(user.name)}</AvatarFallback>
              </Avatar>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-semibold">{user.name}</span>
                <span className="truncate text-xs capitalize">{user.role}</span>
              </div>
            </div>
          </DropdownMenuItem>
        ))}
        <DropdownMenuSeparator />
        <DropdownMenuGroup>
          <DropdownMenuItem>
            <BadgeCheck />
            Account
          </DropdownMenuItem>
          <DropdownMenuItem>
            <CreditCard />
            Billing
          </DropdownMenuItem>
          <DropdownMenuItem>
            <Bell />
            Notifications
          </DropdownMenuItem>
        </DropdownMenuGroup>
        <DropdownMenuSeparator />
        <DropdownMenuItem>
          <LogOut />
          Log out
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/app-sidebar.tsx">
"use client";

import Link from "next/link";

import { Command } from "lucide-react";

import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
} from "@/components/ui/sidebar";
import { APP_CONFIG } from "@/config";
import { sidebarItems } from "@/navigation/sidebar/sidebar-items";

import { NavMain } from "./nav-main";
import { NavUserClerk } from "./nav-user-clerk";

export function AppSidebar({ ...props }: React.ComponentProps<typeof Sidebar>) {
  return (
    <Sidebar {...props}>
      <SidebarHeader>
        <SidebarMenu>
          <SidebarMenuItem>
            <SidebarMenuButton asChild className="data-[slot=sidebar-menu-button]:!p-1.5">
              <Link href="/dashboard/default">
                <Command />
                <span className="text-base font-semibold">{APP_CONFIG.name}</span>
              </Link>
            </SidebarMenuButton>
          </SidebarMenuItem>
        </SidebarMenu>
      </SidebarHeader>
      <SidebarContent>
        <NavMain items={sidebarItems} />
      </SidebarContent>
      <SidebarFooter>
        <NavUserClerk />
      </SidebarFooter>
    </Sidebar>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/clerk-auth.tsx">
"use client";

import { SignInButton, SignUpButton, SignedIn, SignedOut, UserButton, OrganizationSwitcher } from "@clerk/nextjs";

import { Button } from "@/components/ui/button";

export function ClerkAuth() {
  return (
    <>
      <SignedOut>
        <div className="flex items-center gap-2">
          <SignInButton mode="modal">
            <Button variant="ghost" size="sm">
              Sign In
            </Button>
          </SignInButton>
          <SignUpButton mode="modal">
            <Button size="sm" className="bg-primary text-primary-foreground">
              Sign Up
            </Button>
          </SignUpButton>
        </div>
      </SignedOut>
      <SignedIn>
        <UserButton
          appearance={{
            elements: {
              avatarBox: "size-9 rounded-lg",
            },
          }}
        />
      </SignedIn>
    </>
  );
}

export function ClerkOrgSwitcher() {
  return (
    <SignedIn>
      <OrganizationSwitcher
        appearance={{
          elements: {
            rootBox: "flex items-center",
            organizationSwitcherTrigger:
              "rounded-lg border border-input bg-background hover:bg-accent hover:text-accent-foreground px-3 py-2",
          },
        }}
        hidePersonal={false}
        afterCreateOrganizationUrl="/organization"
        afterSelectOrganizationUrl="/dashboard"
      />
    </SignedIn>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-documents.tsx">
"use client";

import { LucideIcon, Ellipsis, Folder, Forward, Trash2 } from "lucide-react";

import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  SidebarGroup,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuButton,
  SidebarMenuItem,
  useSidebar,
} from "@/components/ui/sidebar";

export function NavDocuments({
  items,
}: {
  readonly items: readonly {
    readonly name: string;
    readonly url: string;
    readonly icon: LucideIcon;
  }[];
}) {
  const { isMobile } = useSidebar();

  return (
    <SidebarGroup className="group-data-[collapsible=icon]:hidden">
      <SidebarGroupLabel>Documents</SidebarGroupLabel>
      <SidebarMenu>
        {items.map((item) => (
          <SidebarMenuItem key={item.name}>
            <SidebarMenuButton asChild>
              <a href={item.url}>
                <item.icon />
                <span>{item.name}</span>
              </a>
            </SidebarMenuButton>
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <SidebarMenuAction showOnHover className="data-[state=open]:bg-accent rounded-sm">
                  <Ellipsis />
                  <span className="sr-only">More</span>
                </SidebarMenuAction>
              </DropdownMenuTrigger>
              <DropdownMenuContent
                className="w-24 rounded-lg"
                side={isMobile ? "bottom" : "right"}
                align={isMobile ? "end" : "start"}
              >
                <DropdownMenuItem>
                  <Folder />
                  <span>Open</span>
                </DropdownMenuItem>
                <DropdownMenuItem>
                  <Forward />
                  <span>Share</span>
                </DropdownMenuItem>
                <DropdownMenuSeparator />
                <DropdownMenuItem variant="destructive">
                  <Trash2 />
                  <span>Delete</span>
                </DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>
          </SidebarMenuItem>
        ))}
        <SidebarMenuItem>
          <SidebarMenuButton className="text-sidebar-foreground/70">
            <Ellipsis className="text-sidebar-foreground/70" />
            <span>More</span>
          </SidebarMenuButton>
        </SidebarMenuItem>
      </SidebarMenu>
    </SidebarGroup>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-main.tsx">
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";

import { PlusCircleIcon, MailIcon, ChevronRight } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from "@/components/ui/collapsible";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  useSidebar,
} from "@/components/ui/sidebar";
import { type NavGroup, type NavMainItem } from "@/navigation/sidebar/sidebar-items";

interface NavMainProps {
  readonly items: readonly NavGroup[];
}

const IsComingSoon = () => (
  <span className="ml-auto rounded-md bg-gray-200 px-2 py-1 text-xs dark:text-gray-800">Soon</span>
);

const NavItemExpanded = ({
  item,
  isActive,
  isSubmenuOpen,
}: {
  item: NavMainItem;
  isActive: (url: string, subItems?: NavMainItem["subItems"]) => boolean;
  isSubmenuOpen: (subItems?: NavMainItem["subItems"]) => boolean;
}) => {
  return (
    <Collapsible key={item.title} asChild defaultOpen={isSubmenuOpen(item.subItems)} className="group/collapsible">
      <SidebarMenuItem>
        <CollapsibleTrigger asChild>
          {item.subItems ? (
            <SidebarMenuButton
              disabled={item.comingSoon}
              isActive={isActive(item.url, item.subItems)}
              tooltip={item.title}
            >
              {item.icon && <item.icon />}
              <span>{item.title}</span>
              {item.comingSoon && <IsComingSoon />}
              <ChevronRight className="ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90" />
            </SidebarMenuButton>
          ) : (
            <SidebarMenuButton
              asChild
              aria-disabled={item.comingSoon}
              isActive={isActive(item.url)}
              tooltip={item.title}
            >
              <Link href={item.url} target={item.newTab ? "_blank" : undefined}>
                {item.icon && <item.icon />}
                <span>{item.title}</span>
                {item.comingSoon && <IsComingSoon />}
              </Link>
            </SidebarMenuButton>
          )}
        </CollapsibleTrigger>
        {item.subItems && (
          <CollapsibleContent>
            <SidebarMenuSub>
              {item.subItems.map((subItem) => (
                <SidebarMenuSubItem key={subItem.title}>
                  <SidebarMenuSubButton aria-disabled={subItem.comingSoon} isActive={isActive(subItem.url)} asChild>
                    <Link href={subItem.url} target={subItem.newTab ? "_blank" : undefined}>
                      {subItem.icon && <subItem.icon />}
                      <span>{subItem.title}</span>
                      {subItem.comingSoon && <IsComingSoon />}
                    </Link>
                  </SidebarMenuSubButton>
                </SidebarMenuSubItem>
              ))}
            </SidebarMenuSub>
          </CollapsibleContent>
        )}
      </SidebarMenuItem>
    </Collapsible>
  );
};

const NavItemCollapsed = ({
  item,
  isActive,
}: {
  item: NavMainItem;
  isActive: (url: string, subItems?: NavMainItem["subItems"]) => boolean;
}) => {
  return (
    <SidebarMenuItem key={item.title}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <SidebarMenuButton
            disabled={item.comingSoon}
            tooltip={item.title}
            isActive={isActive(item.url, item.subItems)}
          >
            {item.icon && <item.icon />}
            <span>{item.title}</span>
            <ChevronRight />
          </SidebarMenuButton>
        </DropdownMenuTrigger>
        <DropdownMenuContent className="w-50 space-y-1" side="right" align="start">
          {item.subItems?.map((subItem) => (
            <DropdownMenuItem key={subItem.title} asChild>
              <SidebarMenuSubButton
                key={subItem.title}
                asChild
                className="focus-visible:ring-0"
                aria-disabled={subItem.comingSoon}
                isActive={isActive(subItem.url)}
              >
                <Link href={subItem.url} target={subItem.newTab ? "_blank" : undefined}>
                  {subItem.icon && <subItem.icon className="[&>svg]:text-sidebar-foreground" />}
                  <span>{subItem.title}</span>
                  {subItem.comingSoon && <IsComingSoon />}
                </Link>
              </SidebarMenuSubButton>
            </DropdownMenuItem>
          ))}
        </DropdownMenuContent>
      </DropdownMenu>
    </SidebarMenuItem>
  );
};

export function NavMain({ items }: NavMainProps) {
  const path = usePathname();
  const { state, isMobile } = useSidebar();

  const isItemActive = (url: string, subItems?: NavMainItem["subItems"]) => {
    if (subItems?.length) {
      return subItems.some((sub) => path.startsWith(sub.url));
    }
    return path === url;
  };

  const isSubmenuOpen = (subItems?: NavMainItem["subItems"]) => {
    return subItems?.some((sub) => path.startsWith(sub.url)) ?? false;
  };

  return (
    <>
      <SidebarGroup>
        <SidebarGroupContent className="flex flex-col gap-2">
          <SidebarMenu>
            <SidebarMenuItem className="flex items-center gap-2">
              <SidebarMenuButton
                tooltip="Quick Create"
                className="bg-primary text-primary-foreground hover:bg-primary/90 hover:text-primary-foreground active:bg-primary/90 active:text-primary-foreground min-w-8 duration-200 ease-linear"
              >
                <PlusCircleIcon />
                <span>Quick Create</span>
              </SidebarMenuButton>
              <Button
                size="icon"
                className="h-9 w-9 shrink-0 group-data-[collapsible=icon]:opacity-0"
                variant="outline"
              >
                <MailIcon />
                <span className="sr-only">Inbox</span>
              </Button>
            </SidebarMenuItem>
          </SidebarMenu>
        </SidebarGroupContent>
      </SidebarGroup>
      {items.map((group) => (
        <SidebarGroup key={group.id}>
          {group.label && <SidebarGroupLabel>{group.label}</SidebarGroupLabel>}
          <SidebarGroupContent className="flex flex-col gap-2">
            <SidebarMenu>
              {group.items.map((item) => {
                if (state === "collapsed" && !isMobile) {
                  // If no subItems, just render the button as a link
                  if (!item.subItems) {
                    return (
                      <SidebarMenuItem key={item.title}>
                        <SidebarMenuButton
                          asChild
                          aria-disabled={item.comingSoon}
                          tooltip={item.title}
                          isActive={isItemActive(item.url)}
                        >
                          <Link href={item.url} target={item.newTab ? "_blank" : undefined}>
                            {item.icon && <item.icon />}
                            <span>{item.title}</span>
                          </Link>
                        </SidebarMenuButton>
                      </SidebarMenuItem>
                    );
                  }
                  // Otherwise, render the dropdown as before
                  return <NavItemCollapsed key={item.title} item={item} isActive={isItemActive} />;
                }
                // Expanded view
                return (
                  <NavItemExpanded key={item.title} item={item} isActive={isItemActive} isSubmenuOpen={isSubmenuOpen} />
                );
              })}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      ))}
    </>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-secondary.tsx">
"use client";

import * as React from "react";

import { LucideIcon } from "lucide-react";

import {
  SidebarGroup,
  SidebarGroupContent,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
} from "@/components/ui/sidebar";

export function NavSecondary({
  items,
  ...props
}: {
  items: {
    title: string;
    url: string;
    icon: LucideIcon;
  }[];
} & React.ComponentPropsWithoutRef<typeof SidebarGroup>) {
  return (
    <SidebarGroup {...props}>
      <SidebarGroupContent>
        <SidebarMenu>
          {items.map((item) => (
            <SidebarMenuItem key={item.title}>
              <SidebarMenuButton asChild>
                <a href={item.url}>
                  <item.icon />
                  <span>{item.title}</span>
                </a>
              </SidebarMenuButton>
            </SidebarMenuItem>
          ))}
        </SidebarMenu>
      </SidebarGroupContent>
    </SidebarGroup>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-user-clerk.tsx">
"use client";

import { useUser, useClerk } from "@clerk/nextjs";
import { EllipsisVertical, CircleUser, CreditCard, MessageSquareDot, LogOut } from "lucide-react";

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { SidebarMenu, SidebarMenuButton, SidebarMenuItem, useSidebar } from "@/components/ui/sidebar";
import { getInitials } from "@/lib/utils";

export function NavUserClerk() {
  const { isMobile } = useSidebar();
  const { user } = useUser();
  const { signOut, openUserProfile } = useClerk();

  if (!user) {
    return null;
  }

  const userName = user.fullName ?? user.username ?? "User";
  const userEmail = user.primaryEmailAddress?.emailAddress ?? "";
  const userAvatar = user.imageUrl;

  return (
    <SidebarMenu>
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <SidebarMenuButton
              size="lg"
              className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground"
            >
              <Avatar className="h-8 w-8 rounded-lg">
                <AvatarImage src={userAvatar} alt={userName} />
                <AvatarFallback className="rounded-lg">{getInitials(userName)}</AvatarFallback>
              </Avatar>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-medium">{userName}</span>
                <span className="text-muted-foreground truncate text-xs">{userEmail}</span>
              </div>
              <EllipsisVertical className="ml-auto size-4" />
            </SidebarMenuButton>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            className="w-(--radix-dropdown-menu-trigger-width) min-w-56 rounded-lg"
            side={isMobile ? "bottom" : "right"}
            align="end"
            sideOffset={4}
          >
            <DropdownMenuLabel className="p-0 font-normal">
              <div className="flex items-center gap-2 px-1 py-1.5 text-left text-sm">
                <Avatar className="h-8 w-8 rounded-lg">
                  <AvatarImage src={userAvatar} alt={userName} />
                  <AvatarFallback className="rounded-lg">{getInitials(userName)}</AvatarFallback>
                </Avatar>
                <div className="grid flex-1 text-left text-sm leading-tight">
                  <span className="truncate font-medium">{userName}</span>
                  <span className="text-muted-foreground truncate text-xs">{userEmail}</span>
                </div>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuGroup>
              <DropdownMenuItem onClick={() => openUserProfile()}>
                <CircleUser />
                Account
              </DropdownMenuItem>
              <DropdownMenuItem>
                <CreditCard />
                Billing
              </DropdownMenuItem>
              <DropdownMenuItem>
                <MessageSquareDot />
                Notifications
              </DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator />
            <DropdownMenuItem onClick={() => signOut()}>
              <LogOut />
              Log out
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    </SidebarMenu>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-user.tsx">
"use client";

import { EllipsisVertical, CircleUser, CreditCard, MessageSquareDot, LogOut } from "lucide-react";

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { SidebarMenu, SidebarMenuButton, SidebarMenuItem, useSidebar } from "@/components/ui/sidebar";
import { getInitials } from "@/lib/utils";

export function NavUser({
  user,
}: {
  readonly user: {
    readonly name: string;
    readonly email: string;
    readonly avatar: string;
  };
}) {
  const { isMobile } = useSidebar();

  return (
    <SidebarMenu>
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <SidebarMenuButton
              size="lg"
              className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground"
            >
              <Avatar className="h-8 w-8 rounded-lg grayscale">
                <AvatarImage src={user.avatar || undefined} alt={user.name} />
                <AvatarFallback className="rounded-lg">{getInitials(user.name)}</AvatarFallback>
              </Avatar>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-medium">{user.name}</span>
                <span className="text-muted-foreground truncate text-xs">{user.email}</span>
              </div>
              <EllipsisVertical className="ml-auto size-4" />
            </SidebarMenuButton>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            className="w-(--radix-dropdown-menu-trigger-width) min-w-56 rounded-lg"
            side={isMobile ? "bottom" : "right"}
            align="end"
            sideOffset={4}
          >
            <DropdownMenuLabel className="p-0 font-normal">
              <div className="flex items-center gap-2 px-1 py-1.5 text-left text-sm">
                <Avatar className="h-8 w-8 rounded-lg">
                  <AvatarImage src={user.avatar || undefined} alt={user.name} />
                  <AvatarFallback className="rounded-lg">{getInitials(user.name)}</AvatarFallback>
                </Avatar>
                <div className="grid flex-1 text-left text-sm leading-tight">
                  <span className="truncate font-medium">{user.name}</span>
                  <span className="text-muted-foreground truncate text-xs">{user.email}</span>
                </div>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuGroup>
              <DropdownMenuItem>
                <CircleUser />
                Account
              </DropdownMenuItem>
              <DropdownMenuItem>
                <CreditCard />
                Billing
              </DropdownMenuItem>
              <DropdownMenuItem>
                <MessageSquareDot />
                Notifications
              </DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator />
            <DropdownMenuItem>
              <LogOut />
              Log out
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    </SidebarMenu>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/theme-switcher.tsx">
"use client";

import { Moon, Sun } from "lucide-react";

import { Button } from "@/components/ui/button";
import { updateThemeMode } from "@/lib/theme-utils";
import { setValueToCookie } from "@/server/server-actions";
import { usePreferencesStore } from "@/stores/preferences/preferences-provider";

export function ThemeSwitcher() {
  const themeMode = usePreferencesStore((s) => s.themeMode);
  const setThemeMode = usePreferencesStore((s) => s.setThemeMode);

  const handleValueChange = async () => {
    const newTheme = themeMode === "dark" ? "light" : "dark";
    updateThemeMode(newTheme);
    setThemeMode(newTheme);
    await setValueToCookie("theme_mode", newTheme);
  };

  return (
    <Button size="icon" onClick={handleValueChange}>
      {themeMode === "dark" ? <Sun /> : <Moon />}
    </Button>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/[...not-found]/page.tsx">
"use client";

export default function DashboardNotFound() {
  return (
    <div className="flex h-full flex-col items-center justify-center space-y-2 text-center">
      <h1 className="text-2xl font-semibold">Page not found.</h1>
      <p className="text-muted-foreground">This section will be added in future updates.</p>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/performance-metrics.tsx">
"use client";

import { Area, AreaChart, CartesianGrid, XAxis } from "recharts";

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";

const performanceData = Array.from({ length: 24 }, (_, i) => ({
  hour: `${i}:00`,
  responseTime: 50 + Math.random() * 100,
  throughput: 1000 + Math.random() * 500,
}));

export function PerformanceMetrics() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Performance Metrics</CardTitle>
        <CardDescription>Response time and throughput over 24 hours</CardDescription>
      </CardHeader>
      <CardContent>
        <ChartContainer
          config={{
            responseTime: { label: "Response Time (ms)", color: "hsl(var(--chart-1))" },
            throughput: { label: "Throughput (req/s)", color: "hsl(var(--chart-2))" },
          }}
        >
          <AreaChart accessibilityLayer data={performanceData} margin={{ left: 12, right: 12 }}>
            <CartesianGrid vertical={false} />
            <XAxis dataKey="hour" tickLine={false} axisLine={false} tickMargin={8} minTickGap={32} />
            <ChartTooltip cursor={false} content={<ChartTooltipContent indicator="dot" />} />
            <Area
              dataKey="responseTime"
              type="natural"
              fill="var(--color-responseTime)"
              fillOpacity={0.4}
              stroke="var(--color-responseTime)"
              stackId="a"
            />
            <Area
              dataKey="throughput"
              type="natural"
              fill="var(--color-throughput)"
              fillOpacity={0.4}
              stroke="var(--color-throughput)"
              stackId="b"
            />
          </AreaChart>
        </ChartContainer>
      </CardContent>
    </Card>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/system-health.tsx">
"use client";

import { Activity, CheckCircle, AlertCircle, XCircle } from "lucide-react";

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Separator } from "@/components/ui/separator";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";

const systemComponents = [
  { name: "API Gateway", status: "operational", uptime: "99.9%", icon: CheckCircle, color: "text-green-500" },
  { name: "Database", status: "operational", uptime: "99.8%", icon: CheckCircle, color: "text-green-500" },
  { name: "Message Queue", status: "degraded", uptime: "98.2%", icon: AlertCircle, color: "text-amber-500" },
  { name: "Data Pipeline", status: "operational", uptime: "99.5%", icon: CheckCircle, color: "text-green-500" },
  { name: "Analytics Engine", status: "operational", uptime: "99.7%", icon: CheckCircle, color: "text-green-500" },
];

export function SystemHealth() {
  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Activity className="size-5" />
          System Health
        </CardTitle>
        <CardDescription>Real-time component status</CardDescription>
      </CardHeader>
      <CardContent>
        <Tabs defaultValue="status">
          <TabsList className="grid w-full grid-cols-2">
            <TabsTrigger value="status">Status</TabsTrigger>
            <TabsTrigger value="uptime">Uptime</TabsTrigger>
          </TabsList>
          <TabsContent value="status" className="space-y-4">
            {systemComponents.map((component, i) => (
              <div key={i}>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <component.icon className={`size-4 ${component.color}`} />
                    <span className="text-sm font-medium">{component.name}</span>
                  </div>
                  <span className="text-muted-foreground text-xs capitalize">{component.status}</span>
                </div>
                {i < systemComponents.length - 1 && <Separator className="mt-4" />}
              </div>
            ))}
          </TabsContent>
          <TabsContent value="uptime" className="space-y-4">
            {systemComponents.map((component, i) => (
              <div key={i}>
                <div className="flex items-center justify-between">
                  <span className="text-sm font-medium">{component.name}</span>
                  <span className="text-sm font-semibold tabular-nums">{component.uptime}</span>
                </div>
                {i < systemComponents.length - 1 && <Separator className="mt-4" />}
              </div>
            ))}
          </TabsContent>
        </Tabs>
      </CardContent>
    </Card>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/assets/[assetId]/page.tsx">
export default function AssetPage() {
  return (
    <div className="flex h-full flex-col items-center justify-center p-8 text-center">
      <h1 className="text-2xl font-bold">Asset Detail</h1>
      <p className="text-muted-foreground">This page is under construction.</p>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/assets/page.tsx">
import { auth } from "@clerk/nextjs/server";
import { Asset } from "@moondesk/domain";

import { DataTable } from "@/app/(main)/dashboard/overview/_components/data-table";
import { adaptAssetsToDistribution, adaptAssetsToTableRows } from "@/lib/adapters/dashboard-adapter";
import { moondeskApi } from "@/lib/api/api-client";

import { AssetInsightCards } from "./_components/asset-insight-cards";

export default async function Page() {
  const { getToken } = await auth();
  const token = await getToken();

  if (token) {
    moondeskApi.setToken(token);
  }

  const assets = await moondeskApi.getAssets().catch(() => []);

  const distributionData = adaptAssetsToDistribution(assets);
  const tableData = adaptAssetsToTableRows(assets);

  return (
    <div className="flex flex-col gap-4 md:gap-6">
      <AssetInsightCards data={distributionData} />
      <div className="@container/main">
        <DataTable data={tableData} />
      </div>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/coming-soon/page.tsx">
export default function Page() {
  return (
    <div className="flex h-full flex-col items-center justify-center space-y-2 text-center">
      <h1 className="text-2xl font-semibold">Page not found.</h1>
      <p className="text-muted-foreground">This page is under development and will be available in future updates.</p>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/columns.tsx">
import { ColumnDef } from "@tanstack/react-table";
import { CircleCheck, EllipsisVertical, AlertCircle, Clock, MapPin, Activity } from "lucide-react";
import { z } from "zod";

import { DataTableColumnHeader } from "@/components/data-table/data-table-column-header";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

import { assetSchema } from "./schema";

export const assetColumns: ColumnDef<z.infer<typeof assetSchema>>[] = [
  {
    id: "select",
    header: ({ table }) => (
      <div className="flex items-center justify-center">
        <Checkbox
          checked={table.getIsAllPageRowsSelected() || (table.getIsSomePageRowsSelected() && "indeterminate")}
          onCheckedChange={(value) => table.toggleAllPageRowsSelected(!!value)}
          aria-label="Select all"
        />
      </div>
    ),
    cell: ({ row }) => (
      <div className="flex items-center justify-center">
        <Checkbox
          checked={row.getIsSelected()}
          onCheckedChange={(value) => row.toggleSelected(!!value)}
          aria-label="Select row"
        />
      </div>
    ),
    enableSorting: false,
    enableHiding: false,
  },
  {
    accessorKey: "name",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Asset Name" />,
    cell: ({ row }) => <span className="font-medium">{row.getValue("name") as string}</span>,
    enableSorting: true,
  },
  {
    accessorKey: "type",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Type" />,
    cell: ({ row }) => (
      <div className="w-32">
        <Badge variant="outline" className="text-muted-foreground px-1.5">
          {row.getValue("type") as string}
        </Badge>
      </div>
    ),
    enableSorting: true,
  },
  {
    accessorKey: "status",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Status" />,
    cell: ({ row }) => {
      const status = row.getValue("status") as string;
      const isOnline = status === "Online";
      return (
        <Badge variant="outline" className="text-muted-foreground gap-1.5 px-1.5">
          {isOnline ? (
            <CircleCheck className="size-3.5 fill-green-500 dark:fill-green-400" />
          ) : (
            <AlertCircle className="fill-destructive/20 text-destructive size-3.5" />
          )}
          {status}
        </Badge>
      );
    },
    enableSorting: true,
  },
  {
    accessorKey: "location",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Location" />,
    cell: ({ row }) => (
      <div className="text-muted-foreground flex items-center gap-1.5">
        <MapPin className="size-3.5" />
        <span>{row.getValue("location")}</span>
      </div>
    ),
    enableSorting: true,
  },
  {
    accessorKey: "lastReading",
    header: ({ column }) => <DataTableColumnHeader className="text-right" column={column} title="Last Reading" />,
    cell: ({ row }) => (
      <div className="flex items-center justify-end gap-1.5">
        <Activity className="text-muted-foreground size-3.5" />
        <span className="font-mono">{row.getValue("lastReading")}</span>
      </div>
    ),
    enableSorting: false,
  },
  {
    accessorKey: "lastSeen",
    header: ({ column }) => <DataTableColumnHeader className="text-right" column={column} title="Last Seen" />,
    cell: ({ row }) => (
      <div className="text-muted-foreground flex items-center justify-end gap-1.5">
        <Clock className="size-3.5" />
        <span>{row.getValue("lastSeen")}</span>
      </div>
    ),
    enableSorting: true,
  },
  {
    id: "actions",
    cell: () => (
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="ghost" className="data-[state=open]:bg-muted text-muted-foreground flex size-8" size="icon">
            <EllipsisVertical />
            <span className="sr-only">Open menu</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end" className="w-32">
          <DropdownMenuItem>View Details</DropdownMenuItem>
          <DropdownMenuItem>View Sensors</DropdownMenuItem>
          <DropdownMenuSeparator />
          <DropdownMenuItem variant="destructive">Maintenance</DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    ),
    enableSorting: false,
  },
];
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/schema.ts">
import { z } from "zod";

export const assetSchema = z.object({
  id: z.string(),
  name: z.string(),
  status: z.string(),
  type: z.string(),
  location: z.string(),
  lastReading: z.string(),
  lastSeen: z.string(),
  activeAlerts: z.number(),
});

// Legacy schema for table-cell-viewer (from demo template)
export const sectionSchema = z.object({
  id: z.string(),
  header: z.string(),
  type: z.string(),
  status: z.string(),
  target: z.string(),
  limit: z.string(),
  reviewer: z.string(),
});
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/overview/page.tsx">
import { auth } from "@clerk/nextjs/server";
import { Reading } from "@moondesk/domain";

import { ChartAreaInteractive } from "@/app/(main)/dashboard/overview/_components/chart-area-interactive";
import { DataTable } from "@/app/(main)/dashboard/overview/_components/data-table";
import { SectionCards } from "@/app/(main)/dashboard/overview/_components/section-cards";
import {
  adaptToMetricTrends,
  adaptReadingsToTimeSeries,
  adaptAssetsToTableRows,
} from "@/lib/adapters/dashboard-adapter";
import { moondeskApi } from "@/lib/api/api-client";

export default async function Page() {
  const { getToken } = await auth();
  const token = await getToken();

  if (token) {
    moondeskApi.setToken(token);
  }

  // Fetch data in parallel
  const [assets, alertStats, readingStats] = await Promise.all([
    moondeskApi.getAssets().catch(() => []),
    moondeskApi.getAlertStats().catch(() => undefined),
    moondeskApi.getReadingStats().catch(() => undefined),
  ]);

  // Fetch readings for chart (e.g., from the first asset with a sensor)
  // This is a simplification for the overview; a real dashboard might aggregate
  let readings: Reading[] = [];
  const firstAssetWithSensor = assets.find((a) => a.sensors && a.sensors.length > 0);
  if (firstAssetWithSensor && firstAssetWithSensor.sensors?.[0]) {
    readings = await moondeskApi.getRecentReadings(firstAssetWithSensor.sensors[0].id).catch(() => []);
  }

  // Adapt data
  const stats = adaptToMetricTrends(assets, readingStats, alertStats);
  const chartData = adaptReadingsToTimeSeries(readings);
  const tableData = adaptAssetsToTableRows(assets);

  return (
    <div className="@container/main flex flex-col gap-4 md:gap-6">
      <SectionCards stats={stats} />
      <ChartAreaInteractive data={chartData} />
      <DataTable data={tableData} />
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/page.tsx">
export default function Page() {
  return <>Coming Soon</>;
}
</file>

<file path="apps/moondesk-dash/src/app/organization/[[...organization]]/page.tsx">
import { OrganizationProfile } from "@clerk/nextjs";

export default function OrganizationPage() {
  return (
    <div className="bg-background flex min-h-screen items-center justify-center">
      <OrganizationProfile />
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/sentry-example-page/page.tsx">
"use client";

import { useState, useEffect } from "react";

import Head from "next/head";

import * as Sentry from "@sentry/nextjs";

class SentryExampleFrontendError extends Error {
  constructor(message: string | undefined) {
    super(message);
    this.name = "SentryExampleFrontendError";
  }
}

export default function Page() {
  const [hasSentError, setHasSentError] = useState(false);
  const [isConnected, setIsConnected] = useState(true);

  useEffect(() => {
    async function checkConnectivity() {
      const result = await Sentry.diagnoseSdkConnectivity();
      setIsConnected(result !== "sentry-unreachable");
    }
    checkConnectivity();
  }, []);

  return (
    <div>
      <Head>
        <title>sentry-example-page</title>
        <meta name="description" content="Test Sentry for your Next.js app!" />
      </Head>

      <main>
        <div className="flex-spacer" />
        <svg height="40" width="40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M21.85 2.995a3.698 3.698 0 0 1 1.353 1.354l16.303 28.278a3.703 3.703 0 0 1-1.354 5.053 3.694 3.694 0 0 1-1.848.496h-3.828a31.149 31.149 0 0 0 0-3.09h3.815a.61.61 0 0 0 .537-.917L20.523 5.893a.61.61 0 0 0-1.057 0l-3.739 6.494a28.948 28.948 0 0 1 9.63 10.453 28.988 28.988 0 0 1 3.499 13.78v1.542h-9.852v-1.544a19.106 19.106 0 0 0-2.182-8.85 19.08 19.08 0 0 0-6.032-6.829l-1.85 3.208a15.377 15.377 0 0 1 6.382 12.484v1.542H3.696A3.694 3.694 0 0 1 0 34.473c0-.648.17-1.286.494-1.849l2.33-4.074a8.562 8.562 0 0 1 2.689 1.536L3.158 34.17a.611.611 0 0 0 .538.917h8.448a12.481 12.481 0 0 0-6.037-9.09l-1.344-.772 4.908-8.545 1.344.77a22.16 22.16 0 0 1 7.705 7.444 22.193 22.193 0 0 1 3.316 10.193h3.699a25.892 25.892 0 0 0-3.811-12.033 25.856 25.856 0 0 0-9.046-8.796l-1.344-.772 5.269-9.136a3.698 3.698 0 0 1 3.2-1.849c.648 0 1.285.17 1.847.495Z"
            fill="currentcolor"
          />
        </svg>
        <h1>sentry-example-page</h1>

        <p className="description">
          Click the button below, and view the sample error on the Sentry{" "}
          <a target="_blank" href="https://moondesk.sentry.io/issues/?project=4510518434463824">
            Issues Page
          </a>
          . For more details about setting up Sentry,{" "}
          <a target="_blank" href="https://docs.sentry.io/platforms/javascript/guides/nextjs/">
            read our docs
          </a>
          .
        </p>

        <button
          type="button"
          onClick={async () => {
            await Sentry.startSpan(
              {
                name: "Example Frontend/Backend Span",
                op: "test",
              },
              async () => {
                const res = await fetch("/api/sentry-example-api");
                if (!res.ok) {
                  setHasSentError(true);
                }
              },
            );
            throw new SentryExampleFrontendError("This error is raised on the frontend of the example page.");
          }}
          disabled={!isConnected}
        >
          <span>Throw Sample Error</span>
        </button>

        {hasSentError ? (
          <p className="success">Error sent to Sentry.</p>
        ) : !isConnected ? (
          <div className="connectivity-error">
            <p>
              It looks like network requests to Sentry are being blocked, which will prevent errors from being captured.
              Try disabling your ad-blocker to complete the test.
            </p>
          </div>
        ) : (
          <div className="success_placeholder" />
        )}

        <div className="flex-spacer" />
      </main>

      <style>{`
        main {
          display: flex;
          min-height: 100vh;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 16px;
          padding: 16px;
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
        }

        h1 {
          padding: 0px 4px;
          border-radius: 4px;
          background-color: rgba(24, 20, 35, 0.03);
          font-family: monospace;
          font-size: 20px;
          line-height: 1.2;
        }

        p {
          margin: 0;
          font-size: 20px;
        }

        a {
          color: #6341F0;
          text-decoration: underline;
          cursor: pointer;

          @media (prefers-color-scheme: dark) {
            color: #B3A1FF;
          }
        }

        button {
          border-radius: 8px;
          color: white;
          cursor: pointer;
          background-color: #553DB8;
          border: none;
          padding: 0;
          margin-top: 4px;

          & > span {
            display: inline-block;
            padding: 12px 16px;
            border-radius: inherit;
            font-size: 20px;
            font-weight: bold;
            line-height: 1;
            background-color: #7553FF;
            border: 1px solid #553DB8;
            transform: translateY(-4px);
          }

          &:hover > span {
            transform: translateY(-8px);
          }

          &:active > span {
            transform: translateY(0);
          }

          &:disabled {
	            cursor: not-allowed;
	            opacity: 0.6;
	
	            & > span {
	              transform: translateY(0);
	              border: none
	            }
	          }
        }

        .description {
          text-align: center;
          color: #6E6C75;
          max-width: 500px;
          line-height: 1.5;
          font-size: 20px;

          @media (prefers-color-scheme: dark) {
            color: #A49FB5;
          }
        }

        .flex-spacer {
          flex: 1;
        }

        .success {
          padding: 12px 16px;
          border-radius: 8px;
          font-size: 20px;
          line-height: 1;
          background-color: #00F261;
          border: 1px solid #00BF4D;
          color: #181423;
        }

        .success_placeholder {
          height: 46px;
        }

        .connectivity-error {
          padding: 12px 16px;
          background-color: #E50045;
          border-radius: 8px;
          width: 500px;
          color: #FFFFFF;
          border: 1px solid #A80033;
          text-align: center;
          margin: 0;
        }
        
        .connectivity-error a {
          color: #FFFFFF;
          text-decoration: underline;
        }
      `}</style>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/sso-callback/page.tsx">
import { AuthenticateWithRedirectCallback } from "@clerk/nextjs";

export default function SSOCallback() {
  return <AuthenticateWithRedirectCallback />;
}
</file>

<file path="apps/moondesk-dash/src/app/global-error.tsx">
"use client";

import { useEffect } from "react";

import NextError from "next/error";

import * as Sentry from "@sentry/nextjs";

export default function GlobalError({ error }: { error: Error & { digest?: string } }) {
  useEffect(() => {
    Sentry.captureException(error);
  }, [error]);

  return (
    <html>
      <body>
        {/* `NextError` is the default Next.js error page component. Its type
        definition requires a `statusCode` prop. However, since the App Router
        does not expose status codes for errors, we simply pass 0 to render a
        generic error message. */}
        <NextError statusCode={0} />
      </body>
    </html>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/globals.css">
@import "tailwindcss";
/* @import "tw-animate-css"; */

/* Theme preset styles: these override CSS variables based on the selected data-theme-preset */
@import "../styles/presets/brutalist.css";
@import "../styles/presets/soft-pop.css";
@import "../styles/presets/tangerine.css";

@import "@clerk/themes/shadcn.css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

/* Default theme styles (used when no data-theme-preset is set or when 'default' is selected).
These serve as the fallback; there is no separate default.css file. */
:root {
  --radius: 0.625rem;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.3211 0 0);
  --chart-2: oklch(0.4495 0 0);
  --chart-3: oklch(0.5693 0 0);
  --chart-4: oklch(0.683 0 0);
  --chart-5: oklch(0.7921 0 0);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.9521 0 0);
  --chart-2: oklch(0.8576 0 0);
  --chart-3: oklch(0.7572 0 0);
  --chart-4: oklch(0.6534 0 0);
  --chart-5: oklch(0.5452 0 0);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer utilities {
  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-2xs {
    box-shadow: var(--shadow-2xs);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-xs {
    box-shadow: var(--shadow-xs);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-sm {
    box-shadow: var(--shadow-sm);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow {
    box-shadow: var(--shadow);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-md {
    box-shadow: var(--shadow-md);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-lg {
    box-shadow: var(--shadow-lg);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-xl {
    box-shadow: var(--shadow-xl);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-2xl {
    box-shadow: var(--shadow-2xl);
  }
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground;
  }
}

html {
  overscroll-behavior: none;
}

.disable-transitions * {
  transition: none !important;
}
</file>

<file path="apps/moondesk-dash/src/app/layout.tsx">
import { ReactNode } from "react";

import type { Metadata } from "next";
import { Inter } from "next/font/google";

import { ClerkProvider } from "@clerk/nextjs";
import { dark } from "@clerk/themes";

import { Toaster } from "@/components/ui/sonner";
import { APP_CONFIG } from "@/config";
import { getPreference } from "@/server/server-actions";
import { PreferencesStoreProvider } from "@/stores/preferences/preferences-provider";
import { THEME_MODE_VALUES, THEME_PRESET_VALUES, type ThemePreset, type ThemeMode } from "@/types/preferences/theme";

import "./globals.css";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: APP_CONFIG.meta.title,
  description: APP_CONFIG.meta.description,
};

export default async function RootLayout({ children }: Readonly<{ children: ReactNode }>) {
  const themeMode = await getPreference<ThemeMode>("theme_mode", THEME_MODE_VALUES, "light");
  const themePreset = await getPreference<ThemePreset>("theme_preset", THEME_PRESET_VALUES, "default");

  return (
    <ClerkProvider
      appearance={{
        baseTheme: themeMode === "dark" ? dark : undefined,
      }}
    >
      <html
        lang="en"
        className={themeMode === "dark" ? "dark" : ""}
        data-theme-preset={themePreset}
        suppressHydrationWarning
      >
        <body className={`${inter.className} min-h-screen antialiased`}>
          <PreferencesStoreProvider themeMode={themeMode} themePreset={themePreset}>
            {children}
            <Toaster />
          </PreferencesStoreProvider>
        </body>
      </html>
    </ClerkProvider>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/not-found.tsx">
"use client";

import Link from "next/link";

import { Button } from "@/components/ui/button";

export default function NotFound() {
  return (
    <div className="flex h-dvh flex-col items-center justify-center space-y-2 text-center">
      <h1 className="text-2xl font-semibold">Page not found.</h1>
      <p className="text-muted-foreground">The page you are looking for could not be found.</p>
      <Link replace href="/dashboard/default">
        <Button variant="outline">Go back home</Button>
      </Link>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/components/data-table/data-table-column-header.tsx">
import { Column } from "@tanstack/react-table";
import { ArrowDown, ArrowUp, ChevronsUpDown, EyeOff } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { cn } from "@/lib/utils";

interface DataTableColumnHeaderProps<TData, TValue> extends React.HTMLAttributes<HTMLDivElement> {
  column: Column<TData, TValue>;
  title: string;
}

function getSortIcon(sort: "asc" | "desc" | false | undefined) {
  switch (sort) {
    case "desc":
      return <ArrowDown />;
    case "asc":
      return <ArrowUp />;
    default:
      return <ChevronsUpDown />;
  }
}

export function DataTableColumnHeader<TData, TValue>({
  column,
  title,
  className,
}: DataTableColumnHeaderProps<TData, TValue>) {
  if (!column.getCanSort()) {
    return <div className={cn(className)}>{title}</div>;
  }
  return (
    <div className={cn("flex items-center space-x-2", className)}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="ghost" size="sm" className="data-[state=open]:bg-accent -ml-3 h-8">
            <span>{title}</span>
            {getSortIcon(column.getIsSorted())}
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="start">
          <DropdownMenuItem onClick={() => column.toggleSorting(false)}>
            <ArrowUp className="text-muted-foreground/70 h-3.5 w-3.5" />
            Asc
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => column.toggleSorting(true)}>
            <ArrowDown className="text-muted-foreground/70 h-3.5 w-3.5" />
            Desc
          </DropdownMenuItem>
          {column.columnDef.enableHiding !== false && (
            <>
              <DropdownMenuSeparator />
              <DropdownMenuItem onClick={() => column.toggleVisibility(false)}>
                <EyeOff className="text-muted-foreground/70 h-3.5 w-3.5" />
                Hide
              </DropdownMenuItem>
            </>
          )}
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/components/data-table/data-table-pagination.tsx">
import { Table } from "@tanstack/react-table";
import { ChevronRight, ChevronsRight, ChevronLeft, ChevronsLeft } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";

interface DataTablePaginationProps<TData> {
  table: Table<TData>;
}

export function DataTablePagination<TData>({ table }: DataTablePaginationProps<TData>) {
  return (
    <div className="flex items-center justify-between px-4">
      <div className="text-muted-foreground hidden flex-1 text-sm lg:flex">
        {table.getFilteredSelectedRowModel().rows.length} of {table.getFilteredRowModel().rows.length} row(s) selected.
      </div>
      <div className="flex w-full items-center gap-8 lg:w-fit">
        <div className="hidden items-center gap-2 lg:flex">
          <Label htmlFor="rows-per-page" className="text-sm font-medium">
            Rows per page
          </Label>
          <Select
            value={`${table.getState().pagination.pageSize}`}
            onValueChange={(value) => {
              table.setPageSize(Number(value));
            }}
          >
            <SelectTrigger size="sm" className="w-20" id="rows-per-page">
              <SelectValue placeholder={table.getState().pagination.pageSize} />
            </SelectTrigger>
            <SelectContent side="top">
              {[10, 20, 30, 40, 50].map((pageSize) => (
                <SelectItem key={pageSize} value={`${pageSize}`}>
                  {pageSize}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
        <div className="flex w-fit items-center justify-center text-sm font-medium">
          Page {table.getState().pagination.pageIndex + 1} of {table.getPageCount()}
        </div>
        <div className="ml-auto flex items-center gap-2 lg:ml-0">
          <Button
            variant="outline"
            className="hidden h-8 w-8 p-0 lg:flex"
            onClick={() => table.setPageIndex(0)}
            disabled={!table.getCanPreviousPage()}
          >
            <span className="sr-only">Go to first page</span>
            <ChevronsLeft />
          </Button>
          <Button
            variant="outline"
            className="size-8"
            size="icon"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            <span className="sr-only">Go to previous page</span>
            <ChevronLeft />
          </Button>
          <Button
            variant="outline"
            className="size-8"
            size="icon"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            <span className="sr-only">Go to next page</span>
            <ChevronRight />
          </Button>
          <Button
            variant="outline"
            className="hidden size-8 lg:flex"
            size="icon"
            onClick={() => table.setPageIndex(table.getPageCount() - 1)}
            disabled={!table.getCanNextPage()}
          >
            <span className="sr-only">Go to last page</span>
            <ChevronsRight />
          </Button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/components/data-table/data-table-view-options.tsx">
"use client";

import { Table } from "@tanstack/react-table";
import { Settings2 } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuCheckboxItem,
  DropdownMenuContent,
  DropdownMenuLabel,
  DropdownMenuSeparator,
} from "@/components/ui/dropdown-menu";

interface DataTableViewOptionsProps<TData> {
  table: Table<TData>;
}

export function DataTableViewOptions<TData>({ table }: DataTableViewOptionsProps<TData>) {
  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm" className="ml-auto hidden h-8 lg:flex">
          <Settings2 />
          View
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-[150px]">
        <DropdownMenuLabel>Toggle columns</DropdownMenuLabel>
        <DropdownMenuSeparator />
        {table
          .getAllColumns()
          .filter((column) => typeof column.accessorFn !== "undefined" && column.getCanHide())
          .map((column) => {
            return (
              <DropdownMenuCheckboxItem
                key={column.id}
                className="capitalize"
                checked={column.getIsVisible()}
                onCheckedChange={(value) => column.toggleVisibility(!!value)}
              >
                {column.id}
              </DropdownMenuCheckboxItem>
            );
          })}
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
</file>

<file path="apps/moondesk-dash/src/components/data-table/data-table.tsx">
import * as React from "react";

import {
  KeyboardSensor,
  MouseSensor,
  TouchSensor,
  useSensor,
  useSensors,
  DndContext,
  closestCenter,
  type UniqueIdentifier,
  type DragEndEvent,
} from "@dnd-kit/core";
import { restrictToVerticalAxis } from "@dnd-kit/modifiers";
import { SortableContext, verticalListSortingStrategy, arrayMove } from "@dnd-kit/sortable";
import { ColumnDef, flexRender, type Table as TanStackTable } from "@tanstack/react-table";

import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";

import { DraggableRow } from "./draggable-row";

interface DataTableProps<TData, TValue> {
  table: TanStackTable<TData>;
  columns: ColumnDef<TData, TValue>[];
  dndEnabled?: boolean;
  onReorder?: (newData: TData[]) => void;
}

function renderTableBody<TData, TValue>({
  table,
  columns,
  dndEnabled,
  dataIds,
}: {
  table: TanStackTable<TData>;
  columns: ColumnDef<TData, TValue>[];
  dndEnabled: boolean;
  dataIds: UniqueIdentifier[];
}) {
  if (!table.getRowModel().rows.length) {
    return (
      <TableRow>
        <TableCell colSpan={columns.length} className="h-24 text-center">
          No results.
        </TableCell>
      </TableRow>
    );
  }
  if (dndEnabled) {
    return (
      <SortableContext items={dataIds} strategy={verticalListSortingStrategy}>
        {table.getRowModel().rows.map((row) => (
          <DraggableRow key={row.id} row={row} />
        ))}
      </SortableContext>
    );
  }
  return table.getRowModel().rows.map((row) => (
    <TableRow key={row.id} data-state={row.getIsSelected() && "selected"}>
      {row.getVisibleCells().map((cell) => (
        <TableCell key={cell.id}>{flexRender(cell.column.columnDef.cell, cell.getContext())}</TableCell>
      ))}
    </TableRow>
  ));
}

export function DataTable<TData, TValue>({
  table,
  columns,
  dndEnabled = false,
  onReorder,
}: DataTableProps<TData, TValue>) {
  const dataIds: UniqueIdentifier[] = table.getRowModel().rows.map((row) => Number(row.id) as UniqueIdentifier);
  const sortableId = React.useId();
  const sensors = useSensors(useSensor(MouseSensor, {}), useSensor(TouchSensor, {}), useSensor(KeyboardSensor, {}));

  function handleDragEnd(event: DragEndEvent) {
    const { active, over } = event;
    if (over && active.id !== over.id && onReorder) {
      const oldIndex = dataIds.indexOf(active.id);
      const newIndex = dataIds.indexOf(over.id);

      // Call parent with new data order (parent manages state)
      const newData = arrayMove(table.options.data, oldIndex, newIndex);
      onReorder(newData);
    }
  }

  const tableContent = (
    <Table>
      <TableHeader className="bg-muted sticky top-0 z-10">
        {table.getHeaderGroups().map((headerGroup) => (
          <TableRow key={headerGroup.id}>
            {headerGroup.headers.map((header) => {
              return (
                <TableHead key={header.id} colSpan={header.colSpan}>
                  {header.isPlaceholder ? null : flexRender(header.column.columnDef.header, header.getContext())}
                </TableHead>
              );
            })}
          </TableRow>
        ))}
      </TableHeader>
      <TableBody className="**:data-[slot=table-cell]:first:w-8">
        {renderTableBody({ table, columns, dndEnabled, dataIds })}
      </TableBody>
    </Table>
  );

  if (dndEnabled) {
    return (
      <DndContext
        collisionDetection={closestCenter}
        modifiers={[restrictToVerticalAxis]}
        onDragEnd={handleDragEnd}
        sensors={sensors}
        id={sortableId}
      >
        {tableContent}
      </DndContext>
    );
  }

  return tableContent;
}
</file>

<file path="apps/moondesk-dash/src/components/data-table/drag-column.tsx">
import { useSortable } from "@dnd-kit/sortable";
import { ColumnDef } from "@tanstack/react-table";
import { GripVertical } from "lucide-react";

import { Button } from "@/components/ui/button";

function DragHandle({ id }: { id: number }) {
  const { attributes, listeners } = useSortable({
    id,
  });

  return (
    <Button
      {...attributes}
      {...listeners}
      variant="ghost"
      size="icon"
      className="text-muted-foreground size-7 hover:bg-transparent"
    >
      <GripVertical className="text-muted-foreground size-3" />
      <span className="sr-only">Drag to reorder</span>
    </Button>
  );
}

export const dragColumn: ColumnDef<any> = {
  id: "drag",
  header: () => null,
  cell: ({ row }) => <DragHandle id={row.original.id} />,
  enableSorting: false,
  enableHiding: false,
};
</file>

<file path="apps/moondesk-dash/src/components/data-table/draggable-row.tsx">
import { useSortable } from "@dnd-kit/sortable";
import { CSS } from "@dnd-kit/utilities";
import { Row, flexRender } from "@tanstack/react-table";

import { TableCell, TableRow } from "@/components/ui/table";

export function DraggableRow<TData>({ row }: { row: Row<TData> }) {
  const { transform, transition, setNodeRef, isDragging } = useSortable({
    id: (row.original as { id: number }).id,
  });
  return (
    <TableRow
      data-state={row.getIsSelected() && "selected"}
      data-dragging={isDragging}
      ref={setNodeRef}
      className="relative z-0 data-[dragging=true]:z-10 data-[dragging=true]:opacity-80"
      style={{
        transform: CSS.Transform.toString(transform),
        transition: transition,
      }}
    >
      {row.getVisibleCells().map((cell) => (
        <TableCell key={cell.id}>{flexRender(cell.column.columnDef.cell, cell.getContext())}</TableCell>
      ))}
    </TableRow>
  );
}
</file>

<file path="apps/moondesk-dash/src/components/data-table/table-utils.ts">
import type { ColumnDef } from "@tanstack/react-table";

import { dragColumn } from "./drag-column";

export function withDndColumn<T>(columns: ColumnDef<T>[]): ColumnDef<T>[] {
  return [dragColumn as ColumnDef<T>, ...columns];
}
</file>

<file path="apps/moondesk-dash/src/components/providers/query-provider.tsx">
"use client";

import { useState } from "react";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

export function QueryProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60 * 1000,
          },
        },
      }),
  );

  return <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;
}
</file>

<file path="apps/moondesk-dash/src/components/simple-icon.tsx">
"use client";

import * as React from "react";

import type { SimpleIcon } from "simple-icons";

import { cn } from "@/lib/utils";

type SimpleIconProps = {
  icon: SimpleIcon;
  className?: string;
} & React.SVGProps<SVGSVGElement>;

export function SimpleIcon({ icon, className, ...props }: SimpleIconProps) {
  const { title, path } = icon;

  return (
    <svg
      viewBox="0 0 24 24"
      aria-label={title}
      aria-hidden="false"
      focusable="false"
      className={cn("fill-foreground size-5", className)}
      {...props}
    >
      <title>{title}</title>
      <path d={path} />
    </svg>
  );
}
</file>

<file path="apps/moondesk-dash/src/hooks/__tests__/use-signalr.test.ts">
import { HubConnectionBuilder } from "@microsoft/signalr";
import { describe, it, expect, vi } from "vitest";

import { useSignalR } from "../use-signalr";

// Mock SignalR module
vi.mock("@microsoft/signalr", () => {
  const mockConnection = {
    on: vi.fn(),
    start: vi.fn().mockResolvedValue(undefined),
    stop: vi.fn().mockResolvedValue(undefined),
    state: "Connected",
  };

  return {
    HubConnectionBuilder: vi.fn().mockImplementation(() => ({
      withUrl: vi.fn().mockReturnThis(),
      withAutomaticReconnect: vi.fn().mockReturnThis(),
      build: vi.fn().mockReturnValue(mockConnection),
    })),
    HubConnectionState: {
      Connected: "Connected",
      Disconnected: "Disconnected",
    },
  };
});

describe("useSignalR", () => {
  it("hook is defined", () => {
    expect(useSignalR).toBeDefined();
    expect(typeof useSignalR).toBe("function");
  });

  it("SignalR builder is mocked correctly", () => {
    const builder = new HubConnectionBuilder();

    expect(builder.withUrl).toBeDefined();
    expect(builder.withAutomaticReconnect).toBeDefined();
    expect(builder.build).toBeDefined();
  });
});
</file>

<file path="apps/moondesk-dash/src/hooks/use-data-table-instance.ts">
import * as React from "react";

import {
  ColumnDef,
  ColumnFiltersState,
  SortingState,
  VisibilityState,
  getCoreRowModel,
  getFacetedRowModel,
  getFacetedUniqueValues,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from "@tanstack/react-table";

type UseDataTableInstanceProps<TData, TValue> = {
  data: TData[];
  columns: ColumnDef<TData, TValue>[];
  enableRowSelection?: boolean;
  defaultPageIndex?: number;
  defaultPageSize?: number;
  getRowId?: (row: TData, index: number) => string;
};

export function useDataTableInstance<TData, TValue>({
  data,
  columns,
  enableRowSelection = true,
  defaultPageIndex,
  defaultPageSize,
  getRowId,
}: UseDataTableInstanceProps<TData, TValue>) {
  const [rowSelection, setRowSelection] = React.useState({});
  const [columnVisibility, setColumnVisibility] = React.useState<VisibilityState>({});
  const [columnFilters, setColumnFilters] = React.useState<ColumnFiltersState>([]);
  const [sorting, setSorting] = React.useState<SortingState>([]);
  const [pagination, setPagination] = React.useState({
    pageIndex: defaultPageIndex ?? 0,
    pageSize: defaultPageSize ?? 10,
  });

  const table = useReactTable({
    data,
    columns,
    state: {
      sorting,
      columnVisibility,
      rowSelection,
      columnFilters,
      pagination,
    },
    enableRowSelection,
    getRowId: getRowId ?? ((row) => (row as { id: string | number }).id.toString()),
    onRowSelectionChange: setRowSelection,
    onSortingChange: setSorting,
    onColumnFiltersChange: setColumnFilters,
    onColumnVisibilityChange: setColumnVisibility,
    onPaginationChange: setPagination,
    getCoreRowModel: getCoreRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFacetedRowModel: getFacetedRowModel(),
    getFacetedUniqueValues: getFacetedUniqueValues(),
  });

  return table;
}
</file>

<file path="apps/moondesk-dash/src/hooks/use-mobile.ts">
import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined);

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}
</file>

<file path="apps/moondesk-dash/src/hooks/use-signalr.ts">
import { useEffect, useState } from "react";

import { HubConnection, HubConnectionBuilder, HubConnectionState } from "@microsoft/signalr";
import { Alert, Reading } from "@moondesk/domain";
import { useQueryClient } from "@tanstack/react-query";

const HUB_URL = process.env.NEXT_PUBLIC_API_URL?.replace("/api", "") + "/hubs/iot" || "http://localhost:5000/hubs/iot";

export function useSignalR() {
  const [connection, setConnection] = useState<HubConnection | null>(null);
  const queryClient = useQueryClient();

  useEffect(() => {
    const newConnection = new HubConnectionBuilder().withUrl(HUB_URL).withAutomaticReconnect().build();

    newConnection.on("ReceiveReading", (reading: Reading) => {
      queryClient.setQueryData(["readings", reading.sensorId, 24], (old: Reading[] = []) =>
        [...old, reading].slice(-100),
      );
    });

    newConnection.on("ReceiveAlert", (alert: Alert) => {
      queryClient.setQueryData(["alerts"], (old: Alert[] = []) => [alert, ...old]);
      queryClient.invalidateQueries({ queryKey: ["stats"] });
    });

    newConnection.on("AssetStatusChanged", () => {
      queryClient.invalidateQueries({ queryKey: ["assets"] });
      queryClient.invalidateQueries({ queryKey: ["stats"] });
    });

    newConnection
      .start()
      .then(() => setConnection(newConnection))
      .catch(console.error);

    return () => {
      if (newConnection.state === HubConnectionState.Connected) {
        newConnection.stop();
      }
    };
  }, [queryClient]);

  return connection;
}
</file>

<file path="apps/moondesk-dash/src/lib/adapters/__tests__/dashboard-adapter.test.ts">
import {
  Asset,
  Alert,
  ReadingStats,
  AssetStatus,
  SensorType,
  Parameter,
  Protocol,
  AlertSeverity,
} from "@moondesk/domain";
import { describe, it, expect } from "vitest";

import { adaptToMetricTrends } from "../dashboard-adapter";

describe("dashboard-adapter", () => {
  it("should adapt ReadingStats to MetricTrend", () => {
    const assets: Asset[] = [];
    const alerts: Alert[] = [];
    const readingStats: ReadingStats = {
      total: 1234567,
      dailyTrend: 0,
      qualityScore: 0,
      trends: [
        { bucket: "2023-01-01", count: 100 },
        { bucket: "2023-01-02", count: 5000 }, // Last bucket
      ],
    };

    const trends = adaptToMetricTrends(assets, readingStats, undefined);

    const readingsCard = trends.find((t) => t.title === "Total Readings");
    expect(readingsCard).toBeDefined();
    expect(readingsCard?.value).toBe("1,234,567");
    expect(readingsCard?.trend).toBe(5000); // Last bucket count
    expect(readingsCard?.status).toBe("up");
  });

  it("should handle undefined stats gracefully", () => {
    const trends = adaptToMetricTrends([], undefined, undefined);
    const readingsCard = trends.find((t) => t.title === "Total Readings");
    expect(readingsCard?.value).toBe("0");
    expect(readingsCard?.trend).toBe(0);
  });
});
</file>

<file path="apps/moondesk-dash/src/lib/adapters/dashboard-adapter.ts">
import { AlertStats, Asset, AssetStatus, Reading, ReadingStats } from "@moondesk/domain";

// --- Frontend View Models ---

export interface MetricTrend {
  title: string;
  value: string | number;
  noTrendData?: boolean;
  trend?: number;
  label: string;
  status: "up" | "down" | "neutral";
  description: string;
  icon?: "trending-up" | "trending-down" | "users" | "activity" | "alert-circle";
}

export interface TimeSeriesPoint {
  date: string;
  [key: string]: number | string; // e.g., "temperature": 24.5
}

export interface AssetTableRow {
  id: string;
  name: string;
  status: string; // AssetStatus enum string
  type: string;
  location: string;
  lastReading: string;
  lastSeen: string;
  activeAlerts: number;
}

export interface PieChartData {
  name: string;
  value: number;
  fill: string;
}

// --- Adapter Functions ---

function getOnlineStatus(assets: Asset[]): MetricTrend {
  const totalAssets = assets.length;
  const onlineAssets = assets.filter((a) => a.status === AssetStatus.Online).length;

  if (totalAssets > 0) {
    return {
      title: "Online Status",
      value: `${onlineAssets}/${totalAssets}`,
      noTrendData: true,
      label: onlineAssets < totalAssets ? "All assets online" : "Some assets need attention",
      status: "neutral",
      description:
        onlineAssets < totalAssets
          ? "All assets are online and operational"
          : "Configure connections in the assets page",
      icon: "activity",
    };
  }

  return {
    title: "Online Status",
    value: "0/0",
    noTrendData: true,
    label: "No assets found",
    status: "neutral",
    description: "Please configure assets",
    icon: "activity",
  };
}

function getActiveAlertsStatus(stats: AlertStats): MetricTrend {
  const activeAlerts = stats.byStatus.unacknowledged;
  const alertTrendValue = stats.trends.weekly;

  let label: string;
  let description: string;

  if (stats.total > 0) {
    label = "vs last week";
    description = activeAlerts > 0 ? "Requires attention" : "No active alerts";
  } else {
    label = "No alert history";
    description = "System is running smoothly";
  }

  return {
    title: "Active Alerts",
    value: activeAlerts,
    trend: alertTrendValue,
    label,
    status: alertTrendValue > 0 ? "up" : alertTrendValue < 0 ? "down" : "neutral",
    description,
    icon: "alert-circle",
  };
}

function getReadingsStatus(stats: ReadingStats): MetricTrend {
  const readingsCount = stats.total;
  const readingsTrendValue = stats.dailyTrend;

  let label: string;
  let description: string;

  if (readingsCount > 0) {
    label = "vs yesterday";
    description = "Total data points collected";
  } else {
    label = "No data";
    description = "No readings recorded yet";
  }

  return {
    title: "Total Readings",
    value: readingsCount.toLocaleString(),
    trend: readingsTrendValue,
    noTrendData: false,
    label,
    status: readingsTrendValue > 0 ? "up" : readingsTrendValue < 0 ? "down" : "neutral",
    description,
    icon: "activity",
  };
}

function getSignalQualityStatus(stats: ReadingStats): MetricTrend {
  const readingsCount = stats.total;

  let value: string;
  let label: string;
  let description: string;

  if (readingsCount > 0) {
    value = `${stats.qualityScore}%`;
    label = "Good readings";
    description = "Overall data reliability";
  } else {
    value = "N/A";
    label = "No data";
    description = "No readings to analyze";
  }

  return {
    title: "Signal Quality",
    value,
    noTrendData: true,
    trend: 0,
    label,
    status: "neutral",
    description,
    icon: "activity",
  };
}

/**
 * Adapts Asset and Alert data into MetricTrends for SectionCards
 */
export function adaptToMetricTrends(
  assets: Asset[] | undefined,
  readingStats: ReadingStats | undefined,
  alertStats: AlertStats | undefined,
): MetricTrend[] {
  const safeAssets = assets ?? [];
  const safeReadingStats = readingStats ?? { total: 0, dailyTrend: 0, qualityScore: 0, trends: [] };
  const safeAlertStats = alertStats ?? {
    byStatus: { unacknowledged: 0, acknowledged: 0 },
    bySeverity: { info: 0, warning: 0, critical: 0, emergency: 0 },
    trends: { daily: 0, weekly: 0, critical: 0 },
    recentTrend: [],
    total: 0,
  };

  return [
    getOnlineStatus(safeAssets),
    getActiveAlertsStatus(safeAlertStats),
    getReadingsStatus(safeReadingStats),
    getSignalQualityStatus(safeReadingStats),
  ];
}

/**
 * Adapts raw Readings into TimeSeriesPoints for ChartAreaInteractive
 */
export function adaptReadingsToTimeSeries(readings: Reading[]): TimeSeriesPoint[] {
  const grouped = new Map<string, { sum: number; count: number }>();

  readings.forEach((reading) => {
    const date = new Date(reading.timestamp).toISOString().split("T")[0];
    const current = grouped.get(date) ?? { sum: 0, count: 0 };
    current.sum += reading.value;
    current.count += 1;
    grouped.set(date, current);
  });

  return Array.from(grouped.entries())
    .map(([date, { sum, count }]) => ({
      date,
      desktop: Math.round(sum / count),
      mobile: Math.round((sum / count) * 0.8),
    }))
    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
}

/**
 * Adapts Assets into AssetTableRows for DataTable
 */
export function adaptAssetsToTableRows(assets: Asset[]): AssetTableRow[] {
  return assets.map((asset) => ({
    id: asset.id.toString(),
    name: asset.name,
    status: asset.status,
    type: asset.type,
    location: asset.location,
    lastReading: "N/A", // Needs sensor join
    lastSeen: asset.lastSeen ? new Date(asset.lastSeen).toLocaleDateString() : "Never",
    activeAlerts: 0, // Needs alert join
  }));
}

/**
 * Adapts Assets to Pie Chart Data (by Type)
 */
export function adaptAssetsToDistribution(assets: Asset[]): PieChartData[] {
  const typeCounts = new Map<string, number>();

  assets.forEach((asset) => {
    const current = typeCounts.get(asset.type) ?? 0;
    typeCounts.set(asset.type, current + 1);
  });

  const colors = ["var(--chart-1)", "var(--chart-2)", "var(--chart-3)", "var(--chart-4)", "var(--chart-5)"];

  return Array.from(typeCounts.entries()).map(([name, value], index) => ({
    name,
    value,
    fill: colors[index % colors.length],
  }));
}
</file>

<file path="apps/moondesk-dash/src/lib/mock-data/iot-data.ts">
/* eslint-disable max-lines */
import type { Asset, Reading, DashboardStats, AssetStatus, Parameter } from "@/types/iot";

export const mockStats: DashboardStats = {
  totalAssets: 12,
  onlineAssets: 9,
  offlineAssets: 3,
  activeAlerts: 2,
};

export const mockAssets: Asset[] = [
  {
    id: 1,
    organizationId: "org_123",
    name: "Water Treatment Plant A",
    type: "Treatment Facility",
    location: "North District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 5 * 60000).toISOString(),
    manufacturer: "AquaTech",
    modelNumber: "WTP-2000",
    sensors: [
      {
        id: 101,
        assetId: 1,
        name: "pH Sensor",
        parameter: 1 as Parameter,
        unit: "pH",
        thresholdLow: 6.5,
        thresholdHigh: 8.5,
        isActive: true,
      },
      {
        id: 102,
        assetId: 1,
        name: "Chlorine Monitor",
        parameter: 2 as Parameter,
        unit: "mg/L",
        thresholdLow: 0.5,
        thresholdHigh: 2.0,
        isActive: true,
      },
      {
        id: 103,
        assetId: 1,
        name: "Turbidity Sensor",
        parameter: 10 as Parameter,
        unit: "NTU",
        thresholdHigh: 5,
        isActive: true,
      },
    ],
  },
  {
    id: 2,
    organizationId: "org_123",
    name: "Pump Station 5",
    type: "Pump Station",
    location: "East District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 2 * 60000).toISOString(),
    manufacturer: "FlowTech",
    modelNumber: "PS-500",
    sensors: [
      {
        id: 201,
        assetId: 2,
        name: "Flow Rate",
        parameter: 20 as Parameter,
        unit: "L/min",
        thresholdLow: 100,
        thresholdHigh: 500,
        isActive: true,
      },
      {
        id: 202,
        assetId: 2,
        name: "Pressure Sensor",
        parameter: 21 as Parameter,
        unit: "bar",
        thresholdLow: 2,
        thresholdHigh: 8,
        isActive: true,
      },
    ],
  },
  {
    id: 3,
    organizationId: "org_123",
    name: "Storage Tank B",
    type: "Storage",
    location: "Central District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 10 * 60000).toISOString(),
    sensors: [
      {
        id: 301,
        assetId: 3,
        name: "Level Sensor",
        parameter: 22 as Parameter,
        unit: "m",
        thresholdLow: 2,
        thresholdHigh: 10,
        isActive: true,
      },
      {
        id: 302,
        assetId: 3,
        name: "Temperature",
        parameter: 11 as Parameter,
        unit: "°C",
        thresholdLow: 5,
        thresholdHigh: 25,
        isActive: true,
      },
    ],
  },
  {
    id: 4,
    organizationId: "org_123",
    name: "Filtration Unit 3",
    type: "Filtration",
    location: "South District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 1 * 60000).toISOString(),
    sensors: [
      {
        id: 401,
        assetId: 4,
        name: "Turbidity",
        parameter: 10 as Parameter,
        unit: "NTU",
        thresholdHigh: 3,
        isActive: true,
      },
      {
        id: 402,
        assetId: 4,
        name: "Flow Rate",
        parameter: 20 as Parameter,
        unit: "L/min",
        thresholdLow: 50,
        thresholdHigh: 300,
        isActive: true,
      },
    ],
  },
  {
    id: 5,
    organizationId: "org_123",
    name: "Monitoring Station 7",
    type: "Monitoring",
    location: "West District",
    status: 2 as AssetStatus,
    lastSeen: new Date(Date.now() - 120 * 60000).toISOString(),
    sensors: [
      {
        id: 501,
        assetId: 5,
        name: "Dissolved Oxygen",
        parameter: 5 as Parameter,
        unit: "mg/L",
        thresholdLow: 5,
        isActive: false,
      },
      {
        id: 502,
        assetId: 5,
        name: "Conductivity",
        parameter: 12 as Parameter,
        unit: "μS/cm",
        thresholdHigh: 1500,
        isActive: false,
      },
    ],
  },
  {
    id: 6,
    organizationId: "org_123",
    name: "Treatment Plant C",
    type: "Treatment Facility",
    location: "North District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 3 * 60000).toISOString(),
    sensors: [
      {
        id: 601,
        assetId: 6,
        name: "pH Monitor",
        parameter: 1 as Parameter,
        unit: "pH",
        thresholdLow: 6.5,
        thresholdHigh: 8.5,
        isActive: true,
      },
      {
        id: 602,
        assetId: 6,
        name: "Free Chlorine",
        parameter: 2 as Parameter,
        unit: "mg/L",
        thresholdLow: 0.5,
        thresholdHigh: 2.0,
        isActive: true,
      },
    ],
  },
  {
    id: 7,
    organizationId: "org_123",
    name: "Pump Station 12",
    type: "Pump Station",
    location: "East District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 7 * 60000).toISOString(),
    sensors: [
      {
        id: 701,
        assetId: 7,
        name: "Pressure",
        parameter: 21 as Parameter,
        unit: "bar",
        thresholdLow: 2,
        thresholdHigh: 8,
        isActive: true,
      },
    ],
  },
  {
    id: 8,
    organizationId: "org_123",
    name: "Reservoir D",
    type: "Storage",
    location: "Central District",
    status: 3 as AssetStatus,
    lastSeen: new Date(Date.now() - 30 * 60000).toISOString(),
    sensors: [
      {
        id: 801,
        assetId: 8,
        name: "Water Level",
        parameter: 22 as Parameter,
        unit: "m",
        thresholdLow: 3,
        thresholdHigh: 12,
        isActive: true,
      },
    ],
  },
  {
    id: 9,
    organizationId: "org_123",
    name: "Quality Monitor 4",
    type: "Monitoring",
    location: "South District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 4 * 60000).toISOString(),
    sensors: [
      {
        id: 901,
        assetId: 9,
        name: "TDS Sensor",
        parameter: 13 as Parameter,
        unit: "ppm",
        thresholdHigh: 500,
        isActive: true,
      },
      {
        id: 902,
        assetId: 9,
        name: "Temperature",
        parameter: 11 as Parameter,
        unit: "°C",
        thresholdLow: 5,
        thresholdHigh: 25,
        isActive: true,
      },
    ],
  },
  {
    id: 10,
    organizationId: "org_123",
    name: "Pump Station 8",
    type: "Pump Station",
    location: "West District",
    status: 2 as AssetStatus,
    lastSeen: new Date(Date.now() - 180 * 60000).toISOString(),
    sensors: [
      {
        id: 1001,
        assetId: 10,
        name: "Flow Meter",
        parameter: 20 as Parameter,
        unit: "L/min",
        thresholdLow: 100,
        thresholdHigh: 400,
        isActive: false,
      },
    ],
  },
  {
    id: 11,
    organizationId: "org_123",
    name: "Filtration Unit 7",
    type: "Filtration",
    location: "North District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 6 * 60000).toISOString(),
    sensors: [
      {
        id: 1101,
        assetId: 11,
        name: "Turbidity Monitor",
        parameter: 10 as Parameter,
        unit: "NTU",
        thresholdHigh: 4,
        isActive: true,
      },
    ],
  },
  {
    id: 12,
    organizationId: "org_123",
    name: "Distribution Point 3",
    type: "Distribution",
    location: "East District",
    status: 2 as AssetStatus,
    lastSeen: new Date(Date.now() - 240 * 60000).toISOString(),
    sensors: [
      {
        id: 1201,
        assetId: 12,
        name: "Pressure Gauge",
        parameter: 21 as Parameter,
        unit: "bar",
        thresholdLow: 2,
        thresholdHigh: 6,
        isActive: false,
      },
    ],
  },
];

// Generate 24 hours of readings for sensor 101 (pH)
export const mockReadings: Reading[] = Array.from({ length: 48 }, (_, i) => ({
  sensorId: 101,
  timestamp: new Date(Date.now() - (47 - i) * 30 * 60000).toISOString(),
  value: 7.2 + Math.sin(i / 8) * 0.5 + (Math.random() - 0.5) * 0.2,
  parameter: 1 as Parameter,
}));
</file>

<file path="apps/moondesk-dash/src/lib/layout-utils.ts">
export function updateContentLayout(value: "centered" | "full-width") {
  const target = document.querySelector('[data-slot="sidebar-inset"]');
  if (target) {
    target.setAttribute("data-content-layout", value);
  }
}

export function updateNavbarStyle(value: "sticky" | "scroll") {
  const target = document.querySelector("header[data-navbar-style]");
  if (target) {
    target.setAttribute("data-navbar-style", value);
  }
}
</file>

<file path="apps/moondesk-dash/src/lib/theme-utils.ts">
export function updateThemeMode(value: "light" | "dark") {
  const doc = document.documentElement;
  doc.classList.add("disable-transitions");
  doc.classList.toggle("dark", value === "dark");
  requestAnimationFrame(() => {
    doc.classList.remove("disable-transitions");
  });
}

export function updateThemePreset(value: string) {
  document.documentElement.setAttribute("data-theme-preset", value);
}
</file>

<file path="apps/moondesk-dash/src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

export const getInitials = (str: string): string => {
  if (typeof str !== "string" || !str.trim()) return "?";

  return (
    str
      .trim()
      .split(/\s+/)
      .filter(Boolean)
      .map((word) => word[0])
      .join("")
      .toUpperCase() || "?"
  );
};

export function formatCurrency(
  amount: number,
  opts?: {
    currency?: string;
    locale?: string;
    minimumFractionDigits?: number;
    maximumFractionDigits?: number;
    noDecimals?: boolean;
  },
) {
  const { currency = "USD", locale = "en-US", minimumFractionDigits, maximumFractionDigits, noDecimals } = opts ?? {};

  const formatOptions: Intl.NumberFormatOptions = {
    style: "currency",
    currency,
    minimumFractionDigits: noDecimals ? 0 : minimumFractionDigits,
    maximumFractionDigits: noDecimals ? 0 : maximumFractionDigits,
  };

  return new Intl.NumberFormat(locale, formatOptions).format(amount);
}
</file>

<file path="apps/moondesk-dash/src/navigation/sidebar/sidebar-items.ts">
import {
  Mail,
  Logs,
  ReceiptText,
  Users,
  Lock,
  LayoutDashboard,
  ChartBar,
  Banknote,
  Gauge,
  type LucideIcon,
  Settings,
} from "lucide-react";

export interface NavSubItem {
  title: string;
  url: string;
  icon?: LucideIcon;
  comingSoon?: boolean;
  newTab?: boolean;
  isNew?: boolean;
}

export interface NavMainItem {
  title: string;
  url: string;
  icon?: LucideIcon;
  subItems?: NavSubItem[];
  comingSoon?: boolean;
  newTab?: boolean;
  isNew?: boolean;
}

export interface NavGroup {
  id: number;
  label?: string;
  items: NavMainItem[];
}

export const sidebarItems: NavGroup[] = [
  {
    id: 1,
    label: "Dashboards",
    items: [
      {
        title: "Overview",
        url: "/dashboard/overview",
        icon: LayoutDashboard,
      },
      {
        title: "Inventory",
        url: "/dashboard/assets",
        icon: ChartBar,
      },
      {
        title: "Analytics",
        url: "/dashboard/coming-soon",
        icon: Gauge,
        comingSoon: true,
      },
      {
        title: "Settings",
        url: "dashboard/settings",
        icon: Settings,
      },
      {
        title: "Logs",
        url: "/dashboard/logs",
        icon: Logs,
      },
    ],
  },
  {
    id: 2,
    label: "Pages",
    items: [
      {
        title: "Email",
        url: "/dashboard/coming-soon",
        icon: Mail,
        comingSoon: true,
      },
      {
        title: "Invoice",
        url: "/dashboard/coming-soon",
        icon: ReceiptText,
        comingSoon: true,
      },
      {
        title: "Users",
        url: "/dashboard/coming-soon",
        icon: Users,
        comingSoon: true,
      },
      {
        title: "Roles",
        url: "/dashboard/coming-soon",
        icon: Lock,
        comingSoon: true,
      },
    ],
  },
];
</file>

<file path="apps/moondesk-dash/src/scripts/generate-theme-presets.ts">
/**
 * Script: generate-theme-presets.ts
 *
 * This script scans the /styles/presets directory for CSS files containing theme definitions.
 * It extracts `label:`, `value:`, and primary color definitions (`--primary`) for both light and dark modes.
 * These primary colors are used to visually represent each theme in the UI (e.g., colored dots or theme previews).
 * Default theme colors are fetched from /app/globals.css.
 * All extracted metadata is injected into a marked section of the /types/preferences/theme.ts file.
 *
 * Usage:
 * - During local development, run manually after adding any new theme preset:
 *     npm run generate:presets
 * - Ensure that each new CSS preset includes `label:` and `value:` comments.
 * - This generation step is currently automated using a Husky pre-push hook.
 * - You may optionally integrate it directly into a build step if preferred.
 */
import fs from "fs";
import path from "path";

import prettier from "prettier";

const presetDir = path.resolve(__dirname, "../styles/presets");

if (!fs.existsSync(presetDir)) {
  console.error(`❌ Preset directory not found at: ${presetDir}`);
  process.exit(1);
}

const outputPath = path.resolve(__dirname, "../types/preferences/theme.ts");

const files = fs.readdirSync(presetDir).filter((file) => file.endsWith(".css"));

if (files.length === 0) {
  console.warn("⚠️ No preset CSS files found. Only default preset will be included.");
}

// eslint-disable-next-line complexity
const presets = files.map((file) => {
  const filePath = path.join(presetDir, file);
  // eslint-disable-next-line security/detect-non-literal-fs-filename
  const content = fs.readFileSync(filePath, "utf8");

  const labelMatch = content.match(/label:\s*(.+)/);
  const valueMatch = content.match(/value:\s*(.+)/);

  if (!labelMatch) {
    console.warn(`⚠️ No 'label:' found in ${file}, using filename as fallback.`);
  }
  if (!valueMatch) {
    console.warn(`⚠️ No 'value:' found in ${file}, using filename as fallback.`);
  }

  const label = labelMatch?.[1]?.trim() ?? file.replace(".css", "");
  const value = valueMatch?.[1]?.trim() ?? file.replace(".css", "");

  const lightPrimaryMatch = content.match(/:root\[data-theme-preset="[^"]*"\][\s\S]*?--primary:\s*([^;]+);/);
  const darkPrimaryMatch = content.match(/\.dark:root\[data-theme-preset="[^"]*"\][\s\S]*?--primary:\s*([^;]+);/);

  const primary = {
    light: lightPrimaryMatch?.[1]?.trim() ?? "",
    dark: darkPrimaryMatch?.[1]?.trim() ?? "",
  };

  if (!lightPrimaryMatch || !darkPrimaryMatch) {
    console.warn(`⚠️ Missing --primary for ${file} (light or dark). Check CSS syntax.`);
  }

  return { label, value, primary };
});

const globalStylesPath = path.resolve(__dirname, "../app/globals.css");

let globalContent = "";
try {
  globalContent = fs.readFileSync(globalStylesPath, "utf8");
} catch (err) {
  console.error(`❌ Could not read globals.css at ${globalStylesPath}`);
  console.error(err);
  process.exit(1);
}

const defaultLightPrimaryRegex = /:root\s*{[^}]*--primary:\s*([^;]+);/;
const defaultDarkPrimaryRegex = /\.dark\s*{[^}]*--primary:\s*([^;]+);/;

const defaultLightPrimaryMatch = defaultLightPrimaryRegex.exec(globalContent);
const defaultDarkPrimaryMatch = defaultDarkPrimaryRegex.exec(globalContent);

const defaultPrimary = {
  light: defaultLightPrimaryMatch?.[1]?.trim() ?? "",
  dark: defaultDarkPrimaryMatch?.[1]?.trim() ?? "",
};

presets.unshift({ label: "Default", value: "default", primary: defaultPrimary });

const generatedBlock = `// --- generated:themePresets:start ---

export const THEME_PRESET_OPTIONS = ${JSON.stringify(presets, null, 2)} as const;

export const THEME_PRESET_VALUES = THEME_PRESET_OPTIONS.map((p) => p.value);

export type ThemePreset = (typeof THEME_PRESET_OPTIONS)[number]["value"];

// --- generated:themePresets:end ---`;

const fileContent = fs.readFileSync(outputPath, "utf8");

const updated = fileContent.replace(
  /\/\/ --- generated:themePresets:start ---[\s\S]*?\/\/ --- generated:themePresets:end ---/,
  generatedBlock,
);

async function main() {
  const formatted = await prettier.format(updated, { parser: "typescript" });

  if (formatted === fileContent) {
    console.log("ℹ️  No changes in theme.ts");
    return;
  }

  fs.writeFileSync(outputPath, formatted);
  console.log("✅ theme.ts updated with new theme presets");
}

main().catch((err) => {
  console.error("❌ Unexpected error while generating theme presets:", err);
  process.exit(1);
});
</file>

<file path="apps/moondesk-dash/src/server/server-actions.ts">
"use server";

import { cookies } from "next/headers";

export async function getValueFromCookie(key: string): Promise<string | undefined> {
  const cookieStore = await cookies();
  return cookieStore.get(key)?.value;
}

export async function setValueToCookie(
  key: string,
  value: string,
  options: { path?: string; maxAge?: number } = {},
): Promise<void> {
  const cookieStore = await cookies();
  cookieStore.set(key, value, {
    path: options.path ?? "/",
    maxAge: options.maxAge ?? 60 * 60 * 24 * 7, // default: 7 days
  });
}

export async function getPreference<T extends string>(key: string, allowed: readonly T[], fallback: T): Promise<T> {
  const cookieStore = await cookies();
  const cookie = cookieStore.get(key);
  const value = cookie ? cookie.value.trim() : undefined;
  return allowed.includes(value as T) ? (value as T) : fallback;
}
</file>

<file path="apps/moondesk-dash/src/services/api-client.ts">
import { auth } from "@clerk/nextjs/server";
import axios, { type AxiosInstance, type AxiosRequestConfig } from "axios";

// API Client with Clerk JWT integration
class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: process.env.NEXT_PUBLIC_API_URL ?? "http://localhost:5000",
      headers: {
        "Content-Type": "application/json",
      },
    });
  }

  // Attach Clerk JWT token to requests
  private async getAuthHeaders() {
    const { getToken } = await auth();
    const token = await getToken();

    return token
      ? {
          Authorization: `Bearer ${token}`,
        }
      : {};
  }

  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.get<T>(url, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }

  async post<T>(url: string, data?: unknown, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.post<T>(url, data, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }

  async put<T>(url: string, data?: unknown, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.put<T>(url, data, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }

  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.delete<T>(url, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }
}

export const apiClient = new ApiClient();
</file>

<file path="apps/moondesk-dash/src/services/device-service.ts">

</file>

<file path="apps/moondesk-dash/src/stores/preferences/preferences-provider.tsx">
"use client";

import { createContext, useContext, useRef } from "react";

import { useStore, type StoreApi } from "zustand";

import { createPreferencesStore, PreferencesState } from "./preferences-store";

const PreferencesStoreContext = createContext<StoreApi<PreferencesState> | null>(null);

export const PreferencesStoreProvider = ({
  children,
  themeMode,
  themePreset,
}: {
  children: React.ReactNode;
  themeMode: PreferencesState["themeMode"];
  themePreset: PreferencesState["themePreset"];
}) => {
  const storeRef = useRef<StoreApi<PreferencesState> | null>(null);

  storeRef.current ??= createPreferencesStore({ themeMode, themePreset });

  return <PreferencesStoreContext.Provider value={storeRef.current}>{children}</PreferencesStoreContext.Provider>;
};

export const usePreferencesStore = <T,>(selector: (state: PreferencesState) => T): T => {
  const store = useContext(PreferencesStoreContext);
  if (!store) throw new Error("Missing PreferencesStoreProvider");
  return useStore(store, selector);
};
</file>

<file path="apps/moondesk-dash/src/stores/preferences/preferences-store.ts">
import { createStore } from "zustand/vanilla";

import type { ThemeMode, ThemePreset } from "@/types/preferences/theme";

export type PreferencesState = {
  themeMode: ThemeMode;
  themePreset: ThemePreset;
  setThemeMode: (mode: ThemeMode) => void;
  setThemePreset: (preset: ThemePreset) => void;
};

export const createPreferencesStore = (init?: Partial<PreferencesState>) =>
  createStore<PreferencesState>()((set) => ({
    themeMode: init?.themeMode ?? "light",
    themePreset: init?.themePreset ?? "default",
    setThemeMode: (mode) => set({ themeMode: mode }),
    setThemePreset: (preset) => set({ themePreset: preset }),
  }));
</file>

<file path="apps/moondesk-dash/src/styles/presets/brutalist.css">
/* 
label: Brutalist
value: brutalist 
*/

:root[data-theme-preset="brutalist"] {
  --radius: 0px;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0 0 0);
  --primary: oklch(0.6489 0.237 26.9728);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.968 0.211 109.7692);
  --secondary-foreground: oklch(0 0 0);
  --muted: oklch(0.9551 0 0);
  --muted-foreground: oklch(0.3211 0 0);
  --accent: oklch(0.5635 0.2408 260.8178);
  --accent-foreground: oklch(1 0 0);
  --destructive: oklch(0 0 0);
  --border: oklch(0 0 0);
  --input: oklch(0 0 0);
  --ring: oklch(0.6489 0.237 26.9728);
  --chart-1: oklch(0.6489 0.237 26.9728);
  --chart-2: oklch(0.968 0.211 109.7692);
  --chart-3: oklch(0.5635 0.2408 260.8178);
  --chart-4: oklch(0.7323 0.2492 142.4953);
  --chart-5: oklch(0.5931 0.2726 328.3634);
  --sidebar: oklch(0.9551 0 0);
  --sidebar-foreground: oklch(0 0 0);
  --sidebar-primary: oklch(0.6489 0.237 26.9728);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.5635 0.2408 260.8178);
  --sidebar-accent-foreground: oklch(1 0 0);
  --sidebar-border: oklch(0 0 0);
  --sidebar-ring: oklch(0.6489 0.237 26.9728);
  --background: oklch(1 0 0);
  --foreground: oklch(0 0 0);
  --shadow-2xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-sm: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow-md: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 2px 4px -1px hsl(0 0% 0% / 1);
  --shadow-lg: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 4px 6px -1px hsl(0 0% 0% / 1);
  --shadow-xl: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 8px 10px -1px hsl(0 0% 0% / 1);
  --shadow-2xl: 4px 4px 0px 0px hsl(0 0% 0% / 2.5);
}

.dark:root[data-theme-preset="brutalist"] {
  --background: oklch(0 0 0);
  --foreground: oklch(1 0 0);
  --card: oklch(0.3211 0 0);
  --card-foreground: oklch(1 0 0);
  --popover: oklch(0.3211 0 0);
  --popover-foreground: oklch(1 0 0);
  --primary: oklch(0.7044 0.1872 23.1858);
  --primary-foreground: oklch(0 0 0);
  --secondary: oklch(0.9691 0.2005 109.6228);
  --secondary-foreground: oklch(0 0 0);
  --muted: oklch(0.3211 0 0);
  --muted-foreground: oklch(0.8452 0 0);
  --accent: oklch(0.6755 0.1765 252.2592);
  --accent-foreground: oklch(0 0 0);
  --destructive: oklch(1 0 0);
  --border: oklch(1 0 0);
  --input: oklch(1 0 0);
  --ring: oklch(0.7044 0.1872 23.1858);
  --chart-1: oklch(0.7044 0.1872 23.1858);
  --chart-2: oklch(0.9691 0.2005 109.6228);
  --chart-3: oklch(0.6755 0.1765 252.2592);
  --chart-4: oklch(0.7395 0.2268 142.8504);
  --chart-5: oklch(0.6131 0.2458 328.0714);
  --sidebar: oklch(0 0 0);
  --sidebar-foreground: oklch(1 0 0);
  --sidebar-primary: oklch(0.7044 0.1872 23.1858);
  --sidebar-primary-foreground: oklch(0 0 0);
  --sidebar-accent: oklch(0.6755 0.1765 252.2592);
  --sidebar-accent-foreground: oklch(0 0 0);
  --sidebar-border: oklch(1 0 0);
  --sidebar-ring: oklch(0.7044 0.1872 23.1858);
  --shadow-2xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-sm: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow-md: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 2px 4px -1px hsl(0 0% 0% / 1);
  --shadow-lg: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 4px 6px -1px hsl(0 0% 0% / 1);
  --shadow-xl: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 8px 10px -1px hsl(0 0% 0% / 1);
  --shadow-2xl: 4px 4px 0px 0px hsl(0 0% 0% / 2.5);
}
</file>

<file path="apps/moondesk-dash/src/styles/presets/soft-pop.css">
/* 
label: Soft Pop
value: soft-pop 
*/

:root[data-theme-preset="soft-pop"] {
  --radius: 1rem;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0 0 0);
  --primary: oklch(0.5106 0.2301 276.9656);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.7038 0.123 182.5025);
  --secondary-foreground: oklch(1 0 0);
  --muted: oklch(0.9551 0 0);
  --muted-foreground: oklch(0.3211 0 0);
  --accent: oklch(0.7686 0.1647 70.0804);
  --accent-foreground: oklch(0 0 0);
  --destructive: oklch(0.6368 0.2078 25.3313);
  --border: oklch(0 0 0);
  --input: oklch(0.5555 0 0);
  --ring: oklch(0.7853 0.1041 274.7134);
  --chart-1: oklch(0.5106 0.2301 276.9656);
  --chart-2: oklch(0.7038 0.123 182.5025);
  --chart-3: oklch(0.7686 0.1647 70.0804);
  --chart-4: oklch(0.6559 0.2118 354.3084);
  --chart-5: oklch(0.7227 0.192 149.5793);
  --sidebar: oklch(0.9789 0.0082 121.6272);
  --sidebar-foreground: oklch(0 0 0);
  --sidebar-primary: oklch(0.5106 0.2301 276.9656);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.7686 0.1647 70.0804);
  --sidebar-accent-foreground: oklch(0 0 0);
  --sidebar-border: oklch(0 0 0);
  --sidebar-ring: oklch(0.7853 0.1041 274.7134);
  --background: oklch(0.9789 0.0082 121.6272);
  --foreground: oklch(0 0 0);
  --shadow-2xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-sm: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-md: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 2px 4px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-lg: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 4px 6px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 8px 10px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-2xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.13);
}

.dark:root[data-theme-preset="soft-pop"] {
  --background: oklch(0 0 0);
  --foreground: oklch(1 0 0);
  --card: oklch(0.2455 0.0217 257.2823);
  --card-foreground: oklch(1 0 0);
  --popover: oklch(0.2455 0.0217 257.2823);
  --popover-foreground: oklch(1 0 0);
  --primary: oklch(0.6801 0.1583 276.9349);
  --primary-foreground: oklch(0 0 0);
  --secondary: oklch(0.7845 0.1325 181.912);
  --secondary-foreground: oklch(0 0 0);
  --muted: oklch(0.3211 0 0);
  --muted-foreground: oklch(0.8452 0 0);
  --accent: oklch(0.879 0.1534 91.6054);
  --accent-foreground: oklch(0 0 0);
  --destructive: oklch(0.7106 0.1661 22.2162);
  --border: oklch(0.4459 0 0);
  --input: oklch(1 0 0);
  --ring: oklch(0.6801 0.1583 276.9349);
  --chart-1: oklch(0.6801 0.1583 276.9349);
  --chart-2: oklch(0.7845 0.1325 181.912);
  --chart-3: oklch(0.879 0.1534 91.6054);
  --chart-4: oklch(0.7253 0.1752 349.7607);
  --chart-5: oklch(0.8003 0.1821 151.711);
  --sidebar: oklch(0 0 0);
  --sidebar-foreground: oklch(1 0 0);
  --sidebar-primary: oklch(0.6801 0.1583 276.9349);
  --sidebar-primary-foreground: oklch(0 0 0);
  --sidebar-accent: oklch(0.879 0.1534 91.6054);
  --sidebar-accent-foreground: oklch(0 0 0);
  --sidebar-border: oklch(1 0 0);
  --sidebar-ring: oklch(0.6801 0.1583 276.9349);
  --shadow-2xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-sm: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-md: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 2px 4px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-lg: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 4px 6px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 8px 10px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-2xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.13);
}
</file>

<file path="apps/moondesk-dash/src/styles/presets/tangerine.css">
/* 
label: Tangerine
value: tangerine  
*/

:root[data-theme-preset="tangerine"] {
  --radius: 0.625rem;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.32 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.32 0 0);
  --primary: oklch(0.64 0.17 36.44);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.97 0 264.54);
  --secondary-foreground: oklch(0.45 0.03 256.8);
  --muted: oklch(0.98 0 247.84);
  --muted-foreground: oklch(0.55 0.02 264.36);
  --accent: oklch(0.91 0.02 243.82);
  --accent-foreground: oklch(0.38 0.14 265.52);
  --destructive: oklch(0.64 0.21 25.33);
  --border: oklch(0.9 0.01 247.88);
  --input: oklch(0.97 0 264.54);
  --ring: oklch(0.64 0.17 36.44);
  --chart-1: oklch(0.72 0.06 248.68);
  --chart-2: oklch(0.79 0.09 35.96);
  --chart-3: oklch(0.58 0.08 254.16);
  --chart-4: oklch(0.5 0.08 259.49);
  --chart-5: oklch(0.42 0.1 264.03);
  --sidebar: oklch(0.9 0 258.33);
  --sidebar-foreground: oklch(0.32 0 0);
  --sidebar-primary: oklch(0.64 0.17 36.44);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.91 0.02 243.82);
  --sidebar-accent-foreground: oklch(0.38 0.14 265.52);
  --sidebar-border: oklch(0.93 0.01 264.53);
  --sidebar-ring: oklch(0.64 0.17 36.44);
  --background: oklch(0.94 0 236.5);
  --foreground: oklch(0.32 0 0);
  --shadow-2xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-sm: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow-md: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 2px 4px -1px hsl(0 0% 0% / 0.1);
  --shadow-lg: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 4px 6px -1px hsl(0 0% 0% / 0.1);
  --shadow-xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 8px 10px -1px hsl(0 0% 0% / 0.1);
  --shadow-2xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.25);
}

.dark:root[data-theme-preset="tangerine"] {
  --background: oklch(0.26 0.03 262.67);
  --foreground: oklch(0.92 0 0);
  --card: oklch(0.31 0.03 268.64);
  --card-foreground: oklch(0.92 0 0);
  --popover: oklch(0.29 0.02 268.4);
  --popover-foreground: oklch(0.92 0 0);
  --primary: oklch(0.64 0.17 36.44);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.31 0.03 266.71);
  --secondary-foreground: oklch(0.92 0 0);
  --muted: oklch(0.31 0.03 266.71);
  --muted-foreground: oklch(0.72 0 0);
  --accent: oklch(0.34 0.06 267.59);
  --accent-foreground: oklch(0.88 0.06 254.13);
  --destructive: oklch(0.64 0.21 25.33);
  --border: oklch(0.38 0.03 269.73);
  --input: oklch(0.38 0.03 269.73);
  --ring: oklch(0.64 0.17 36.44);
  --chart-1: oklch(0.72 0.06 248.68);
  --chart-2: oklch(0.77 0.09 34.19);
  --chart-3: oklch(0.58 0.08 254.16);
  --chart-4: oklch(0.5 0.08 259.49);
  --chart-5: oklch(0.42 0.1 264.03);
  --sidebar: oklch(0.31 0.03 267.74);
  --sidebar-foreground: oklch(0.92 0 0);
  --sidebar-primary: oklch(0.64 0.17 36.44);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.34 0.06 267.59);
  --sidebar-accent-foreground: oklch(0.88 0.06 254.13);
  --sidebar-border: oklch(0.38 0.03 269.73);
  --sidebar-ring: oklch(0.64 0.17 36.44);
  --shadow-2xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-sm: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow-md: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 2px 4px -1px hsl(0 0% 0% / 0.1);
  --shadow-lg: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 4px 6px -1px hsl(0 0% 0% / 0.1);
  --shadow-xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 8px 10px -1px hsl(0 0% 0% / 0.1);
  --shadow-2xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.25);
}
</file>

<file path="apps/moondesk-dash/src/styles/clerk-custom.css">

</file>

<file path="apps/moondesk-dash/src/test/setup.ts">
import "@testing-library/jest-dom";
import { cleanup } from "@testing-library/react";
import { afterEach } from "vitest";

// Mock ResizeObserver for Recharts
global.ResizeObserver = class ResizeObserver {
  observe() {}
  unobserve() {}
  disconnect() {}
};

afterEach(() => {
  cleanup();
});
</file>

<file path="apps/moondesk-dash/src/test/utils.tsx">
import { ReactElement } from "react";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { render, RenderOptions } from "@testing-library/react";

const createTestQueryClient = () =>
  new QueryClient({
    defaultOptions: {
      queries: { retry: false },
      mutations: { retry: false },
    },
  });

export function renderWithProviders(ui: ReactElement, options?: Omit<RenderOptions, "wrapper">) {
  const queryClient = createTestQueryClient();

  return render(ui, {
    wrapper: ({ children }) => <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>,
    ...options,
  });
}
</file>

<file path="apps/moondesk-dash/src/types/preferences/layout.ts">
// Sidebar Variant
export const SIDEBAR_VARIANT_OPTIONS = [
  { label: "Inset", value: "inset" },
  { label: "Sidebar", value: "sidebar" },
  { label: "Floating", value: "floating" },
] as const;
export const SIDEBAR_VARIANT_VALUES = SIDEBAR_VARIANT_OPTIONS.map((v) => v.value);
export type SidebarVariant = (typeof SIDEBAR_VARIANT_VALUES)[number];

// Sidebar Collapsible
export const SIDEBAR_COLLAPSIBLE_OPTIONS = [
  { label: "Icon", value: "icon" },
  { label: "Offcanvas", value: "offcanvas" },
] as const;
export const SIDEBAR_COLLAPSIBLE_VALUES = SIDEBAR_COLLAPSIBLE_OPTIONS.map((v) => v.value);
export type SidebarCollapsible = (typeof SIDEBAR_COLLAPSIBLE_VALUES)[number];

// Content Layout
export const CONTENT_LAYOUT_OPTIONS = [
  { label: "Centered", value: "centered" },
  { label: "Full Width", value: "full-width" },
] as const;
export const CONTENT_LAYOUT_VALUES = CONTENT_LAYOUT_OPTIONS.map((v) => v.value);
export type ContentLayout = (typeof CONTENT_LAYOUT_VALUES)[number];

// Navbar Style
export const NAVBAR_STYLE_OPTIONS = [
  { label: "Sticky", value: "sticky" },
  { label: "Scroll", value: "scroll" },
] as const;
export const NAVBAR_STYLE_VALUES = NAVBAR_STYLE_OPTIONS.map((v) => v.value);
export type NavbarStyle = (typeof NAVBAR_STYLE_VALUES)[number];
</file>

<file path="apps/moondesk-dash/src/types/preferences/theme.ts">
export const THEME_MODE_OPTIONS = [
  {
    label: "Light",
    value: "light",
  },
  {
    label: "Dark",
    value: "dark",
  },
] as const;

export const THEME_MODE_VALUES = THEME_MODE_OPTIONS.map((m) => m.value);

export type ThemeMode = (typeof THEME_MODE_VALUES)[number];

// --- generated:themePresets:start ---

export const THEME_PRESET_OPTIONS = [
  {
    label: "Default",
    value: "default",
    primary: {
      light: "oklch(0.205 0 0)",
      dark: "oklch(0.922 0 0)",
    },
  },
  {
    label: "Brutalist",
    value: "brutalist",
    primary: {
      light: "oklch(0.6489 0.2370 26.9728)",
      dark: "oklch(0.7044 0.1872 23.1858)",
    },
  },
  {
    label: "Soft Pop",
    value: "soft-pop",
    primary: {
      light: "oklch(0.5106 0.2301 276.9656)",
      dark: "oklch(0.6801 0.1583 276.9349)",
    },
  },
  {
    label: "Tangerine",
    value: "tangerine",
    primary: {
      light: "oklch(0.64 0.17 36.44)",
      dark: "oklch(0.64 0.17 36.44)",
    },
  },
] as const;

export const THEME_PRESET_VALUES = THEME_PRESET_OPTIONS.map((p) => p.value);

export type ThemePreset = (typeof THEME_PRESET_OPTIONS)[number]["value"];

// --- generated:themePresets:end ---
</file>

<file path="apps/moondesk-dash/src/types/iot.ts">
export enum AssetStatus {
  Unknown = 0,
  Online = 1,
  Offline = 2,
  Maintenance = 3,
  Error = 4,
}

export enum AlertSeverity {
  Info = 0,
  Warning = 1,
  Critical = 2,
}

export enum Parameter {
  None = 0,
  pH = 1,
  FreeChlorine = 2,
  TotalChlorine = 3,
  Fluoride = 4,
  DissolvedOxygen = 5,
  Turbidity = 10,
  Temperature = 11,
  Conductivity = 12,
  TotalDissolvedSolids = 13,
  FlowRate = 20,
  Pressure = 21,
  Level = 22,
}

export interface Asset {
  id: number;
  organizationId: string;
  name: string;
  type: string;
  location: string;
  status: AssetStatus;
  lastSeen?: string;
  description?: string;
  manufacturer?: string;
  modelNumber?: string;
  sensors: Sensor[];
}

export interface Sensor {
  id: number;
  assetId: number;
  name: string;
  parameter: Parameter;
  unit: string;
  thresholdLow?: number;
  thresholdHigh?: number;
  isActive: boolean;
}

export interface Reading {
  sensorId: number;
  timestamp: string;
  value: number;
  parameter: Parameter;
}

export interface Alert {
  id: number;
  sensorId: number;
  timestamp: string;
  severity: AlertSeverity;
  message: string;
  triggerValue: number;
  acknowledged: boolean;
}

export interface DashboardStats {
  totalAssets: number;
  onlineAssets: number;
  offlineAssets: number;
  activeAlerts: number;
}
</file>

<file path="apps/moondesk-dash/src/config.ts">
import packageJson from "../package.json";

const currentYear = new Date().getFullYear();

export const APP_CONFIG = {
  name: "Moondesk",
  version: packageJson.version,
  copyright: `© ${currentYear}, Moondesk.`,
  meta: {
    title: "Moondesk - Industrial IoT Dashboard",
    description:
      "Moondesk is a modern Industrial IoT dashboard for monitoring and managing industrial assets. Track solar panels, PLCs, sensors, and more in real-time.",
  },
};
</file>

<file path="apps/moondesk-dash/src/instrumentation-client.ts">
// This file configures the initialization of Sentry on the client.
// The added config here will be used whenever a users loads a page in their browser.
// https://docs.sentry.io/platforms/javascript/guides/nextjs/

import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: "https://12d4e362381e912751acf2f4d2ea7e21@o4509589925527552.ingest.de.sentry.io/4510518434463824",

  // Define how likely traces are sampled. Adjust this value in production, or use tracesSampler for greater control.
  tracesSampleRate: 1,
  // Enable logs to be sent to Sentry
  enableLogs: true,

  // Enable sending user PII (Personally Identifiable Information)
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
});

export const onRouterTransitionStart = Sentry.captureRouterTransitionStart;
</file>

<file path="apps/moondesk-dash/src/instrumentation.ts">
import * as Sentry from "@sentry/nextjs";

export async function register() {
  if (process.env.NEXT_RUNTIME === "nodejs") {
    await import("../sentry.server.config");
  }

  if (process.env.NEXT_RUNTIME === "edge") {
    await import("../sentry.edge.config");
  }
}

export const onRequestError = Sentry.captureRequestError;
</file>

<file path="apps/moondesk-dash/src/proxy.disabled.ts">
// Proxy disabled.
// Rename this file to `proxy.ts` to enable it.
import { NextRequest, NextResponse } from "next/server";

/**
 * Runs before requests complete.
 * Use for rewrites, redirects, or header changes.
 * Refer to Next.js Proxy docs for more examples.
 */
export function proxy(req: NextRequest) {
  // Example: redirect to dashboard if user is logged in
  // const token = req.cookies.get("session_token")?.value;
  // if (token && req.nextUrl.pathname === "/auth/login")
  //   return NextResponse.redirect(new URL("/dashboard", req.url));

  return NextResponse.next();
}

/**
 * Matcher runs for all routes.
 * To skip assets or APIs, use a negative matcher from docs.
 */
export const config = {
  matcher: "/:path*",
};
</file>

<file path="apps/moondesk-dash/src/proxy.ts">
import { clerkMiddleware, createRouteMatcher } from "@clerk/nextjs/server";

const isPublicRoute = createRouteMatcher([
  "/",
  "/auth/v1/login(.*)",
  "/auth/v1/register(.*)",
  "/auth/v2/login(.*)",
  "/auth/v2/register(.*)",
  "/sso-callback(.*)",
]);

export default clerkMiddleware(async (auth, request) => {
  if (!isPublicRoute(request)) {
    await auth.protect();
  }
});

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    "/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)",
    // Always run for API routes
    "/(api|trpc)(.*)",
  ],
};
</file>

<file path="apps/moondesk-dash/.env.local.example">
# Clerk Authentication Keys
# Get these from https://dashboard.clerk.com
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Clerk URLs (using v2 auth pages)
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/auth/v2/login
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/auth/v2/register
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_ORGANIZATION_PROFILE_URL=/organization

# Backend API URL (your .NET C# backend)
NEXT_PUBLIC_API_URL=http://localhost:5000
</file>

<file path="apps/moondesk-dash/.gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js
.yarn/install-state.gz

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem
*.sh

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# local env files
.env*.local

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# Sentry Config File
.env.sentry-build-plugin
</file>

<file path="apps/moondesk-dash/.prettierignore">
node_modules
.next
.prettierrc
components.json
next.config.mjs
package-lock.json
package.json
postcss.config.mjs
README.md
tsconfig.json
.env
src/components/ui
</file>

<file path="apps/moondesk-dash/.prettierrc">
{
  "semi": true,
  "singleQuote": false,
  "trailingComma": "all",
  "tabWidth": 2,
  "printWidth": 120,
  "bracketSpacing": true,
  "plugins": ["prettier-plugin-tailwindcss"]
}
</file>

<file path="apps/moondesk-dash/CLERK_AUTH_INTEGRATION.md">
# Clerk Authentication Integration

This document outlines the Clerk authentication integration into the existing custom auth components (v1 and v2).

## Changes Made

### 1. Updated App Configuration

- **File**: `src/config.ts`
- Changed app name from "Studio Admin" to "Moondesk"
- Updated meta title and description for Industrial IoT focus

### 2. Updated README

- **File**: `README.md`
- Replaced generic admin template content with Moondesk IIoT dashboard information
- Added proper tech stack and features for industrial IoT

### 3. Integrated Clerk into Login Form

- **File**: `src/app/(main)/auth/_components/login-form.tsx`
- Added Clerk's `useSignIn` hook
- Implemented email/password authentication with Clerk
- Added loading states and error handling
- Redirects to `/dashboard/iiot` on successful login

### 4. Integrated Clerk into Register Form

- **File**: `src/app/(main)/auth/_components/register-form.tsx`
- Added Clerk's `useSignUp` hook
- Implemented email/password registration with Clerk
- Added email verification flow (sends code, user verifies)
- Shows verification code input after initial registration
- Redirects to `/dashboard/iiot` after successful verification

### 5. Updated Google OAuth Button

- **File**: `src/app/(main)/auth/_components/social-auth/google-button.tsx`
- Integrated Clerk's OAuth authentication
- Uses `authenticateWithRedirect` for Google sign-in
- Redirects to SSO callback page

### 6. Created SSO Callback Page

- **File**: `src/app/sso-callback/page.tsx`
- Handles OAuth redirects from Google and other providers
- Uses Clerk's `AuthenticateWithRedirectCallback` component

### 7. Updated Auth Pages with Moondesk Branding

- **Files**:
  - `src/app/(main)/auth/v1/login/page.tsx`
  - `src/app/(main)/auth/v1/register/page.tsx`
  - `src/app/(main)/auth/v2/layout.tsx`
- Replaced generic Command icon with Factory icon (industrial theme)
- Updated copy to reflect Moondesk and Industrial IoT focus
- Maintained original v1 and v2 design layouts

### 8. Updated Sign-In/Sign-Up Pages

- **Files**:
  - `src/app/sign-in/[[...sign-in]]/page.tsx`
  - `src/app/sign-up/[[...sign-up]]/page.tsx`
- Added Moondesk branding and Factory icon
- Wrapped Clerk's default components with custom styling
- These are fallback pages; main auth uses v1/v2 custom components

## Authentication Flow

### Email/Password Login (v1 or v2)

1. User enters email and password
2. Form validates with Zod schema
3. Clerk's `signIn.create()` authenticates user
4. On success, redirects to `/dashboard/iiot`
5. On error, shows toast notification

### Email/Password Registration (v1 or v2)

1. User enters email, password, and confirms password
2. Form validates with Zod schema (including password match)
3. Clerk's `signUp.create()` creates account
4. Clerk sends verification code to email
5. User enters verification code
6. Clerk's `attemptEmailAddressVerification()` verifies code
7. On success, redirects to `/dashboard/iiot`

### Google OAuth

1. User clicks "Continue with Google"
2. Clerk redirects to Google OAuth
3. User authorizes on Google
4. Google redirects to `/sso-callback`
5. Clerk completes authentication
6. Redirects to `/dashboard/iiot`

## Available Auth Routes

- `/auth/v1/login` - Version 1 login page (split layout)
- `/auth/v1/register` - Version 1 register page (split layout)
- `/auth/v2/login` - Version 2 login page (centered with sidebar)
- `/auth/v2/register` - Version 2 register page (centered with sidebar)
- `/sign-in` - Fallback Clerk default sign-in (with custom wrapper)
- `/sign-up` - Fallback Clerk default sign-up (with custom wrapper)
- `/sso-callback` - OAuth callback handler

## Environment Variables Required

Make sure these are set in `.env.local`:

```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/auth/v2/login
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/auth/v2/register
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard/iiot
```

## Design Preserved

Both v1 and v2 auth page designs have been preserved:

- **v1**: Split layout with colored sidebar (left for login, right for register)
- **v2**: Centered form with large colored sidebar panel

All original styling, layouts, and visual designs remain intact. Only the authentication logic has been replaced with Clerk integration.

## Next Steps

1. Configure Clerk dashboard with Google OAuth provider
2. Test email verification flow
3. Test Google OAuth flow
4. Customize Clerk email templates (optional)
5. Add password reset functionality (optional)
6. Remove CRM/Finance dashboard placeholders if not needed
</file>

<file path="apps/moondesk-dash/CLERK_SETUP.md">
# Clerk Authentication Setup

## ✅ What's Been Configured

### 1. Clerk Integration

- ✅ `@clerk/nextjs` installed
- ✅ `ClerkProvider` wrapping the app in `src/app/layout.tsx`
- ✅ `proxy.ts` middleware configured (Next.js 16+)

### 2. Authentication Components

- ✅ **ClerkAuth** - Sign In/Sign Up buttons + UserButton in header
- ✅ **ClerkOrgSwitcher** - Organization switcher in header for multi-tenancy
- ✅ **NavUserClerk** - Sidebar user menu with Clerk integration

### 3. Pages

- ✅ **Landing Page** (`/`) - Shows sign-in/sign-up for unauthenticated users
- ✅ **Dashboard** - Protected, redirects to `/dashboard/iiot` when signed in

## 🔧 Setup Instructions

### Step 1: Get Clerk Keys

1. Go to [https://dashboard.clerk.com](https://dashboard.clerk.com)
2. Create a new application (or use existing)
3. Copy your API keys from the dashboard

### Step 2: Configure Environment Variables

Create `.env.local` file in `apps/moondesk-dash/`:

```bash
# Copy from .env.local.example
cp .env.local.example .env.local
```

Then add your Clerk keys:

```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
```

### Step 3: Enable Organizations in Clerk

1. In Clerk Dashboard, go to **Settings** → **Organizations**
2. Enable Organizations feature
3. Configure organization settings as needed

### Step 4: Run the App

```bash
pnpm dev
```

Visit `http://localhost:3000` - you should see the landing page with sign-in/sign-up buttons.

## 🎯 What's Next

Now that authentication is set up, you can:

1. **Create IIoT Dashboard Pages** - Device overview, device list, device details
2. **Implement API Integration** - Connect to your .NET backend
3. **Add Device Provisioning** - Modal for adding new devices
4. **Build Charts** - Time-series visualization with Recharts

## 📝 Key Files

- `src/proxy.ts` - Clerk middleware (Next.js 16+)
- `src/app/layout.tsx` - ClerkProvider wrapper
- `src/app/(main)/dashboard/layout.tsx` - Dashboard layout with auth components
- `src/app/(main)/dashboard/_components/sidebar/clerk-auth.tsx` - Auth components
- `src/app/(main)/dashboard/_components/sidebar/nav-user-clerk.tsx` - Sidebar user menu
- `src/app/(external)/page.tsx` - Landing page with auth redirect

## 🔐 How It Works

1. **Unauthenticated users** see the landing page with sign-in/sign-up buttons
2. **After signing in**, users are redirected to `/dashboard/iiot`
3. **Organization Switcher** in header allows switching between organizations
4. **All API calls** will include Clerk JWT token (via `src/services/api-client.ts`)
5. **User profile** accessible via UserButton in header or sidebar menu
</file>

<file path="apps/moondesk-dash/components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
</file>

<file path="apps/moondesk-dash/CONTRIBUTING.md">
# Contributing to Studio Admin

Thanks for showing interest in improving **Studio Admin** (repo: `next-shadcn-admin-dashboard`).  
This guide will help you set up your environment and understand how to contribute.

---

## Overview

This project is built with **Next.js 16**, **TypeScript**, **Tailwind CSS v4**, and **Shadcn UI**.  
The goal is to keep the codebase modular, scalable, and easy to extend.

---

## Project Layout

We use a **colocation-based file system**. Each feature keeps its own pages, components, and logic.

```
src
├── app               # Next.js routes (App Router)
│   ├── (auth)        # Auth layouts & screens
│   ├── (main)        # Main dashboard routes
│   │   └── (dashboard)
│   │       ├── crm
│   │       ├── finance
│   │       ├── default
│   │       └── ...
│   └── layout.tsx
├── components        # Shared UI components
├── hooks             # Reusable hooks
├── lib               # Config & utilities
├── styles            # Tailwind / theme setup
└── types             # TypeScript definitions
```

If you’d like a more detailed example of this setup, check out the [Next Colocation Template](https://github.com/arhamkhnz/next-colocation-template), where the full structure is explained with examples.

---

## Getting Started

### Fork and Clone the Repository

1. Fork the Repository

   Click [here](https://github.com/arhamkhnz/next-shadcn-admin-dashboard/fork) to fork the repository.

2. Clone the Repository
   ```bash
   git clone https://github.com/YOUR_USERNAME/next-shadcn-admin-dashboard.git
   ```
3. Navigate into the Project

   ```bash
   cd next-shadcn-admin-dashboard
   ```

4. **Install dependencies**

   ```bash
   npm install
   ```

5. **Run the dev server**
   ```bash
   npm run dev
   ```
   App will be available at [http://localhost:3000](http://localhost:3000).

---

## Contribution Flow

- Always create a new branch before working on changes:

  ```bash
  git checkout -b feature/my-update
  ```

- Use clear commit messages:

  ```bash
  git commit -m "feat: add finance dashboard screen"
  ```

- Open a Pull Request once ready.
- If your change adds a new UI screen or component, include a screenshot in your PR description.

---

## Where to Contribute

- **External Pages**: Landing pages or other non-dashboard routes → `src/app/(external)/`
- **Auth Screens**: Login, register, and authentication layouts → `src/app/(main)/auth/`
- **Dashboard Screens**: Feature dashboards like CRM, Finance, Analytics → `src/app/(main)/dashboard/`
- **Components**: Reusable UI goes in `src/components/`
- **Hooks**: Custom logic goes in `src/hooks/`
- **Themes**: New presets under `src/styles/presets/`

---

## Guidelines

- Prefer **TypeScript types** over `any`
- Husky pre-commit hooks are enabled - linting and formatting run automatically when you commit, and if there are errors the commit will be blocked until they are fixed.
- Follow **Shadcn UI** style & Tailwind v4 conventions
- Keep accessibility in mind (ARIA, keyboard nav)
- Use clear commit messages with conventional prefixes (`feat:`, `fix:`, `chore:`, etc.)
- Avoid unnecessary dependencies — prefer existing utilities where possible

---

## Submitting PRs

- Open a Pull Request once your changes are ready.
- Ensure your branch is up to date with `main` before submitting.
- Reference any related issue in your PR for context.

---

## Questions & Support

- Report bugs, suggestions, or issues via [GitHub Issues](https://github.com/arhamkhnz/next-shadcn-admin-dashboard/issues)

---

Your contributions keep this project growing. 🚀

**Happy Vibe Coding!**
</file>

<file path="apps/moondesk-dash/IIOT_DASHBOARD_SPEC.md">
# Industrial IoT Dashboard - Feature Specification

## Overview

Build a Next.js dashboard for monitoring and managing industrial assets (Solar Panels, PLCs, Sensors) with real-time telemetry visualization and device provisioning capabilities.

---

## 1. Navigation & Sidebar

### Requirements

- Add IIoT section to sidebar navigation
- Replace existing demo dashboards with IIoT-specific pages

### Implementation

**File:** `src/navigation/sidebar/sidebar-items.ts`

Add new navigation group:

```typescript
{
  id: 1,
  label: "Industrial IoT",
  items: [
    {
      title: "Overview",
      url: "/dashboard/iiot",
      icon: LayoutDashboard,
    },
    {
      title: "Devices",
      url: "/dashboard/iiot/devices",
      icon: Factory,
    },
    {
      title: "Analytics",
      url: "/dashboard/iiot/analytics",
      icon: ChartBar,
      comingSoon: true,
    },
  ],
}
```

---

## 2. IIoT Overview Page (Dashboard Home)

### Requirements

- Display grid of device status cards
- Show real-time device metrics (last reported value)
- Visual status indicators (Online/Offline/Alarm)
- Click card to navigate to device detail page

### Page Structure

**File:** `src/app/(main)/dashboard/iiot/page.tsx`

### Components Needed

1. **DeviceStatusCard** - Individual device widget
   - Device name
   - Device type badge (Solar/Sensor/PLC)
   - Status indicator (colored dot + text)
   - Last value display (e.g., "24.5 °C", "450W")
   - Last seen timestamp
   - Click to navigate to detail page

2. **DeviceGrid** - Responsive grid layout
   - 1 column on mobile
   - 2-3 columns on tablet
   - 3-4 columns on desktop

### Data Requirements

- Fetch devices for current organization
- Include last telemetry value for each device
- Real-time status updates (optional: use polling or WebSocket)

### Design Notes

- Industrial modern aesthetic
- Slate/Zinc color scheme
- Green for Online, Red for Alarm/Offline, Yellow for Maintenance
- Data-dense but clean layout

---

## 3. Devices Page (Inventory)

### Requirements

- Table listing all devices for current organization
- Sortable and filterable columns
- Search functionality
- "Add Device" button to open provisioning modal

### Page Structure

**File:** `src/app/(main)/dashboard/iiot/devices/page.tsx`

### Table Columns

1. **Name** - Device name (clickable to detail page)
2. **Type** - Badge showing Solar/Sensor/PLC
3. **Device ID** - Unique identifier
4. **Status** - Status badge with color
5. **Last Seen** - Relative time (e.g., "2 minutes ago")
6. **Actions** - Dropdown menu (View, Edit, Delete)

### Components Needed

1. **DevicesTable** - Uses existing `data-table` component
2. **DeviceTypeFilter** - Filter by device type
3. **StatusFilter** - Filter by status
4. **AddDeviceButton** - Opens provisioning modal

### Features

- Use TanStack Table (already installed)
- Pagination (10, 25, 50 per page)
- Column sorting
- Global search across name and ID
- Export to CSV (optional)

---

## 4. Device Provisioning Modal

### Requirements

- Modal/Dialog form to add new device
- Collect device name and type
- On success, display device credentials
- Credentials shown only once (copy-pasteable)

### Flow

1. User clicks "Add Device" button
2. Modal opens with form:
   - **Device Name** (text input, required)
   - **Device Type** (dropdown: Solar, Sensor, PLC)
   - **Submit** button

3. On submit:
   - POST to `/api/devices`
   - Show loading state

4. On success:
   - Show "Device Created" success state
   - Display credentials card with:
     - Host
     - Client ID
     - Username
     - Password/Token
   - Copy buttons for each field
   - Warning: "Save these credentials - they won't be shown again"
   - "Done" button to close modal

### Components Needed

**File:** `src/app/(main)/dashboard/iiot/devices/_components/add-device-modal.tsx`

1. **AddDeviceModal** - Main modal component
2. **DeviceForm** - Form with validation (react-hook-form + zod)
3. **CredentialsCard** - Display credentials with copy buttons

### Validation

- Device name: Required, 3-50 characters
- Device type: Required, one of enum values

---

## 5. Device Detail Page (Digital Twin)

### Requirements

- Show device metadata
- Display time-series chart (last 24 hours)
- Real-time current value
- Device actions (Edit, Delete, Restart)

### Page Structure

**File:** `src/app/(main)/dashboard/iiot/devices/[deviceId]/page.tsx`

### Layout Sections

#### A. Header Section

- Device name (editable inline)
- Device type badge
- Status indicator
- Last seen timestamp
- Action buttons (Edit, Delete, Restart)

#### B. Current Metrics Card

- Large display of current value
- Metric name and unit
- Trend indicator (up/down arrow)
- Comparison to previous value

#### C. Time-Series Chart

- Recharts line chart
- X-axis: Time (last 24 hours)
- Y-axis: Value with unit
- Responsive design
- Zoom/pan controls (optional)
- Time range selector (1h, 6h, 24h, 7d)

#### D. Device Information Card

- Device ID
- Organization
- Firmware version
- Location
- Model
- Created date
- Last updated

### Components Needed

1. **DeviceHeader** - Top section with name and actions
2. **CurrentMetricsCard** - Real-time value display
3. **TelemetryChart** - Recharts time-series visualization
4. **DeviceInfoCard** - Metadata display
5. **TimeRangeSelector** - Button group for time range

### Data Requirements

- Fetch device details by ID
- Fetch telemetry data for selected time range
- Real-time updates for current value (polling every 5-10s)

---

## 6. API Service Layer

### Requirements

- Centralized API client with Clerk JWT integration
- Type-safe API methods
- Error handling
- Mock data for development

### Files Structure

```
src/services/
├── api-client.ts          (✅ Already created)
├── devices-api.ts         (Device CRUD operations)
└── telemetry-api.ts       (Telemetry data fetching)
```

### API Methods Needed

#### devices-api.ts

```typescript
- getDevices(organizationId: string): Promise<Device[]>
- getDevice(deviceId: string): Promise<Device>
- createDevice(data: CreateDeviceRequest): Promise<DeviceCredentials>
- updateDevice(deviceId: string, data: Partial<Device>): Promise<Device>
- deleteDevice(deviceId: string): Promise<void>
```

#### telemetry-api.ts

```typescript
- getTelemetry(deviceId: string, timeRange: TimeRange): Promise<TelemetryData[]>
- getLatestValue(deviceId: string): Promise<TelemetryData>
```

### Mock Data Strategy

- Create mock data generators for development
- Use realistic industrial values:
  - Solar: 0-500W power output
  - Sensor: 15-35°C temperature
  - PLC: 0-100% utilization
- Add flag to switch between mock and real API

**File:** `src/services/mock-data.ts`

---

## 7. React Query Integration

### Requirements

- Use TanStack Query for data fetching
- Implement caching and refetching strategies
- Optimistic updates for mutations

### Query Keys Structure

```typescript
const queryKeys = {
  devices: {
    all: (orgId: string) => ["devices", orgId],
    detail: (deviceId: string) => ["devices", deviceId],
  },
  telemetry: {
    range: (deviceId: string, range: string) => ["telemetry", deviceId, range],
    latest: (deviceId: string) => ["telemetry", deviceId, "latest"],
  },
};
```

### Hooks to Create

**File:** `src/hooks/use-devices.ts`

```typescript
- useDevices(organizationId: string)
- useDevice(deviceId: string)
- useCreateDevice()
- useUpdateDevice()
- useDeleteDevice()
```

**File:** `src/hooks/use-telemetry.ts`

```typescript
- useTelemetry(deviceId: string, timeRange: TimeRange)
- useLatestValue(deviceId: string)
```

### Refetch Strategies

- Devices list: Refetch on window focus
- Device detail: Refetch every 10s
- Latest telemetry: Refetch every 5s
- Historical telemetry: Cache for 5 minutes

---

## 8. Type Definitions

### Files

**File:** `src/types/iiot.ts` (✅ Already created)

Ensure all types are defined:

- Device
- DeviceType
- DeviceStatus
- DeviceCredentials
- TelemetryData
- CreateDeviceRequest
- DeviceWithLastValue
- TimeRange

---

## 9. Styling & Design System

### Color Palette (Industrial Theme)

```css
/* Status Colors */
--status-online: #10b981 (green-500) --status-offline: #ef4444 (red-500) --status-alarm: #ef4444 (red-500)
  --status-maintenance: #f59e0b (amber-500) /* Device Type Colors */ --device-solar: #f59e0b (amber-500)
  --device-sensor: #3b82f6 (blue-500) --device-plc: #8b5cf6 (violet-500) /* Background */ Use existing slate/zinc from
  Tailwind;
```

### Component Styling Guidelines

- Use existing shadcn/ui components
- Consistent spacing (p-4, p-6 for cards)
- Border radius: rounded-lg
- Shadows: shadow-sm for cards
- Hover states on interactive elements
- Loading skeletons for async data

---

## 10. Error Handling & Loading States

### Requirements

- Loading skeletons for all async content
- Error boundaries for page-level errors
- Toast notifications for actions (success/error)
- Empty states for no data

### Components Needed

1. **DeviceCardSkeleton** - Loading state for device cards
2. **TableSkeleton** - Loading state for devices table
3. **ChartSkeleton** - Loading state for charts
4. **EmptyState** - No devices found
5. **ErrorState** - Error loading data

### Toast Messages

- Device created successfully
- Device updated successfully
- Device deleted successfully
- Failed to load devices
- Failed to create device
- Credentials copied to clipboard

---

## 11. Organization Context

### Requirements

- Get current organization from Clerk
- Filter all data by organization ID
- Handle organization switching

### Implementation

**File:** `src/hooks/use-organization.ts`

```typescript
export function useOrganization() {
  const { organization } = useOrganization();
  return {
    organizationId: organization?.id,
    organizationName: organization?.name,
  };
}
```

### Usage

- Pass organizationId to all API calls
- Refetch data when organization changes
- Show organization name in breadcrumbs

---

## 12. Breadcrumbs

### Requirements

- Show current page path
- Clickable navigation
- Update on route change

### Examples

- Overview: `Home / IIoT / Overview`
- Devices: `Home / IIoT / Devices`
- Device Detail: `Home / IIoT / Devices / [Device Name]`

**File:** Update existing breadcrumb component or create new one

---

## Implementation Priority

### Phase 1: Core Pages (MVP)

1. ✅ Clerk authentication setup
2. Update sidebar navigation
3. Create IIoT Overview page with device cards
4. Create Devices page with table
5. Implement mock API service

### Phase 2: Device Management

6. Add Device provisioning modal
7. Device detail page with metadata
8. Device CRUD operations
9. React Query hooks

### Phase 3: Visualization

10. Time-series chart with Recharts
11. Time range selector
12. Real-time updates

### Phase 4: Polish

13. Loading states and skeletons
14. Error handling
15. Empty states
16. Toast notifications
17. Responsive design refinement

---

## Testing Checklist

- [ ] Sign in/sign up flow works
- [ ] Organization switcher changes data
- [ ] Device cards display correctly
- [ ] Device table sorting/filtering works
- [ ] Add device modal creates device
- [ ] Credentials are copyable
- [ ] Device detail page loads
- [ ] Chart displays telemetry data
- [ ] Time range selector updates chart
- [ ] Real-time updates work
- [ ] Mobile responsive
- [ ] Dark mode works
- [ ] Loading states show
- [ ] Error states show
- [ ] Empty states show

---

## Notes

- Start with mock data to build UI quickly
- Add `// TODO: Replace with real .NET API` comments
- Keep components small and focused
- Use existing shadcn/ui components
- Follow existing code patterns in the project
- Industrial aesthetic: clean, data-dense, professional
</file>

<file path="apps/moondesk-dash/LICENSE">
MIT License

Copyright (c) 2024 Mohammed Arham Khan

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
</file>

<file path="apps/moondesk-dash/next.config.mjs">
import { withSentryConfig } from "@sentry/nextjs";
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactCompiler: true,
  compiler: {
    removeConsole: process.env.NODE_ENV === "production",
  },
  async redirects() {
    return [
      {
        source: "/dashboard",
        destination: "/dashboard/default",
        permanent: false,
      },
    ];
  },
}

export default withSentryConfig(nextConfig, {
  // For all available options, see:
  // https://www.npmjs.com/package/@sentry/webpack-plugin#options

  org: "moondesk",

  project: "moondesk-dash",

  // Only print logs for uploading source maps in CI
  silent: !process.env.CI,

  // For all available options, see:
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/

  // Upload a larger set of source maps for prettier stack traces (increases build time)
  widenClientFileUpload: true,

  // Route browser requests to Sentry through a Next.js rewrite to circumvent ad-blockers.
  // This can increase your server load as well as your hosting bill.
  // Note: Check that the configured route will not match with your Next.js middleware, otherwise reporting of client-
  // side errors will fail.
  tunnelRoute: "/monitoring",

  // Automatically tree-shake Sentry logger statements to reduce bundle size
  disableLogger: true,

  // Enables automatic instrumentation of Vercel Cron Monitors. (Does not yet work with App Router route handlers.)
  // See the following for more information:
  // https://docs.sentry.io/product/crons/
  // https://vercel.com/docs/cron-jobs
  automaticVercelMonitors: true,
});
</file>

<file path="apps/moondesk-dash/package.json">
{
  "name": "moondesk-dash",
  "version": "2.0.0",
  "type": "module",
  "private": true,
  "scripts": {
    "dev": "next dev --port 3000",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "check-types": "next typegen && tsc --noEmit",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "generate:presets": "tsx src/scripts/generate-theme-presets.ts",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.3.1",
    "@eslint/js": "^9.16.0",
    "@moondesk/typescript-config": "workspace:*",
    "@tailwindcss/postcss": "^4.1.17",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@types/node": "^22.15.3",
    "@types/react": "19.2.2",
    "@types/react-dom": "19.2.2",
    "@typescript-eslint/parser": "^8.26.0",
    "@vitejs/plugin-react": "^5.1.1",
    "@vitest/coverage-v8": "4.0.13",
    "babel-plugin-react-compiler": "^19.0.0-beta-df7b47d-20241124",
    "eslint": "^9.39.1",
    "eslint-config-next": "^16.0.1",
    "eslint-plugin-import": "^2.32.0",
    "eslint-plugin-prettier": "^5.5.4",
    "eslint-plugin-security": "^3.0.1",
    "eslint-plugin-sonarjs": "^3.0.5",
    "eslint-plugin-unicorn": "^56.0.1",
    "globals": "^15.15.0",
    "jsdom": "^27.2.0",
    "postcss": "^8.5.6",
    "prettier": "^3.6.2",
    "prettier-plugin-tailwindcss": "^0.6.14",
    "tailwindcss": "^4.1.17",
    "tsx": "^4.19.2",
    "typescript": "5.9.2",
    "typescript-eslint": "^8.46.4",
    "vitest": "^4.0.13"
  },
  "dependencies": {
    "@clerk/nextjs": "^6.35.2",
    "@clerk/themes": "^2.4.37",
    "@dnd-kit/core": "^6.3.1",
    "@dnd-kit/modifiers": "^9.0.0",
    "@dnd-kit/sortable": "^10.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "@hookform/resolvers": "^3.10.0",
    "@microsoft/signalr": "^10.0.0",
    "@moondesk/domain": "workspace:*",
    "@moondesk/ui": "workspace:*",
    "@sentry/nextjs": "^10.30.0",
    "@tanstack/react-query": "^5.90.8",
    "@tanstack/react-table": "^8.21.3",
    "@vitest/ui": "^4.0.13",
    "axios": "^1.13.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "date-fns": "^4.1.0",
    "embla-carousel-react": "^8.6.0",
    "import-in-the-middle": "^2.0.0",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.454.0",
    "next": "^16.0.1",
    "next-themes": "^0.4.6",
    "radix-ui": "^1.4.3",
    "react": "^19.2.0",
    "react-day-picker": "^9.11.1",
    "react-dom": "^19.2.0",
    "react-hook-form": "^7.66.0",
    "react-resizable-panels": "^3.0.6",
    "recharts": "^2.15.4",
    "require-in-the-middle": "^8.0.1",
    "simple-icons": "^15.20.0",
    "sonner": "^2.0.7",
    "tailwind-merge": "^3.4.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^1.1.2",
    "zod": "^3.24.2",
    "zustand": "^5.0.8"
  }
}
</file>

<file path="apps/moondesk-dash/postcss.config.mjs">
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}

export default config
</file>

<file path="apps/moondesk-dash/sentry.edge.config.ts">
// This file configures the initialization of Sentry for edge features (middleware, edge routes, and so on).
// The config you add here will be used whenever one of the edge features is loaded.
// Note that this config is unrelated to the Vercel Edge Runtime and is also required when running locally.
// https://docs.sentry.io/platforms/javascript/guides/nextjs/

import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: "https://12d4e362381e912751acf2f4d2ea7e21@o4509589925527552.ingest.de.sentry.io/4510518434463824",

  // Define how likely traces are sampled. Adjust this value in production, or use tracesSampler for greater control.
  tracesSampleRate: 1,

  // Enable logs to be sent to Sentry
  enableLogs: true,

  // Enable sending user PII (Personally Identifiable Information)
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
});
</file>

<file path="apps/moondesk-dash/sentry.server.config.ts">
// This file configures the initialization of Sentry on the server.
// The config you add here will be used whenever the server handles a request.
// https://docs.sentry.io/platforms/javascript/guides/nextjs/

import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: "https://12d4e362381e912751acf2f4d2ea7e21@o4509589925527552.ingest.de.sentry.io/4510518434463824",

  // Define how likely traces are sampled. Adjust this value in production, or use tracesSampler for greater control.
  tracesSampleRate: 1,

  // Enable logs to be sent to Sentry
  enableLogs: true,

  // Enable sending user PII (Personally Identifiable Information)
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
});
</file>

<file path="apps/moondesk-dash/tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", ".next/dev/types/**/*.ts"],
  "exclude": ["node_modules"]
}
</file>

<file path="apps/moondesk-dash/vitest.config.ts">
import { defineConfig } from "vitest/config";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
  plugins: [react()],
  test: {
    environment: "jsdom",
    globals: true,
    setupFiles: ["./src/test/setup.ts"],
  },
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
});
</file>

<file path="apps/mqtt-worker/Dockerfile">
FROM node:22-alpine AS base
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable

FROM base AS builder
RUN apk add --no-cache libc6-compat
WORKDIR /app
COPY . .
RUN pnpm install --frozen-lockfile
RUN pnpm --filter @moondesk/mqtt-worker build

FROM base AS runner
WORKDIR /app

# Copy root config files
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/pnpm-lock.yaml ./pnpm-lock.yaml
COPY --from=builder /app/pnpm-workspace.yaml ./pnpm-workspace.yaml

# Copy shared packages
COPY --from=builder /app/packages ./packages

# Copy app source and build
COPY --from=builder /app/apps/mqtt-worker ./apps/mqtt-worker

# Install production dependencies
RUN pnpm install --prod --frozen-lockfile

ENV NODE_ENV=production
WORKDIR /app/apps/mqtt-worker

CMD ["node", "dist/index.js"]
</file>

<file path="apps/mqtt-worker/eslint.config.mjs">
import { config } from "@moondesk/eslint-config/base";

export default [...config];
</file>

<file path="apps/mqtt-worker/tsconfig.json">
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "outDir": "dist",
        "rootDir": "src"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
</file>

<file path="docker/mosquitto/config/mosquitto.conf">
persistence true
persistence_location /mosquitto/data/
log_dest file /mosquitto/log/mosquitto.log

listener 1883
allow_anonymous true

listener 9001
protocol websockets
allow_anonymous true
</file>

<file path="docker-compose.yml">
services:
  timescaledb:
    image: timescale/timescaledb:latest-pg17
    container_name: moondesk_db
    environment:
      POSTGRES_USER: ${DB_USER:-postgres}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-postgres}
      POSTGRES_DB: ${DB_NAME:-moondesk}
    ports:
      - "${DB_PORT:-5432}:5432"
    volumes:
      - timescaledb_data:/var/lib/postgresql/data
    networks:
      - moondesk_net
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USER:-postgres}"]
      interval: 5s
      timeout: 5s
      retries: 5

  mosquitto:
    image: eclipse-mosquitto:2
    container_name: moondesk_mqtt
    ports:
      - "${MQTT_PORT:-1883}:1883"
      - "9001:9001"
    volumes:
      - ./docker/mosquitto/config:/mosquitto/config
      - mosquitto_data:/mosquitto/data
      - mosquitto_log:/mosquitto/log
    networks:
      - moondesk_net

  redis:
    image: redis:alpine
    container_name: moondesk_redis
    ports:
      - "${REDIS_PORT:-6379}:6379"
    volumes:
      - redis_data:/data
    networks:
      - moondesk_net

  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    container_name: moondesk_api
    environment:
      - PORT=3000
      - HOST=0.0.0.0
      - DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@timescaledb:5432/${DB_NAME}
      - MQTT_HOST=mosquitto
      - REDIS_HOST=redis
      - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
      - CLERK_PUBLISHABLE_KEY=${CLERK_PUBLISHABLE_KEY}
      - INTERNAL_SERVICE_TOKEN=${INTERNAL_SERVICE_TOKEN}
    ports:
      - "3000:3000"
    depends_on:
      timescaledb:
        condition: service_healthy
      mosquitto:
        condition: service_started
    networks:
      - moondesk_net

  mqtt-worker:
    build:
      context: .
      dockerfile: apps/mqtt-worker/Dockerfile
    container_name: moondesk_worker
    environment:
      - DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@timescaledb:5432/${DB_NAME}
      - MQTT_HOST=mosquitto
      - INTERNAL_SERVICE_TOKEN=${INTERNAL_SERVICE_TOKEN}
      - API_URL=http://api:3000
    depends_on:
      timescaledb:
        condition: service_healthy
      mosquitto:
        condition: service_started
      api:
        condition: service_started
    networks:
      - moondesk_net

  edge-simulator:
    build:
      context: .
      dockerfile: apps/edge-simulator/Dockerfile
    container_name: moondesk_simulator
    environment:
      - MQTT_HOST=mosquitto
    depends_on:
      mosquitto:
        condition: service_started
    networks:
      - moondesk_net
    profiles:
      - tools  # Don't run by default with 'docker-compose up', explicit only


volumes:
  timescaledb_data:
  mosquitto_data:
  mosquitto_log:
  redis_data:

networks:
  moondesk_net:
    driver: bridge
</file>

<file path=".github/workflows/ci.yml">
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Format
        run: pnpm format:check

      - name: Lint
        run: pnpm lint

      - name: Check Types
        run: pnpm check-types

      - name: Test
        run: pnpm test

      - name: Build
        run: pnpm build
</file>

<file path=".husky/commit-msg">
#!/bin/sh

# Get the current branch name
branch_name=$(git symbolic-ref --short HEAD)

# Check if branch matches the pattern mndsk-<number>-...
if echo "$branch_name" | grep -qE '^mndsk-[0-9]+-'; then
  # Extract the identifier (e.g., mndsk-39)
  ticket_id=$(echo "$branch_name" | grep -oE 'mndsk-[0-9]+' | tr '[:lower:]' '[:upper:]')
  
  # Get the current commit message
  commit_msg=$(cat "$1")
  
  # Check if the message already starts with the ticket ID
  if ! echo "$commit_msg" | grep -qE "^$ticket_id"; then
    # Prepend the ticket ID to the message
    echo "$ticket_id $commit_msg" > "$1"
  fi
fi
</file>

<file path="apps/edge-simulator/src/__tests__/generators.test.ts">
import { describe, it, expect } from "vitest";
import { generateValue } from "../generators";
import { SimulationProfile } from "../types";
import { Parameter } from "@moondesk/domain";

// Helper to create a basic profile
const createProfile = (
  overrides: Partial<SimulationProfile> = {},
): SimulationProfile => ({
  waveform: "constant",
  min: 0,
  max: 10,
  frequency: 1,
  noise: 0,
  parameter: Parameter.None,
  ...overrides,
});

describe("generateValue", () => {
  it("should generate constant value correctly", () => {
    const profile = createProfile({
      waveform: "constant",
      min: 10,
      max: 10,
      noise: 0,
    });
    const val = generateValue(profile, 0);
    expect(val).toBe(10);
  });

  it("should respect explicit offset in constant waveform", () => {
    const profile = createProfile({
      waveform: "constant",
      offset: 42,
      noise: 0,
    });
    const val = generateValue(profile, 0);
    expect(val).toBe(42);
  });

  it("should generate linear values correctly", () => {
    const profile = createProfile({
      waveform: "linear",
      min: 10,
      max: 2,
      noise: 0,
    }); // start 10, slope 2 (max used as slope)
    // t=0 => 10
    expect(generateValue(profile, 0)).toBe(10);
    // t=1s (1000ms) => 12
    expect(generateValue(profile, 1000)).toBe(12);
    // t=10s (10000ms) => 30
    expect(generateValue(profile, 10000)).toBe(30);
  });

  it("should generate sine wave within min/max bounds (ignoring noise)", () => {
    const profile = createProfile({
      waveform: "sine",
      min: -10,
      max: 10,
      frequency: 1,
      noise: 0,
    });
    // t=0, sin(0)=0. Base value is center (0) + 0 = 0?
    // Let's check impl: baseValue = center + amplitude * sin(...)
    // center = (-10+10)/2 = 0. amplitude = (10 - -10)/2 = 10.
    // t=0 -> 0
    expect(generateValue(profile, 0)).toBe(0);

    // t=0.25s (250ms) -> sin(2pi * 1 * 0.25) = 1. Val = 10.
    expect(generateValue(profile, 250)).toBe(10);

    // t=0.75s (750ms) -> sin(2pi * 1 * 0.75) = -1. Val = -10.
    expect(generateValue(profile, 750)).toBe(-10);
  });

  it("should return number with max 4 decimal places", () => {
    const profile = createProfile({
      waveform: "random",
      min: 0,
      max: 1,
      noise: 0.123456,
    });
    const val = generateValue(profile, 0);
    // Check string representation length logic or just formatting check
    const decimalPart = val.toString().split(".")[1];
    if (decimalPart) {
      expect(decimalPart.length).toBeLessThanOrEqual(4);
    }
  });
});
</file>

<file path="apps/edge-simulator/src/__tests__/presets.test.ts">
import { describe, it, expect } from "vitest";
import { EnergyProfiles, ProcessProfiles } from "../presets";
import { Parameter } from "@moondesk/domain";

describe("Presets", () => {
  it("EnergyProfiles should have valid parameters", () => {
    expect(EnergyProfiles.GridVoltage.parameter).toBe(Parameter.Voltage);
    expect(EnergyProfiles.MotorCurrent.parameter).toBe(Parameter.Current);
    expect(EnergyProfiles.ActivePower.parameter).toBe(Parameter.Power);
    expect(EnergyProfiles.EnergyConsumption.parameter).toBe(Parameter.Energy);
  });

  it("EnergyConsumption should use linear waveform", () => {
    expect(EnergyProfiles.EnergyConsumption.waveform).toBe("linear");
  });

  it("ProcessProfiles should have valid parameters", () => {
    expect(ProcessProfiles.TankLevel.parameter).toBe(Parameter.Level);
    expect(ProcessProfiles.PipePressure.parameter).toBe(Parameter.Pressure);
    expect(ProcessProfiles.WaterTemperature.parameter).toBe(
      Parameter.Temperature,
    );
    expect(ProcessProfiles.PipeFlow.parameter).toBe(Parameter.Flow);
  });

  it("All profiles should have min <= max", () => {
    const allProfiles = { ...EnergyProfiles, ...ProcessProfiles };
    Object.values(allProfiles).forEach((profile) => {
      // For linear, max is slope, so min<=max doesn't strictly apply, but let's check non-linear ones
      if (profile.waveform !== "linear") {
        expect(profile.min).toBeLessThanOrEqual(profile.max);
      }
    });
  });
});
</file>

<file path="apps/edge-simulator/src/generators.ts">
import { SimulationProfile } from "./types";

/**
 * Generate a value based on the simulation profile and current time
 */
export function generateValue(
  profile: SimulationProfile,
  timestamp: number,
): number {
  const { waveform, min, max, frequency, noise, offset = 0 } = profile;
  const timeSec = timestamp / 1000;
  const amplitude = (max - min) / 2;
  const center = min + amplitude;

  let baseValue = 0;

  switch (waveform) {
    case "sine":
      baseValue =
        center + amplitude * Math.sin(2 * Math.PI * frequency * timeSec);
      break;
    case "cosine":
      baseValue =
        center + amplitude * Math.cos(2 * Math.PI * frequency * timeSec);
      break;
    case "triangle": {
      const period = 1 / frequency;
      const t = (timeSec % period) / period;
      baseValue = center + amplitude * (2 * Math.abs(2 * t - 1) - 1);
      break;
    }
    case "sawtooth": {
      const period = 1 / frequency;
      const t = (timeSec % period) / period;
      baseValue = min + (max - min) * t;
      break;
    }
    case "square":
      baseValue = Math.sin(2 * Math.PI * frequency * timeSec) >= 0 ? max : min;
      break;
    case "random":
      baseValue = min + Math.random() * (max - min);
      break;
    case "constant":
      baseValue = center; // or just offset? let's stick to center + offset logic if needed
      if (offset !== 0)
        baseValue = offset; // override if explicit offset given for constant
      else baseValue = (min + max) / 2;
      break;
    case "linear":
      // For linear, we use 'max' as the rate (slope) and 'min' as the starting value (intercept)
      // Value = start + slope * time
      // To prevent unbounded growth in simple tests, we might want to modulo it or just let it grow.
      // Requirement mentions "Energy consumption (increasing)", so unbounded growth is expected.
      // However, timeSec is absolute simulation time? Or request time?
      // Usually simulators run indefinitely. Let's assume linear is strictly T * slope + offset
      // We use 'max' field for slope, 'min' for initial value.
      baseValue = min + max * timeSec;
      break;
  }

  // Add noise
  if (noise > 0) {
    const noiseValue = (Math.random() - 0.5) * 2 * noise;
    baseValue += noiseValue;
  }

  // Apply global offset if not constant (already handled)
  if (waveform !== "constant" && offset) {
    baseValue += offset;
  }

  // Clamping just in case noise pushed it way out?
  // Actually real sensors might go out of range, so let's allow it to float unless explicitly clamped.
  // But usually we want some boundaries. Let's return raw value for now.

  return Number(baseValue.toFixed(4));
}
</file>

<file path="apps/edge-simulator/src/main.ts">
import { createLogger } from "@moondesk/logger";
import { MqttPublisher } from "./mqtt-publisher";
import { SimulationEngine } from "./simulation-engine";
import { SimulationScenario } from "./types";
import { Parameter, SensorType } from "@moondesk/domain";

const logger = createLogger("simulator-main");

const DEFAULT_SCENARIO: SimulationScenario = {
  id: "default-factory",
  name: "Default Smart Factory",
  description: "A basic factory setup with various sensors",
  sensors: [
    {
      id: 101, // Temperature Sensor
      organizationId: "org_1",
      type: SensorType.Temperature,
      enabled: true,
      intervalMs: 2000,
      profile: {
        waveform: "sine",
        parameter: Parameter.Temperature,
        min: 20,
        max: 80,
        frequency: 0.1, // Slow cycle
        noise: 1.5,
      },
    },
    {
      id: 102, // Vibration Sensor (High frequency)
      organizationId: "org_1",
      type: SensorType.Vibration,
      enabled: true,
      intervalMs: 500, // Fast sampling
      profile: {
        waveform: "random", // Noisy
        parameter: Parameter.Vibration,
        min: 0,
        max: 5,
        frequency: 1,
        noise: 0.5,
      },
    },
    {
      id: 103, // Pressure Sensor (Sawtooth - building up then release)
      organizationId: "org_1",
      type: SensorType.Pressure,
      enabled: true,
      intervalMs: 1000,
      profile: {
        waveform: "sawtooth",
        parameter: Parameter.Pressure,
        min: 100,
        max: 500,
        frequency: 0.05,
        noise: 5,
      },
    },
  ],
};

async function main() {
  logger.info("Starting Edge Simulator...");

  const publisher = new MqttPublisher();
  const engine = new SimulationEngine(publisher);

  try {
    await publisher.connect();

    // Load default scenario
    engine.startScenario(DEFAULT_SCENARIO);

    // Keep process alive
    process.stdin.resume();

    // Handle shutdown
    const shutdown = async () => {
      logger.info("Shutting down...");
      engine.stopAll();
      await publisher.disconnect();
      process.exit(0);
    };

    process.on("SIGINT", shutdown);
    process.on("SIGTERM", shutdown);
  } catch (error) {
    logger.error({ error }, "Failed to start simulator");
    process.exit(1);
  }
}

main();
</file>

<file path="apps/edge-simulator/src/mqtt-publisher.ts">
import mqtt, { MqttClient, IClientOptions } from "mqtt";
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";

const logger = createLogger("simulator-mqtt");

export class MqttPublisher {
  private client: MqttClient | null = null;
  private isConnected = false;

  async connect(): Promise<void> {
    const env = getEnv();
    const options: IClientOptions = {
      host: env.MQTT_HOST ?? "localhost",
      port: env.MQTT_PORT ?? 1883,
      username: env.MQTT_USERNAME,
      password: env.MQTT_PASSWORD,
      clientId: `simulator-${process.pid}`,
    };

    return new Promise((resolve, reject) => {
      logger.info({ host: options.host }, "Connecting to MQTT broker...");
      this.client = mqtt.connect(options);

      this.client.on("connect", () => {
        logger.info("Connected to MQTT broker");
        this.isConnected = true;
        resolve();
      });

      this.client.on("error", (err) => {
        logger.error({ err }, "MQTT connection error");
        if (!this.isConnected) reject(err);
      });

      this.client.on("close", () => {
        this.isConnected = false;
        logger.warn("MQTT connection closed");
      });
    });
  }

  publish(topic: string, payload: object): void {
    if (!this.client || !this.isConnected) return;

    const message = JSON.stringify(payload);
    this.client.publish(topic, message, { qos: 0 }, (err) => {
      if (err) logger.error({ err, topic }, "Failed to publish message");
    });
  }

  async disconnect(): Promise<void> {
    if (this.client) {
      await new Promise<void>((resolve) =>
        this.client!.end(false, {}, () => resolve()),
      );
      this.isConnected = false;
    }
  }
}
</file>

<file path="apps/edge-simulator/src/presets.ts">
import { Parameter } from "@moondesk/domain";

export const EnergyProfiles = {
  GridVoltage: {
    waveform: "sine",
    min: 228,
    max: 232,
    frequency: 50, // 50 Hz mains
    noise: 0.1,
    parameter: Parameter.Voltage,
  },
  MotorCurrent: {
    waveform: "random", // Fluctuating load
    min: 5,
    max: 15,
    frequency: 1, // variation speed check
    noise: 0.5,
    parameter: Parameter.Current,
  },
  ActivePower: {
    waveform: "square", // Different operating modes
    min: 2000,
    max: 3500,
    frequency: 0.05, // changes every 20 seconds
    noise: 50,
    parameter: Parameter.Power,
  },
  EnergyConsumption: {
    waveform: "linear",
    min: 1000, // Starting kWh Reading
    max: 0.5, // 0.5 kWh per second? value increase rate.
    frequency: 0,
    noise: 0,
    parameter: Parameter.Energy,
  },
};

export const ProcessProfiles = {
  TankLevel: {
    waveform: "triangle", // Filling and emptying
    min: 10,
    max: 90,
    frequency: 0.005, // Slow cycle
    noise: 0.2,
    parameter: Parameter.Level,
  },
  PipePressure: {
    waveform: "constant",
    min: 4.8,
    max: 5.2,
    frequency: 0,
    offset: 5.0, // Target pressure
    noise: 0.1,
    parameter: Parameter.Pressure,
  },
  WaterTemperature: {
    waveform: "sine", // Daily cycle
    min: 15,
    max: 25,
    frequency: 0.00001157, // One cycle per day (rough)
    noise: 0.05,
    parameter: Parameter.Temperature,
  },
  PipeFlow: {
    waveform: "sine",
    min: 50,
    max: 150,
    frequency: 0.1,
    noise: 2,
    parameter: Parameter.Flow,
  },
};
</file>

<file path="apps/edge-simulator/src/simulation-engine.ts">
import { createLogger } from "@moondesk/logger";
import { MqttPublisher } from "./mqtt-publisher";
import { generateValue } from "./generators";
import { SimulatedSensorConfig, SimulationScenario } from "./types";
import { ReadingQuality } from "@moondesk/domain";

const logger = createLogger("simulation-engine");

export class SimulationEngine {
  private sensors: Map<number, NodeJS.Timeout> = new Map();
  private configs: Map<number, SimulatedSensorConfig> = new Map();
  private publisher: MqttPublisher;

  constructor(publisher: MqttPublisher) {
    this.publisher = publisher;
  }

  startScenario(scenario: SimulationScenario) {
    logger.info({ scenario: scenario.name }, "Starting scenario");
    this.stopAll();

    for (const sensorConfig of scenario.sensors) {
      this.addSensor(sensorConfig);
    }
  }

  addSensor(config: SimulatedSensorConfig) {
    if (this.configs.has(config.id)) {
      this.removeSensor(config.id);
    }
    this.configs.set(config.id, config);

    if (config.enabled) {
      this.startSensor(config.id);
    }
  }

  private startSensor(id: number) {
    const config = this.configs.get(id);
    if (!config) return;

    logger.info(
      { sensorId: id, type: config.type },
      "Starting sensor simulation",
    );

    // Initial reading
    this.emitReading(config);

    const interval = setInterval(() => {
      this.emitReading(config);
    }, config.intervalMs);

    this.sensors.set(id, interval);
  }

  private emitReading(config: SimulatedSensorConfig) {
    const value = generateValue(config.profile, Date.now());
    const topic = `moondesk/${config.organizationId}/sensors/${config.id}/readings`;

    const payload = {
      sensorId: config.id,
      value: value,
      timestamp: new Date().toISOString(),
      parameter: config.profile.parameter,
      quality: ReadingQuality.Good,
      metadata: {
        generator: "edge-simulator",
        waveform: config.profile.waveform,
      },
    };

    this.publisher.publish(topic, payload);
  }

  removeSensor(id: number) {
    const interval = this.sensors.get(id);
    if (interval) {
      clearInterval(interval);
      this.sensors.delete(id);
    }
    this.configs.delete(id);
  }

  stopAll() {
    for (const interval of this.sensors.values()) {
      clearInterval(interval);
    }
    this.sensors.clear();
    this.configs.clear();
    logger.info("Stopped all simulations");
  }
}
</file>

<file path="apps/edge-simulator/src/types.ts">
import { Parameter, SensorType } from "@moondesk/domain";

export type WaveForm =
  | "sine"
  | "cosine"
  | "triangle"
  | "sawtooth"
  | "square"
  | "random"
  | "constant"
  | "linear";

export interface SimulationProfile {
  waveform: WaveForm;
  min: number;
  max: number;
  /** Frequency in Hz (cycles per second) */
  frequency: number;
  /** Noise amplitude (random variation added to value) */
  noise: number;
  /** Offset to shift the wave up/down */
  offset?: number;
  /** Parameter this profile simulates */
  parameter: Parameter;
}

export interface SimulatedSensorConfig {
  id: number;
  organizationId: string;
  type: SensorType;
  profile: SimulationProfile;
  /** Interval in milliseconds between readings */
  intervalMs: number;
  enabled: boolean;
}

export interface SimulationScenario {
  id: string;
  name: string;
  description?: string;
  sensors: SimulatedSensorConfig[];
}
</file>

<file path="apps/edge-simulator/package.json">
{
    "name": "@moondesk/edge-simulator",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "scripts": {
        "dev": "tsx watch src/main.ts",
        "build": "tsup",
        "start": "node dist/main.js",
        "check-types": "tsc --noEmit",
        "lint": "eslint src/",
        "test": "vitest run"
    },
    "dependencies": {
        "@moondesk/config": "workspace:*",
        "@moondesk/domain": "workspace:*",
        "@moondesk/logger": "workspace:*",
        "mqtt": "^5.14.1",
        "zod": "^3.24.2"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:^",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "tsup": "^8.5.1",
        "tsx": "^4.19.4",
        "typescript": "5.9.2",
        "vitest": "^4.0.15"
    }
}
</file>

<file path="apps/edge-simulator/tsup.config.ts">
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/main.ts"],
  format: ["esm"],
  clean: true,
  outDir: "dist",
  noExternal: [/^@moondesk\/.*/],
  sourcemap: true,
  banner: {
    js: "import { createRequire } from 'module';const require = createRequire(import.meta.url);",
  },
});
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/layout-controls.tsx">
"use client";

import { Settings } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { ToggleGroup, ToggleGroupItem } from "@/components/ui/toggle-group";
import { updateContentLayout, updateNavbarStyle } from "@/lib/layout-utils";
import { updateThemeMode, updateThemePreset } from "@/lib/theme-utils";
import { setValueToCookie } from "@/server/server-actions";
import { usePreferencesStore } from "@/stores/preferences/preferences-provider";
import type { SidebarVariant, SidebarCollapsible, ContentLayout, NavbarStyle } from "@/types/preferences/layout";
import { THEME_PRESET_OPTIONS, type ThemePreset, type ThemeMode } from "@/types/preferences/theme";

type LayoutControlsProps = {
  readonly variant: SidebarVariant;
  readonly collapsible: SidebarCollapsible;
  readonly contentLayout: ContentLayout;
  readonly navbarStyle: NavbarStyle;
};

export function LayoutControls(props: LayoutControlsProps) {
  const { variant, collapsible, contentLayout, navbarStyle } = props;

  const themeMode = usePreferencesStore((s) => s.themeMode);
  const setThemeMode = usePreferencesStore((s) => s.setThemeMode);
  const themePreset = usePreferencesStore((s) => s.themePreset);
  const setThemePreset = usePreferencesStore((s) => s.setThemePreset);

  const handleValueChange = async (key: string, value: any) => {
    if (key === "theme_mode") {
      updateThemeMode(value);
      setThemeMode(value as ThemeMode);
    }

    if (key === "theme_preset") {
      updateThemePreset(value);
      setThemePreset(value as ThemePreset);
    }

    if (key === "content_layout") {
      updateContentLayout(value);
    }

    if (key === "navbar_style") {
      updateNavbarStyle(value);
    }
    await setValueToCookie(key, value);
  };

  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button size="icon">
          <Settings />
        </Button>
      </PopoverTrigger>
      <PopoverContent align="end">
        <div className="flex flex-col gap-5">
          <div className="space-y-1.5">
            <h4 className="text-sm font-medium leading-none">Layout Settings</h4>
            <p className="text-muted-foreground text-xs">Customize your dashboard layout preferences.</p>
          </div>
          <div className="space-y-3">
            <div className="space-y-1">
              <Label className="text-xs font-medium">Preset</Label>
              <Select value={themePreset} onValueChange={(value) => handleValueChange("theme_preset", value)}>
                <SelectTrigger size="sm" className="w-full text-xs">
                  <SelectValue placeholder="Preset" />
                </SelectTrigger>
                <SelectContent>
                  {THEME_PRESET_OPTIONS.map((preset) => (
                    <SelectItem key={preset.value} className="text-xs" value={preset.value}>
                      <span
                        className="size-2.5 rounded-full"
                        style={{
                          backgroundColor: themeMode === "dark" ? preset.primary.dark : preset.primary.light,
                        }}
                      />
                      {preset.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Mode</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={themeMode}
                onValueChange={(value) => handleValueChange("theme_mode", value)}
              >
                <ToggleGroupItem value="light" aria-label="Toggle inset">
                  Light
                </ToggleGroupItem>
                <ToggleGroupItem value="dark" aria-label="Toggle sidebar">
                  Dark
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Sidebar Variant</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={variant}
                onValueChange={(value) => handleValueChange("sidebar_variant", value)}
              >
                <ToggleGroupItem value="inset" aria-label="Toggle inset">
                  Inset
                </ToggleGroupItem>
                <ToggleGroupItem value="sidebar" aria-label="Toggle sidebar">
                  Sidebar
                </ToggleGroupItem>
                <ToggleGroupItem value="floating" aria-label="Toggle floating">
                  Floating
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Navbar Style</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={navbarStyle}
                onValueChange={(value) => handleValueChange("navbar_style", value)}
              >
                <ToggleGroupItem value="sticky" aria-label="Toggle sticky">
                  Sticky
                </ToggleGroupItem>
                <ToggleGroupItem value="scroll" aria-label="Toggle scroll">
                  Scroll
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Sidebar Collapsible</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={collapsible}
                onValueChange={(value) => handleValueChange("sidebar_collapsible", value)}
              >
                <ToggleGroupItem value="icon" aria-label="Toggle icon">
                  Icon
                </ToggleGroupItem>
                <ToggleGroupItem value="offcanvas" aria-label="Toggle offcanvas">
                  OffCanvas
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Content Layout</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={contentLayout}
                onValueChange={(value) => handleValueChange("content_layout", value)}
              >
                <ToggleGroupItem value="centered" aria-label="Toggle centered">
                  Centered
                </ToggleGroupItem>
                <ToggleGroupItem value="full-width" aria-label="Toggle full-width">
                  Full Width
                </ToggleGroupItem>
              </ToggleGroup>
            </div>
          </div>
        </div>
      </PopoverContent>
    </Popover>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/search-dialog.tsx">
"use client";
import * as React from "react";

import { LayoutDashboard, ChartBar, Gauge, ShoppingBag, GraduationCap, Forklift, Search } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  CommandDialog,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
  CommandSeparator,
} from "@/components/ui/command";

const searchItems = [
  { group: "Dashboards", icon: LayoutDashboard, label: "Default" },
  { group: "Dashboards", icon: ChartBar, label: "CRM", disabled: true },
  { group: "Dashboards", icon: Gauge, label: "Analytics", disabled: true },
  { group: "Dashboards", icon: ShoppingBag, label: "E-Commerce", disabled: true },
  { group: "Dashboards", icon: GraduationCap, label: "Academy", disabled: true },
  { group: "Dashboards", icon: Forklift, label: "Logistics", disabled: true },
  { group: "Authentication", label: "Login v1" },
  { group: "Authentication", label: "Login v2" },
  { group: "Authentication", label: "Register v1" },
  { group: "Authentication", label: "Register v2" },
];

export function SearchDialog() {
  const [open, setOpen] = React.useState(false);
  React.useEffect(() => {
    const down = (e: KeyboardEvent) => {
      if (e.key === "j" && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        setOpen((open) => !open);
      }
    };
    document.addEventListener("keydown", down);
    return () => document.removeEventListener("keydown", down);
  }, []);

  return (
    <>
      <Button
        variant="link"
        className="text-muted-foreground !px-0 font-normal hover:no-underline"
        onClick={() => setOpen(true)}
      >
        <Search className="size-4" />
        Search
        <kbd className="bg-muted inline-flex h-5 select-none items-center gap-1 rounded border px-1.5 text-[10px] font-medium">
          <span className="text-xs">⌘</span>J
        </kbd>
      </Button>
      <CommandDialog open={open} onOpenChange={setOpen}>
        <CommandInput placeholder="Search dashboards, users, and more…" />
        <CommandList>
          <CommandEmpty>No results found.</CommandEmpty>
          {[...new Set(searchItems.map((item) => item.group))].map((group, i) => (
            <React.Fragment key={group}>
              {i !== 0 && <CommandSeparator />}
              <CommandGroup heading={group} key={group}>
                {searchItems
                  .filter((item) => item.group === group)
                  .map((item) => (
                    <CommandItem className="!py-1.5" key={item.label} onSelect={() => setOpen(false)}>
                      {item.icon && <item.icon />}
                      <span>{item.label}</span>
                    </CommandItem>
                  ))}
              </CommandGroup>
            </React.Fragment>
          ))}
        </CommandList>
      </CommandDialog>
    </>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/data-usage.tsx">
"use client";

import { Label, PolarGrid, PolarRadiusAxis, RadialBar, RadialBarChart } from "recharts";

import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer } from "@/components/ui/chart";

const chartData = [{ usage: 68, fill: "hsl(var(--chart-2))" }];

export function DataUsage() {
  return (
    <Card className="flex flex-col">
      <CardHeader className="pb-0">
        <CardTitle>Data Usage</CardTitle>
        <CardDescription>Storage consumption</CardDescription>
      </CardHeader>
      <CardContent className="flex-1 pb-0">
        <ChartContainer
          config={{ usage: { label: "Usage", color: "hsl(var(--chart-2))" } }}
          className="mx-auto aspect-square max-h-[250px]"
        >
          <RadialBarChart data={chartData} startAngle={0} endAngle={250} innerRadius={80} outerRadius={110}>
            <PolarGrid
              gridType="circle"
              radialLines={false}
              stroke="none"
              className="first:fill-muted last:fill-background"
              polarRadius={[86, 74]}
            />
            <RadialBar dataKey="usage" background cornerRadius={10} />
            <PolarRadiusAxis tick={false} tickLine={false} axisLine={false}>
              <Label
                content={({ viewBox }) => {
                  if (viewBox && "cx" in viewBox && "cy" in viewBox) {
                    return (
                      <text x={viewBox.cx} y={viewBox.cy} textAnchor="middle" dominantBaseline="middle">
                        <tspan x={viewBox.cx} y={viewBox.cy} className="fill-foreground text-4xl font-bold">
                          {chartData[0].usage}%
                        </tspan>
                        <tspan x={viewBox.cx} y={(viewBox.cy ?? 0) + 24} className="fill-muted-foreground">
                          Used
                        </tspan>
                      </text>
                    );
                  }
                }}
              />
            </PolarRadiusAxis>
          </RadialBarChart>
        </ChartContainer>
      </CardContent>
      <CardFooter className="flex-col gap-2 text-sm">
        <div className="flex items-center gap-2 font-medium leading-none">6.8 TB of 10 TB used</div>
        <div className="text-muted-foreground leading-none">3.2 TB remaining</div>
      </CardFooter>
    </Card>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/energy-consumption.tsx">
"use client";

import { TrendingUp } from "lucide-react";
import { Bar, BarChart, CartesianGrid, XAxis } from "recharts";

import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";

const chartData = [
  { month: "Jan", consumption: 186 },
  { month: "Feb", consumption: 205 },
  { month: "Mar", consumption: 237 },
  { month: "Apr", consumption: 173 },
  { month: "May", consumption: 209 },
  { month: "Jun", consumption: 214 },
];

export function EnergyConsumption() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Energy Consumption</CardTitle>
        <CardDescription>Monthly usage in kWh</CardDescription>
      </CardHeader>
      <CardContent>
        <ChartContainer config={{ consumption: { label: "Consumption", color: "hsl(var(--chart-3))" } }}>
          <BarChart accessibilityLayer data={chartData}>
            <CartesianGrid vertical={false} />
            <XAxis dataKey="month" tickLine={false} tickMargin={10} axisLine={false} />
            <ChartTooltip cursor={false} content={<ChartTooltipContent hideLabel />} />
            <Bar dataKey="consumption" fill="var(--color-consumption)" radius={8} />
          </BarChart>
        </ChartContainer>
      </CardContent>
      <CardFooter className="flex-col items-start gap-2 text-sm">
        <div className="flex gap-2 font-medium leading-none">
          Trending up by 5.2% this month <TrendingUp className="size-4" />
        </div>
        <div className="text-muted-foreground leading-none">Showing last 6 months</div>
      </CardFooter>
    </Card>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/analytics/page.tsx">
import { DataUsage } from "./_components/data-usage";
import { EnergyConsumption } from "./_components/energy-consumption";
import { PerformanceMetrics } from "./_components/performance-metrics";
import { SystemHealth } from "./_components/system-health";

export default function Page() {
  return (
    <div className="grid grid-cols-1 gap-4 lg:grid-cols-3">
      <div className="flex flex-col gap-4 lg:col-span-1">
        <SystemHealth />
      </div>

      <div className="flex flex-col gap-4 lg:col-span-2">
        <div className="flex-1">
          <PerformanceMetrics />
        </div>
        <div className="*:data-[slot=card]:shadow-xs grid flex-1 grid-cols-1 gap-4 md:grid-cols-2">
          <DataUsage />
          <EnergyConsumption />
        </div>
      </div>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/assets/_components/asset-insight-cards.tsx">
"use client";

import { Pie, PieChart, Label, Cell } from "recharts";

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartConfig } from "@/components/ui/chart";
import { PieChartData } from "@/lib/adapters/dashboard-adapter";

const chartConfig = {
  count: {
    label: "Assets",
  },
  // Dynamic colors will be applied from data
} satisfies ChartConfig;

export function AssetInsightCards({ data }: { data: PieChartData[] }) {
  const totalAssets = data.reduce((acc, curr) => acc + curr.value, 0);

  return (
    <div className="*:data-[slot=card]:shadow-xs grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3">
      <Card className="col-span-1 xl:col-span-1">
        <CardHeader>
          <CardTitle>Asset Distribution</CardTitle>
        </CardHeader>
        <CardContent className="max-h-64">
          <ChartContainer config={chartConfig} className="size-full">
            <PieChart className="m-0" margin={{ top: 0, right: 0, left: 0, bottom: 0 }}>
              <ChartTooltip cursor={false} content={<ChartTooltipContent hideLabel />} />
              <Pie
                data={data}
                dataKey="value"
                nameKey="name"
                innerRadius={65}
                outerRadius={90}
                paddingAngle={2}
                cornerRadius={4}
              >
                {data.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={entry.fill} />
                ))}
                <Label
                  content={({ viewBox }) => {
                    if (viewBox && "cx" in viewBox && "cy" in viewBox) {
                      return (
                        <text x={viewBox.cx} y={viewBox.cy} textAnchor="middle" dominantBaseline="middle">
                          <tspan
                            x={viewBox.cx}
                            y={viewBox.cy}
                            className="fill-foreground text-3xl font-bold tabular-nums"
                          >
                            {totalAssets.toLocaleString()}
                          </tspan>
                          <tspan x={viewBox.cx} y={(viewBox.cy ?? 0) + 24} className="fill-muted-foreground">
                            Assets
                          </tspan>
                        </text>
                      );
                    }
                  }}
                />
              </Pie>
              <ChartLegend
                layout="vertical"
                verticalAlign="middle"
                align="right"
                content={() => (
                  <ul className="ml-4 flex flex-col gap-2">
                    {data.map((item) => (
                      <li key={item.name} className="flex items-center justify-between gap-2">
                        <span className="flex items-center gap-2 text-sm">
                          <span className="size-2.5 rounded-full" style={{ background: item.fill }} />
                          {item.name}
                        </span>
                        <span className="font-mono text-sm font-bold">{item.value}</span>
                      </li>
                    ))}
                  </ul>
                )}
              />
            </PieChart>
          </ChartContainer>
        </CardContent>
        <CardFooter className="gap-2">
          <Button size="sm" variant="outline" className="w-full">
            Download Report
          </Button>
        </CardFooter>
      </Card>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/chart-area-interactive.tsx">
"use client";

import * as React from "react";

import { Area, AreaChart, CartesianGrid, XAxis } from "recharts";

import { Card, CardAction, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartConfig, ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { ToggleGroup, ToggleGroupItem } from "@/components/ui/toggle-group";
import { useIsMobile } from "@/hooks/use-mobile";
import { TimeSeriesPoint } from "@/lib/adapters/dashboard-adapter";

export const description = "An interactive area chart";

const chartConfig = {
  readings: {
    label: "Readings",
  },
  desktop: {
    label: "Average Value",
    color: "var(--chart-1)",
  },
  mobile: {
    label: "Min/Max",
    color: "var(--chart-2)",
  },
} satisfies ChartConfig;

export function ChartAreaInteractive({ data = [] }: { data?: TimeSeriesPoint[] }) {
  const isMobile = useIsMobile();
  const [timeRange, setTimeRange] = React.useState("90d");

  React.useEffect(() => {
    if (isMobile) {
      setTimeRange("7d");
    }
  }, [isMobile]);

  const filteredData = data.filter((item) => {
    const date = new Date(item.date);
    const referenceDate = new Date(); // Use current date as reference
    let daysToSubtract = 90;
    if (timeRange === "30d") {
      daysToSubtract = 30;
    } else if (timeRange === "7d") {
      daysToSubtract = 7;
    }
    const startDate = new Date(referenceDate);
    startDate.setDate(startDate.getDate() - daysToSubtract);
    return date >= startDate;
  });

  return (
    <Card className="@container/card">
      <CardHeader>
        <CardTitle>Sensor Readings</CardTitle>
        <CardDescription>
          <span className="@[540px]/card:block hidden">Average readings over time</span>
          <span className="@[540px]/card:hidden">Readings trend</span>
        </CardDescription>
        <CardAction>
          <ToggleGroup
            type="single"
            value={timeRange}
            onValueChange={setTimeRange}
            variant="outline"
            className="@[767px]/card:flex hidden *:data-[slot=toggle-group-item]:!px-4"
          >
            <ToggleGroupItem value="90d">Last 3 months</ToggleGroupItem>
            <ToggleGroupItem value="30d">Last 30 days</ToggleGroupItem>
            <ToggleGroupItem value="7d">Last 7 days</ToggleGroupItem>
          </ToggleGroup>
          <Select value={timeRange} onValueChange={setTimeRange}>
            <SelectTrigger
              className="**:data-[slot=select-value]:block **:data-[slot=select-value]:truncate @[767px]/card:hidden flex w-40"
              size="sm"
              aria-label="Select a value"
            >
              <SelectValue placeholder="Last 3 months" />
            </SelectTrigger>
            <SelectContent className="rounded-xl">
              <SelectItem value="90d" className="rounded-lg">
                Last 3 months
              </SelectItem>
              <SelectItem value="30d" className="rounded-lg">
                Last 30 days
              </SelectItem>
              <SelectItem value="7d" className="rounded-lg">
                Last 7 days
              </SelectItem>
            </SelectContent>
          </Select>
        </CardAction>
      </CardHeader>
      <CardContent className="px-2 pt-4 sm:px-6 sm:pt-6">
        <ChartContainer config={chartConfig} className="aspect-auto h-[250px] w-full">
          <AreaChart data={filteredData}>
            <defs>
              <linearGradient id="fillDesktop" x1="0" y1="0" x2="0" y2="1">
                <stop offset="5%" stopColor="var(--color-desktop)" stopOpacity={1.0} />
                <stop offset="95%" stopColor="var(--color-desktop)" stopOpacity={0.1} />
              </linearGradient>
              <linearGradient id="fillMobile" x1="0" y1="0" x2="0" y2="1">
                <stop offset="5%" stopColor="var(--color-mobile)" stopOpacity={0.8} />
                <stop offset="95%" stopColor="var(--color-mobile)" stopOpacity={0.1} />
              </linearGradient>
            </defs>
            <CartesianGrid vertical={false} />
            <XAxis
              dataKey="date"
              tickLine={false}
              axisLine={false}
              tickMargin={8}
              minTickGap={32}
              tickFormatter={(value) => {
                const date = new Date(value);
                return date.toLocaleDateString("en-US", {
                  month: "short",
                  day: "numeric",
                });
              }}
            />
            <ChartTooltip
              cursor={false}
              defaultIndex={isMobile ? -1 : 10}
              content={
                <ChartTooltipContent
                  labelFormatter={(value) => {
                    return new Date(value).toLocaleDateString("en-US", {
                      month: "short",
                      day: "numeric",
                    });
                  }}
                  indicator="dot"
                />
              }
            />
            <Area dataKey="mobile" type="natural" fill="url(#fillMobile)" stroke="var(--color-mobile)" stackId="a" />
            <Area dataKey="desktop" type="natural" fill="url(#fillDesktop)" stroke="var(--color-desktop)" stackId="a" />
          </AreaChart>
        </ChartContainer>
      </CardContent>
    </Card>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/data-table.tsx">
"use client";

import * as React from "react";

import { Plus } from "lucide-react";
import { z } from "zod";

import { DataTable as DataTableNew } from "@/components/data-table/data-table";
import { DataTablePagination } from "@/components/data-table/data-table-pagination";
import { DataTableViewOptions } from "@/components/data-table/data-table-view-options";
import { withDndColumn } from "@/components/data-table/table-utils";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useDataTableInstance } from "@/hooks/use-data-table-instance";

import { assetColumns } from "./columns";
import { assetSchema } from "./schema";

export function DataTable({ data: initialData }: { data: z.infer<typeof assetSchema>[] }) {
  const [data, setData] = React.useState(() => initialData);
  const columns = withDndColumn(assetColumns);
  const table = useDataTableInstance({ data, columns, getRowId: (row) => row.id });

  return (
    <Tabs defaultValue="all" className="w-full flex-col justify-start gap-6">
      <div className="flex items-center justify-between">
        <Label htmlFor="view-selector" className="sr-only">
          View
        </Label>
        <Select defaultValue="all">
          <SelectTrigger className="@4xl/main:hidden flex w-fit" size="sm" id="view-selector">
            <SelectValue placeholder="Select a view" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All Assets</SelectItem>
            <SelectItem value="online">Online</SelectItem>
            <SelectItem value="offline">Offline</SelectItem>
            <SelectItem value="maintenance">Maintenance</SelectItem>
          </SelectContent>
        </Select>
        <TabsList className="**:data-[slot=badge]:bg-muted-foreground/30 **:data-[slot=badge]:size-5 **:data-[slot=badge]:rounded-full **:data-[slot=badge]:px-1 @4xl/main:flex hidden">
          <TabsTrigger value="all">All Assets</TabsTrigger>
          <TabsTrigger value="online">
            Online <Badge variant="secondary">{data.filter((a) => a.status === "Online").length}</Badge>
          </TabsTrigger>
          <TabsTrigger value="offline">
            Offline <Badge variant="secondary">{data.filter((a) => a.status === "Offline").length}</Badge>
          </TabsTrigger>
          <TabsTrigger value="maintenance">Maintenance</TabsTrigger>
        </TabsList>
        <div className="flex items-center gap-2">
          <DataTableViewOptions table={table} />
          <Button variant="outline" size="sm">
            <Plus />
            <span className="hidden lg:inline">Add Asset</span>
          </Button>
        </div>
      </div>
      <TabsContent value="all" className="relative flex flex-col gap-4 overflow-auto">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
        <DataTablePagination table={table} />
      </TabsContent>
      <TabsContent value="online" className="flex flex-col">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
      </TabsContent>
      <TabsContent value="offline" className="flex flex-col">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
      </TabsContent>
      <TabsContent value="maintenance" className="flex flex-col">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
      </TabsContent>
    </Tabs>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/section-cards.tsx">
import { TrendingUp, TrendingDown, Activity, AlertCircle, Users } from "lucide-react";

import { Badge } from "@/components/ui/badge";
import { Card, CardAction, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { MetricTrend } from "@/lib/adapters/dashboard-adapter";

export function SectionCards({ stats }: { stats: MetricTrend[] }) {
  return (
    <div className="*:data-[slot=card]:from-primary/5 *:data-[slot=card]:to-card dark:*:data-[slot=card]:bg-card *:data-[slot=card]:shadow-xs @xl/main:grid-cols-2 @5xl/main:grid-cols-4 grid grid-cols-1 gap-4 *:data-[slot=card]:bg-gradient-to-t">
      {stats.map((stat, index) => {
        const TrendIcon = stat.status === "up" ? TrendingUp : stat.status === "down" ? TrendingDown : Activity;

        return (
          <Card key={index} className="@container/card">
            <CardHeader>
              <CardDescription>{stat.title}</CardDescription>
              <CardTitle className="@[250px]/card:text-3xl text-2xl font-semibold tabular-nums">{stat.value}</CardTitle>
              <CardAction>
                {!stat.noTrendData && typeof stat.trend === "number" && (
                  <Badge variant="outline">
                    <TrendIcon />
                    {stat.trend > 0 ? "+" : ""}
                    {stat.trend}%
                  </Badge>
                )}
              </CardAction>
            </CardHeader>
            <CardFooter className="flex-col items-start gap-1.5 text-sm">
              <div className="line-clamp-1 flex gap-2 font-medium">
                {stat.label}{" "}
                {!stat.noTrendData && typeof stat.trend === "number" && stat.trend !== 0 && (
                  <TrendIcon className="size-4" />
                )}
              </div>
              <div className="text-muted-foreground">{stat.description}</div>
            </CardFooter>
          </Card>
        );
      })}
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/table-cell-viewer.tsx">
import { TrendingUp } from "lucide-react";
import { Area, AreaChart, CartesianGrid, XAxis } from "recharts";
import { z } from "zod";

import { Button } from "@/components/ui/button";
import { ChartConfig, ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";
import {
  Drawer,
  DrawerClose,
  DrawerContent,
  DrawerDescription,
  DrawerFooter,
  DrawerHeader,
  DrawerTitle,
  DrawerTrigger,
} from "@/components/ui/drawer";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Separator } from "@/components/ui/separator";
import { useIsMobile } from "@/hooks/use-mobile";

import { sectionSchema } from "./schema";

const chartData = [
  { month: "January", desktop: 186, mobile: 80 },
  { month: "February", desktop: 305, mobile: 200 },
  { month: "March", desktop: 237, mobile: 120 },
  { month: "April", desktop: 73, mobile: 190 },
  { month: "May", desktop: 209, mobile: 130 },
  { month: "June", desktop: 214, mobile: 140 },
];

const chartConfig = {
  desktop: {
    label: "Desktop",
    color: "var(--primary)",
  },
  mobile: {
    label: "Mobile",
    color: "var(--primary)",
  },
} satisfies ChartConfig;

export function TableCellViewer({ item }: { item: z.infer<typeof sectionSchema> }) {
  const isMobile = useIsMobile();

  return (
    <Drawer direction={isMobile ? "bottom" : "right"}>
      <DrawerTrigger asChild>
        <Button variant="link" className="text-foreground w-fit px-0 text-left">
          {item.header}
        </Button>
      </DrawerTrigger>
      <DrawerContent>
        <DrawerHeader className="gap-1">
          <DrawerTitle>{item.header}</DrawerTitle>
          <DrawerDescription>Showing total visitors for the last 6 months</DrawerDescription>
        </DrawerHeader>
        <div className="flex flex-col gap-4 overflow-y-auto px-4 text-sm">
          {!isMobile && (
            <>
              <ChartContainer config={chartConfig}>
                <AreaChart
                  accessibilityLayer
                  data={chartData}
                  margin={{
                    left: 0,
                    right: 10,
                  }}
                >
                  <CartesianGrid vertical={false} />
                  <XAxis
                    dataKey="month"
                    tickLine={false}
                    axisLine={false}
                    tickMargin={8}
                    tickFormatter={(value) => value.slice(0, 3)}
                    hide
                  />
                  <ChartTooltip cursor={false} content={<ChartTooltipContent indicator="dot" />} />
                  <Area
                    dataKey="mobile"
                    type="natural"
                    fill="var(--color-mobile)"
                    fillOpacity={0.6}
                    stroke="var(--color-mobile)"
                    stackId="a"
                  />
                  <Area
                    dataKey="desktop"
                    type="natural"
                    fill="var(--color-desktop)"
                    fillOpacity={0.4}
                    stroke="var(--color-desktop)"
                    stackId="a"
                  />
                </AreaChart>
              </ChartContainer>
              <Separator />
              <div className="grid gap-2">
                <div className="flex gap-2 font-medium leading-none">
                  Trending up by 5.2% this month <TrendingUp className="size-4" />
                </div>
                <div className="text-muted-foreground">
                  Showing total visitors for the last 6 months. This is just some random text to test the layout. It
                  spans multiple lines and should wrap around.
                </div>
              </div>
              <Separator />
            </>
          )}
          <form className="flex flex-col gap-4">
            <div className="flex flex-col gap-3">
              <Label htmlFor="header">Header</Label>
              <Input id="header" defaultValue={item.header} />
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div className="flex flex-col gap-3">
                <Label htmlFor="type">Type</Label>
                <Select defaultValue={item.type}>
                  <SelectTrigger id="type" className="w-full">
                    <SelectValue placeholder="Select a type" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="Table of Contents">Table of Contents</SelectItem>
                    <SelectItem value="Executive Summary">Executive Summary</SelectItem>
                    <SelectItem value="Technical Approach">Technical Approach</SelectItem>
                    <SelectItem value="Design">Design</SelectItem>
                    <SelectItem value="Capabilities">Capabilities</SelectItem>
                    <SelectItem value="Focus Documents">Focus Documents</SelectItem>
                    <SelectItem value="Narrative">Narrative</SelectItem>
                    <SelectItem value="Cover Page">Cover Page</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              <div className="flex flex-col gap-3">
                <Label htmlFor="status">Status</Label>
                <Select defaultValue={item.status}>
                  <SelectTrigger id="status" className="w-full">
                    <SelectValue placeholder="Select a status" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="Done">Done</SelectItem>
                    <SelectItem value="In Progress">In Progress</SelectItem>
                    <SelectItem value="Not Started">Not Started</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div className="flex flex-col gap-3">
                <Label htmlFor="target">Target</Label>
                <Input id="target" defaultValue={item.target} />
              </div>
              <div className="flex flex-col gap-3">
                <Label htmlFor="limit">Limit</Label>
                <Input id="limit" defaultValue={item.limit} />
              </div>
            </div>
            <div className="flex flex-col gap-3">
              <Label htmlFor="reviewer">Reviewer</Label>
              <Select defaultValue={item.reviewer}>
                <SelectTrigger id="reviewer" className="w-full">
                  <SelectValue placeholder="Select a reviewer" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="Eddie Lake">Eddie Lake</SelectItem>
                  <SelectItem value="Jamik Tashpulatov">Jamik Tashpulatov</SelectItem>
                  <SelectItem value="Emily Whalen">Emily Whalen</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </form>
        </div>
        <DrawerFooter>
          <Button>Submit</Button>
          <DrawerClose asChild>
            <Button variant="outline">Done</Button>
          </DrawerClose>
        </DrawerFooter>
      </DrawerContent>
    </Drawer>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/dashboard/layout.tsx">
import { ReactNode } from "react";

import { cookies } from "next/headers";

import { AppSidebar } from "@/app/(main)/dashboard/_components/sidebar/app-sidebar";
import { Separator } from "@/components/ui/separator";
import { SidebarInset, SidebarProvider, SidebarTrigger } from "@/components/ui/sidebar";
import { cn } from "@/lib/utils";
import { getPreference } from "@/server/server-actions";
import {
  SIDEBAR_VARIANT_VALUES,
  SIDEBAR_COLLAPSIBLE_VALUES,
  CONTENT_LAYOUT_VALUES,
  NAVBAR_STYLE_VALUES,
  type SidebarVariant,
  type SidebarCollapsible,
  type ContentLayout,
  type NavbarStyle,
} from "@/types/preferences/layout";

import { ClerkAuth, ClerkOrgSwitcher } from "./_components/sidebar/clerk-auth";
import { LayoutControls } from "./_components/sidebar/layout-controls";
import { SearchDialog } from "./_components/sidebar/search-dialog";
import { ThemeSwitcher } from "./_components/sidebar/theme-switcher";

export default async function Layout({ children }: Readonly<{ children: ReactNode }>) {
  const cookieStore = await cookies();
  const defaultOpen = cookieStore.get("sidebar_state")?.value === "true";

  const [sidebarVariant, sidebarCollapsible, contentLayout, navbarStyle] = await Promise.all([
    getPreference<SidebarVariant>("sidebar_variant", SIDEBAR_VARIANT_VALUES, "inset"),
    getPreference<SidebarCollapsible>("sidebar_collapsible", SIDEBAR_COLLAPSIBLE_VALUES, "icon"),
    getPreference<ContentLayout>("content_layout", CONTENT_LAYOUT_VALUES, "centered"),
    getPreference<NavbarStyle>("navbar_style", NAVBAR_STYLE_VALUES, "scroll"),
  ]);

  const layoutPreferences = {
    contentLayout,
    variant: sidebarVariant,
    collapsible: sidebarCollapsible,
    navbarStyle,
  };

  return (
    <SidebarProvider defaultOpen={defaultOpen}>
      <AppSidebar variant={sidebarVariant} collapsible={sidebarCollapsible} />
      <SidebarInset
        data-content-layout={contentLayout}
        className={cn(
          "data-[content-layout=centered]:!mx-auto data-[content-layout=centered]:max-w-screen-2xl",
          // Adds right margin for inset sidebar in centered layout up to 113rem.
          // On wider screens with collapsed sidebar, removes margin and sets margin auto for alignment.
          "max-[113rem]:peer-data-[variant=inset]:!mr-2 min-[101rem]:peer-data-[variant=inset]:peer-data-[state=collapsed]:!mr-auto",
        )}
      >
        <header
          data-navbar-style={navbarStyle}
          className={cn(
            "group-has-data-[collapsible=icon]/sidebar-wrapper:h-12 flex h-12 shrink-0 items-center gap-2 border-b transition-[width,height] ease-linear",
            // Handle sticky navbar style with conditional classes so blur, background, z-index, and rounded corners remain consistent across all SidebarVariant layouts.
            "data-[navbar-style=sticky]:bg-background/50 data-[navbar-style=sticky]:sticky data-[navbar-style=sticky]:top-0 data-[navbar-style=sticky]:z-50 data-[navbar-style=sticky]:overflow-hidden data-[navbar-style=sticky]:rounded-t-[inherit] data-[navbar-style=sticky]:backdrop-blur-md",
          )}
        >
          <div className="flex w-full items-center justify-between px-4 lg:px-6">
            <div className="flex items-center gap-1 lg:gap-2">
              <SidebarTrigger className="-ml-1" />
              <Separator orientation="vertical" className="mx-2 data-[orientation=vertical]:h-4" />
              <SearchDialog />
            </div>
            <div className="flex items-center gap-2">
              <ClerkOrgSwitcher />
              <LayoutControls {...layoutPreferences} />
              <ThemeSwitcher />
              <ClerkAuth />
            </div>
          </div>
        </header>
        <div className="h-full p-4 md:p-6">{children}</div>
      </SidebarInset>
    </SidebarProvider>
  );
}
</file>

<file path="apps/moondesk-dash/src/app/(main)/unauthorized/page.tsx">
import Link from "next/link";

import { Lock } from "lucide-react";

export default function page() {
  return (
    <div className="bg-background flex min-h-dvh flex-col items-center justify-center px-4 py-12 sm:px-6 lg:px-8">
      <div className="mx-auto max-w-md text-center">
        <Lock className="text-primary mx-auto size-12" />
        <h1 className="mt-4 text-3xl font-bold tracking-tight sm:text-4xl">Unauthorized Access</h1>
        <p className="text-muted-foreground mt-4">
          You do not have permission to view the requested content. Please contact the site administrator if you believe
          this is an error.
        </p>
        <div className="mt-6">
          <Link
            href="dashboard"
            className="bg-primary text-primary-foreground hover:bg-primary/90 focus:ring-primary shadow-xs focus:outline-hidden inline-flex items-center rounded-md px-4 py-2 text-sm font-medium transition-colors focus:ring-2 focus:ring-offset-2"
            prefetch={false}
          >
            Go to Homepage
          </Link>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="apps/moondesk-dash/src/components/ui/accordion.tsx">
"use client";

import * as React from "react";
import { Accordion as AccordionPrimitive } from "radix-ui";
import { ChevronDownIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Accordion({ ...props }: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />;
}

function AccordionItem({ className, ...props }: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  );
}

function AccordionTrigger({ className, children, ...props }: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium outline-none transition-all hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className,
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  );
}

function AccordionContent({ className, children, ...props }: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pb-4 pt-0", className)}>{children}</div>
    </AccordionPrimitive.Content>
  );
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };
</file>

<file path="apps/moondesk-dash/src/components/ui/alert-dialog.tsx">
"use client";

import * as React from "react";
import { AlertDialog as AlertDialogPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

function AlertDialog({ ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />;
}

function AlertDialogTrigger({ ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />;
}

function AlertDialogPortal({ ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />;
}

function AlertDialogOverlay({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogContent({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed left-[50%] top-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      />
    </AlertDialogPortal>
  );
}

function AlertDialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function AlertDialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function AlertDialogTitle({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  );
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function AlertDialogAction({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return <AlertDialogPrimitive.Action className={cn(buttonVariants(), className)} {...props} />;
}

function AlertDialogCancel({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return <AlertDialogPrimitive.Cancel className={cn(buttonVariants({ variant: "outline" }), className)} {...props} />;
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/alert.tsx">
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Alert({ className, variant, ...props }: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return <div data-slot="alert" role="alert" className={cn(alertVariants({ variant }), className)} {...props} />;
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight", className)}
      {...props}
    />
  );
}

function AlertDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className,
      )}
      {...props}
    />
  );
}

export { Alert, AlertTitle, AlertDescription };
</file>

<file path="apps/moondesk-dash/src/components/ui/aspect-ratio.tsx">
"use client";

import { AspectRatio as AspectRatioPrimitive } from "radix-ui";

function AspectRatio({ ...props }: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />;
}

export { AspectRatio };
</file>

<file path="apps/moondesk-dash/src/components/ui/avatar.tsx">
"use client";

import * as React from "react";
import { Avatar as AvatarPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Avatar({ className, ...props }: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn("relative flex size-8 shrink-0 overflow-hidden rounded-full", className)}
      {...props}
    />
  );
}

function AvatarImage({ className, ...props }: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image data-slot="avatar-image" className={cn("aspect-square size-full", className)} {...props} />
  );
}

function AvatarFallback({ className, ...props }: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn("bg-muted flex size-full items-center justify-center rounded-full", className)}
      {...props}
    />
  );
}

export { Avatar, AvatarImage, AvatarFallback };
</file>

<file path="apps/moondesk-dash/src/components/ui/badge.tsx">
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default: "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary: "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline: "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> & VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "span";

  return <Comp data-slot="badge" className={cn(badgeVariants({ variant }), className)} {...props} />;
}

export { Badge, badgeVariants };
</file>

<file path="apps/moondesk-dash/src/components/ui/breadcrumb.tsx">
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { ChevronRight, MoreHorizontal } from "lucide-react";

import { cn } from "@/lib/utils";

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />;
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 break-words text-sm sm:gap-2.5",
        className,
      )}
      {...props}
    />
  );
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return <li data-slot="breadcrumb-item" className={cn("inline-flex items-center gap-1.5", className)} {...props} />;
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "a";

  return (
    <Comp data-slot="breadcrumb-link" className={cn("hover:text-foreground transition-colors", className)} {...props} />
  );
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  );
}

function BreadcrumbSeparator({ children, className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  );
}

function BreadcrumbEllipsis({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  );
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/button-group.tsx">
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Separator } from "@/components/ui/separator";

const buttonGroupVariants = cva(
  "flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",
  {
    variants: {
      orientation: {
        horizontal:
          "[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",
        vertical:
          "flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none",
      },
    },
    defaultVariants: {
      orientation: "horizontal",
    },
  },
);

function ButtonGroup({
  className,
  orientation,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof buttonGroupVariants>) {
  return (
    <div
      role="group"
      data-slot="button-group"
      data-orientation={orientation}
      className={cn(buttonGroupVariants({ orientation }), className)}
      {...props}
    />
  );
}

function ButtonGroupText({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & {
  asChild?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "div";

  return (
    <Comp
      className={cn(
        "bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none",
        className,
      )}
      {...props}
    />
  );
}

function ButtonGroupSeparator({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="button-group-separator"
      orientation={orientation}
      className={cn("bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto", className)}
      {...props}
    />
  );
}

export { ButtonGroup, ButtonGroupSeparator, ButtonGroupText, buttonGroupVariants };
</file>

<file path="apps/moondesk-dash/src/components/ui/button.tsx">
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean;
  }) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";

  return <Comp data-slot="button" className={cn(buttonVariants({ variant, size, className }))} {...props} />;
}

export { Button, buttonVariants };
</file>

<file path="apps/moondesk-dash/src/components/ui/calendar.tsx">
"use client";

import * as React from "react";
import { ChevronDownIcon, ChevronLeftIcon, ChevronRightIcon } from "lucide-react";
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker";

import { cn } from "@/lib/utils";
import { Button, buttonVariants } from "@/components/ui/button";

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"];
}) {
  const defaultClassNames = getDefaultClassNames();

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className,
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) => date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn("flex gap-4 flex-col md:flex-row relative", defaultClassNames.months),
        month: cn("flex flex-col w-full gap-4", defaultClassNames.month),
        nav: cn("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between", defaultClassNames.nav),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_previous,
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_next,
        ),
        month_caption: cn(
          "flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",
          defaultClassNames.month_caption,
        ),
        dropdowns: cn(
          "w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",
          defaultClassNames.dropdowns,
        ),
        dropdown_root: cn(
          "relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",
          defaultClassNames.dropdown_root,
        ),
        dropdown: cn("absolute bg-popover inset-0 opacity-0", defaultClassNames.dropdown),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",
          defaultClassNames.caption_label,
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",
          defaultClassNames.weekday,
        ),
        week: cn("flex w-full mt-2", defaultClassNames.week),
        week_number_header: cn("select-none w-(--cell-size)", defaultClassNames.week_number_header),
        week_number: cn("text-[0.8rem] select-none text-muted-foreground", defaultClassNames.week_number),
        day: cn(
          "relative w-full h-full p-0 text-center [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",
          props.showWeekNumber
            ? "[&:nth-child(2)[data-selected=true]_button]:rounded-l-md"
            : "[&:first-child[data-selected=true]_button]:rounded-l-md",
          defaultClassNames.day,
        ),
        range_start: cn("rounded-l-md bg-accent", defaultClassNames.range_start),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("rounded-r-md bg-accent", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today,
        ),
        outside: cn("text-muted-foreground aria-selected:text-muted-foreground", defaultClassNames.outside),
        disabled: cn("text-muted-foreground opacity-50", defaultClassNames.disabled),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return <div data-slot="calendar" ref={rootRef} className={cn(className)} {...props} />;
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return <ChevronLeftIcon className={cn("size-4", className)} {...props} />;
          }

          if (orientation === "right") {
            return <ChevronRightIcon className={cn("size-4", className)} {...props} />;
          }

          return <ChevronDownIcon className={cn("size-4", className)} {...props} />;
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="size-(--cell-size) flex items-center justify-center text-center">{children}</div>
            </td>
          );
        },
        ...components,
      }}
      {...props}
    />
  );
}

function CalendarDayButton({ className, day, modifiers, ...props }: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames();

  const ref = React.useRef<HTMLButtonElement>(null);
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus();
  }, [modifiers.focused]);

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected && !modifiers.range_start && !modifiers.range_end && !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground min-w-(--cell-size) flex aspect-square size-auto w-full flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-start=true]:rounded-l-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className,
      )}
      {...props}
    />
  );
}

export { Calendar, CalendarDayButton };
</file>

<file path="apps/moondesk-dash/src/components/ui/card.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm", className)}
      {...props}
    />
  );
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6 grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6",
        className,
      )}
      {...props}
    />
  );
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="card-title" className={cn("font-semibold leading-none", className)} {...props} />;
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="card-description" className={cn("text-muted-foreground text-sm", className)} {...props} />;
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn("col-start-2 row-span-2 row-start-1 self-start justify-self-end", className)}
      {...props}
    />
  );
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="card-content" className={cn("px-6", className)} {...props} />;
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="card-footer" className={cn("[.border-t]:pt-6 flex items-center px-6", className)} {...props} />
  );
}

export { Card, CardHeader, CardFooter, CardTitle, CardAction, CardDescription, CardContent };
</file>

<file path="apps/moondesk-dash/src/components/ui/carousel.tsx">
"use client";

import * as React from "react";
import useEmblaCarousel, { type UseEmblaCarouselType } from "embla-carousel-react";
import { ArrowLeft, ArrowRight } from "lucide-react";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: "horizontal" | "vertical";
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />");
  }

  return context;
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins,
  );
  const [canScrollPrev, setCanScrollPrev] = React.useState(false);
  const [canScrollNext, setCanScrollNext] = React.useState(false);

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return;
    setCanScrollPrev(api.canScrollPrev());
    setCanScrollNext(api.canScrollNext());
  }, []);

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev();
  }, [api]);

  const scrollNext = React.useCallback(() => {
    api?.scrollNext();
  }, [api]);

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault();
        scrollPrev();
      } else if (event.key === "ArrowRight") {
        event.preventDefault();
        scrollNext();
      }
    },
    [scrollPrev, scrollNext],
  );

  React.useEffect(() => {
    if (!api || !setApi) return;
    setApi(api);
  }, [api, setApi]);

  React.useEffect(() => {
    if (!api) return;
    onSelect(api);
    api.on("reInit", onSelect);
    api.on("select", onSelect);

    return () => {
      api?.off("select", onSelect);
    };
  }, [api, onSelect]);

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation: orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  );
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel();

  return (
    <div ref={carouselRef} className="overflow-hidden" data-slot="carousel-content">
      <div className={cn("flex", orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col", className)} {...props} />
    </div>
  );
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel();

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn("min-w-0 shrink-0 grow-0 basis-full", orientation === "horizontal" ? "pl-4" : "pt-4", className)}
      {...props}
    />
  );
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel();

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  );
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel();

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  );
}

export { type CarouselApi, Carousel, CarouselContent, CarouselItem, CarouselPrevious, CarouselNext };
</file>

<file path="apps/moondesk-dash/src/components/ui/chart.tsx">
"use client";

import * as React from "react";
import * as RechartsPrimitive from "recharts";

import { cn } from "@/lib/utils";

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const;

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode;
    icon?: React.ComponentType;
  } & ({ color?: string; theme?: never } | { color?: never; theme: Record<keyof typeof THEMES, string> });
};

type ChartContextProps = {
  config: ChartConfig;
};

const ChartContext = React.createContext<ChartContextProps | null>(null);

function useChart() {
  const context = React.useContext(ChartContext);

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />");
  }

  return context;
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig;
  children: React.ComponentProps<typeof RechartsPrimitive.ResponsiveContainer>["children"];
}) {
  const uniqueId = React.useId();
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-surface]:outline-hidden flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-sector[stroke='#fff']]:stroke-transparent",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>{children}</RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  );
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(([, config]) => config.theme || config.color);

  if (!colorConfig.length) {
    return null;
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color = itemConfig.theme?.[theme as keyof typeof itemConfig.theme] || itemConfig.color;
    return color ? `  --color-${key}: ${color};` : null;
  })
  .join("\n")}
}
`,
          )
          .join("\n"),
      }}
    />
  );
};

const ChartTooltip = RechartsPrimitive.Tooltip;

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean;
    hideIndicator?: boolean;
    indicator?: "line" | "dot" | "dashed";
    nameKey?: string;
    labelKey?: string;
  }) {
  const { config } = useChart();

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null;
    }

    const [item] = payload;
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`;
    const itemConfig = getPayloadConfigFromPayload(config, item, key);
    const value =
      !labelKey && typeof label === "string" ? config[label as keyof typeof config]?.label || label : itemConfig?.label;

    if (labelFormatter) {
      return <div className={cn("font-medium", labelClassName)}>{labelFormatter(value, payload)}</div>;
    }

    if (!value) {
      return null;
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>;
  }, [label, labelFormatter, payload, hideLabel, labelClassName, config, labelKey]);

  if (!active || !payload?.length) {
    return null;
  }

  const nestLabel = payload.length === 1 && indicator !== "dot";

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className,
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload
          .filter((item) => item.type !== "none")
          .map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`;
            const itemConfig = getPayloadConfigFromPayload(config, item, key);
            const indicatorColor = color || item.payload.fill || item.color;

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                  indicator === "dot" && "items-center",
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn("border-(--color-border) bg-(--color-bg) shrink-0 rounded-[2px]", {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent": indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          })}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center",
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">{itemConfig?.label || item.name}</span>
                      </div>
                      {item.value && (
                        <span className="text-foreground font-mono font-medium tabular-nums">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            );
          })}
      </div>
    </div>
  );
}

const ChartLegend = RechartsPrimitive.Legend;

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean;
    nameKey?: string;
  }) {
  const { config } = useChart();

  if (!payload?.length) {
    return null;
  }

  return (
    <div className={cn("flex items-center justify-center gap-4", verticalAlign === "top" ? "pb-3" : "pt-3", className)}>
      {payload
        .filter((item) => item.type !== "none")
        .map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`;
          const itemConfig = getPayloadConfigFromPayload(config, item, key);

          return (
            <div
              key={item.value}
              className={cn("[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3")}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          );
        })}
    </div>
  );
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(config: ChartConfig, payload: unknown, key: string) {
  if (typeof payload !== "object" || payload === null) {
    return undefined;
  }

  const payloadPayload =
    "payload" in payload && typeof payload.payload === "object" && payload.payload !== null
      ? payload.payload
      : undefined;

  let configLabelKey: string = key;

  if (key in payload && typeof payload[key as keyof typeof payload] === "string") {
    configLabelKey = payload[key as keyof typeof payload] as string;
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[key as keyof typeof payloadPayload] as string;
  }

  return configLabelKey in config ? config[configLabelKey] : config[key as keyof typeof config];
}

export { ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartLegendContent, ChartStyle };
</file>

<file path="apps/moondesk-dash/src/components/ui/checkbox.tsx">
"use client";

import * as React from "react";
import { Checkbox as CheckboxPrimitive } from "radix-ui";
import { CheckIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Checkbox({ className, ...props }: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive shadow-xs peer size-4 shrink-0 rounded-[4px] border outline-none transition-shadow focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="grid place-content-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  );
}

export { Checkbox };
</file>

<file path="apps/moondesk-dash/src/components/ui/collapsible.tsx">
"use client";

import { Collapsible as CollapsiblePrimitive } from "radix-ui";

function Collapsible({ ...props }: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />;
}

function CollapsibleTrigger({ ...props }: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return <CollapsiblePrimitive.CollapsibleTrigger data-slot="collapsible-trigger" {...props} />;
}

function CollapsibleContent({ ...props }: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return <CollapsiblePrimitive.CollapsibleContent data-slot="collapsible-content" {...props} />;
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent };
</file>

<file path="apps/moondesk-dash/src/components/ui/command.tsx">
"use client";

import * as React from "react";
import { Command as CommandPrimitive } from "cmdk";
import { SearchIcon } from "lucide-react";

import { cn } from "@/lib/utils";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from "@/components/ui/dialog";

function Command({ className, ...props }: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className,
      )}
      {...props}
    />
  );
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string;
  description?: string;
  className?: string;
  showCloseButton?: boolean;
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent className={cn("overflow-hidden p-0", className)} showCloseButton={showCloseButton}>
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
}

function CommandInput({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div data-slot="command-input-wrapper" className="flex h-9 items-center gap-2 border-b px-3">
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground outline-hidden flex h-10 w-full rounded-md bg-transparent py-3 text-sm disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CommandList({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn("max-h-[300px] scroll-py-1 overflow-y-auto overflow-x-hidden", className)}
      {...props}
    />
  );
}

function CommandEmpty({ ...props }: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return <CommandPrimitive.Empty data-slot="command-empty" className="py-6 text-center text-sm" {...props} />;
}

function CommandGroup({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className,
      )}
      {...props}
    />
  );
}

function CommandSeparator({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  );
}

function CommandItem({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function CommandShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/context-menu.tsx">
"use client";

import * as React from "react";
import { ContextMenu as ContextMenuPrimitive } from "radix-ui";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function ContextMenu({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />;
}

function ContextMenuTrigger({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />;
}

function ContextMenuGroup({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />;
}

function ContextMenuPortal({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />;
}

function ContextMenuSub({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />;
}

function ContextMenuRadioGroup({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return <ContextMenuPrimitive.RadioGroup data-slot="context-menu-radio-group" {...props} />;
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm data-[inset]:pl-8 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  );
}

function ContextMenuSubContent({ className, ...props }: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-context-menu-content-transform-origin) z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuContent({ className, ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-(--radix-context-menu-content-available-height) origin-(--radix-context-menu-content-transform-origin) z-50 min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  );
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled]:pointer-events-none data-[inset]:pl-8 data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  );
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  );
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn("text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8", className)}
      {...props}
    />
  );
}

function ContextMenuSeparator({ className, ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function ContextMenuShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/dialog.tsx">
"use client";

import * as React from "react";
import { Dialog as DialogPrimitive } from "radix-ui";
import { XIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Dialog({ ...props }: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean;
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed left-[50%] top-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground rounded-xs focus:outline-hidden absolute right-4 top-4 opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg font-semibold leading-none", className)}
      {...props}
    />
  );
}

function DialogDescription({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/drawer.tsx">
"use client";

import * as React from "react";
import { Drawer as DrawerPrimitive } from "vaul";

import { cn } from "@/lib/utils";

function Drawer({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />;
}

function DrawerTrigger({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />;
}

function DrawerPortal({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />;
}

function DrawerClose({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />;
}

function DrawerOverlay({ className, ...props }: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DrawerContent({ className, children, ...props }: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  );
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        "flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",
        className,
      )}
      {...props}
    />
  );
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="drawer-footer" className={cn("mt-auto flex flex-col gap-2 p-4", className)} {...props} />;
}

function DrawerTitle({ className, ...props }: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function DrawerDescription({ className, ...props }: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/dropdown-menu.tsx">
"use client";

import * as React from "react";
import { DropdownMenu as DropdownMenuPrimitive } from "radix-ui";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function DropdownMenu({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />;
}

function DropdownMenuPortal({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />;
}

function DropdownMenuTrigger({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return <DropdownMenuPrimitive.Trigger data-slot="dropdown-menu-trigger" {...props} />;
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-(--radix-dropdown-menu-content-available-height) origin-(--radix-dropdown-menu-content-transform-origin) z-50 min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  );
}

function DropdownMenuGroup({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />;
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled]:pointer-events-none data-[inset]:pl-8 data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  );
}

function DropdownMenuRadioGroup({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return <DropdownMenuPrimitive.RadioGroup data-slot="dropdown-menu-radio-group" {...props} />;
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  );
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8", className)}
      {...props}
    />
  );
}

function DropdownMenuSeparator({ className, ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function DropdownMenuShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

function DropdownMenuSub({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />;
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[inset]:pl-8 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  );
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-dropdown-menu-content-transform-origin) z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/empty.tsx">
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

function Empty({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty"
      className={cn(
        "flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12",
        className,
      )}
      {...props}
    />
  );
}

function EmptyHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty-header"
      className={cn("flex max-w-sm flex-col items-center gap-2 text-center", className)}
      {...props}
    />
  );
}

const emptyMediaVariants = cva(
  "flex shrink-0 items-center justify-center mb-2 [&_svg]:pointer-events-none [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        icon: "bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function EmptyMedia({
  className,
  variant = "default",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof emptyMediaVariants>) {
  return (
    <div
      data-slot="empty-icon"
      data-variant={variant}
      className={cn(emptyMediaVariants({ variant, className }))}
      {...props}
    />
  );
}

function EmptyTitle({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="empty-title" className={cn("text-lg font-medium tracking-tight", className)} {...props} />;
}

function EmptyDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <div
      data-slot="empty-description"
      className={cn(
        "text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4",
        className,
      )}
      {...props}
    />
  );
}

function EmptyContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty-content"
      className={cn("flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm", className)}
      {...props}
    />
  );
}

export { Empty, EmptyHeader, EmptyTitle, EmptyDescription, EmptyContent, EmptyMedia };
</file>

<file path="apps/moondesk-dash/src/components/ui/field.tsx">
"use client";

import { useMemo } from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Label } from "@/components/ui/label";
import { Separator } from "@/components/ui/separator";

function FieldSet({ className, ...props }: React.ComponentProps<"fieldset">) {
  return (
    <fieldset
      data-slot="field-set"
      className={cn(
        "flex flex-col gap-6",
        "has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3",
        className,
      )}
      {...props}
    />
  );
}

function FieldLegend({
  className,
  variant = "legend",
  ...props
}: React.ComponentProps<"legend"> & { variant?: "legend" | "label" }) {
  return (
    <legend
      data-slot="field-legend"
      data-variant={variant}
      className={cn("mb-3 font-medium", "data-[variant=legend]:text-base", "data-[variant=label]:text-sm", className)}
      {...props}
    />
  );
}

function FieldGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-group"
      className={cn(
        "group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4",
        className,
      )}
      {...props}
    />
  );
}

const fieldVariants = cva("group/field flex w-full gap-3 data-[invalid=true]:text-destructive", {
  variants: {
    orientation: {
      vertical: ["flex-col [&>*]:w-full [&>.sr-only]:w-auto"],
      horizontal: [
        "flex-row items-center",
        "[&>[data-slot=field-label]]:flex-auto",
        "has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px",
      ],
      responsive: [
        "flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto",
        "@md/field-group:[&>[data-slot=field-label]]:flex-auto",
        "@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px",
      ],
    },
  },
  defaultVariants: {
    orientation: "vertical",
  },
});

function Field({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof fieldVariants>) {
  return (
    <div
      role="group"
      data-slot="field"
      data-orientation={orientation}
      className={cn(fieldVariants({ orientation }), className)}
      {...props}
    />
  );
}

function FieldContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-content"
      className={cn("group/field-content flex flex-1 flex-col gap-1.5 leading-snug", className)}
      {...props}
    />
  );
}

function FieldLabel({ className, ...props }: React.ComponentProps<typeof Label>) {
  return (
    <Label
      data-slot="field-label"
      className={cn(
        "group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50",
        "has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4",
        "has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10",
        className,
      )}
      {...props}
    />
  );
}

function FieldTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-label"
      className={cn(
        "flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50",
        className,
      )}
      {...props}
    />
  );
}

function FieldDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <p
      data-slot="field-description"
      className={cn(
        "text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance",
        "nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5",
        "[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",
        className,
      )}
      {...props}
    />
  );
}

function FieldSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  children?: React.ReactNode;
}) {
  return (
    <div
      data-slot="field-separator"
      data-content={!!children}
      className={cn("relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2", className)}
      {...props}
    >
      <Separator className="absolute inset-0 top-1/2" />
      {children && (
        <span
          className="bg-background text-muted-foreground relative mx-auto block w-fit px-2"
          data-slot="field-separator-content"
        >
          {children}
        </span>
      )}
    </div>
  );
}

function FieldError({
  className,
  children,
  errors,
  ...props
}: React.ComponentProps<"div"> & {
  errors?: Array<{ message?: string } | undefined>;
}) {
  const content = useMemo(() => {
    if (children) {
      return children;
    }

    if (!errors?.length) {
      return null;
    }

    const uniqueErrors = [...new Map(errors.map((error) => [error?.message, error])).values()];

    if (uniqueErrors?.length == 1) {
      return uniqueErrors[0]?.message;
    }

    return (
      <ul className="ml-4 flex list-disc flex-col gap-1">
        {uniqueErrors.map((error, index) => error?.message && <li key={index}>{error.message}</li>)}
      </ul>
    );
  }, [children, errors]);

  if (!content) {
    return null;
  }

  return (
    <div
      role="alert"
      data-slot="field-error"
      className={cn("text-destructive text-sm font-normal", className)}
      {...props}
    >
      {content}
    </div>
  );
}

export {
  Field,
  FieldLabel,
  FieldDescription,
  FieldError,
  FieldGroup,
  FieldLegend,
  FieldSeparator,
  FieldSet,
  FieldContent,
  FieldTitle,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/form.tsx">
"use client";

import * as React from "react";
import { Label as LabelPrimitive, Slot as SlotPrimitive } from "radix-ui";

import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form";

import { cn } from "@/lib/utils";
import { Label } from "@/components/ui/label";

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState } = useFormContext();
  const formState = useFormState({ name: fieldContext.name });
  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>");
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div data-slot="form-item" className={cn("grid gap-2", className)} {...props} />
    </FormItemContext.Provider>
  );
}

function FormLabel({ className, ...props }: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField();

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  );
}

function FormControl({ ...props }: React.ComponentProps<typeof SlotPrimitive.Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField();

  return (
    <SlotPrimitive.Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}
      aria-invalid={!!error}
      {...props}
    />
  );
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField();

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message ?? "") : props.children;

  if (!body) {
    return null;
  }

  return (
    <p data-slot="form-message" id={formMessageId} className={cn("text-destructive text-sm", className)} {...props}>
      {body}
    </p>
  );
}

export { useFormField, Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };
</file>

<file path="apps/moondesk-dash/src/components/ui/hover-card.tsx">
"use client";

import * as React from "react";
import { HoverCard as HoverCardPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function HoverCard({ ...props }: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />;
}

function HoverCardTrigger({ ...props }: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />;
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-hover-card-content-transform-origin) outline-hidden z-50 w-64 rounded-md border p-4 shadow-md",
          className,
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  );
}

export { HoverCard, HoverCardTrigger, HoverCardContent };
</file>

<file path="apps/moondesk-dash/src/components/ui/input-group.tsx">
"use client";

import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";

function InputGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-group"
      role="group"
      className={cn(
        "group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]",
        "h-9 min-w-0 has-[>textarea]:h-auto",

        // Variants based on alignment.
        "has-[>[data-align=inline-start]]:[&>input]:pl-2",
        "has-[>[data-align=inline-end]]:[&>input]:pr-2",
        "has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3",
        "has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3",

        // Focus state.
        "has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot=input-group-control]:focus-visible]:ring-[3px]",

        // Error state.
        "has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40",

        className,
      )}
      {...props}
    />
  );
}

const inputGroupAddonVariants = cva(
  "text-muted-foreground flex h-auto cursor-text items-center justify-center gap-2 py-1.5 text-sm font-medium select-none [&>svg:not([class*='size-'])]:size-4 [&>kbd]:rounded-[calc(var(--radius)-5px)] group-data-[disabled=true]/input-group:opacity-50",
  {
    variants: {
      align: {
        "inline-start": "order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]",
        "inline-end": "order-last pr-3 has-[>button]:mr-[-0.45rem] has-[>kbd]:mr-[-0.35rem]",
        "block-start":
          "order-first w-full justify-start px-3 pt-3 [.border-b]:pb-3 group-has-[>input]/input-group:pt-2.5",
        "block-end": "order-last w-full justify-start px-3 pb-3 [.border-t]:pt-3 group-has-[>input]/input-group:pb-2.5",
      },
    },
    defaultVariants: {
      align: "inline-start",
    },
  },
);

function InputGroupAddon({
  className,
  align = "inline-start",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof inputGroupAddonVariants>) {
  return (
    <div
      role="group"
      data-slot="input-group-addon"
      data-align={align}
      className={cn(inputGroupAddonVariants({ align }), className)}
      onClick={(e) => {
        if ((e.target as HTMLElement).closest("button")) {
          return;
        }
        e.currentTarget.parentElement?.querySelector("input")?.focus();
      }}
      {...props}
    />
  );
}

const inputGroupButtonVariants = cva("text-sm shadow-none flex gap-2 items-center", {
  variants: {
    size: {
      xs: "h-6 gap-1 px-2 rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-3.5 has-[>svg]:px-2",
      sm: "h-8 px-2.5 gap-1.5 rounded-md has-[>svg]:px-2.5",
      "icon-xs": "size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0",
      "icon-sm": "size-8 p-0 has-[>svg]:p-0",
    },
  },
  defaultVariants: {
    size: "xs",
  },
});

function InputGroupButton({
  className,
  type = "button",
  variant = "ghost",
  size = "xs",
  ...props
}: Omit<React.ComponentProps<typeof Button>, "size"> & VariantProps<typeof inputGroupButtonVariants>) {
  return (
    <Button
      type={type}
      data-size={size}
      variant={variant}
      className={cn(inputGroupButtonVariants({ size }), className)}
      {...props}
    />
  );
}

function InputGroupText({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      className={cn(
        "text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none",
        className,
      )}
      {...props}
    />
  );
}

function InputGroupInput({ className, ...props }: React.ComponentProps<"input">) {
  return (
    <Input
      data-slot="input-group-control"
      className={cn(
        "flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent",
        className,
      )}
      {...props}
    />
  );
}

function InputGroupTextarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <Textarea
      data-slot="input-group-control"
      className={cn(
        "flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent",
        className,
      )}
      {...props}
    />
  );
}

export { InputGroup, InputGroupAddon, InputGroupButton, InputGroupText, InputGroupInput, InputGroupTextarea };
</file>

<file path="apps/moondesk-dash/src/components/ui/input-otp.tsx">
"use client";

import * as React from "react";
import { OTPInput, OTPInputContext } from "input-otp";
import { MinusIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string;
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn("flex items-center gap-2 has-disabled:opacity-50", containerClassName)}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  );
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="input-otp-group" className={cn("flex items-center", className)} {...props} />;
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number;
}) {
  const inputOTPContext = React.useContext(OTPInputContext);
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {};

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input shadow-xs relative flex h-9 w-9 items-center justify-center border-y border-r text-sm outline-none transition-all first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  );
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  );
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };
</file>

<file path="apps/moondesk-dash/src/components/ui/input.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input shadow-xs h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base outline-none transition-[color,box-shadow] file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className,
      )}
      {...props}
    />
  );
}

export { Input };
</file>

<file path="apps/moondesk-dash/src/components/ui/item.tsx">
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Separator } from "@/components/ui/separator";

function ItemGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div role="list" data-slot="item-group" className={cn("group/item-group flex flex-col", className)} {...props} />
  );
}

function ItemSeparator({ className, ...props }: React.ComponentProps<typeof Separator>) {
  return <Separator data-slot="item-separator" orientation="horizontal" className={cn("my-0", className)} {...props} />;
}

const itemVariants = cva(
  "group/item flex items-center border border-transparent text-sm rounded-md transition-colors [a]:hover:bg-accent/50 [a]:transition-colors duration-100 flex-wrap outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline: "border-border",
        muted: "bg-muted/50",
      },
      size: {
        default: "p-4 gap-4 ",
        sm: "py-3 px-4 gap-2.5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Item({
  className,
  variant = "default",
  size = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof itemVariants> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "div";
  return (
    <Comp
      data-slot="item"
      data-variant={variant}
      data-size={size}
      className={cn(itemVariants({ variant, size, className }))}
      {...props}
    />
  );
}

const itemMediaVariants = cva(
  "flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none group-has-[[data-slot=item-description]]/item:translate-y-0.5",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        icon: "size-8 border rounded-sm bg-muted [&_svg:not([class*='size-'])]:size-4",
        image: "size-10 rounded-sm overflow-hidden [&_img]:size-full [&_img]:object-cover",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function ItemMedia({
  className,
  variant = "default",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof itemMediaVariants>) {
  return (
    <div
      data-slot="item-media"
      data-variant={variant}
      className={cn(itemMediaVariants({ variant, className }))}
      {...props}
    />
  );
}

function ItemContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-content"
      className={cn("flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none", className)}
      {...props}
    />
  );
}

function ItemTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-title"
      className={cn("flex w-fit items-center gap-2 text-sm font-medium leading-snug", className)}
      {...props}
    />
  );
}

function ItemDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <p
      data-slot="item-description"
      className={cn(
        "text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal",
        "[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",
        className,
      )}
      {...props}
    />
  );
}

function ItemActions({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="item-actions" className={cn("flex items-center gap-2", className)} {...props} />;
}

function ItemHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-header"
      className={cn("flex basis-full items-center justify-between gap-2", className)}
      {...props}
    />
  );
}

function ItemFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-footer"
      className={cn("flex basis-full items-center justify-between gap-2", className)}
      {...props}
    />
  );
}

export {
  Item,
  ItemMedia,
  ItemContent,
  ItemActions,
  ItemGroup,
  ItemSeparator,
  ItemTitle,
  ItemDescription,
  ItemHeader,
  ItemFooter,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/kbd.tsx">
import { cn } from "@/lib/utils";

function Kbd({ className, ...props }: React.ComponentProps<"kbd">) {
  return (
    <kbd
      data-slot="kbd"
      className={cn(
        "bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium",
        "[&_svg:not([class*='size-'])]:size-3",
        "[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10",
        className,
      )}
      {...props}
    />
  );
}

function KbdGroup({ className, ...props }: React.ComponentProps<"div">) {
  return <kbd data-slot="kbd-group" className={cn("inline-flex items-center gap-1", className)} {...props} />;
}

export { Kbd, KbdGroup };
</file>

<file path="apps/moondesk-dash/src/components/ui/label.tsx">
"use client";

import * as React from "react";
import { Label as LabelPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Label({ className, ...props }: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex select-none items-center gap-2 text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50 group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50",
        className,
      )}
      {...props}
    />
  );
}

export { Label };
</file>

<file path="apps/moondesk-dash/src/components/ui/menubar.tsx">
"use client";

import * as React from "react";
import { Menubar as MenubarPrimitive } from "radix-ui";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Menubar({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn("bg-background shadow-xs flex h-9 items-center gap-1 rounded-md border p-1", className)}
      {...props}
    />
  );
}

function MenubarMenu({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />;
}

function MenubarGroup({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />;
}

function MenubarPortal({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />;
}

function MenubarRadioGroup({ ...props }: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />;
}

function MenubarTrigger({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground outline-hidden flex select-none items-center rounded-sm px-2 py-1 text-sm font-medium",
        className,
      )}
      {...props}
    />
  );
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-menubar-content-transform-origin) z-50 min-w-[12rem] overflow-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </MenubarPortal>
  );
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled]:pointer-events-none data-[inset]:pl-8 data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground rounded-xs outline-hidden relative flex cursor-default select-none items-center gap-2 py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  );
}

function MenubarRadioItem({ className, children, ...props }: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground rounded-xs outline-hidden relative flex cursor-default select-none items-center gap-2 py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  );
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8", className)}
      {...props}
    />
  );
}

function MenubarSeparator({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function MenubarShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

function MenubarSub({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />;
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  );
}

function MenubarSubContent({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-menubar-content-transform-origin) z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/navigation-menu.tsx">
import * as React from "react";
import { NavigationMenu as NavigationMenuPrimitive } from "radix-ui";
import { cva } from "class-variance-authority";
import { ChevronDownIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean;
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn("group/navigation-menu relative flex max-w-max flex-1 items-center justify-center", className)}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  );
}

function NavigationMenuList({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn("group flex flex-1 list-none items-center justify-center gap-1", className)}
      {...props}
    />
  );
}

function NavigationMenuItem({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item data-slot="navigation-menu-item" className={cn("relative", className)} {...props} />
  );
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1",
);

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  );
}

function NavigationMenuContent({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 left-0 top-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div className={cn("absolute left-0 top-full isolate z-50 flex justify-center")}>
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function NavigationMenuLink({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm outline-none transition-all focus-visible:outline-1 focus-visible:ring-[3px] [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className,
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  );
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/pagination.tsx">
import * as React from "react";
import { ChevronLeftIcon, ChevronRightIcon, MoreHorizontalIcon } from "lucide-react";

import { cn } from "@/lib/utils";
import { Button, buttonVariants } from "@/components/ui/button";

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  );
}

function PaginationContent({ className, ...props }: React.ComponentProps<"ul">) {
  return <ul data-slot="pagination-content" className={cn("flex flex-row items-center gap-1", className)} {...props} />;
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />;
}

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">;

function PaginationLink({ className, isActive, size = "icon", ...props }: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className,
      )}
      {...props}
    />
  );
}

function PaginationPrevious({ className, ...props }: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  );
}

function PaginationNext({ className, ...props }: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  );
}

function PaginationEllipsis({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  );
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/popover.tsx">
"use client";

import * as React from "react";
import { Popover as PopoverPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Popover({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />;
}

function PopoverTrigger({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />;
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-popover-content-transform-origin) outline-hidden z-50 w-72 rounded-md border p-4 shadow-md",
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  );
}

function PopoverAnchor({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />;
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };
</file>

<file path="apps/moondesk-dash/src/components/ui/progress.tsx">
"use client";

import * as React from "react";
import { Progress as ProgressPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Progress({ className, value, ...props }: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full", className)}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  );
}

export { Progress };
</file>

<file path="apps/moondesk-dash/src/components/ui/radio-group.tsx">
"use client";

import * as React from "react";
import { RadioGroup as RadioGroupPrimitive } from "radix-ui";
import { CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function RadioGroup({ className, ...props }: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return <RadioGroupPrimitive.Root data-slot="radio-group" className={cn("grid gap-3", className)} {...props} />;
}

function RadioGroupItem({ className, ...props }: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 shadow-xs aspect-square size-4 shrink-0 rounded-full border outline-none transition-[color,box-shadow] focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute left-1/2 top-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
}

export { RadioGroup, RadioGroupItem };
</file>

<file path="apps/moondesk-dash/src/components/ui/resizable.tsx">
"use client";

import * as React from "react";
import { GripVerticalIcon } from "lucide-react";
import * as ResizablePrimitive from "react-resizable-panels";

import { cn } from "@/lib/utils";

function ResizablePanelGroup({ className, ...props }: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn("flex h-full w-full data-[panel-group-direction=vertical]:flex-col", className)}
      {...props}
    />
  );
}

function ResizablePanel({ ...props }: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />;
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean;
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring focus-visible:outline-hidden relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className,
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border rounded-xs z-10 flex h-4 w-3 items-center justify-center border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  );
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle };
</file>

<file path="apps/moondesk-dash/src/components/ui/scroll-area.tsx">
"use client";

import * as React from "react";
import { ScrollArea as ScrollAreaPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function ScrollArea({ className, children, ...props }: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root data-slot="scroll-area" className={cn("relative", className)} {...props}>
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] outline-none transition-[color,box-shadow] focus-visible:outline-1 focus-visible:ring-[3px]"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  );
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none select-none p-px transition-colors",
        orientation === "vertical" && "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" && "h-2.5 flex-col border-t border-t-transparent",
        className,
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  );
}

export { ScrollArea, ScrollBar };
</file>

<file path="apps/moondesk-dash/src/components/ui/select.tsx">
"use client";

import * as React from "react";
import { Select as SelectPrimitive } from "radix-ui";
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Select({ ...props }: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({ ...props }: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({ ...props }: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default";
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 shadow-xs flex w-fit items-center justify-between gap-2 whitespace-nowrap rounded-md border bg-transparent px-3 py-2 text-sm outline-none transition-[color,box-shadow] focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  );
}

function SelectContent({
  className,
  children,
  position = "popper",
  align = "center",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-(--radix-select-content-available-height) origin-(--radix-select-content-transform-origin) relative z-50 min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className,
        )}
        position={position}
        align={align}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1",
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  );
}

function SelectLabel({ className, ...props }: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  );
}

function SelectItem({ className, children, ...props }: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2 relative flex w-full cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-2 pr-8 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  );
}

function SelectSeparator({ className, ...props }: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function SelectScrollUpButton({ className, ...props }: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn("flex cursor-default items-center justify-center py-1", className)}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  );
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn("flex cursor-default items-center justify-center py-1", className)}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  );
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/separator.tsx">
"use client";

import * as React from "react";
import { Separator as SeparatorPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=vertical]:h-full data-[orientation=horizontal]:w-full data-[orientation=vertical]:w-px",
        className,
      )}
      {...props}
    />
  );
}

export { Separator };
</file>

<file path="apps/moondesk-dash/src/components/ui/sheet.tsx">
"use client";

import * as React from "react";
import { Dialog as SheetPrimitive } from "radix-ui";
import { XIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />;
}

function SheetTrigger({ ...props }: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />;
}

function SheetClose({ ...props }: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />;
}

function SheetPortal({ ...props }: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />;
}

function SheetOverlay({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left";
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className,
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary rounded-xs focus:outline-hidden absolute right-4 top-4 opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  );
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="sheet-header" className={cn("flex flex-col gap-1.5 p-4", className)} {...props} />;
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="sheet-footer" className={cn("mt-auto flex flex-col gap-2 p-4", className)} {...props} />;
}

function SheetTitle({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function SheetDescription({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export { Sheet, SheetTrigger, SheetClose, SheetContent, SheetHeader, SheetFooter, SheetTitle, SheetDescription };
</file>

<file path="apps/moondesk-dash/src/components/ui/sidebar.tsx">
"use client";

import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";
import { PanelLeftIcon } from "lucide-react";

import { useIsMobile } from "@/hooks/use-mobile";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Separator } from "@/components/ui/separator";
import { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle } from "@/components/ui/sheet";
import { Skeleton } from "@/components/ui/skeleton";
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip";

const SIDEBAR_COOKIE_NAME = "sidebar_state";
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = "16rem";
const SIDEBAR_WIDTH_MOBILE = "18rem";
const SIDEBAR_WIDTH_ICON = "3rem";
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContextProps = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}) {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full", className)}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  );
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right";
  variant?: "sidebar" | "floating" | "inset";
  collapsible?: "offcanvas" | "icon" | "none";
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn("bg-sidebar text-sidebar-foreground w-(--sidebar-width) flex h-full flex-col", className)}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      className="text-sidebar-foreground group peer hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "w-(--sidebar-width) relative bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "w-(--sidebar-width) fixed inset-y-0 z-10 hidden h-svh transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  );
}

function SidebarTrigger({ className, onClick, ...props }: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar();

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInput({ className, ...props }: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarSeparator({ className, ...props }: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  );
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "div";

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring outline-hidden flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground outline-hidden absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  );
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  isActive?: boolean;
  tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent side="right" align="center" hidden={state !== "collapsed" || isMobile} {...tooltip} />
    </Tooltip>
  );
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  showOnHover?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground outline-hidden absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuBadge({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean;
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && <Skeleton className="size-4 rounded-md" data-sidebar="menu-skeleton-icon" />}
      <Skeleton
        className="max-w-(--skeleton-width) h-4 flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSubItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  );
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
  size?: "sm" | "md";
  isActive?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "a";

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground outline-hidden flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
};
</file>

<file path="apps/moondesk-dash/src/components/ui/skeleton.tsx">
import { cn } from "@/lib/utils";

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="skeleton" className={cn("bg-accent animate-pulse rounded-md", className)} {...props} />;
}

export { Skeleton };
</file>

<file path="apps/moondesk-dash/src/components/ui/slider.tsx">
"use client";

import * as React from "react";
import { Slider as SliderPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () => (Array.isArray(value) ? value : Array.isArray(defaultValue) ? defaultValue : [min, max]),
    [value, defaultValue, min, max],
  );

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none select-none items-center data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col data-[disabled]:opacity-50",
        className,
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=vertical]:h-full data-[orientation=horizontal]:w-full data-[orientation=vertical]:w-1.5",
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary ring-ring/50 focus-visible:outline-hidden block size-4 shrink-0 rounded-full border bg-white shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  );
}

export { Slider };
</file>

<file path="apps/moondesk-dash/src/components/ui/sonner.tsx">
"use client";

import { CircleCheckIcon, InfoIcon, Loader2Icon, OctagonXIcon, TriangleAlertIcon } from "lucide-react";
import { useTheme } from "next-themes";
import { Toaster as Sonner, type ToasterProps } from "sonner";

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme();

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      icons={{
        success: <CircleCheckIcon className="size-4" />,
        info: <InfoIcon className="size-4" />,
        warning: <TriangleAlertIcon className="size-4" />,
        error: <OctagonXIcon className="size-4" />,
        loading: <Loader2Icon className="size-4 animate-spin" />,
      }}
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
          "--border-radius": "var(--radius)",
        } as React.CSSProperties
      }
      {...props}
    />
  );
};

export { Toaster };
</file>

<file path="apps/moondesk-dash/src/components/ui/spinner.tsx">
import { Loader2Icon } from "lucide-react";

import { cn } from "@/lib/utils";

function Spinner({ className, ...props }: React.ComponentProps<"svg">) {
  return <Loader2Icon role="status" aria-label="Loading" className={cn("size-4 animate-spin", className)} {...props} />;
}

export { Spinner };
</file>

<file path="apps/moondesk-dash/src/components/ui/switch.tsx">
"use client";

import * as React from "react";
import { Switch as SwitchPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Switch({ className, ...props }: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 shadow-xs peer inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent outline-none transition-all focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0",
        )}
      />
    </SwitchPrimitive.Root>
  );
}

export { Switch };
</file>

<file path="apps/moondesk-dash/src/components/ui/table.tsx">
"use client";

import * as React from "react";

import { cn } from "@/lib/utils";

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div data-slot="table-container" className="relative w-full overflow-x-auto">
      <table data-slot="table" className={cn("w-full caption-bottom text-sm", className)} {...props} />
    </div>
  );
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return <thead data-slot="table-header" className={cn("[&_tr]:border-b", className)} {...props} />;
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return <tbody data-slot="table-body" className={cn("[&_tr:last-child]:border-0", className)} {...props} />;
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0", className)}
      {...props}
    />
  );
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors", className)}
      {...props}
    />
  );
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 whitespace-nowrap px-2 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "whitespace-nowrap p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCaption({ className, ...props }: React.ComponentProps<"caption">) {
  return (
    <caption data-slot="table-caption" className={cn("text-muted-foreground mt-4 text-sm", className)} {...props} />
  );
}

export { Table, TableHeader, TableBody, TableFooter, TableHead, TableRow, TableCell, TableCaption };
</file>

<file path="apps/moondesk-dash/src/components/ui/tabs.tsx">
"use client";

import * as React from "react";
import { Tabs as TabsPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Tabs({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return <TabsPrimitive.Root data-slot="tabs" className={cn("flex flex-col gap-2", className)} {...props} />;
}

function TabsList({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className,
      )}
      {...props}
    />
  );
}

function TabsTrigger({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 whitespace-nowrap rounded-md border border-transparent px-2 py-1 text-sm font-medium transition-[color,box-shadow] focus-visible:outline-1 focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function TabsContent({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return <TabsPrimitive.Content data-slot="tabs-content" className={cn("flex-1 outline-none", className)} {...props} />;
}

export { Tabs, TabsList, TabsTrigger, TabsContent };
</file>

<file path="apps/moondesk-dash/src/components/ui/textarea.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 field-sizing-content shadow-xs flex min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base outline-none transition-[color,box-shadow] focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className,
      )}
      {...props}
    />
  );
}

export { Textarea };
</file>

<file path="apps/moondesk-dash/src/components/ui/toggle-group.tsx">
"use client";

import * as React from "react";
import { ToggleGroup as ToggleGroupPrimitive } from "radix-ui";
import { type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { toggleVariants } from "@/components/ui/toggle";

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants> & {
    spacing?: number;
  }
>({
  size: "default",
  variant: "default",
  spacing: 0,
});

function ToggleGroup({
  className,
  variant,
  size,
  spacing = 0,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants> & {
    spacing?: number;
  }) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      data-spacing={spacing}
      style={{ "--gap": spacing } as React.CSSProperties}
      className={cn(
        "group/toggle-group data-[spacing=default]:data-[variant=outline]:shadow-xs flex w-fit items-center gap-[--spacing(var(--gap))] rounded-md",
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size, spacing }}>{children}</ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  );
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> & VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      data-spacing={context.spacing}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "w-auto min-w-0 shrink-0 px-3 focus:z-10 focus-visible:z-10",
        "data-[spacing=0]:rounded-none data-[spacing=0]:data-[variant=outline]:border-l-0 data-[spacing=0]:shadow-none data-[spacing=0]:first:rounded-l-md data-[spacing=0]:data-[variant=outline]:first:border-l data-[spacing=0]:last:rounded-r-md",
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
}

export { ToggleGroup, ToggleGroupItem };
</file>

<file path="apps/moondesk-dash/src/components/ui/toggle.tsx">
"use client";

import * as React from "react";
import { Toggle as TogglePrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline: "border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root data-slot="toggle" className={cn(toggleVariants({ variant, size, className }))} {...props} />
  );
}

export { Toggle, toggleVariants };
</file>

<file path="apps/moondesk-dash/src/components/ui/tooltip.tsx">
"use client";

import * as React from "react";
import { Tooltip as TooltipPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function TooltipProvider({ delayDuration = 0, ...props }: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return <TooltipPrimitive.Provider data-slot="tooltip-provider" delayDuration={delayDuration} {...props} />;
}

function Tooltip({ ...props }: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  );
}

function TooltipTrigger({ ...props }: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />;
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-tooltip-content-transform-origin) z-50 w-fit text-balance rounded-md px-3 py-1.5 text-xs",
          className,
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  );
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };
</file>

<file path="apps/moondesk-dash/eslint.config.mjs">
// TODO: Fix linting issues in this package. Linting is currently disabled in package.json to prevent CI hangs.
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";
import pluginJs from "@eslint/js";
import pluginImport from "eslint-plugin-import";
import globals from "globals";
import tseslint from "typescript-eslint";
import securityPlugin from "eslint-plugin-security";
import prettier from "eslint-plugin-prettier";
import unicorn from "eslint-plugin-unicorn";
import sonarjs from "eslint-plugin-sonarjs";

export default defineConfig([
  ...nextVitals,
  ...nextTs,
  { files: ["**/*.{js,mjs,cjs,ts,jsx,tsx}"] },
  {
    languageOptions: {
      globals: globals.browser,
      parser: "@typescript-eslint/parser",
      parserOptions: {
        project: "./tsconfig.json",
      },
    },
    plugins: {
      import: pluginImport,
      security: securityPlugin,
      prettier: prettier,
      unicorn: unicorn,
      sonarjs: sonarjs,
    },
  },
  pluginJs.configs.recommended,
  securityPlugin.configs.recommended,
  ...tseslint.configs.recommended,
  {
    rules: {
      // Prettier integration rules
      "prettier/prettier": "warn",

      // File Naming
      "unicorn/filename-case": [
        "error",
        {
          case: "kebabCase",
          ignore: ["^.*\\.config\\.(js|ts|mjs)$", "^.*\\.d\\.ts$"],
        },
      ],

      // Custom Rules (Not covered by plugins)
      "spaced-comment": ["error", "always", { exceptions: ["-", "+"] }],
      "key-spacing": ["error", { beforeColon: false, afterColon: true }],
      "no-useless-rename": "error",

      // Import/Export Rules
      "import/no-mutable-exports": "error",
      "import/order": [
        "error",
        {
          groups: ["builtin", "external", "internal", "parent", "sibling", "index"],
          pathGroups: [
            {
              pattern: "react",
              group: "external",
              position: "before",
            },
            {
              pattern: "{next,next/**}",
              group: "external",
              position: "before",
            },
          ],
          pathGroupsExcludedImportTypes: [],
          "newlines-between": "always",
          alphabetize: {
            order: "asc",
            caseInsensitive: true,
          },
        },
      ],
      "import/newline-after-import": "error",
      "import/no-unresolved": [
        "error",
        {
          caseSensitive: true,
        },
      ],
      "no-duplicate-imports": ["error", { includeExports: true }],
      "import/no-cycle": ["error", { maxDepth: 2 }],

      // Whitespace and Punctuation (Style Rules)
      "no-trailing-spaces": "error",
      "no-multiple-empty-lines": ["error", { max: 1, maxEOF: 1 }],
      "space-before-function-paren": [
        "error",
        {
          anonymous: "always",
          named: "never",
          asyncArrow: "always",
        },
      ],
      "space-in-parens": ["error", "never"],
      "array-bracket-spacing": ["error", "never"],
      "object-curly-spacing": ["error", "always"],
      "func-call-spacing": ["error", "never"],
      "computed-property-spacing": ["error", "never"],

      // Naming Conventions
      "no-underscore-dangle": ["error", { allow: ["_id", "__dirname"] }],

      // Complexity
      complexity: ["error", { max: 10 }],
      "max-lines": ["error", { max: 300, skipBlankLines: true, skipComments: true }],
      "max-depth": ["error", 4],

      // TypeScript-Specific Rules (customized)
      "@typescript-eslint/prefer-nullish-coalescing": "error",
      "@typescript-eslint/no-unnecessary-type-assertion": "warn",
      "@typescript-eslint/no-unnecessary-condition": "warn",
      "@typescript-eslint/no-explicit-any": "warn",
      "@typescript-eslint/no-unused-vars": ["warn"],

      // React unnecessary import rules
      "react/jsx-no-useless-fragment": ["warn", { allowExpressions: true }],

      // React JSX Pascal Case Rule
      "react/jsx-pascal-case": [
        "error",
        {
          allowAllCaps: false,
          ignore: [],
        },
      ],

      // React: Prevent nesting component definitions inside another component
      "react/no-unstable-nested-components": ["error", { allowAsProps: true }],

      // React: Prevent re-renders by ensuring context values are memoized
      "react/jsx-no-constructed-context-values": "error",

      // React: Disallow array index as key in JSX
      "react/no-array-index-key": "warn",

      // SonarJS: Detect commented-out code
      "sonarjs/no-commented-code": "warn",
    },
  },
  globalIgnores([
    ".github/",
    ".husky/",
    "node_modules/",
    ".next/**",
    "out/**",
    "build/**",
    "dist/**",
    "coverage/**",
    "next-env.d.ts",
    "src/components/ui",
    "*.config.ts",
    "*.mjs",
  ]),
]);
</file>

<file path="apps/moondesk-dash/README.md">
# Moondesk - Industrial IoT Dashboard

**Moondesk** is a modern Industrial IoT dashboard for monitoring and managing industrial assets in real-time.

## Features

- **Device Management**: Provision and monitor industrial devices (Solar Panels, PLCs, Sensors)
- **Real-time Monitoring**: Track telemetry data and device status
- **Multi-tenancy**: Secure organization-based access control via Clerk
- **Customizable Themes**: Multiple theme presets (default, brutalist, soft-pop, tangerine)
- **Responsive Design**: Mobile-first, works on all devices
- **Type-Safe**: Built with TypeScript for reliability

## Tech Stack

- **Framework**: Next.js 16 (App Router), TypeScript, Tailwind CSS v4
- **UI Components**: shadcn/ui (New York style)
- **Authentication**: Clerk
- **State Management**: Zustand
- **Data Fetching**: TanStack Query (React Query)
- **Forms**: React Hook Form + Zod validation
- **Charts**: Recharts
- **Icons**: Lucide React

## Getting Started

### Prerequisites

- Node.js 18+ and pnpm
- Clerk account for authentication

### Installation

1. **Clone the repository**

   ```bash
   git clone <repository-url>
   cd moondesk/apps/moondesk-dash
   ```

2. **Install dependencies**

   ```bash
   pnpm install
   ```

3. **Set up environment variables**

   Copy `.env.local.example` to `.env.local` and add your Clerk keys:

   ```bash
   cp .env.local.example .env.local
   ```

4. **Start the development server**
   ```bash
   pnpm dev
   ```

Your app will be running at [http://localhost:3000](http://localhost:3000)

## Project Structure

```
src/
├── app/                    # Next.js App Router pages
│   ├── (external)/         # Public pages (landing)
│   ├── (main)/             # Protected pages (dashboard)
│   ├── sign-in/            # Custom sign-in page
│   ├── sign-up/            # Custom sign-up page
│   └── organization/       # Organization management
├── components/
│   ├── ui/                 # shadcn/ui components
│   └── data-table/         # Reusable table components
├── config/                 # App configuration
├── hooks/                  # Custom React hooks
├── lib/                    # Utility functions
├── navigation/             # Navigation configuration
├── server/                 # Server actions
├── services/               # API clients
├── stores/                 # Zustand stores
├── styles/                 # Theme presets
└── types/                  # TypeScript types
```

## Available Scripts

- `pnpm dev` - Start development server
- `pnpm build` - Build for production
- `pnpm start` - Start production server
- `pnpm lint` - Run ESLint
- `pnpm format` - Format code with Prettier
- `pnpm check-types` - Type check with TypeScript

## Theme Customization

Moondesk includes multiple theme presets:

- **default** - Neutral gray theme
- **brutalist** - Bold orange/red with hard shadows
- **soft-pop** - Purple/violet theme
- **tangerine** - Orange theme

Switch themes in the app settings or create custom presets in `src/styles/presets/`.

## License

MIT
</file>

<file path="apps/mqtt-worker/src/api-broadcaster.test.ts">
import { vi, describe, it, expect, beforeEach, afterEach } from "vitest";
import {
  connectToApi,
  broadcastToApi,
  disconnectFromApi,
} from "./api-broadcaster";
import { io } from "socket.io-client";

vi.mock("socket.io-client", () => ({
  io: vi.fn(),
}));

vi.mock("@moondesk/config", () => ({
  getEnv: vi.fn(() => ({
    HOST: "localhost",
    PORT: 3001,
    DATABASE_URL: "postgresql://user:password@host:port/db",
  })),
}));

describe("api-broadcaster", () => {
  let socketMock: any;

  beforeEach(() => {
    socketMock = {
      on: vi.fn(),
      emit: vi.fn(),
      disconnect: vi.fn(),
      connected: false,
    };
    (io as any).mockReturnValue(socketMock);
  });

  afterEach(() => {
    vi.clearAllMocks();
    disconnectFromApi();
  });

  describe("connectToApi", () => {
    it("should connect to the API and resolve on successful connection", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: () => void) => {
          if (event === "connect") {
            callback();
          }
        },
      );

      await connectToApi();

      expect(io).toHaveBeenCalled();
      expect(socketMock.on).toHaveBeenCalledWith(
        "connect",
        expect.any(Function),
      );
    });

    it("should resolve even if the connection fails", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: (error: Error) => void) => {
          if (event === "connect_error") {
            callback(new Error("Connection failed"));
          }
        },
      );

      await connectToApi();

      expect(io).toHaveBeenCalled();
      expect(socketMock.on).toHaveBeenCalledWith(
        "connect_error",
        expect.any(Function),
      );
    });
  });

  describe("broadcastToApi", () => {
    it("should emit an event if the socket is connected", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: () => void) => {
          if (event === "connect") {
            socketMock.connected = true;
            callback();
          }
        },
      );

      await connectToApi();
      await broadcastToApi("reading", {
        sensorId: 1,
        assetId: 1,
        organizationId: "org1",
        timestamp: new Date(),
        value: 10,
        parameter: "temp",
        quality: "good",
      });

      expect(socketMock.emit).toHaveBeenCalledWith(
        "worker:reading",
        expect.any(Object),
      );
    });

    it("should not emit an event if the socket is not connected", async () => {
      await broadcastToApi("reading", {
        sensorId: 1,
        assetId: 1,
        organizationId: "org1",
        timestamp: new Date(),
        value: 10,
        parameter: "temp",
        quality: "good",
      });

      expect(socketMock.emit).not.toHaveBeenCalled();
    });
  });

  describe("disconnectFromApi", () => {
    it("should disconnect the socket", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: () => void) => {
          if (event === "connect") {
            callback();
          }
        },
      );

      await connectToApi();
      disconnectFromApi();

      expect(socketMock.disconnect).toHaveBeenCalled();
    });
  });
});
</file>

<file path="apps/mqtt-worker/src/api-broadcaster.ts">
import { io, Socket } from "socket.io-client";
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";

const logger = createLogger("api-broadcaster");

let socket: Socket | null = null;

interface ReadingPayload {
  sensorId: number;
  assetId: number;
  organizationId: string;
  timestamp: Date;
  value: number;
  parameter: string;
  quality: string;
}

interface AlertPayload {
  id: number;
  sensorId: number;
  assetId: number;
  organizationId: string;
  severity: string;
  message: string;
  value: number;
  threshold: number;
  createdAt: Date;
}

interface CommandStatusPayload {
  id: number;
  sensorId: number;
  organizationId: string;
  status: string;
  result: string | null;
  completedAt: Date;
}

type BroadcastType = "reading" | "reading-batch" | "alert" | "command-status";
type BroadcastPayload =
  | ReadingPayload
  | ReadingPayload[]
  | AlertPayload
  | CommandStatusPayload;

/**
 * Connect to the API's internal broadcast endpoint
 * In production, this would use Redis pub/sub for horizontal scaling
 */
export async function connectToApi(): Promise<void> {
  const env = getEnv();
  const apiUrl = process.env["API_URL"] || `http://${env.HOST}:${env.PORT}`;

  return new Promise((resolve, reject) => {
    logger.info({ apiUrl }, "Connecting to API for broadcasting");

    socket = io(apiUrl, {
      autoConnect: true,
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionAttempts: 10,
      // Use internal service token for worker-to-API communication
      auth: {
        token: process.env["INTERNAL_SERVICE_TOKEN"] ?? "",
        isWorker: true,
      },
    });

    socket.on("connect", () => {
      logger.info("Connected to API for broadcasting");
      resolve();
    });

    socket.on("connect_error", (error) => {
      logger.error({ error: error.message }, "Failed to connect to API");
      // Don't reject - we can operate without broadcasting
      resolve();
    });

    socket.on("disconnect", (reason) => {
      logger.warn({ reason }, "Disconnected from API");
    });
  });
}

/**
 * Broadcast an event to the API server
 * The API server will then broadcast to connected clients
 */
export async function broadcastToApi(
  type: BroadcastType,
  payload: BroadcastPayload,
): Promise<void> {
  if (!socket?.connected) {
    logger.debug({ type }, "Cannot broadcast - not connected to API");
    return;
  }

  try {
    socket.emit(`worker:${type}`, payload);
    logger.debug({ type }, "Broadcasted event to API");
  } catch (error) {
    logger.error({ error, type }, "Failed to broadcast to API");
  }
}

/**
 * Disconnect from API
 */
export function disconnectFromApi(): void {
  if (socket) {
    socket.disconnect();
    socket = null;
    logger.info("Disconnected from API broadcaster");
  }
}
</file>

<file path="apps/mqtt-worker/src/index.ts">
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";
import {
  connectMqtt,
  subscribeToTopics,
  setMessageHandler,
  disconnectMqtt,
} from "./mqtt-client";
import { handleMessage, refreshAllSensorThresholds } from "./ingestion-handler";
import { connectToApi, disconnectFromApi } from "./api-broadcaster";

const logger = createLogger("mqtt-worker");
const THRESHOLD_REFRESH_INTERVAL_MS = 5 * 60 * 1000; // 5 minutes

async function main(): Promise<void> {
  logger.info("Starting MQTT Worker...");

  try {
    getEnv();

    // Connect to API for broadcasting (optional - worker can run without it)
    await connectToApi();

    // Connect to MQTT broker
    await connectMqtt();

    // Set up message handler
    setMessageHandler(handleMessage);

    // Subscribe to all organization sensor topics
    await subscribeToTopics();

    // Periodically refresh sensor thresholds
    await refreshAllSensorThresholds();
    setInterval(refreshAllSensorThresholds, THRESHOLD_REFRESH_INTERVAL_MS);

    logger.info(`✅ MQTT Worker running`);
    logger.info(`📡 Subscribed to sensor topics`);
    logger.info(`🔗 Connected to API for broadcasting`);
  } catch (error) {
    logger.error({ error }, "Failed to start MQTT Worker");
    process.exit(1);
  }
}

// Graceful shutdown
async function shutdown(signal: string): Promise<void> {
  logger.info({ signal }, "Shutting down MQTT Worker...");

  disconnectFromApi();
  await disconnectMqtt();

  logger.info("MQTT Worker stopped");
  process.exit(0);
}

process.on("SIGINT", () => shutdown("SIGINT"));
process.on("SIGTERM", () => shutdown("SIGTERM"));

// Handle uncaught errors
process.on("uncaughtException", (error) => {
  logger.error({ error }, "Uncaught exception");
  process.exit(1);
});

process.on("unhandledRejection", (reason) => {
  logger.error({ reason }, "Unhandled rejection");
  process.exit(1);
});

main();
</file>

<file path="apps/mqtt-worker/src/ingestion-handler.test.ts">
import { vi, describe, it, expect, beforeEach } from "vitest";

vi.mock("@moondesk/database");
vi.mock("./api-broadcaster");
vi.mock("./parser");

import {
  handleMessage,
  refreshAllSensorThresholds,
  clearThresholdCache,
} from "./ingestion-handler";
import { ReadingRepository, SensorRepository } from "@moondesk/database";
import { broadcastToApi } from "./api-broadcaster";
import { parseMessage, parseTopic } from "./parser";

describe("Ingestion Handler", () => {
  beforeEach(() => {
    vi.resetAllMocks();
    clearThresholdCache();
  });

  describe("handleMessage", () => {
    it('should call handleSingleReading for "readings" action', async () => {
      const readingRepo = new ReadingRepository();
      vi.mocked(parseTopic).mockReturnValue({
        organizationId: "test-org",
        sensorId: 1,
        action: "readings",
      });
      vi.mocked(parseMessage).mockReturnValue({ value: 25, sensorId: 1 });
      vi.mocked(readingRepo.insert).mockResolvedValue({
        id: 1,
        value: 25,
        timestamp: new Date(),
      } as any);

      await handleMessage("org/test-org/sensor/1/readings", Buffer.from(""));

      expect(readingRepo.insert).toHaveBeenCalled();
      expect(broadcastToApi).toHaveBeenCalledWith(
        "reading",
        expect.any(Object),
      );
    });

    it("should handle errors in handleSingleReading gracefully", async () => {
      const readingRepo = new ReadingRepository();
      vi.mocked(parseTopic).mockReturnValue({
        organizationId: "test-org",
        sensorId: 1,
        action: "readings",
      });
      vi.mocked(parseMessage).mockReturnValue({ value: 25, sensorId: 1 });
      vi.mocked(readingRepo.insert).mockRejectedValue(new Error("DB Error"));

      await handleMessage("org/test-org/sensor/1/readings", Buffer.from(""));

      expect(readingRepo.insert).toHaveBeenCalled();
    });
  });

  describe("refreshAllSensorThresholds", () => {
    it("should fetch all sensors and update the cache", async () => {
      const sensorRepo = new SensorRepository();
      const sensors = [
        { id: 1, thresholdLow: 10, thresholdHigh: 30 },
        { id: 2, thresholdLow: null, thresholdHigh: 50 },
      ];
      vi.mocked(sensorRepo.getAllSystemSensors).mockResolvedValue(
        sensors as any,
      );

      await refreshAllSensorThresholds();

      expect(sensorRepo.getAllSystemSensors).toHaveBeenCalled();
    });
  });
});
</file>

<file path="apps/mqtt-worker/src/ingestion-handler.ts">
import { createLogger } from "@moondesk/logger";
import {
  ReadingRepository,
  SensorRepository,
  AlertRepository,
} from "@moondesk/database";
import {
  AlertSeverity,
  Parameter,
  Protocol,
  ReadingQuality,
} from "@moondesk/domain";
import type { CreateReadingInput, CreateAlertInput } from "@moondesk/domain";
import {
  parseTopic,
  parseMessage,
  type MqttReading,
  type MqttBatch,
  type MqttCommandResponse,
} from "./parser";
import { broadcastToApi } from "./api-broadcaster";

const logger = createLogger("ingestion");

const readingRepository = new ReadingRepository();
const sensorRepository = new SensorRepository();
const alertRepository = new AlertRepository();

// Cache for sensor thresholds (refreshed periodically)
const sensorThresholdCache = new Map<
  number,
  { min: number | null; max: number | null }
>();

/**
 * Main message handler for incoming MQTT messages
 */
export async function handleMessage(
  topic: string,
  payload: Buffer,
): Promise<void> {
  const parsed = parseTopic(topic);
  if (!parsed) {
    logger.warn({ topic }, "Unable to parse topic");
    return;
  }

  const { organizationId, sensorId, action } = parsed;

  switch (action) {
    case "readings":
      try {
        await handleSingleReading(organizationId, sensorId, payload);
      } catch (error) {
        logger.error(
          { error, topic, organizationId, sensorId },
          "Error processing single reading",
        );
      }
      break;
    case "batch":
      try {
        await handleBatchReadings(organizationId, sensorId, payload);
      } catch (error) {
        logger.error(
          { error, topic, organizationId, sensorId },
          "Error processing batch readings",
        );
      }
      break;
    case "command-response":
      try {
        await handleCommandResponse(organizationId, sensorId, payload);
      } catch (error) {
        logger.error(
          { error, topic, organizationId, sensorId },
          "Error processing command response",
        );
      }
      break;
    default:
      logger.debug({ topic, action }, "Unhandled action type");
  }
}

/**
 * Handle a single reading message
 */
async function handleSingleReading(
  organizationId: string,
  sensorId: number,
  payload: Buffer,
): Promise<void> {
  const message = parseMessage(payload, "readings") as MqttReading | null;

  if (!message) {
    logger.warn({ organizationId, sensorId }, "Invalid reading message");
    return;
  }

  const input: CreateReadingInput = {
    sensorId,
    organizationId,
    timestamp: message.timestamp ? new Date(message.timestamp) : new Date(),
    value: message.value,
    parameter: message.parameter ?? Parameter.None,
    protocol: Protocol.Mqtt,
    quality: message.quality ?? ReadingQuality.Good,
    metadata: message.metadata ?? {},
  };

  // Insert reading
  const reading = await readingRepository.insert(input);

  logger.debug({ sensorId, value: reading.value }, "Reading ingested");

  // Check for alert thresholds
  await checkThresholds(organizationId, sensorId, message.value);

  // Broadcast to API via Socket.io
  await broadcastToApi("reading", {
    sensorId,
    assetId: 0, // Would need to lookup
    organizationId,
    timestamp: reading.timestamp,
    value: reading.value,
    parameter: reading.parameter,
    quality: reading.quality,
  });
}

/**
 * Handle a batch of readings
 */
async function handleBatchReadings(
  organizationId: string,
  sensorId: number,
  payload: Buffer,
): Promise<void> {
  const message = parseMessage(payload, "batch") as MqttBatch | null;

  if (!message || !message.readings.length) {
    logger.warn({ organizationId, sensorId }, "Invalid or empty batch message");
    return;
  }

  const inputs: CreateReadingInput[] = message.readings.map(
    (r: MqttReading) => ({
      sensorId: r.sensorId || sensorId,
      organizationId,
      timestamp: r.timestamp ? new Date(r.timestamp) : new Date(),
      value: r.value,
      parameter: r.parameter ?? Parameter.None,
      protocol: Protocol.Mqtt,
      quality: r.quality ?? ReadingQuality.Good,
      metadata: r.metadata ?? {},
    }),
  );

  // Bulk insert readings
  await readingRepository.bulkInsert(inputs);

  logger.info({ sensorId, count: inputs.length }, "Batch readings ingested");

  // Check thresholds for each reading
  for (const input of inputs) {
    await checkThresholds(organizationId, input.sensorId, input.value);
  }

  // Broadcast batch to API
  await broadcastToApi(
    "reading-batch",
    inputs.map((r) => ({
      sensorId: r.sensorId,
      assetId: 0,
      organizationId,
      timestamp: r.timestamp ?? new Date(),
      value: r.value,
      parameter: r.parameter ?? Parameter.None,
      quality: r.quality ?? ReadingQuality.Good,
    })),
  );
}

/**
 * Handle command response from edge device
 */
async function handleCommandResponse(
  organizationId: string,
  sensorId: number,
  payload: Buffer,
): Promise<void> {
  const message = parseMessage(
    payload,
    "command-response",
  ) as MqttCommandResponse | null;

  if (!message) {
    logger.warn({ organizationId, sensorId }, "Invalid command response");
    return;
  }

  // Would update command status in database
  logger.info(
    { sensorId, commandId: message.commandId, status: message.status },
    "Command response received",
  );

  // Broadcast command status update
  await broadcastToApi("command-status", {
    id: message.commandId,
    sensorId,
    organizationId,
    status: message.status,
    result: message.result ?? null,
    completedAt: new Date(),
  });
}

/**
 * Check reading value against thresholds and create alerts if needed
 */
async function checkThresholds(
  organizationId: string,
  sensorId: number,
  value: number,
): Promise<void> {
  // Get cached thresholds or fetch from database
  let thresholds = sensorThresholdCache.get(sensorId);

  if (!thresholds) {
    const sensor = await sensorRepository.getById(sensorId, organizationId);
    if (sensor) {
      thresholds = { min: sensor.thresholdLow, max: sensor.thresholdHigh };
      sensorThresholdCache.set(sensorId, thresholds);
    } else {
      return;
    }
  }

  let alertSeverity: AlertSeverity | null = null;
  let alertMessage = "";
  let thresholdValue: number | null = null;

  if (thresholds.max !== null && value > thresholds.max) {
    alertSeverity = AlertSeverity.Critical;
    alertMessage = `Value ${value} exceeds maximum threshold ${thresholds.max}`;
    thresholdValue = thresholds.max;
  } else if (thresholds.min !== null && value < thresholds.min) {
    alertSeverity = AlertSeverity.Warning;
    alertMessage = `Value ${value} below minimum threshold ${thresholds.min}`;
    thresholdValue = thresholds.min;
  }

  if (alertSeverity) {
    const alertInput: CreateAlertInput = {
      sensorId,
      organizationId,
      severity: alertSeverity,
      message: alertMessage,
      triggerValue: value,
      thresholdValue,
      protocol: Protocol.Mqtt,
      metadata: {},
    };

    const alert = await alertRepository.create(alertInput);

    logger.info(
      { sensorId, alertId: alert.id, severity: alertSeverity },
      "Alert created",
    );

    // Broadcast alert
    await broadcastToApi("alert", {
      id: alert.id,
      sensorId,
      assetId: 0,
      organizationId,
      severity: alert.severity,
      message: alert.message,
      value: alert.triggerValue,
      threshold: alert.thresholdValue ?? 0,
      createdAt: alert.timestamp,
    });
  }
}

/**
 * Refresh threshold cache for all sensors in the system.
 * This should be called periodically.
 */
export async function refreshAllSensorThresholds(): Promise<void> {
  const sensors = await sensorRepository.getAllSystemSensors();
  for (const sensor of sensors) {
    sensorThresholdCache.set(sensor.id, {
      min: sensor.thresholdLow,
      max: sensor.thresholdHigh,
    });
  }
  logger.info({ count: sensors.length }, "Refreshed sensor threshold cache");
}

/**
 * Clear threshold cache
 */
export function clearThresholdCache(): void {
  sensorThresholdCache.clear();
}
</file>

<file path="apps/mqtt-worker/src/mqtt-client.ts">
import mqtt, { MqttClient, IClientOptions } from "mqtt";
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";

const logger = createLogger("mqtt-client");

export type MessageHandler = (topic: string, payload: Buffer) => void;

let client: MqttClient | null = null;
let messageHandler: MessageHandler | null = null;

/**
 * Initialize MQTT client connection
 */
export async function connectMqtt(): Promise<MqttClient> {
  const env = getEnv();

  const options: IClientOptions = {
    host: env.MQTT_HOST ?? "localhost",
    port: env.MQTT_PORT ?? 1883,
    username: env.MQTT_USERNAME,
    password: env.MQTT_PASSWORD,
    clientId: `moondesk-worker-${process.pid}`,
    reconnectPeriod: 5000,
    connectTimeout: 30000,
    clean: true,
  };

  return new Promise((resolve, reject) => {
    logger.info(
      { host: options.host, port: options.port },
      "Connecting to MQTT broker",
    );

    client = mqtt.connect(options);

    client.on("connect", () => {
      logger.info("Connected to MQTT broker");
      resolve(client!);
    });

    client.on("error", (error) => {
      logger.error({ error }, "MQTT connection error");
      reject(error);
    });

    client.on("reconnect", () => {
      logger.info("Reconnecting to MQTT broker");
    });

    client.on("offline", () => {
      logger.warn("MQTT client offline");
    });

    client.on("close", () => {
      logger.info("MQTT connection closed");
    });

    client.on("message", (topic, payload) => {
      if (messageHandler) {
        messageHandler(topic, payload);
      }
    });
  });
}

/**
 * Subscribe to organization topics
 */
export async function subscribeToTopics(
  organizationIds?: string[],
): Promise<void> {
  if (!client) {
    throw new Error("MQTT client not connected");
  }

  // Subscribe to all organizations or specific ones
  const topicPattern = organizationIds
    ? organizationIds.map((id) => `moondesk/${id}/sensors/+/#`)
    : ["moondesk/+/sensors/+/#"];

  for (const topic of topicPattern) {
    await new Promise<void>((resolve, reject) => {
      client!.subscribe(topic, { qos: 1 }, (error) => {
        if (error) {
          logger.error({ error, topic }, "Failed to subscribe to topic");
          reject(error);
        } else {
          logger.info({ topic }, "Subscribed to topic");
          resolve();
        }
      });
    });
  }
}

/**
 * Set the message handler for incoming MQTT messages
 */
export function setMessageHandler(handler: MessageHandler): void {
  messageHandler = handler;
}

/**
 * Publish a command to a sensor
 */
export async function publishCommand(
  organizationId: string,
  sensorId: number,
  commandPayload: Record<string, unknown>,
): Promise<void> {
  if (!client) {
    throw new Error("MQTT client not connected");
  }

  const topic = `moondesk/${organizationId}/sensors/${sensorId}/commands`;
  const payload = JSON.stringify(commandPayload);

  await new Promise<void>((resolve, reject) => {
    client!.publish(topic, payload, { qos: 1 }, (error) => {
      if (error) {
        logger.error({ error, topic }, "Failed to publish command");
        reject(error);
      } else {
        logger.debug({ topic, sensorId }, "Published command");
        resolve();
      }
    });
  });
}

/**
 * Disconnect from MQTT broker
 */
export async function disconnectMqtt(): Promise<void> {
  if (client) {
    await new Promise<void>((resolve) => {
      client!.end(false, {}, () => {
        logger.info("Disconnected from MQTT broker");
        resolve();
      });
    });
    client = null;
  }
}

/**
 * Get the MQTT client instance
 */
export function getMqttClient(): MqttClient | null {
  return client;
}
</file>

<file path="apps/mqtt-worker/src/parser.ts">
import { z } from "zod";
import { Parameter, Protocol, ReadingQuality } from "@moondesk/domain";

/**
 * Expected MQTT message format from edge devices
 * Topic format: moondesk/{organizationId}/sensors/{sensorId}/readings
 */
export const mqttReadingSchema = z.object({
  // Sensor identification
  sensorId: z.number(),

  // Reading data
  value: z.number(),
  timestamp: z.string().datetime().optional(),

  // Optional metadata
  parameter: z.nativeEnum(Parameter).optional(),
  quality: z.nativeEnum(ReadingQuality).optional(),
  metadata: z.record(z.string()).optional(),
});

export type MqttReading = z.infer<typeof mqttReadingSchema>;

/**
 * Batch message for multiple readings
 */
export const mqttBatchSchema = z.object({
  readings: z.array(mqttReadingSchema),
});

export type MqttBatch = z.infer<typeof mqttBatchSchema>;

/**
 * Alert threshold configuration message
 */
export const mqttAlertConfigSchema = z.object({
  sensorId: z.number(),
  minValue: z.number().optional(),
  maxValue: z.number().optional(),
  enabled: z.boolean().default(true),
});

export type MqttAlertConfig = z.infer<typeof mqttAlertConfigSchema>;

/**
 * Command response from edge device
 */
export const mqttCommandResponseSchema = z.object({
  commandId: z.number(),
  status: z.enum(["completed", "failed", "timeout"]),
  result: z.string().optional(),
  error: z.string().optional(),
});

export type MqttCommandResponse = z.infer<typeof mqttCommandResponseSchema>;

/**
 * Parse topic to extract organization and sensor IDs
 * Format: moondesk/{organizationId}/sensors/{sensorId}/{action}
 */
export interface ParsedTopic {
  organizationId: string;
  sensorId: number;
  action: "readings" | "batch" | "status" | "command-response";
}

export function parseTopic(topic: string): ParsedTopic | null {
  const parts = topic.split("/");

  // Expected: moondesk/{orgId}/sensors/{sensorId}/{action}
  if (parts.length < 5 || parts[0] !== "moondesk" || parts[2] !== "sensors") {
    return null;
  }

  const organizationId = parts[1];
  const sensorId = parseInt(parts[3] ?? "", 10);
  const action = parts[4] as ParsedTopic["action"];

  if (!organizationId || isNaN(sensorId)) {
    return null;
  }

  const validActions = ["readings", "batch", "status", "command-response"];
  if (!validActions.includes(action)) {
    return null;
  }

  return { organizationId, sensorId, action };
}

/**
 * Parse and validate MQTT message payload
 */
export function parseMessage(
  payload: Buffer,
  action: ParsedTopic["action"],
): MqttReading | MqttBatch | MqttCommandResponse | null {
  try {
    const data = JSON.parse(payload.toString());

    switch (action) {
      case "readings":
        return mqttReadingSchema.parse(data);
      case "batch":
        return mqttBatchSchema.parse(data);
      case "command-response":
        return mqttCommandResponseSchema.parse(data);
      default:
        return null;
    }
  } catch (error) {
    return null;
  }
}
</file>

<file path="apps/mqtt-worker/package.json">
{
  "name": "@moondesk/mqtt-worker",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "tsx watch src/index.ts",
    "build": "tsup",
    "start": "node dist/index.js",
    "check-types": "tsc --noEmit",
    "lint": "eslint src/",
    "test": "vitest run"
  },
  "dependencies": {
    "@moondesk/config": "workspace:*",
    "@moondesk/database": "workspace:*",
    "@moondesk/domain": "workspace:*",
    "@moondesk/logger": "workspace:*",
    "mqtt": "^5.14.1",
    "socket.io-client": "^4.8.1",
    "zod": "^3.24.2"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:^",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "tsup": "^8.5.1",
    "tsx": "^4.19.4",
    "typescript": "5.8.3",
    "vitest": "^2.0.5"
  }
}
</file>

<file path="apps/mqtt-worker/tsup.config.ts">
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/index.ts"],
  format: ["esm"],
  clean: true,
  outDir: "dist",
  noExternal: [/^@moondesk\/.*/],
  sourcemap: true,
  banner: {
    js: "import { createRequire } from 'module';const require = createRequire(import.meta.url);",
  },
});
</file>

<file path="package.json">
{
  "name": "moondesk",
  "private": true,
  "scripts": {
    "build": "turbo run build",
    "dev": "turbo run dev",
    "lint": "turbo run lint",
    "test": "turbo run test",
    "format": "prettier --write \"**/*.{ts,tsx,md}\"",
    "format:check": "prettier --check \"**/*.{ts,tsx,md}\"",
    "check-types": "turbo run check-types",
    "prepare": "husky"
  },
  "devDependencies": {
    "husky": "^9.1.7",
    "prettier": "^3.7.4",
    "turbo": "^2.6.3",
    "typescript": "5.9.3"
  },
  "packageManager": "pnpm@9.0.0",
  "engines": {
    "node": ">=18"
  }
}
</file>

<file path=".gitignore">
# Binaries
bin/
dist/
.turbo
.vscode

# Modules
node_modules/

# OS Specific
.DS_Store
Thumbs.db

# Editors
.vscode/
.idea/
*.swp
.cursor/
.cursorrules

# Env
.env
api

# Legacy (Merged)
# Dependencies
.pnp
.pnp.js

# Local env files
.env.local
.env.development.local
.env.test.local
.env.production.local

**/.env
**/.env.local
**/.env.development.local
**/.env.test.local
**/.env.production.local

# Testing
coverage

# Turbo
.turbo

# Vercel
.vercel

# Build Outputs
.next/
out/
build
.kiro

# Debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
*.log
*.pem
</file>

<file path="AGENTS.md">
# Moondesk Agent Guidelines (TypeScript)

This document provides comprehensive instructions and conventions for AI agents (and human developers) working on the Moondesk TypeScript codebase.

## 1. Project Overview

Moondesk is a scalable, protocol-agnostic IoT platform designed to handle high-throughput data ingestion, real-time analytics, and device management.

## 2. Environment & Setup

- **Runtime**: Node.js (v20+), strictly TypeScript.
- **Package Manager**: `pnpm` (Corepack enabled).
- **Build System**: `turbo` for task orchestration, `tsup` for backend bundling.
- **Database**: PostgreSQL with TimescaleDB extension.
- **ORM**: Drizzle ORM.
- **Infrastructure**: Docker Compose for local development (Redis, Postgres, Mosquitto).

### Common Commands

- **Setup**: `corepack enable && pnpm install`
- **Dev**: `turbo run dev` (starts apps)
- **Docker**: `docker compose up -d` (starts infra + backend services)
- **Build**: `turbo run build`
- **Lint**: `turbo run lint`
- **Check Types**: `turbo run check-types`

## 3. Git Workflow & Linear Integration

Strict Git hooks (Husky) are enforced. Agents MUST follow these rules to successfully push code.

- **Branch Naming**:
  - Format: `mndsk-<ticket-id>-<title-kebab-case>`
  - Example: `mndsk-39-initial-commit` or `mndsk-42-fix-sensor-reading`
  - **Restriction**: You CANNOT commit directly to `main` or `master`.
- **Linear Integration**:
  - The project uses a `commit-msg` hook.
  - It automatically prepends the Linear Ticket ID (e.g., `MNDSK-39`) from the branch name to your commit message.
  - You do not need to manually type `MNDSK-39` in the commit message.
- **Pushing**:
  - Direct pushes to `main` are blocked.
  - You must push to your feature branch and open a Pull Request.

## 4. Repository Structure

This is a **Monorepo** managed by **Turbo** and **pnpm** workspaces.

### `apps/`

- **`api`**: Fastify backend. Main entry point for REST/WS.
- **`mqtt-worker`**: Node.js worker. Handles high-velocity MQTT traffic.
- **`edge-simulator`**: Tool to generate synthetic load for testing.
- **`moondesk-dash`**: Next.js 14+ frontend application.
- **`docs`**: Documentation site.

### `packages/`

- **`config`**: Shared configuration (env vars, schemas, constants).
- **`database`**: Drizzle ORM schemas and repositories.
- **`domain`**: Shared interfaces, types, Models, and Enums. No side effects.
- **`logger`**: Standardized Pino logger configuration.
- **`ui`**: Shared React UI components (shadcn/ui based).
- **`typescript-config`**: Shared `tsconfig.json` bases.

## 5. Architecture & Key Patterns

### System Architecture

1.  **Edge Devices**: Simulate or real devices sending data via MQTT.
2.  **Broker (Mosquitto)**: Handles MQTT messsaging.
3.  **Worker (MQTT Worker)**: Subscribes to broker, processes ingestion, and broadcasts "hot" data to API.
4.  **API (Fastify)**: REST & WebSocket API for frontend clients.
5.  **Storage**: TimescaleDB (Postgres) & Redis.

### Key Patterns

- **Ingestion Flow**: Device -> MQTT -> Mosquitto -> Worker -> Database + API (Broadcast).
- **Internal Auth**: The MQ worker talks to the API using a shared `INTERNAL_SERVICE_TOKEN`.
- **Bundling**: Backend apps use `tsup` to bundle local workspace packages into a single entry point for Docker.

## 6. Development Philosophy

1.  **Strict Types**: We do NOT use `any`. All types should be defined in `@moondesk/domain` if shared.
2.  **Docker First**: The entire backend stack runs in Docker.
3.  **Environment Variables**: Strictly validated using Zod in `@moondesk/config`.

## 7. Pre-Push Verification

**CRITICAL**: Before pushing ANY code, you MUST ensure these pass:

1.  `pnpm lint` (0 exit code)
2.  `pnpm check-types` (or `pnpm typecheck`)
3.  `pnpm build`

**If any of these fail, you MUST fix the errors before pushing.**

## 8. Commit Conventions

Every commit message should provide context. The Linear ID will be auto-prepended.

1.  **Summary Line**: `feat: implement user login flow`
2.  **Detailed Description**: List changed files and why.

Example:

```text
feat: implement user login flow

- apps/api/src/controllers/auth.controller.ts: Added login endpoint handler.
- packages/domain/src/schemas/auth.schema.ts: Added Zod schema.
```
</file>

</files>
````

## File: repomix-output.2.xml
````xml
This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.github/
  workflows/
    ci.yml
.husky/
  commit-msg
  pre-commit
  pre-push
apps/
  docs/
    app/
      fonts/
        GeistMonoVF.woff
        GeistVF.woff
      favicon.ico
      globals.css
      layout.tsx
      page.module.css
      page.tsx
    public/
      file-text.svg
      globe.svg
      next.svg
      turborepo-dark.svg
      turborepo-light.svg
      vercel.svg
      window.svg
    .gitignore
    eslint.config.js
    next.config.js
    package.json
    README.md
    tsconfig.json
  edge-simulator/
    src/
      __tests__/
        generators.test.ts
        presets.test.ts
      generators.ts
      main.ts
      mqtt-publisher.ts
      presets.ts
      simulation-engine.ts
      types.ts
    Dockerfile
    eslint.config.mjs
    package.json
    tsconfig.json
    tsup.config.ts
  moondesk-dash/
    .husky/
      pre-commit
    media/
      dashboard.png
    public/
      avatars/
        arhamkhnz.png
    src/
      app/
        (external)/
          page.tsx
        (main)/
          auth/
            _components/
              social-auth/
                google-button.tsx
              login-form.tsx
              register-form.tsx
            v1/
              login/
                page.tsx
              register/
                page.tsx
            v2/
              login/
                page.tsx
              register/
                page.tsx
              layout.tsx
          dashboard/
            _components/
              sidebar/
                account-switcher.tsx
                app-sidebar.tsx
                clerk-auth.tsx
                layout-controls.tsx
                nav-documents.tsx
                nav-main.tsx
                nav-secondary.tsx
                nav-user-clerk.tsx
                nav-user.tsx
                search-dialog.tsx
                theme-switcher.tsx
            [...not-found]/
              page.tsx
            analytics/
              _components/
                data-usage.tsx
                energy-consumption.tsx
                performance-metrics.tsx
                system-health.tsx
              page.tsx
            assets/
              _components/
                asset-insight-cards.tsx
              [assetId]/
                page.tsx
              page.tsx
            coming-soon/
              page.tsx
            overview/
              _components/
                chart-area-interactive.tsx
                columns.tsx
                data-table.tsx
                schema.ts
                section-cards.tsx
                table-cell-viewer.tsx
              page.tsx
            layout.tsx
            page.tsx
          unauthorized/
            page.tsx
        organization/
          [[...organization]]/
            page.tsx
        sentry-example-page/
          page.tsx
        sso-callback/
          page.tsx
        favicon.ico
        global-error.tsx
        globals.css
        layout.tsx
        not-found.tsx
      components/
        data-table/
          data-table-column-header.tsx
          data-table-pagination.tsx
          data-table-view-options.tsx
          data-table.tsx
          drag-column.tsx
          draggable-row.tsx
          table-utils.ts
        providers/
          query-provider.tsx
        ui/
          accordion.tsx
          alert-dialog.tsx
          alert.tsx
          aspect-ratio.tsx
          avatar.tsx
          badge.tsx
          breadcrumb.tsx
          button-group.tsx
          button.tsx
          calendar.tsx
          card.tsx
          carousel.tsx
          chart.tsx
          checkbox.tsx
          collapsible.tsx
          command.tsx
          context-menu.tsx
          dialog.tsx
          drawer.tsx
          dropdown-menu.tsx
          empty.tsx
          field.tsx
          form.tsx
          hover-card.tsx
          input-group.tsx
          input-otp.tsx
          input.tsx
          item.tsx
          kbd.tsx
          label.tsx
          menubar.tsx
          navigation-menu.tsx
          pagination.tsx
          popover.tsx
          progress.tsx
          radio-group.tsx
          resizable.tsx
          scroll-area.tsx
          select.tsx
          separator.tsx
          sheet.tsx
          sidebar.tsx
          skeleton.tsx
          slider.tsx
          sonner.tsx
          spinner.tsx
          switch.tsx
          table.tsx
          tabs.tsx
          textarea.tsx
          toggle-group.tsx
          toggle.tsx
          tooltip.tsx
        simple-icon.tsx
      hooks/
        __tests__/
          use-signalr.test.ts
        use-data-table-instance.ts
        use-mobile.ts
        use-signalr.ts
      lib/
        adapters/
          __tests__/
            dashboard-adapter.test.ts
          dashboard-adapter.ts
        mock-data/
          iot-data.ts
        layout-utils.ts
        theme-utils.ts
        utils.ts
      navigation/
        sidebar/
          sidebar-items.ts
      scripts/
        generate-theme-presets.ts
      server/
        server-actions.ts
      services/
        api-client.ts
        device-service.ts
      stores/
        preferences/
          preferences-provider.tsx
          preferences-store.ts
      styles/
        presets/
          brutalist.css
          soft-pop.css
          tangerine.css
        clerk-custom.css
      test/
        setup.ts
        utils.tsx
      types/
        preferences/
          layout.ts
          theme.ts
        iot.ts
      config.ts
      instrumentation-client.ts
      instrumentation.ts
      proxy.disabled.ts
      proxy.ts
    .env.local.example
    .gitignore
    .prettierignore
    .prettierrc
    CLERK_AUTH_INTEGRATION.md
    CLERK_SETUP.md
    components.json
    CONTRIBUTING.md
    eslint.config.mjs
    IIOT_DASHBOARD_SPEC.md
    LICENSE
    next.config.mjs
    package.json
    postcss.config.mjs
    README.md
    sentry.edge.config.ts
    sentry.server.config.ts
    tsconfig.json
    vitest.config.ts
  mqtt-worker/
    src/
      api-broadcaster.test.ts
      api-broadcaster.ts
      index.ts
      ingestion-handler.test.ts
      ingestion-handler.ts
      mqtt-client.ts
      parser.ts
    Dockerfile
    eslint.config.mjs
    package.json
    tsconfig.json
    tsup.config.ts
docker/
  mosquitto/
    config/
      mosquitto.conf
packages/
  config/
    src/
      app.ts
      database.ts
      env.ts
      index.ts
      mqtt.ts
    eslint.config.mjs
    package.json
    README.md
    tsconfig.json
  database/
    src/
      migrations/
        meta/
          _journal.json
          0000_snapshot.json
        0000_tranquil_shotgun.sql
      repositories/
        alert.repository.ts
        asset.repository.ts
        command.repository.ts
        connection-credential.repository.ts
        index.ts
        organization.repository.ts
        reading.repository.ts
        sensor.repository.ts
        user.repository.ts
      schema/
        alerts.ts
        assets.ts
        commands.ts
        connection-credentials.ts
        index.ts
        organizations.ts
        readings.ts
        sensors.ts
        users.ts
      client.ts
      index.ts
    drizzle.config.ts
    eslint.config.mjs
    package.json
    tsconfig.json
  domain/
    src/
      enums/
        alert-severity.ts
        asset-status.ts
        command-status.ts
        index.ts
        parameter.ts
        protocol.ts
        reading-quality.ts
        sensor-type.ts
        user-role.ts
      errors/
        index.ts
      interfaces/
        repositories/
          alert.repository.ts
          asset.repository.ts
          command.repository.ts
          connection-credential.repository.ts
          index.ts
          organization.repository.ts
          reading.repository.ts
          sensor.repository.ts
          user.repository.ts
        services/
          encryption.service.ts
          index.ts
          notification.service.ts
        index.ts
      models/
        alert.ts
        asset.ts
        command.ts
        connection-credential.ts
        index.ts
        organization.ts
        reading.ts
        sensor.ts
        user.ts
      schemas/
        index.ts
      index.ts
    eslint.config.mjs
    package.json
    tsconfig.json
  eslint-config/
    base.js
    next.js
    package.json
    react-internal.js
    README.md
  logger/
    src/
      index.ts
    eslint.config.mjs
    package.json
    tsconfig.json
  typescript-config/
    base.json
    nextjs.json
    package.json
    react-library.json
  ui/
    src/
      button.tsx
      card.tsx
      code.tsx
    eslint.config.mjs
    package.json
    tsconfig.json
.env.example
.gitignore
AGENTS.md
docker-compose.yml
package.json
pnpm-workspace.yaml
README.md
turbo.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="packages/config/eslint.config.mjs">
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
</file>

<file path="packages/config/tsconfig.json">
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
</file>

<file path="packages/database/src/migrations/meta/_journal.json">
{
  "version": "7",
  "dialect": "postgresql",
  "entries": [
    {
      "idx": 0,
      "version": "7",
      "when": 1765314902081,
      "tag": "0000_tranquil_shotgun",
      "breakpoints": true
    }
  ]
}
</file>

<file path="packages/database/src/migrations/meta/0000_snapshot.json">
{
  "id": "15b2b1cb-4e94-4e6f-b3ff-8aa46f9916cc",
  "prevId": "00000000-0000-0000-0000-000000000000",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.assets": {
      "name": "assets",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "location": {
          "name": "location",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "''"
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'unknown'"
        },
        "last_seen": {
          "name": "last_seen",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "manufacturer": {
          "name": "manufacturer",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_number": {
          "name": "model_number",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "installation_date": {
          "name": "installation_date",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_assets_organization_id": {
          "name": "idx_assets_organization_id",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_assets_status": {
          "name": "idx_assets_status",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "status",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.sensors": {
      "name": "sensors",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "asset_id": {
          "name": "asset_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "parameter": {
          "name": "parameter",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'none'"
        },
        "unit": {
          "name": "unit",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "threshold_low": {
          "name": "threshold_low",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "threshold_high": {
          "name": "threshold_high",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "min_value": {
          "name": "min_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "max_value": {
          "name": "max_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "sampling_interval_ms": {
          "name": "sampling_interval_ms",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 1000
        },
        "is_active": {
          "name": "is_active",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": true
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_sensors_asset_id": {
          "name": "idx_sensors_asset_id",
          "columns": [
            {
              "expression": "asset_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "sensors_asset_id_assets_id_fk": {
          "name": "sensors_asset_id_assets_id_fk",
          "tableFrom": "sensors",
          "tableTo": "assets",
          "columnsFrom": [
            "asset_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.readings": {
      "name": "readings",
      "schema": "",
      "columns": {
        "sensor_id": {
          "name": "sensor_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "timestamp": {
          "name": "timestamp",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "value": {
          "name": "value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": true
        },
        "parameter": {
          "name": "parameter",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'none'"
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "quality": {
          "name": "quality",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'good'"
        },
        "notes": {
          "name": "notes",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        }
      },
      "indexes": {
        "idx_readings_org_sensor_time": {
          "name": "idx_readings_org_sensor_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sensor_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "timestamp",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_readings_org_time": {
          "name": "idx_readings_org_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "timestamp",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "readings_sensor_id_sensors_id_fk": {
          "name": "readings_sensor_id_sensors_id_fk",
          "tableFrom": "readings",
          "tableTo": "sensors",
          "columnsFrom": [
            "sensor_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "readings_sensor_id_timestamp_pk": {
          "name": "readings_sensor_id_timestamp_pk",
          "columns": [
            "sensor_id",
            "timestamp"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.alerts": {
      "name": "alerts",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "sensor_id": {
          "name": "sensor_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "timestamp": {
          "name": "timestamp",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "severity": {
          "name": "severity",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'info'"
        },
        "message": {
          "name": "message",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "trigger_value": {
          "name": "trigger_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": true
        },
        "threshold_value": {
          "name": "threshold_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "acknowledged": {
          "name": "acknowledged",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "acknowledged_at": {
          "name": "acknowledged_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "acknowledged_by": {
          "name": "acknowledged_by",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "notes": {
          "name": "notes",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        }
      },
      "indexes": {
        "idx_alerts_org_acknowledged_time": {
          "name": "idx_alerts_org_acknowledged_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "acknowledged",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "timestamp",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_alerts_org_sensor": {
          "name": "idx_alerts_org_sensor",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sensor_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "alerts_sensor_id_sensors_id_fk": {
          "name": "alerts_sensor_id_sensors_id_fk",
          "tableFrom": "alerts",
          "tableTo": "sensors",
          "columnsFrom": [
            "sensor_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.commands": {
      "name": "commands",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "sensor_id": {
          "name": "sensor_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "action": {
          "name": "action",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "parameters": {
          "name": "parameters",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "sent_at": {
          "name": "sent_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "completed_at": {
          "name": "completed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "error_message": {
          "name": "error_message",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        }
      },
      "indexes": {
        "idx_commands_org_status_time": {
          "name": "idx_commands_org_status_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "status",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "created_at",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_commands_org_user": {
          "name": "idx_commands_org_user",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "commands_sensor_id_sensors_id_fk": {
          "name": "commands_sensor_id_sensors_id_fk",
          "tableFrom": "commands",
          "tableTo": "sensors",
          "columnsFrom": [
            "sensor_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.users": {
      "name": "users",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "username": {
          "name": "username",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "first_name": {
          "name": "first_name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "last_name": {
          "name": "last_name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "image_url": {
          "name": "image_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_users_email": {
          "name": "idx_users_email",
          "columns": [
            {
              "expression": "email",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "users_email_unique": {
          "name": "users_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        },
        "users_username_unique": {
          "name": "users_username_unique",
          "nullsNotDistinct": false,
          "columns": [
            "username"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_memberships": {
      "name": "organization_memberships",
      "schema": "",
      "columns": {
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_memberships_user_id_users_id_fk": {
          "name": "organization_memberships_user_id_users_id_fk",
          "tableFrom": "organization_memberships",
          "tableTo": "users",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "organization_memberships_organization_id_organizations_id_fk": {
          "name": "organization_memberships_organization_id_organizations_id_fk",
          "tableFrom": "organization_memberships",
          "tableTo": "organizations",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "organization_memberships_user_id_organization_id_pk": {
          "name": "organization_memberships_user_id_organization_id_pk",
          "columns": [
            "user_id",
            "organization_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organizations": {
      "name": "organizations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "image_url": {
          "name": "image_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "owner_id": {
          "name": "owner_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_organizations_owner": {
          "name": "idx_organizations_owner",
          "columns": [
            {
              "expression": "owner_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organizations_slug_unique": {
          "name": "organizations_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.connection_credentials": {
      "name": "connection_credentials",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "endpoint_uri": {
          "name": "endpoint_uri",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "username": {
          "name": "username",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "encrypted_password": {
          "name": "encrypted_password",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "encryption_iv": {
          "name": "encryption_iv",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "client_id": {
          "name": "client_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "is_active": {
          "name": "is_active",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": true
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_credentials_org_protocol": {
          "name": "idx_credentials_org_protocol",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "protocol",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_credentials_org_active": {
          "name": "idx_credentials_org_active",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "is_active",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
</file>

<file path="packages/database/src/migrations/0000_tranquil_shotgun.sql">
CREATE TABLE "assets" (
	"id" serial PRIMARY KEY NOT NULL,
	"organization_id" text NOT NULL,
	"name" text NOT NULL,
	"type" text NOT NULL,
	"location" text DEFAULT '' NOT NULL,
	"status" text DEFAULT 'unknown' NOT NULL,
	"last_seen" timestamp with time zone,
	"description" text,
	"manufacturer" text,
	"model_number" text,
	"installation_date" timestamp with time zone,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "sensors" (
	"id" serial PRIMARY KEY NOT NULL,
	"asset_id" integer NOT NULL,
	"name" text NOT NULL,
	"type" text NOT NULL,
	"parameter" text DEFAULT 'none' NOT NULL,
	"unit" text NOT NULL,
	"threshold_low" double precision,
	"threshold_high" double precision,
	"min_value" double precision,
	"max_value" double precision,
	"sampling_interval_ms" integer DEFAULT 1000 NOT NULL,
	"is_active" boolean DEFAULT true NOT NULL,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"description" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "readings" (
	"sensor_id" integer NOT NULL,
	"organization_id" text NOT NULL,
	"timestamp" timestamp with time zone DEFAULT now() NOT NULL,
	"value" double precision NOT NULL,
	"parameter" text DEFAULT 'none' NOT NULL,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"quality" text DEFAULT 'good' NOT NULL,
	"notes" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	CONSTRAINT "readings_sensor_id_timestamp_pk" PRIMARY KEY("sensor_id","timestamp")
);
--> statement-breakpoint
CREATE TABLE "alerts" (
	"id" serial PRIMARY KEY NOT NULL,
	"sensor_id" integer NOT NULL,
	"organization_id" text NOT NULL,
	"timestamp" timestamp with time zone DEFAULT now() NOT NULL,
	"severity" text DEFAULT 'info' NOT NULL,
	"message" text NOT NULL,
	"trigger_value" double precision NOT NULL,
	"threshold_value" double precision,
	"acknowledged" boolean DEFAULT false NOT NULL,
	"acknowledged_at" timestamp with time zone,
	"acknowledged_by" text,
	"notes" text,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb
);
--> statement-breakpoint
CREATE TABLE "commands" (
	"id" serial PRIMARY KEY NOT NULL,
	"sensor_id" integer NOT NULL,
	"organization_id" text NOT NULL,
	"user_id" text NOT NULL,
	"action" text NOT NULL,
	"parameters" jsonb DEFAULT '{}'::jsonb,
	"status" text DEFAULT 'pending' NOT NULL,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"sent_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"error_message" text,
	"metadata" jsonb DEFAULT '{}'::jsonb
);
--> statement-breakpoint
CREATE TABLE "users" (
	"id" text PRIMARY KEY NOT NULL,
	"email" text NOT NULL,
	"username" text,
	"first_name" text,
	"last_name" text,
	"image_url" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "users_email_unique" UNIQUE("email"),
	CONSTRAINT "users_username_unique" UNIQUE("username")
);
--> statement-breakpoint
CREATE TABLE "organization_memberships" (
	"user_id" text NOT NULL,
	"organization_id" text NOT NULL,
	"role" text DEFAULT 'member' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "organization_memberships_user_id_organization_id_pk" PRIMARY KEY("user_id","organization_id")
);
--> statement-breakpoint
CREATE TABLE "organizations" (
	"id" text PRIMARY KEY NOT NULL,
	"name" text NOT NULL,
	"slug" text,
	"image_url" text,
	"owner_id" text NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "organizations_slug_unique" UNIQUE("slug")
);
--> statement-breakpoint
CREATE TABLE "connection_credentials" (
	"id" serial PRIMARY KEY NOT NULL,
	"organization_id" text NOT NULL,
	"name" text NOT NULL,
	"protocol" text NOT NULL,
	"endpoint_uri" text NOT NULL,
	"username" text NOT NULL,
	"encrypted_password" text NOT NULL,
	"encryption_iv" text NOT NULL,
	"client_id" text,
	"is_active" boolean DEFAULT true NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "sensors" ADD CONSTRAINT "sensors_asset_id_assets_id_fk" FOREIGN KEY ("asset_id") REFERENCES "public"."assets"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "readings" ADD CONSTRAINT "readings_sensor_id_sensors_id_fk" FOREIGN KEY ("sensor_id") REFERENCES "public"."sensors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "alerts" ADD CONSTRAINT "alerts_sensor_id_sensors_id_fk" FOREIGN KEY ("sensor_id") REFERENCES "public"."sensors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commands" ADD CONSTRAINT "commands_sensor_id_sensors_id_fk" FOREIGN KEY ("sensor_id") REFERENCES "public"."sensors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_memberships" ADD CONSTRAINT "organization_memberships_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_memberships" ADD CONSTRAINT "organization_memberships_organization_id_organizations_id_fk" FOREIGN KEY ("organization_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
CREATE INDEX "idx_assets_organization_id" ON "assets" USING btree ("organization_id");--> statement-breakpoint
CREATE INDEX "idx_assets_status" ON "assets" USING btree ("organization_id","status");--> statement-breakpoint
CREATE INDEX "idx_sensors_asset_id" ON "sensors" USING btree ("asset_id");--> statement-breakpoint
CREATE INDEX "idx_readings_org_sensor_time" ON "readings" USING btree ("organization_id","sensor_id","timestamp");--> statement-breakpoint
CREATE INDEX "idx_readings_org_time" ON "readings" USING btree ("organization_id","timestamp");--> statement-breakpoint
CREATE INDEX "idx_alerts_org_acknowledged_time" ON "alerts" USING btree ("organization_id","acknowledged","timestamp");--> statement-breakpoint
CREATE INDEX "idx_alerts_org_sensor" ON "alerts" USING btree ("organization_id","sensor_id");--> statement-breakpoint
CREATE INDEX "idx_commands_org_status_time" ON "commands" USING btree ("organization_id","status","created_at");--> statement-breakpoint
CREATE INDEX "idx_commands_org_user" ON "commands" USING btree ("organization_id","user_id");--> statement-breakpoint
CREATE INDEX "idx_users_email" ON "users" USING btree ("email");--> statement-breakpoint
CREATE INDEX "idx_organizations_owner" ON "organizations" USING btree ("owner_id");--> statement-breakpoint
CREATE INDEX "idx_credentials_org_protocol" ON "connection_credentials" USING btree ("organization_id","protocol");--> statement-breakpoint
CREATE INDEX "idx_credentials_org_active" ON "connection_credentials" USING btree ("organization_id","is_active");
</file>

<file path="packages/database/eslint.config.mjs">
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
</file>

<file path="packages/database/tsconfig.json">
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
</file>

<file path="packages/domain/eslint.config.mjs">
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
</file>

<file path="packages/domain/tsconfig.json">
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
</file>

<file path="packages/eslint-config/base.js">
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";
import turboPlugin from "eslint-plugin-turbo";
import tseslint from "typescript-eslint";
import onlyWarn from "eslint-plugin-only-warn";

/**
 * A shared ESLint configuration for the repository.
 *
 * @type {import("eslint").Linter.Config[]}
 * */
export const config = [
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  {
    plugins: {
      turbo: turboPlugin,
    },
    rules: {
      "turbo/no-undeclared-env-vars": "warn",
    },
  },
  {
    plugins: {
      onlyWarn,
    },
  },
  {
    ignores: ["dist/**"],
  },
];
</file>

<file path="packages/eslint-config/next.js">
import js from "@eslint/js";
import { globalIgnores } from "eslint/config";
import eslintConfigPrettier from "eslint-config-prettier";
import tseslint from "typescript-eslint";
import pluginReactHooks from "eslint-plugin-react-hooks";
import pluginReact from "eslint-plugin-react";
import globals from "globals";
import pluginNext from "@next/eslint-plugin-next";
import { config as baseConfig } from "./base.js";

/**
 * A custom ESLint configuration for libraries that use Next.js.
 *
 * @type {import("eslint").Linter.Config[]}
 * */
export const nextJsConfig = [
  ...baseConfig,
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
  {
    ...pluginReact.configs.flat.recommended,
    languageOptions: {
      ...pluginReact.configs.flat.recommended.languageOptions,
      globals: {
        ...globals.serviceworker,
      },
    },
  },
  {
    plugins: {
      "@next/next": pluginNext,
    },
    rules: {
      ...pluginNext.configs.recommended.rules,
      ...pluginNext.configs["core-web-vitals"].rules,
    },
  },
  {
    plugins: {
      "react-hooks": pluginReactHooks,
    },
    settings: { react: { version: "detect" } },
    rules: {
      ...pluginReactHooks.configs.recommended.rules,
      // React scope no longer necessary with new JSX transform.
      "react/react-in-jsx-scope": "off",
    },
  },
];
</file>

<file path="packages/eslint-config/package.json">
{
  "name": "@moondesk/eslint-config",
  "version": "0.0.0",
  "type": "module",
  "private": true,
  "exports": {
    "./base": "./base.js",
    "./next-js": "./next.js",
    "./react-internal": "./react-internal.js"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@next/eslint-plugin-next": "^15.5.0",
    "eslint": "^9.39.1",
    "eslint-config-prettier": "^10.1.1",
    "eslint-plugin-only-warn": "^1.1.0",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-turbo": "^2.6.0",
    "globals": "^16.5.0",
    "typescript": "^5.9.2",
    "typescript-eslint": "^8.46.3"
  }
}
</file>

<file path="packages/eslint-config/react-internal.js">
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";
import tseslint from "typescript-eslint";
import pluginReactHooks from "eslint-plugin-react-hooks";
import pluginReact from "eslint-plugin-react";
import globals from "globals";
import { config as baseConfig } from "./base.js";

/**
 * A custom ESLint configuration for libraries that use React.
 *
 * @type {import("eslint").Linter.Config[]} */
export const config = [
  ...baseConfig,
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  pluginReact.configs.flat.recommended,
  {
    languageOptions: {
      ...pluginReact.configs.flat.recommended.languageOptions,
      globals: {
        ...globals.serviceworker,
        ...globals.browser,
      },
    },
  },
  {
    plugins: {
      "react-hooks": pluginReactHooks,
    },
    settings: { react: { version: "detect" } },
    rules: {
      ...pluginReactHooks.configs.recommended.rules,
      // React scope no longer necessary with new JSX transform.
      "react/react-in-jsx-scope": "off",
    },
  },
];
</file>

<file path="packages/eslint-config/README.md">
# `@turbo/eslint-config`

Collection of internal eslint configurations.
</file>

<file path="packages/logger/eslint.config.mjs">
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
</file>

<file path="packages/logger/tsconfig.json">
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
</file>

<file path="packages/typescript-config/base.json">
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "compilerOptions": {
    "declaration": true,
    "declarationMap": true,
    "esModuleInterop": true,
    "incremental": false,
    "isolatedModules": true,
    "lib": [
      "es2022",
      "DOM",
      "DOM.Iterable"
    ],
    "module": "ESNext",
    "moduleDetection": "force",
    "moduleResolution": "bundler",
    "noUncheckedIndexedAccess": true,
    "resolveJsonModule": true,
    "skipLibCheck": true,
    "strict": true,
    "target": "ES2022"
  }
}
</file>

<file path="packages/typescript-config/nextjs.json">
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./base.json",
  "compilerOptions": {
    "plugins": [{ "name": "next" }],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "allowJs": true,
    "jsx": "preserve",
    "noEmit": true
  }
}
</file>

<file path="packages/typescript-config/package.json">
{
  "name": "@moondesk/typescript-config",
  "version": "0.0.0",
  "private": true,
  "license": "MIT",
  "publishConfig": {
    "access": "public"
  }
}
</file>

<file path="packages/typescript-config/react-library.json">
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./base.json",
  "compilerOptions": {
    "jsx": "react-jsx"
  }
}
</file>

<file path="packages/ui/src/button.tsx">
"use client";

import { type MouseEventHandler, type ReactNode } from "react";

interface ButtonProps {
  children: ReactNode;
  className?: string;
  onClick?: MouseEventHandler<HTMLButtonElement>;
}

export const Button = ({ children, className, onClick }: ButtonProps) => {
  return (
    <button type="button" className={className} onClick={onClick}>
      {children}
    </button>
  );
};
</file>

<file path="packages/ui/src/card.tsx">
import { type JSX, type ReactNode } from "react";

interface CardProps {
  className?: string;
  title: string;
  children: ReactNode;
  href: string;
}

export function Card({
  className,
  title,
  children,
  href,
}: CardProps): JSX.Element {
  return (
    <div className={className}>
      <h2>
        <a href={href} rel="noopener noreferrer" target="_blank">
          {title} <span>-&gt;</span>
        </a>
      </h2>
      <p>{children}</p>
    </div>
  );
}
</file>

<file path="packages/ui/src/code.tsx">
import { type JSX, type ReactNode } from "react";

interface CodeProps {
  children: ReactNode;
  className?: string;
}

export function Code({ children, className }: CodeProps): JSX.Element {
  return (
    <pre>
      <code className={className}>{children}</code>
    </pre>
  );
}
</file>

<file path="packages/ui/eslint.config.mjs">
import { config } from "@moondesk/eslint-config/react-internal";

/** @type {import("eslint").Linter.Config} */
export default config;
</file>

<file path="packages/ui/package.json">
{
  "name": "@moondesk/ui",
  "version": "0.0.0",
  "private": true,
  "exports": {
    "./*": "./src/*.tsx"
  },
  "scripts": {
    "lint": "eslint . --max-warnings 0",
    "generate:component": "turbo gen react-component",
    "check-types": "tsc --noEmit"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:*",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "@types/react": "19.2.2",
    "@types/react-dom": "19.2.2",
    "eslint": "^9.39.1",
    "typescript": "5.9.2"
  },
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  }
}
</file>

<file path="packages/ui/tsconfig.json">
{
  "extends": "@moondesk/typescript-config/react-library.json",
  "compilerOptions": {
    "outDir": "dist"
  },
  "include": [
    "src"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}
</file>

<file path="pnpm-workspace.yaml">
packages:
  - "apps/*"
  - "packages/*"
</file>

<file path="packages/config/src/app.ts">
import { z } from "zod";
import { getEnv } from "./env";

const appConfigSchema = z.object({
  isProduction: z.boolean(),
  clerk: z.object({
    secretKey: z.string().optional(),
    publishableKey: z.string().optional(),
  }),
});

let appConfig: z.infer<typeof appConfigSchema> | null = null;

export function getAppConfig() {
  if (appConfig) {
    return appConfig;
  }

  const env = getEnv();
  const isProduction = env.NODE_ENV === "production";

  const clerkSecretKey = env.CLERK_SECRET_KEY;
  const clerkPublishableKey = env.CLERK_PUBLISHABLE_KEY;

  if (isProduction && (!clerkSecretKey || !clerkPublishableKey)) {
    throw new Error(
      "CLERK_SECRET_KEY and CLERK_PUBLISHABLE_KEY are required in production",
    );
  }

  appConfig = {
    isProduction,
    clerk: {
      secretKey: clerkSecretKey,
      publishableKey: clerkPublishableKey,
    },
  };

  return appConfig;
}
</file>

<file path="packages/config/src/database.ts">
import { getEnv } from "./env";

/**
 * Database configuration
 */
export function getDatabaseConfig() {
  const env = getEnv();

  return {
    connectionString: env.DATABASE_URL,
    pool: {
      max: 20,
      idleTimeoutMillis: 30000,
      connectionTimeoutMillis: 5000,
    },
  };
}
</file>

<file path="packages/config/src/env.ts">
import { z } from "zod";
import "dotenv/config";

/**
 * Environment variable schema with validation
 */
const envSchema = z
  .object({
    // Node environment
    NODE_ENV: z
      .enum(["development", "production", "test"])
      .default("development"),

    // Server
    PORT: z.string().transform(Number).default("5008"),
    HOST: z.string().default("0.0.0.0"),

    // Database
    DATABASE_URL: z.string().min(1, "DATABASE_URL is required"),

    // Clerk authentication
    CLERK_SECRET_KEY: z.string().optional(),
    CLERK_PUBLISHABLE_KEY: z.string().optional(),
    CLERK_WEBHOOK_SECRET: z.string().optional(),

    // MQTT
    MQTT_HOST: z.string().optional(),
    MQTT_PORT: z.string().transform(Number).optional(),
    MQTT_USERNAME: z.string().optional(),
    MQTT_PASSWORD: z.string().optional(),

    // Encryption
    ENCRYPTION_KEY: z.string().min(32).optional(),
    INTERNAL_SERVICE_TOKEN: z.string().optional(),

    // Logging
    LOG_LEVEL: z.enum(["debug", "info", "warn", "error"]).default("info"),
  })
  .transform((env) => ({
    ...env,
    isProduction: env.NODE_ENV === "production",
  }));

export type Env = z.infer<typeof envSchema>;

let env: Env | null = null;

/**
 * Get validated environment variables
 * @throws Error if validation fails
 */
export function getEnv(): Env {
  if (!env) {
    const result = envSchema.safeParse(process.env);

    if (!result.success) {
      console.error("❌ Invalid environment variables:");
      console.error(result.error.format());
      throw new Error("Invalid environment variables");
    }

    env = result.data;
  }

  return env;
}
</file>

<file path="packages/config/src/index.ts">
// @moondesk/config - Shared configuration

export { getEnv, type Env } from "./env";
export { getAppConfig } from "./app";
export { getDatabaseConfig } from "./database";
export { getMqttConfig } from "./mqtt";
</file>

<file path="packages/config/src/mqtt.ts">
import { getEnv } from "./env";

/**
 * MQTT configuration
 */
export function getMqttConfig() {
  const env = getEnv();

  return {
    host: env.MQTT_HOST ?? "localhost",
    port: env.MQTT_PORT ?? 1883,
    username: env.MQTT_USERNAME,
    password: env.MQTT_PASSWORD,
    clientIdPrefix: "moondesk-",
    topics: {
      telemetry: "+/+/telemetry", // {org_id}/{device_id}/telemetry
      commands: "+/+/cmd", // {org_id}/{device_id}/cmd
    },
  };
}
</file>

<file path="packages/config/package.json">
{
    "name": "@moondesk/config",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "main": "./src/index.ts",
    "types": "./src/index.ts",
    "exports": {
        ".": {
            "types": "./src/index.ts",
            "default": "./src/index.ts"
        }
    },
    "scripts": {
        "check-types": "tsc --noEmit",
        "lint": "eslint src/"
    },
    "dependencies": {
        "dotenv": "^17.2.3",
        "zod": "^3.24.2"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:*",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "eslint": "^9.15.0",
        "typescript": "5.9.2"
    }
}
</file>

<file path="packages/config/README.md">
# @moondesk/config

This package provides a centralized and validated way to manage configuration and environment variables across the Moondesk monorepo. It uses Zod for schema validation to ensure that all services start with a valid configuration, preventing runtime errors due to missing or invalid environment variables.

## Core Concepts

The configuration is split into multiple files, each responsible for a specific domain:

- `env.ts`: Handles base environment variables, such as `NODE_ENV`, `PORT`, and `DATABASE_URL`. It also exports a `isProduction` flag for environment-specific logic.
- `app.ts`: Manages application-level configurations, such as Clerk keys. It ensures that required variables are present in production environments.
- `database.ts`: Provides the database connection configuration.
- `mqtt.ts`: Provides the MQTT connection configuration.

## Usage

To access configuration variables, import the appropriate getter function from this package.

### Environment Variables

The `getEnv()` function returns a validated object with the base environment variables.

```typescript
import { getEnv } from "@moondesk/config";

const env = getEnv();

console.log("Node environment:", env.NODE_ENV);
console.log("Is production:", env.isProduction);
```

### Application Configuration

The `getAppConfig()` function returns application-specific configurations, such as Clerk keys.

```typescript
import { getAppConfig } from "@moondesk/config";

const appConfig = getAppConfig();

if (appConfig.isProduction) {
  console.log("Clerk Secret Key:", appConfig.clerk.secretKey);
}
```

## Validation

The environment variable schemas are defined using Zod. If any required environment variables are missing or invalid, the application will throw an error on startup, preventing it from running with an invalid configuration.

## Adding New Configuration

To add new configuration variables, follow these steps:

1.  **Determine the scope**: Decide whether the variable belongs in `env.ts` (base environment), `app.ts` (application-level), or a new domain-specific file.
2.  **Update the schema**: Add the new variable to the Zod schema in the appropriate file.
3.  **Update the getter function**: If necessary, update the corresponding getter function to include the new variable.
4.  **Access the variable**: Import the getter function in the service that requires the new variable.
</file>

<file path="packages/database/src/repositories/alert.repository.ts">
import { eq, and, desc, gte, lte, sql } from "drizzle-orm";
import type {
  Alert,
  CreateAlertInput,
  AcknowledgeAlertInput,
  AlertQueryParams,
  IAlertRepository,
  AlertStats,
} from "@moondesk/domain";
import { getDb } from "../client";
import { alerts } from "../schema/index";
import type { AlertSeverity, Protocol } from "@moondesk/domain";

/**
 * Alert repository implementation using Drizzle ORM
 */
export class AlertRepository implements IAlertRepository {
  private db = getDb();

  async getAll(organizationId: string, limit = 100): Promise<Alert[]> {
    const results = await this.db
      .select()
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId))
      .orderBy(desc(alerts.timestamp))
      .limit(limit);

    return results.map(this.mapToAlert);
  }

  async getStats(organizationId: string): Promise<AlertStats> {
    // Total count
    const totalResult = await this.db
      .select({ count: sql<number>`count(*)` })
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId));
    const total = Number(totalResult[0]?.count ?? 0);

    // Group by severity
    const bySeverityResult = await this.db
      .select({
        severity: alerts.severity,
        count: sql<number>`count(*)`,
      })
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId))
      .groupBy(alerts.severity);

    const bySeverity: Record<AlertSeverity, number> = {
      info: 0,
      warning: 0,
      critical: 0,
      emergency: 0,
    };

    bySeverityResult.forEach((row) => {
      if (row.severity) {
        bySeverity[row.severity as AlertSeverity] = Number(row.count);
      }
    });

    // Group by acknowledged
    const byStatusResult = await this.db
      .select({
        acknowledged: alerts.acknowledged,
        count: sql<number>`count(*)`,
      })
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId))
      .groupBy(alerts.acknowledged);

    const byStatus = {
      acknowledged: 0,
      unacknowledged: 0,
    };

    byStatusResult.forEach((row) => {
      if (row.acknowledged) {
        byStatus.acknowledged = Number(row.count);
      } else {
        byStatus.unacknowledged = Number(row.count);
      }
    });

    // Recent trend (last 7 days)
    const sevenDaysAgo = new Date();
    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

    const trendResult = await this.db
      .select({
        date: sql<string>`to_char(${alerts.timestamp}, 'YYYY-MM-DD')`,
        severity: alerts.severity,
        count: sql<number>`count(*)`,
      })
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          gte(alerts.timestamp, sevenDaysAgo),
        ),
      )
      .groupBy(sql`to_char(${alerts.timestamp}, 'YYYY-MM-DD')`, alerts.severity)
      .orderBy(sql`to_char(${alerts.timestamp}, 'YYYY-MM-DD')`);

    const recentTrend = trendResult.map((row) => ({
      date: row.date!, // Assuming date is never null due to grouping
      count: Number(row.count),
      severity: row.severity as AlertSeverity,
    }));

    // Calculate trends based on real DB data
    // Group recentTrend by date to get daily totals
    const dailyTotals: Record<string, number> = {};
    const criticalDailyTotals: Record<string, number> = {};

    recentTrend.forEach((item) => {
      dailyTotals[item.date] = (dailyTotals[item.date] || 0) + item.count;
      if (item.severity === "critical" || item.severity === "emergency") {
        criticalDailyTotals[item.date] =
          (criticalDailyTotals[item.date] || 0) + item.count;
      }
    });

    const dates = Object.keys(dailyTotals).sort();
    const lastDate = dates[dates.length - 1]; // Most recent day (today/yesterday)
    const prevDate = dates[dates.length - 2]; // The day before

    // Helper to calculate percentage change
    const calcTrend = (now: number, before: number) => {
      if (before === 0) return now > 0 ? 100 : 0;
      return Math.round(((now - before) / before) * 100);
    };

    const dailyTrend = calcTrend(
      lastDate ? (dailyTotals[lastDate] ?? 0) : 0,
      prevDate ? (dailyTotals[prevDate] ?? 0) : 0,
    );

    const criticalTrend = calcTrend(
      lastDate ? criticalDailyTotals[lastDate] || 0 : 0,
      prevDate ? criticalDailyTotals[prevDate] || 0 : 0,
    );

    // Calculate weekly trend
    const now = new Date();
    const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);

    const currentWeekCountResult = await this.db
      .select({ count: sql<number>`count(*)` })
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          gte(alerts.timestamp, oneWeekAgo),
        ),
      );
    const currentWeekCount = Number(currentWeekCountResult[0]?.count ?? 0);

    const previousWeekCountResult = await this.db
      .select({ count: sql<number>`count(*)` })
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          gte(alerts.timestamp, twoWeeksAgo),
          lte(alerts.timestamp, oneWeekAgo),
        ),
      );
    const previousWeekCount = Number(previousWeekCountResult[0]?.count ?? 0);

    const weeklyTrend = calcTrend(currentWeekCount, previousWeekCount);

    return {
      total,
      bySeverity,
      byStatus,
      trends: {
        daily: dailyTrend,
        weekly: weeklyTrend,
        critical: criticalTrend,
      },
      recentTrend,
    };
  }

  async query(params: AlertQueryParams): Promise<Alert[]> {
    let query = this.db
      .select()
      .from(alerts)
      .where(eq(alerts.organizationId, params.organizationId))
      .$dynamic();

    if (params.sensorId !== undefined) {
      query = query.where(eq(alerts.sensorId, params.sensorId));
    }
    if (params.severity !== undefined) {
      query = query.where(eq(alerts.severity, params.severity));
    }
    if (params.acknowledged !== undefined) {
      query = query.where(eq(alerts.acknowledged, params.acknowledged));
    }
    if (params.startTime !== undefined) {
      query = query.where(gte(alerts.timestamp, params.startTime));
    }
    if (params.endTime !== undefined) {
      query = query.where(lte(alerts.timestamp, params.endTime));
    }

    const results = await query
      .orderBy(desc(alerts.timestamp))
      .limit(params.limit ?? 100);

    return results.map(this.mapToAlert);
  }

  async getById(id: number, organizationId: string): Promise<Alert | null> {
    const results = await this.db
      .select()
      .from(alerts)
      .where(and(eq(alerts.id, id), eq(alerts.organizationId, organizationId)))
      .limit(1);

    return results[0] ? this.mapToAlert(results[0]) : null;
  }

  async getUnacknowledged(organizationId: string): Promise<Alert[]> {
    const results = await this.db
      .select()
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          eq(alerts.acknowledged, false),
        ),
      )
      .orderBy(desc(alerts.timestamp));

    return results.map(this.mapToAlert);
  }

  async create(input: CreateAlertInput): Promise<Alert> {
    const results = await this.db
      .insert(alerts)
      .values({
        sensorId: input.sensorId,
        organizationId: input.organizationId,
        severity: input.severity,
        message: input.message,
        triggerValue: input.triggerValue,
        thresholdValue: input.thresholdValue,
        protocol: input.protocol,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToAlert(results[0]!);
  }

  async acknowledge(
    id: number,
    organizationId: string,
    input: AcknowledgeAlertInput,
  ): Promise<Alert | null> {
    const results = await this.db
      .update(alerts)
      .set({
        acknowledged: true,
        acknowledgedAt: new Date(),
        acknowledgedBy: input.acknowledgedBy,
        notes: input.notes,
      })
      .where(and(eq(alerts.id, id), eq(alerts.organizationId, organizationId)))
      .returning();

    return results[0] ? this.mapToAlert(results[0]) : null;
  }

  private mapToAlert(record: typeof alerts.$inferSelect): Alert {
    return {
      id: record.id,
      sensorId: record.sensorId,
      organizationId: record.organizationId,
      timestamp: record.timestamp,
      severity: record.severity as AlertSeverity,
      message: record.message,
      triggerValue: record.triggerValue,
      thresholdValue: record.thresholdValue,
      acknowledged: record.acknowledged,
      acknowledgedAt: record.acknowledgedAt,
      acknowledgedBy: record.acknowledgedBy,
      notes: record.notes,
      protocol: record.protocol as Protocol,
      metadata: record.metadata ?? {},
    };
  }
}
</file>

<file path="packages/database/src/repositories/command.repository.ts">
import { eq, and, desc } from "drizzle-orm";
import type {
  Command,
  CreateCommandInput,
  UpdateCommandStatusInput,
  ICommandRepository,
} from "@moondesk/domain";
import { CommandStatus } from "@moondesk/domain";
import { getDb } from "../client";
import { commands } from "../schema/index";
import type { Protocol } from "@moondesk/domain";

/**
 * Command repository implementation using Drizzle ORM
 */
export class CommandRepository implements ICommandRepository {
  private db = getDb();

  async getAll(organizationId: string, limit = 100): Promise<Command[]> {
    const results = await this.db
      .select()
      .from(commands)
      .where(eq(commands.organizationId, organizationId))
      .orderBy(desc(commands.createdAt))
      .limit(limit);

    return results.map(this.mapToCommand);
  }

  async getBySensorId(
    sensorId: number,
    organizationId: string,
  ): Promise<Command[]> {
    const results = await this.db
      .select()
      .from(commands)
      .where(
        and(
          eq(commands.sensorId, sensorId),
          eq(commands.organizationId, organizationId),
        ),
      )
      .orderBy(desc(commands.createdAt));

    return results.map(this.mapToCommand);
  }

  async getById(id: number, organizationId: string): Promise<Command | null> {
    const results = await this.db
      .select()
      .from(commands)
      .where(
        and(eq(commands.id, id), eq(commands.organizationId, organizationId)),
      )
      .limit(1);

    return results[0] ? this.mapToCommand(results[0]) : null;
  }

  async getPending(organizationId: string): Promise<Command[]> {
    const results = await this.db
      .select()
      .from(commands)
      .where(
        and(
          eq(commands.organizationId, organizationId),
          eq(commands.status, CommandStatus.Pending),
        ),
      )
      .orderBy(desc(commands.createdAt));

    return results.map(this.mapToCommand);
  }

  async create(input: CreateCommandInput): Promise<Command> {
    const results = await this.db
      .insert(commands)
      .values({
        sensorId: input.sensorId,
        organizationId: input.organizationId,
        userId: input.userId,
        action: input.action,
        parameters: input.parameters ?? {},
        status: CommandStatus.Pending,
        protocol: input.protocol,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToCommand(results[0]!);
  }

  async updateStatus(
    id: number,
    organizationId: string,
    input: UpdateCommandStatusInput,
  ): Promise<Command | null> {
    const updateData: Record<string, unknown> = {
      status: input.status,
    };

    if (input.status === CommandStatus.Sent) {
      updateData["sentAt"] = new Date();
    } else if (
      input.status === CommandStatus.Completed ||
      input.status === CommandStatus.Failed
    ) {
      updateData["completedAt"] = new Date();
      if (input.errorMessage) {
        updateData["errorMessage"] = input.errorMessage;
      }
    }

    const results = await this.db
      .update(commands)
      .set(updateData)
      .where(
        and(eq(commands.id, id), eq(commands.organizationId, organizationId)),
      )
      .returning();

    return results[0] ? this.mapToCommand(results[0]) : null;
  }

  private mapToCommand(record: typeof commands.$inferSelect): Command {
    return {
      id: record.id,
      sensorId: record.sensorId,
      organizationId: record.organizationId,
      userId: record.userId,
      action: record.action,
      parameters: (record.parameters as Record<string, unknown>) ?? {},
      status: record.status as import("@moondesk/domain").CommandStatus,
      protocol: record.protocol as Protocol,
      createdAt: record.createdAt,
      sentAt: record.sentAt,
      completedAt: record.completedAt,
      errorMessage: record.errorMessage,
      metadata: record.metadata ?? {},
    };
  }
}
</file>

<file path="packages/database/src/repositories/connection-credential.repository.ts">
import { eq, and, desc } from "drizzle-orm";
import type {
  ConnectionCredential,
  UpdateCredentialInput,
  IConnectionCredentialRepository,
} from "@moondesk/domain";
import type { Protocol } from "@moondesk/domain";
import { getDb } from "../client";
import { connectionCredentials } from "../schema/index";

/**
 * Internal create input type with already-encrypted password
 * The encryption is handled by the service layer before calling the repository
 */
export interface CreateCredentialDbInput {
  organizationId: string;
  name: string;
  protocol: Protocol;
  endpointUri: string;
  username: string;
  encryptedPassword: string;
  encryptionIV: string;
  clientId?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Internal update input type with optional encrypted password
 */
export interface UpdateCredentialDbInput {
  name?: string;
  endpointUri?: string;
  username?: string;
  encryptedPassword?: string;
  encryptionIV?: string;
  clientId?: string | null;
  isActive?: boolean;
  metadata?: Record<string, string>;
}

/**
 * ConnectionCredential repository implementation using Drizzle ORM
 * Note: This repository expects already-encrypted password data.
 * Use the CredentialService to handle encryption before calling create/update.
 */
export class ConnectionCredentialRepository implements Omit<
  IConnectionCredentialRepository,
  "create" | "update"
> {
  private db = getDb();

  async getAll(organizationId: string): Promise<ConnectionCredential[]> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(eq(connectionCredentials.organizationId, organizationId))
      .orderBy(desc(connectionCredentials.createdAt));

    return results.map(this.mapToCredential);
  }

  async getByProtocol(
    protocol: Protocol,
    organizationId: string,
  ): Promise<ConnectionCredential[]> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.organizationId, organizationId),
          eq(connectionCredentials.protocol, protocol),
        ),
      )
      .orderBy(desc(connectionCredentials.createdAt));

    return results.map(this.mapToCredential);
  }

  async getById(
    id: number,
    organizationId: string,
  ): Promise<ConnectionCredential | null> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.id, id),
          eq(connectionCredentials.organizationId, organizationId),
        ),
      )
      .limit(1);

    return results[0] ? this.mapToCredential(results[0]) : null;
  }

  async getActive(organizationId: string): Promise<ConnectionCredential[]> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.organizationId, organizationId),
          eq(connectionCredentials.isActive, true),
        ),
      )
      .orderBy(desc(connectionCredentials.createdAt));

    return results.map(this.mapToCredential);
  }

  async create(input: CreateCredentialDbInput): Promise<ConnectionCredential> {
    const results = await this.db
      .insert(connectionCredentials)
      .values({
        organizationId: input.organizationId,
        name: input.name,
        protocol: input.protocol,
        endpointUri: input.endpointUri,
        username: input.username,
        encryptedPassword: input.encryptedPassword,
        encryptionIV: input.encryptionIV,
        clientId: input.clientId,
        isActive: true,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToCredential(results[0]!);
  }

  async update(
    id: number,
    organizationId: string,
    input: UpdateCredentialDbInput,
  ): Promise<ConnectionCredential | null> {
    const updateData: Record<string, unknown> = { updatedAt: new Date() };

    if (input.name !== undefined) updateData["name"] = input.name;
    if (input.endpointUri !== undefined)
      updateData["endpointUri"] = input.endpointUri;
    if (input.username !== undefined) updateData["username"] = input.username;
    if (input.encryptedPassword !== undefined)
      updateData["encryptedPassword"] = input.encryptedPassword;
    if (input.encryptionIV !== undefined)
      updateData["encryptionIV"] = input.encryptionIV;
    if (input.clientId !== undefined) updateData["clientId"] = input.clientId;
    if (input.isActive !== undefined) updateData["isActive"] = input.isActive;
    if (input.metadata !== undefined) updateData["metadata"] = input.metadata;

    const results = await this.db
      .update(connectionCredentials)
      .set(updateData)
      .where(
        and(
          eq(connectionCredentials.id, id),
          eq(connectionCredentials.organizationId, organizationId),
        ),
      )
      .returning();

    return results[0] ? this.mapToCredential(results[0]) : null;
  }

  async delete(id: number, organizationId: string): Promise<boolean> {
    const result = await this.db
      .delete(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.id, id),
          eq(connectionCredentials.organizationId, organizationId),
        ),
      )
      .returning({ id: connectionCredentials.id });

    return result.length > 0;
  }

  private mapToCredential(
    record: typeof connectionCredentials.$inferSelect,
  ): ConnectionCredential {
    return {
      id: record.id,
      organizationId: record.organizationId,
      name: record.name,
      protocol: record.protocol as Protocol,
      endpointUri: record.endpointUri,
      username: record.username,
      encryptedPassword: record.encryptedPassword,
      encryptionIV: record.encryptionIV,
      clientId: record.clientId,
      isActive: record.isActive,
      metadata: record.metadata ?? {},
      createdAt: record.createdAt,
      updatedAt: record.updatedAt,
    };
  }
}
</file>

<file path="packages/database/src/repositories/index.ts">
// Repositories barrel export
export { AssetRepository } from "./asset.repository";
export { SensorRepository } from "./sensor.repository";
export { ReadingRepository } from "./reading.repository";
export { AlertRepository } from "./alert.repository";
export { CommandRepository } from "./command.repository";
export { UserRepository } from "./user.repository";
export {
  OrganizationRepository,
  OrganizationMembershipRepository,
} from "./organization.repository";
export {
  ConnectionCredentialRepository,
  type CreateCredentialDbInput,
  type UpdateCredentialDbInput,
} from "./connection-credential.repository";

// Re-export repository interfaces from domain
export type {
  IAssetRepository,
  ISensorRepository,
  IReadingRepository,
  IAlertRepository,
  ICommandRepository,
  IUserRepository,
  IOrganizationRepository,
  IOrganizationMembershipRepository,
  IConnectionCredentialRepository,
} from "@moondesk/domain";
</file>

<file path="packages/database/src/repositories/organization.repository.ts">
import { eq, and } from "drizzle-orm";
import type {
  Organization,
  OrganizationMembership,
  UpsertOrganizationInput,
  UpsertMembershipInput,
  IOrganizationRepository,
  IOrganizationMembershipRepository,
} from "@moondesk/domain";
import type { UserRole } from "@moondesk/domain";
import { getDb } from "../client";
import { organizations, organizationMemberships } from "../schema/index";

/**
 * Organization repository implementation using Drizzle ORM
 */
export class OrganizationRepository implements IOrganizationRepository {
  private db = getDb();

  async getById(id: string): Promise<Organization | null> {
    const results = await this.db
      .select()
      .from(organizations)
      .where(eq(organizations.id, id))
      .limit(1);

    return results[0] ? this.mapToOrganization(results[0]) : null;
  }

  async getAll(): Promise<Organization[]> {
    const results = await this.db.select().from(organizations);

    return results.map(this.mapToOrganization);
  }

  async upsert(input: UpsertOrganizationInput): Promise<Organization> {
    const results = await this.db
      .insert(organizations)
      .values({
        id: input.id,
        name: input.name,
        slug: input.slug,
        imageUrl: input.imageUrl,
        ownerId: input.ownerId,
      })
      .onConflictDoUpdate({
        target: organizations.id,
        set: {
          name: input.name,
          slug: input.slug,
          imageUrl: input.imageUrl,
          ownerId: input.ownerId,
          updatedAt: new Date(),
        },
      })
      .returning();

    return this.mapToOrganization(results[0]!);
  }

  async delete(id: string): Promise<boolean> {
    const result = await this.db
      .delete(organizations)
      .where(eq(organizations.id, id))
      .returning({ id: organizations.id });

    return result.length > 0;
  }

  private mapToOrganization(
    record: typeof organizations.$inferSelect,
  ): Organization {
    return {
      id: record.id,
      name: record.name,
      slug: record.slug,
      imageUrl: record.imageUrl,
      ownerId: record.ownerId,
      createdAt: record.createdAt,
      updatedAt: record.updatedAt,
    };
  }
}

/**
 * OrganizationMembership repository implementation using Drizzle ORM
 */
export class OrganizationMembershipRepository implements IOrganizationMembershipRepository {
  private db = getDb();

  async getByUserId(userId: string): Promise<OrganizationMembership[]> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(eq(organizationMemberships.userId, userId));

    return results.map(this.mapToMembership);
  }

  async getByOrganizationId(
    organizationId: string,
  ): Promise<OrganizationMembership[]> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(eq(organizationMemberships.organizationId, organizationId));

    return results.map(this.mapToMembership);
  }

  async isMember(userId: string, organizationId: string): Promise<boolean> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(
        and(
          eq(organizationMemberships.userId, userId),
          eq(organizationMemberships.organizationId, organizationId),
        ),
      )
      .limit(1);

    return results.length > 0;
  }

  async getByUserAndOrg(
    userId: string,
    organizationId: string,
  ): Promise<OrganizationMembership | null> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(
        and(
          eq(organizationMemberships.userId, userId),
          eq(organizationMemberships.organizationId, organizationId),
        ),
      )
      .limit(1);

    return results[0] ? this.mapToMembership(results[0]) : null;
  }

  async upsert(input: UpsertMembershipInput): Promise<OrganizationMembership> {
    const results = await this.db
      .insert(organizationMemberships)
      .values({
        userId: input.userId,
        organizationId: input.organizationId,
        role: input.role,
      })
      .onConflictDoUpdate({
        target: [
          organizationMemberships.userId,
          organizationMemberships.organizationId,
        ],
        set: {
          role: input.role,
        },
      })
      .returning();

    return this.mapToMembership(results[0]!);
  }

  async delete(userId: string, organizationId: string): Promise<boolean> {
    const result = await this.db
      .delete(organizationMemberships)
      .where(
        and(
          eq(organizationMemberships.userId, userId),
          eq(organizationMemberships.organizationId, organizationId),
        ),
      )
      .returning({
        userId: organizationMemberships.userId,
      });

    return result.length > 0;
  }

  private mapToMembership(
    record: typeof organizationMemberships.$inferSelect,
  ): OrganizationMembership {
    return {
      userId: record.userId,
      organizationId: record.organizationId,
      role: record.role as UserRole,
      createdAt: record.createdAt,
    };
  }
}
</file>

<file path="packages/database/src/repositories/reading.repository.ts">
import { eq, and, desc, sql } from "drizzle-orm";
import type {
  Reading,
  CreateReadingInput,
  ReadingQueryParams,
  AggregatedReading,
} from "@moondesk/domain";
import type { IReadingRepository } from "@moondesk/domain";
import { getDb } from "../client";
import { readings } from "../schema/index";
import {
  Parameter,
  Protocol,
  ReadingQuality,
  ReadingStats,
} from "@moondesk/domain";

/**
 * Reading repository implementation optimized for time-series data
 */
export class ReadingRepository implements IReadingRepository {
  private db = getDb();

  async getRecent(
    organizationId: string,
    sensorId: number,
    limit = 100,
  ): Promise<Reading[]> {
    const results = await this.db
      .select()
      .from(readings)
      .where(
        and(
          eq(readings.organizationId, organizationId),
          eq(readings.sensorId, sensorId),
        ),
      )
      .orderBy(desc(readings.timestamp))
      .limit(limit);

    return results.map(this.mapToReading);
  }

  async query(params: ReadingQueryParams): Promise<Reading[]> {
    // Build dynamic query based on params
    let query = this.db
      .select()
      .from(readings)
      .where(eq(readings.organizationId, params.organizationId))
      .$dynamic();

    // Note: For production, would add more sophisticated filtering
    // This is simplified for initial implementation
    const results = await query
      .orderBy(desc(readings.timestamp))
      .limit(params.limit ?? 1000);

    return results.map(this.mapToReading);
  }

  async getAggregated(
    params: ReadingQueryParams,
  ): Promise<AggregatedReading[]> {
    // TimescaleDB time_bucket aggregation would go here
    // For now, return empty array - requires raw SQL for time_bucket
    console.warn(
      "getAggregated requires TimescaleDB time_bucket - not yet implemented",
    );
    return [];
  }

  async getLatestBySensor(
    organizationId: string,
    sensorIds: number[],
  ): Promise<Map<number, Reading>> {
    const result = new Map<number, Reading>();

    // Get latest reading for each sensor
    // This could be optimized with a window function in production
    for (const sensorId of sensorIds) {
      const latest = await this.db
        .select()
        .from(readings)
        .where(
          and(
            eq(readings.organizationId, organizationId),
            eq(readings.sensorId, sensorId),
          ),
        )
        .orderBy(desc(readings.timestamp))
        .limit(1);

      if (latest[0]) {
        result.set(sensorId, this.mapToReading(latest[0]));
      }
    }

    return result;
  }

  async bulkInsert(inputs: CreateReadingInput[]): Promise<void> {
    if (inputs.length === 0) return;

    const values = inputs.map((input) => ({
      sensorId: input.sensorId,
      organizationId: input.organizationId,
      timestamp: input.timestamp ?? new Date(),
      value: input.value,
      parameter: input.parameter ?? Parameter.None,
      protocol: input.protocol ?? Protocol.Mqtt,
      quality: input.quality ?? ReadingQuality.Good,
      notes: input.notes,
      metadata: input.metadata ?? {},
    }));

    await this.db.insert(readings).values(values);
  }

  async insert(input: CreateReadingInput): Promise<Reading> {
    const results = await this.db
      .insert(readings)
      .values({
        sensorId: input.sensorId,
        organizationId: input.organizationId,
        timestamp: input.timestamp ?? new Date(),
        value: input.value,
        parameter: input.parameter ?? Parameter.None,
        protocol: input.protocol ?? Protocol.Mqtt,
        quality: input.quality ?? ReadingQuality.Good,
        notes: input.notes,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToReading(results[0]!);
  }

  private mapToReading(record: typeof readings.$inferSelect): Reading {
    return {
      sensorId: record.sensorId,
      organizationId: record.organizationId,
      timestamp: record.timestamp,
      value: record.value,
      parameter: record.parameter as import("@moondesk/domain").Parameter,
      protocol: record.protocol as import("@moondesk/domain").Protocol,
      quality: record.quality as import("@moondesk/domain").ReadingQuality,
      notes: record.notes,
      metadata: record.metadata ?? {},
    };
  }

  async getStats(organizationId: string): Promise<ReadingStats> {
    // Query 1: Total count
    // Note: Using Drizzle's `sql` operator for raw queries
    const totalResult = await this.db.execute(
      sql`SELECT count(*) as count FROM ${readings} WHERE ${readings.organizationId} = ${organizationId}`,
    );
    const total = Number(totalResult.rows[0]?.count || 0);

    // Query 2: Daily trend for last 7 days
    // Using TimescaleDB time_bucket
    const trendResult = this.db.execute(
      sql`
                SELECT time_bucket('1 day', ${readings.timestamp}) AS bucket, count(*) 
                FROM ${readings} 
                WHERE ${readings.organizationId} = ${organizationId} 
                AND ${readings.timestamp} > NOW() - INTERVAL '7 days' 
                GROUP BY bucket 
                ORDER BY bucket ASC
            `,
    );

    const trends = (await trendResult).rows.map((row: any) => ({
      bucket: new Date(row.bucket).toISOString(),
      count: Number(row.count),
    }));

    // Calculate dailyTrend
    let dailyTrend = 0;
    if (trends.length >= 2) {
      const last = trends[trends.length - 1]!.count;
      const prev = trends[trends.length - 2]!.count;
      if (prev > 0) {
        dailyTrend = Math.round(((last - prev) / prev) * 100);
      } else if (last > 0) {
        dailyTrend = 100;
      }
    }

    // Query 3: Quality Score (percentage of 'good' readings)
    const qualityResult = await this.db.execute(
      sql`SELECT count(*) as count FROM ${readings} WHERE ${readings.organizationId} = ${organizationId} AND ${readings.quality} = 'good'`,
    );
    const goodCount = Number(qualityResult.rows[0]?.count || 0);
    const qualityScore =
      total > 0 ? Math.round((goodCount / total) * 100) : 100;

    return { total, dailyTrend, qualityScore, trends };
  }
}
</file>

<file path="packages/database/src/repositories/sensor.repository.ts">
import { eq, and, desc, getTableColumns } from "drizzle-orm";
import type {
  Sensor,
  CreateSensorInput,
  UpdateSensorInput,
  ISensorRepository,
} from "@moondesk/domain";
import { getDb } from "../client";
import { assets, sensors } from "../schema/index";
import type { SensorType, Parameter, Protocol } from "@moondesk/domain";

/**
 * Sensor repository implementation using Drizzle ORM
 */
export class SensorRepository implements ISensorRepository {
  private db = getDb();
  private fullSensor = {
    ...getTableColumns(sensors),
    organizationId: assets.organizationId,
  };

  async getAll(organizationId: string): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(eq(assets.organizationId, organizationId))
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async getAllSystemSensors(): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async getByAssetId(
    assetId: number,
    organizationId: string,
  ): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(
        and(
          eq(sensors.assetId, assetId),
          eq(assets.organizationId, organizationId),
        ),
      )
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async getById(id: number, organizationId: string): Promise<Sensor | null> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(and(eq(sensors.id, id), eq(assets.organizationId, organizationId)))
      .limit(1);

    return results[0] ? this.mapToSensor(results[0]) : null;
  }

  async getActive(organizationId: string): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(
        and(
          eq(assets.organizationId, organizationId),
          eq(sensors.isActive, true),
        ),
      )
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async create(input: CreateSensorInput): Promise<Sensor> {
    const asset = await this.db.query.assets.findFirst({
      where: and(
        eq(assets.id, input.assetId),
        eq(assets.organizationId, input.organizationId),
      ),
    });

    if (!asset) {
      throw new Error("Asset not found or does not belong to the organization");
    }

    const results = await this.db
      .insert(sensors)
      .values({
        assetId: input.assetId,
        name: input.name,
        type: input.type,
        parameter: input.parameter,
        unit: input.unit,
        thresholdLow: input.thresholdLow,
        thresholdHigh: input.thresholdHigh,
        minValue: input.minValue,
        maxValue: input.maxValue,
        samplingIntervalMs: input.samplingIntervalMs ?? 1000,
        isActive: true,
        protocol: input.protocol,
        description: input.description,
        metadata: input.metadata ?? {},
      })
      .returning({ id: sensors.id });

    const newSensor = await this.getById(results[0]!.id, input.organizationId);
    return newSensor!;
  }

  async update(
    id: number,
    organizationId: string,
    input: UpdateSensorInput,
  ): Promise<Sensor | null> {
    const sensor = await this.getById(id, organizationId);

    if (!sensor) {
      return null;
    }

    await this.db
      .update(sensors)
      .set({
        ...input,
        updatedAt: new Date(),
      })
      .where(eq(sensors.id, id));

    return this.getById(id, organizationId);
  }

  async delete(id: number, organizationId: string): Promise<boolean> {
    const sensor = await this.getById(id, organizationId);

    if (!sensor) {
      return false;
    }

    const result = await this.db
      .delete(sensors)
      .where(eq(sensors.id, id))
      .returning({ id: sensors.id });

    return result.length > 0;
  }

  private mapToSensor(
    record: Omit<typeof sensors.$inferSelect, "organizationId"> & {
      organizationId: string;
    },
  ): Sensor {
    return {
      id: record.id,
      assetId: record.assetId,
      organizationId: record.organizationId,
      name: record.name,
      type: record.type as SensorType,
      parameter: record.parameter as Parameter,
      unit: record.unit,
      thresholdLow: record.thresholdLow,
      thresholdHigh: record.thresholdHigh,
      minValue: record.minValue,
      maxValue: record.maxValue,
      samplingIntervalMs: record.samplingIntervalMs,
      isActive: record.isActive,
      protocol: record.protocol as Protocol,
      description: record.description,
      metadata: record.metadata ?? {},
    };
  }
}
</file>

<file path="packages/database/src/repositories/user.repository.ts">
import { eq } from "drizzle-orm";
import type { User, UpsertUserInput, IUserRepository } from "@moondesk/domain";
import { getDb } from "../client";
import { users } from "../schema/index";

/**
 * User repository implementation using Drizzle ORM
 */
export class UserRepository implements IUserRepository {
  private db = getDb();

  async getById(id: string): Promise<User | null> {
    const results = await this.db
      .select()
      .from(users)
      .where(eq(users.id, id))
      .limit(1);

    return results[0] ? this.mapToUser(results[0]) : null;
  }

  async getByEmail(email: string): Promise<User | null> {
    const results = await this.db
      .select()
      .from(users)
      .where(eq(users.email, email))
      .limit(1);

    return results[0] ? this.mapToUser(results[0]) : null;
  }

  async upsert(input: UpsertUserInput): Promise<User> {
    const results = await this.db
      .insert(users)
      .values({
        id: input.id,
        email: input.email,
        username: input.username,
        firstName: input.firstName,
        lastName: input.lastName,
        imageUrl: input.imageUrl,
      })
      .onConflictDoUpdate({
        target: users.id,
        set: {
          email: input.email,
          username: input.username,
          firstName: input.firstName,
          lastName: input.lastName,
          imageUrl: input.imageUrl,
          updatedAt: new Date(),
        },
      })
      .returning();

    return this.mapToUser(results[0]!);
  }

  async delete(id: string): Promise<boolean> {
    const result = await this.db
      .delete(users)
      .where(eq(users.id, id))
      .returning({ id: users.id });

    return result.length > 0;
  }

  private mapToUser(record: typeof users.$inferSelect): User {
    return {
      id: record.id,
      email: record.email,
      username: record.username,
      firstName: record.firstName,
      lastName: record.lastName,
      imageUrl: record.imageUrl,
      createdAt: record.createdAt,
      updatedAt: record.updatedAt,
    };
  }
}
</file>

<file path="packages/database/src/schema/alerts.ts">
import {
  pgTable,
  serial,
  text,
  timestamp,
  boolean,
  integer,
  doublePrecision,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Alerts table - threshold violation notifications
 */
export const alerts = pgTable(
  "alerts",
  {
    id: serial("id").primaryKey(),
    sensorId: integer("sensor_id")
      .notNull()
      .references(() => sensors.id, { onDelete: "cascade" }),
    organizationId: text("organization_id").notNull(),
    timestamp: timestamp("timestamp", { withTimezone: true })
      .notNull()
      .defaultNow(),
    severity: text("severity").notNull().default("info"),
    message: text("message").notNull(),
    triggerValue: doublePrecision("trigger_value").notNull(),
    thresholdValue: doublePrecision("threshold_value"),
    acknowledged: boolean("acknowledged").notNull().default(false),
    acknowledgedAt: timestamp("acknowledged_at", { withTimezone: true }),
    acknowledgedBy: text("acknowledged_by"),
    notes: text("notes"),
    protocol: text("protocol").notNull().default("mqtt"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
  },
  (table) => [
    index("idx_alerts_org_acknowledged_time").on(
      table.organizationId,
      table.acknowledged,
      table.timestamp,
    ),
    index("idx_alerts_org_sensor").on(table.organizationId, table.sensorId),
  ],
);

/**
 * Alert relations
 */
export const alertsRelations = relations(alerts, ({ one }) => ({
  sensor: one(sensors, {
    fields: [alerts.sensorId],
    references: [sensors.id],
  }),
}));

export type AlertRecord = typeof alerts.$inferSelect;
export type NewAlertRecord = typeof alerts.$inferInsert;
</file>

<file path="packages/database/src/schema/assets.ts">
import {
  pgTable,
  serial,
  text,
  timestamp,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Assets table - represents industrial equipment being monitored
 */
export const assets = pgTable(
  "assets",
  {
    id: serial("id").primaryKey(),
    organizationId: text("organization_id").notNull(),
    name: text("name").notNull(),
    type: text("type").notNull(),
    location: text("location").notNull().default(""),
    status: text("status").notNull().default("unknown"),
    lastSeen: timestamp("last_seen", { withTimezone: true }),
    description: text("description"),
    manufacturer: text("manufacturer"),
    modelNumber: text("model_number"),
    installationDate: timestamp("installation_date", { withTimezone: true }),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [
    index("idx_assets_organization_id").on(table.organizationId),
    index("idx_assets_status").on(table.organizationId, table.status),
  ],
);

/**
 * Asset relations
 */
export const assetsRelations = relations(assets, ({ many }) => ({
  sensors: many(sensors),
}));

export type AssetRecord = typeof assets.$inferSelect;
export type NewAssetRecord = typeof assets.$inferInsert;
</file>

<file path="packages/database/src/schema/commands.ts">
import {
  pgTable,
  serial,
  text,
  timestamp,
  integer,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Commands table - device control commands
 */
export const commands = pgTable(
  "commands",
  {
    id: serial("id").primaryKey(),
    sensorId: integer("sensor_id")
      .notNull()
      .references(() => sensors.id, { onDelete: "cascade" }),
    organizationId: text("organization_id").notNull(),
    userId: text("user_id").notNull(),
    action: text("action").notNull(),
    parameters: jsonb("parameters")
      .$type<Record<string, unknown>>()
      .default({}),
    status: text("status").notNull().default("pending"),
    protocol: text("protocol").notNull().default("mqtt"),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    sentAt: timestamp("sent_at", { withTimezone: true }),
    completedAt: timestamp("completed_at", { withTimezone: true }),
    errorMessage: text("error_message"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
  },
  (table) => [
    index("idx_commands_org_status_time").on(
      table.organizationId,
      table.status,
      table.createdAt,
    ),
    index("idx_commands_org_user").on(table.organizationId, table.userId),
  ],
);

/**
 * Command relations
 */
export const commandsRelations = relations(commands, ({ one }) => ({
  sensor: one(sensors, {
    fields: [commands.sensorId],
    references: [sensors.id],
  }),
}));

export type CommandRecord = typeof commands.$inferSelect;
export type NewCommandRecord = typeof commands.$inferInsert;
</file>

<file path="packages/database/src/schema/connection-credentials.ts">
import {
  pgTable,
  serial,
  text,
  timestamp,
  boolean,
  jsonb,
  index,
} from "drizzle-orm/pg-core";

/**
 * Connection credentials table - secure storage for MQTT/OPC-UA credentials
 */
export const connectionCredentials = pgTable(
  "connection_credentials",
  {
    id: serial("id").primaryKey(),
    organizationId: text("organization_id").notNull(),
    name: text("name").notNull(),
    protocol: text("protocol").notNull(),
    endpointUri: text("endpoint_uri").notNull(),
    username: text("username").notNull(),
    encryptedPassword: text("encrypted_password").notNull(),
    encryptionIV: text("encryption_iv").notNull(),
    clientId: text("client_id"),
    isActive: boolean("is_active").notNull().default(true),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [
    index("idx_credentials_org_protocol").on(
      table.organizationId,
      table.protocol,
    ),
    index("idx_credentials_org_active").on(
      table.organizationId,
      table.isActive,
    ),
  ],
);

export type ConnectionCredentialRecord =
  typeof connectionCredentials.$inferSelect;
export type NewConnectionCredentialRecord =
  typeof connectionCredentials.$inferInsert;
</file>

<file path="packages/database/src/schema/index.ts">
// Schema barrel export
export * from "./assets";
export * from "./sensors";
export * from "./readings";
export * from "./alerts";
export * from "./commands";
export * from "./users";
export * from "./organizations";
export * from "./connection-credentials";
</file>

<file path="packages/database/src/schema/organizations.ts">
import {
  pgTable,
  text,
  timestamp,
  primaryKey,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { users } from "./users";

/**
 * Organizations table - synced from Clerk
 */
export const organizations = pgTable(
  "organizations",
  {
    id: text("id").primaryKey(), // Clerk organization ID
    name: text("name").notNull(),
    slug: text("slug").unique(),
    imageUrl: text("image_url"),
    ownerId: text("owner_id").notNull(),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [index("idx_organizations_owner").on(table.ownerId)],
);

/**
 * Organization memberships - many-to-many between users and organizations
 */
export const organizationMemberships = pgTable(
  "organization_memberships",
  {
    userId: text("user_id")
      .notNull()
      .references(() => users.id, { onDelete: "cascade" }),
    organizationId: text("organization_id")
      .notNull()
      .references(() => organizations.id, { onDelete: "cascade" }),
    role: text("role").notNull().default("member"),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [primaryKey({ columns: [table.userId, table.organizationId] })],
);

/**
 * Organization relations
 */
export const organizationsRelations = relations(organizations, ({ many }) => ({
  memberships: many(organizationMemberships),
}));

/**
 * Membership relations
 */
export const organizationMembershipsRelations = relations(
  organizationMemberships,
  ({ one }) => ({
    user: one(users, {
      fields: [organizationMemberships.userId],
      references: [users.id],
    }),
    organization: one(organizations, {
      fields: [organizationMemberships.organizationId],
      references: [organizations.id],
    }),
  }),
);

export type OrganizationRecord = typeof organizations.$inferSelect;
export type NewOrganizationRecord = typeof organizations.$inferInsert;
export type OrganizationMembershipRecord =
  typeof organizationMemberships.$inferSelect;
export type NewOrganizationMembershipRecord =
  typeof organizationMemberships.$inferInsert;
</file>

<file path="packages/database/src/schema/readings.ts">
import {
  pgTable,
  text,
  timestamp,
  doublePrecision,
  jsonb,
  index,
  integer,
  primaryKey,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Readings table - time-series sensor data
 * Optimized for TimescaleDB hypertable (composite primary key on sensorId + timestamp)
 */
export const readings = pgTable(
  "readings",
  {
    sensorId: integer("sensor_id")
      .notNull()
      .references(() => sensors.id, { onDelete: "cascade" }),
    organizationId: text("organization_id").notNull(),
    timestamp: timestamp("timestamp", { withTimezone: true })
      .notNull()
      .defaultNow(),
    value: doublePrecision("value").notNull(),
    parameter: text("parameter").notNull().default("none"),
    protocol: text("protocol").notNull().default("mqtt"),
    quality: text("quality").notNull().default("good"),
    notes: text("notes"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
  },
  (table) => [
    // Composite primary key for TimescaleDB
    primaryKey({ columns: [table.sensorId, table.timestamp] }),
    // Critical indexes for time-series queries
    index("idx_readings_org_sensor_time").on(
      table.organizationId,
      table.sensorId,
      table.timestamp,
    ),
    index("idx_readings_org_time").on(table.organizationId, table.timestamp),
  ],
);

/**
 * Reading relations
 */
export const readingsRelations = relations(readings, ({ one }) => ({
  sensor: one(sensors, {
    fields: [readings.sensorId],
    references: [sensors.id],
  }),
}));

export type ReadingRecord = typeof readings.$inferSelect;
export type NewReadingRecord = typeof readings.$inferInsert;
</file>

<file path="packages/database/src/schema/sensors.ts">
import {
  pgTable,
  serial,
  text,
  timestamp,
  boolean,
  integer,
  doublePrecision,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { assets } from "./assets";
import { readings } from "./readings";
import { alerts } from "./alerts";
import { commands } from "./commands";

/**
 * Sensors table - represents measurement devices attached to assets
 */
export const sensors = pgTable(
  "sensors",
  {
    id: serial("id").primaryKey(),
    assetId: integer("asset_id")
      .notNull()
      .references(() => assets.id, { onDelete: "cascade" }),
    name: text("name").notNull(),
    type: text("type").notNull(),
    parameter: text("parameter").notNull().default("none"),
    unit: text("unit").notNull(),
    thresholdLow: doublePrecision("threshold_low"),
    thresholdHigh: doublePrecision("threshold_high"),
    minValue: doublePrecision("min_value"),
    maxValue: doublePrecision("max_value"),
    samplingIntervalMs: integer("sampling_interval_ms").notNull().default(1000),
    isActive: boolean("is_active").notNull().default(true),
    protocol: text("protocol").notNull().default("mqtt"),
    description: text("description"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [index("idx_sensors_asset_id").on(table.assetId)],
);

/**
 * Sensor relations
 */
export const sensorsRelations = relations(sensors, ({ one, many }) => ({
  asset: one(assets, {
    fields: [sensors.assetId],
    references: [assets.id],
  }),
  readings: many(readings),
  alerts: many(alerts),
  commands: many(commands),
}));

export type SensorRecord = typeof sensors.$inferSelect;
export type NewSensorRecord = typeof sensors.$inferInsert;
</file>

<file path="packages/database/src/schema/users.ts">
import { pgTable, text, timestamp, index } from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { organizationMemberships } from "./organizations";

/**
 * Users table - synced from Clerk
 */
export const users = pgTable(
  "users",
  {
    id: text("id").primaryKey(), // Clerk user ID
    email: text("email").notNull().unique(),
    username: text("username").unique(),
    firstName: text("first_name"),
    lastName: text("last_name"),
    imageUrl: text("image_url"),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [index("idx_users_email").on(table.email)],
);

/**
 * User relations
 */
export const usersRelations = relations(users, ({ many }) => ({
  memberships: many(organizationMemberships),
}));

export type UserRecord = typeof users.$inferSelect;
export type NewUserRecord = typeof users.$inferInsert;
</file>

<file path="packages/database/src/client.ts">
import { drizzle } from "drizzle-orm/node-postgres";
import pg from "pg";
import * as schema from "./schema/index";

const { Pool } = pg;

let pool: pg.Pool | null = null;
let db: ReturnType<typeof drizzle<typeof schema>> | null = null;

/**
 * Get or create the database connection pool
 */
export function getPool(): pg.Pool {
  if (!pool) {
    const connectionString = process.env["DATABASE_URL"];
    if (!connectionString) {
      throw new Error("DATABASE_URL environment variable is required");
    }

    pool = new Pool({
      connectionString,
      max: 20, // Maximum connections in pool
      idleTimeoutMillis: 30000,
      connectionTimeoutMillis: 5000,
    });

    pool.on("error", (err) => {
      console.error("Unexpected database pool error:", err);
    });
  }

  return pool;
}

/**
 * Get or create the Drizzle database instance
 */
export function getDb() {
  if (!db) {
    db = drizzle(getPool(), { schema });
  }
  return db;
}

/**
 * Close the database connection pool
 */
export async function closeDb(): Promise<void> {
  if (pool) {
    await pool.end();
    pool = null;
    db = null;
  }
}

// Export schema and types
export * from "./schema/index";
export { schema };
</file>

<file path="packages/database/src/index.ts">
// @moondesk/database - Data access layer with Drizzle ORM

// Database client
export { getDb, getPool, closeDb } from "./client";

// Schema
export * from "./schema/index";

// Repositories
export * from "./repositories/index";
</file>

<file path="packages/database/drizzle.config.ts">
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./src/schema/index.ts",
  out: "./src/migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env["DATABASE_URL"]!,
  },
  verbose: true,
  strict: true,
});
</file>

<file path="packages/domain/src/enums/alert-severity.ts">
/**
 * Represents the severity level of an alert
 */
export const AlertSeverity = {
  Info: "info",
  Warning: "warning",
  Critical: "critical",
  Emergency: "emergency",
} as const;

export type AlertSeverity = (typeof AlertSeverity)[keyof typeof AlertSeverity];
</file>

<file path="packages/domain/src/enums/asset-status.ts">
/**
 * Represents the operational status of an asset
 */
export const AssetStatus = {
  Online: "online",
  Offline: "offline",
  Maintenance: "maintenance",
  Error: "error",
  Unknown: "unknown",
} as const;

export type AssetStatus = (typeof AssetStatus)[keyof typeof AssetStatus];
</file>

<file path="packages/domain/src/enums/command-status.ts">
/**
 * Represents the status of a command sent to a device
 */
export const CommandStatus = {
  Pending: "pending",
  Sent: "sent",
  Acknowledged: "acknowledged",
  Completed: "completed",
  Failed: "failed",
  Timeout: "timeout",
} as const;

export type CommandStatus = (typeof CommandStatus)[keyof typeof CommandStatus];
</file>

<file path="packages/domain/src/enums/index.ts">
// Enums barrel export
export { AssetStatus } from "./asset-status";
export { AlertSeverity } from "./alert-severity";
export { SensorType } from "./sensor-type";
export { Protocol } from "./protocol";
export { Parameter } from "./parameter";
export { ReadingQuality } from "./reading-quality";
export { CommandStatus } from "./command-status";
export { UserRole } from "./user-role";
</file>

<file path="packages/domain/src/enums/parameter.ts">
/**
 * Represents the water quality parameter being measured
 */
export const Parameter = {
  None: "none",
  // Chemical parameters
  pH: "ph",
  Chlorine: "chlorine",
  Fluoride: "fluoride",
  DissolvedOxygen: "dissolved_oxygen",

  // Physical parameters
  Turbidity: "turbidity",
  Temperature: "temperature",
  Conductivity: "conductivity",
  TDS: "tds",

  // Hydraulic parameters
  Flow: "flow",
  Pressure: "pressure",
  Level: "level",
  Vibration: "vibration",

  // Energy parameters
  Voltage: "voltage",
  Current: "current",
  Power: "power",
  Energy: "energy",
} as const;

export type Parameter = (typeof Parameter)[keyof typeof Parameter];
</file>

<file path="packages/domain/src/enums/protocol.ts">
/**
 * Represents the communication protocol used by a sensor or device
 */
export const Protocol = {
  Mqtt: "mqtt",
  OpcUa: "opc_ua",
  Modbus: "modbus",
  Http: "http",
  BACnet: "bacnet",
} as const;

export type Protocol = (typeof Protocol)[keyof typeof Protocol];
</file>

<file path="packages/domain/src/enums/reading-quality.ts">
/**
 * Represents the quality/reliability of a sensor reading
 */
export const ReadingQuality = {
  Good: "good",
  Uncertain: "uncertain",
  Bad: "bad",
  Simulated: "simulated",
} as const;

export type ReadingQuality =
  (typeof ReadingQuality)[keyof typeof ReadingQuality];
</file>

<file path="packages/domain/src/enums/sensor-type.ts">
/**
 * Represents the type of sensor
 */
export const SensorType = {
  // Chemical sensors
  pH: "ph",
  FreeChlorine: "free_chlorine",
  TotalChlorine: "total_chlorine",
  Fluoride: "fluoride",
  DissolvedOxygen: "dissolved_oxygen",

  // Physical sensors
  Turbidity: "turbidity",
  Temperature: "temperature",
  Conductivity: "conductivity",
  TotalDissolvedSolids: "total_dissolved_solids",

  // Hydraulic sensors
  FlowRate: "flow_rate",
  Pressure: "pressure",
  Level: "level",
  Vibration: "vibration",

  // Energy sensors
  VoltageMeter: "voltage_meter",
  CurrentMeter: "current_meter",
  PowerMeter: "power_meter",
  EnergyMeter: "energy_meter",

  // General
  Generic: "generic",
} as const;

export type SensorType = (typeof SensorType)[keyof typeof SensorType];
</file>

<file path="packages/domain/src/enums/user-role.ts">
/**
 * Represents the role of a user within an organization
 */
export const UserRole = {
  Admin: "admin",
  Member: "member",
  Viewer: "viewer",
} as const;

export type UserRole = (typeof UserRole)[keyof typeof UserRole];
</file>

<file path="packages/domain/src/errors/index.ts">
/**
 * Base error class for domain errors
 */
export class DomainError extends Error {
  constructor(
    message: string,
    public readonly code: string,
    public readonly statusCode: number = 500,
  ) {
    super(message);
    this.name = "DomainError";
  }
}

/**
 * Error thrown when a resource is not found
 */
export class NotFoundError extends DomainError {
  constructor(resource: string, id: string | number) {
    super(`${resource} with id '${id}' not found`, "NOT_FOUND", 404);
    this.name = "NotFoundError";
  }
}

/**
 * Error thrown when validation fails
 */
export class ValidationError extends DomainError {
  constructor(
    message: string,
    public readonly field?: string,
  ) {
    super(message, "VALIDATION_ERROR", 400);
    this.name = "ValidationError";
  }
}

/**
 * Error thrown when user is not authorized
 */
export class UnauthorizedError extends DomainError {
  constructor(message = "Unauthorized") {
    super(message, "UNAUTHORIZED", 401);
    this.name = "UnauthorizedError";
  }
}

/**
 * Error thrown when user doesn't have permission
 */
export class ForbiddenError extends DomainError {
  constructor(message = "Access forbidden") {
    super(message, "FORBIDDEN", 403);
    this.name = "ForbiddenError";
  }
}

/**
 * Error thrown when a conflict occurs (e.g., duplicate entry)
 */
export class ConflictError extends DomainError {
  constructor(message: string) {
    super(message, "CONFLICT", 409);
    this.name = "ConflictError";
  }
}
</file>

<file path="packages/domain/src/interfaces/repositories/alert.repository.ts">
import type {
  Alert,
  CreateAlertInput,
  AcknowledgeAlertInput,
  AlertQueryParams,
  AlertStats,
} from "../../models/alert";

/**
 * Repository interface for Alert operations
 */
export interface IAlertRepository {
  /**
   * Get all alerts for an organization
   */
  getAll(organizationId: string, limit?: number): Promise<Alert[]>;

  /**
   * Get alert statistics for an organization
   */
  getStats(organizationId: string): Promise<AlertStats>;

  /**
   * Query alerts with filters
   */
  query(params: AlertQueryParams): Promise<Alert[]>;

  /**
   * Get a single alert by ID
   */
  getById(id: number, organizationId: string): Promise<Alert | null>;

  /**
   * Get unacknowledged alerts
   */
  getUnacknowledged(organizationId: string): Promise<Alert[]>;

  /**
   * Create a new alert
   */
  create(input: CreateAlertInput): Promise<Alert>;

  /**
   * Acknowledge an alert
   */
  acknowledge(
    id: number,
    organizationId: string,
    input: AcknowledgeAlertInput,
  ): Promise<Alert | null>;
}
</file>

<file path="packages/domain/src/interfaces/repositories/asset.repository.ts">
import type {
  Asset,
  CreateAssetInput,
  UpdateAssetInput,
} from "../../models/asset";

/**
 * Repository interface for Asset operations
 */
export interface IAssetRepository {
  /**
   * Get all assets for an organization
   */
  getAll(organizationId: string): Promise<Asset[]>;

  /**
   * Get a single asset by ID
   */
  getById(id: number, organizationId: string): Promise<Asset | null>;

  /**
   * Get an asset with its sensors
   */
  getByIdWithSensors(id: number, organizationId: string): Promise<Asset | null>;

  /**
   * Create a new asset
   */
  create(input: CreateAssetInput): Promise<Asset>;

  /**
   * Update an existing asset
   */
  update(
    id: number,
    organizationId: string,
    input: UpdateAssetInput,
  ): Promise<Asset | null>;

  /**
   * Delete an asset
   */
  delete(id: number, organizationId: string): Promise<boolean>;

  /**
   * Update the lastSeen timestamp for an asset
   */
  updateLastSeen(id: number, organizationId: string): Promise<void>;
}
</file>

<file path="packages/domain/src/interfaces/repositories/command.repository.ts">
import type {
  Command,
  CreateCommandInput,
  UpdateCommandStatusInput,
} from "../../models/command";

/**
 * Repository interface for Command operations
 */
export interface ICommandRepository {
  /**
   * Get all commands for an organization
   */
  getAll(organizationId: string, limit?: number): Promise<Command[]>;

  /**
   * Get commands for a specific sensor
   */
  getBySensorId(sensorId: number, organizationId: string): Promise<Command[]>;

  /**
   * Get a single command by ID
   */
  getById(id: number, organizationId: string): Promise<Command | null>;

  /**
   * Get pending commands
   */
  getPending(organizationId: string): Promise<Command[]>;

  /**
   * Create a new command
   */
  create(input: CreateCommandInput): Promise<Command>;

  /**
   * Update command status
   */
  updateStatus(
    id: number,
    organizationId: string,
    input: UpdateCommandStatusInput,
  ): Promise<Command | null>;
}
</file>

<file path="packages/domain/src/interfaces/repositories/connection-credential.repository.ts">
import type {
  ConnectionCredential,
  CreateCredentialInput,
  UpdateCredentialInput,
} from "../../models/connection-credential";
import type { Protocol } from "../../enums/protocol";

/**
 * Repository interface for ConnectionCredential operations
 */
export interface IConnectionCredentialRepository {
  /**
   * Get all credentials for an organization
   */
  getAll(organizationId: string): Promise<ConnectionCredential[]>;

  /**
   * Get credentials by protocol
   */
  getByProtocol(
    protocol: Protocol,
    organizationId: string,
  ): Promise<ConnectionCredential[]>;

  /**
   * Get a single credential by ID
   */
  getById(
    id: number,
    organizationId: string,
  ): Promise<ConnectionCredential | null>;

  /**
   * Get active credentials
   */
  getActive(organizationId: string): Promise<ConnectionCredential[]>;

  /**
   * Create a new credential
   */
  create(input: CreateCredentialInput): Promise<ConnectionCredential>;

  /**
   * Update an existing credential
   */
  update(
    id: number,
    organizationId: string,
    input: UpdateCredentialInput,
  ): Promise<ConnectionCredential | null>;

  /**
   * Delete a credential
   */
  delete(id: number, organizationId: string): Promise<boolean>;
}
</file>

<file path="packages/domain/src/interfaces/repositories/index.ts">
// Repository interfaces barrel export
export type { IAssetRepository } from "./asset.repository";
export type { ISensorRepository } from "./sensor.repository";
export type { IReadingRepository } from "./reading.repository";
export type { IAlertRepository } from "./alert.repository";
export type { ICommandRepository } from "./command.repository";
export type { IUserRepository } from "./user.repository";
export type {
  IOrganizationRepository,
  IOrganizationMembershipRepository,
} from "./organization.repository";
export type { IConnectionCredentialRepository } from "./connection-credential.repository";
</file>

<file path="packages/domain/src/interfaces/repositories/organization.repository.ts">
import type {
  Organization,
  OrganizationMembership,
  UpsertOrganizationInput,
  UpsertMembershipInput,
} from "../../models/organization";

/**
 * Repository interface for Organization operations
 */
export interface IOrganizationRepository {
  /**
   * Get an organization by ID
   */
  getById(id: string): Promise<Organization | null>;

  /**
   * Get all organizations
   */
  getAll(): Promise<Organization[]>;

  /**
   * Upsert an organization (from Clerk webhook)
   */
  upsert(input: UpsertOrganizationInput): Promise<Organization>;

  /**
   * Delete an organization
   */
  delete(id: string): Promise<boolean>;
}

/**
 * Repository interface for OrganizationMembership operations
 */
export interface IOrganizationMembershipRepository {
  /**
   * Get all memberships for a user
   */
  getByUserId(userId: string): Promise<OrganizationMembership[]>;

  /**
   * Get all memberships for an organization
   */
  getByOrganizationId(
    organizationId: string,
  ): Promise<OrganizationMembership[]>;

  /**
   * Check if user is member of organization
   */
  isMember(userId: string, organizationId: string): Promise<boolean>;

  /**
   * Upsert a membership
   */
  upsert(input: UpsertMembershipInput): Promise<OrganizationMembership>;

  /**
   * Delete a membership
   */
  delete(userId: string, organizationId: string): Promise<boolean>;
}
</file>

<file path="packages/domain/src/interfaces/repositories/reading.repository.ts">
import type {
  Reading,
  CreateReadingInput,
  ReadingQueryParams,
  AggregatedReading,
  ReadingStats,
} from "../../models/reading";

/**
 * Repository interface for Reading operations
 * Optimized for high-volume time-series data
 */
export interface IReadingRepository {
  /**
   * Get recent readings for a sensor
   */
  getRecent(
    organizationId: string,
    sensorId: number,
    limit?: number,
  ): Promise<Reading[]>;

  /**
   * Query readings with filters and optional aggregation
   */
  query(params: ReadingQueryParams): Promise<Reading[]>;

  /**
   * Get aggregated readings (for dashboards)
   */
  getAggregated(params: ReadingQueryParams): Promise<AggregatedReading[]>;

  /**
   * Get the latest reading for each sensor
   */
  getLatestBySensor(
    organizationId: string,
    sensorIds: number[],
  ): Promise<Map<number, Reading>>;

  /**
   * Bulk insert readings (for MQTT ingestion)
   */
  bulkInsert(readings: CreateReadingInput[]): Promise<void>;

  /**
   * Insert a single reading
   */
  insert(reading: CreateReadingInput): Promise<Reading>;

  /**
   * Get reading statistics (total count and trends)
   */
  getStats(organizationId: string): Promise<ReadingStats>;
}
</file>

<file path="packages/domain/src/interfaces/repositories/sensor.repository.ts">
import type {
  Sensor,
  CreateSensorInput,
  UpdateSensorInput,
} from "../../models/sensor";

/**
 * Repository interface for Sensor operations
 */
export interface ISensorRepository {
  /**
   * Get all sensors for an organization
   */
  getAll(organizationId: string): Promise<Sensor[]>;

  /**
   * Get all sensors in the system (across all organizations)
   * Used for background workers
   */
  getAllSystemSensors(): Promise<Sensor[]>;

  /**
   * Get all sensors for a specific asset
   */
  getByAssetId(assetId: number, organizationId: string): Promise<Sensor[]>;

  /**
   * Get a single sensor by ID
   */
  getById(id: number, organizationId: string): Promise<Sensor | null>;

  /**
   * Get sensors that are active
   */
  getActive(organizationId: string): Promise<Sensor[]>;

  /**
   * Create a new sensor
   */
  create(input: CreateSensorInput): Promise<Sensor>;

  /**
   * Update an existing sensor
   */
  update(
    id: number,
    organizationId: string,
    input: UpdateSensorInput,
  ): Promise<Sensor | null>;

  /**
   * Delete a sensor
   */
  delete(id: number, organizationId: string): Promise<boolean>;
}
</file>

<file path="packages/domain/src/interfaces/repositories/user.repository.ts">
import type { User, UpsertUserInput } from "../../models/user";

/**
 * Repository interface for User operations
 */
export interface IUserRepository {
  /**
   * Get a user by ID
   */
  getById(id: string): Promise<User | null>;

  /**
   * Get a user by email
   */
  getByEmail(email: string): Promise<User | null>;

  /**
   * Upsert a user (from Clerk webhook)
   */
  upsert(input: UpsertUserInput): Promise<User>;

  /**
   * Delete a user
   */
  delete(id: string): Promise<boolean>;
}
</file>

<file path="packages/domain/src/interfaces/services/encryption.service.ts">
/**
 * Service interface for encrypting/decrypting sensitive data
 */
export interface IEncryptionService {
  /**
   * Encrypt a plain text value
   * @returns Object containing the encrypted value and IV
   */
  encrypt(plainText: string): { encryptedValue: string; iv: string };

  /**
   * Decrypt an encrypted value
   */
  decrypt(encryptedValue: string, iv: string): string;
}
</file>

<file path="packages/domain/src/interfaces/services/index.ts">
// Service interfaces barrel export
export type { INotificationService } from "./notification.service";
export type { IEncryptionService } from "./encryption.service";
</file>

<file path="packages/domain/src/interfaces/services/notification.service.ts">
import type { Alert } from "../../models/alert";
import type { Reading } from "../../models/reading";

/**
 * Service interface for sending real-time notifications via WebSocket
 */
export interface INotificationService {
  /**
   * Send a sensor reading update to connected clients
   */
  sendSensorReading(reading: Reading, organizationId: string): Promise<void>;

  /**
   * Send an alert notification to connected clients
   */
  sendAlert(alert: Alert, organizationId: string): Promise<void>;

  /**
   * Send device status change notification
   */
  sendDeviceStatus(
    deviceId: number,
    status: string,
    organizationId: string,
  ): Promise<void>;
}
</file>

<file path="packages/domain/src/interfaces/index.ts">
// Interfaces barrel export
export * from "./repositories/index";
export * from "./services/index";
</file>

<file path="packages/domain/src/models/alert.ts">
import type { AlertSeverity } from "../enums/alert-severity";
import type { Protocol } from "../enums/protocol";
import type { Sensor } from "./sensor";

/**
 * Represents an alert triggered when sensor readings exceed thresholds
 */
export interface Alert {
  id: number;
  sensorId: number;
  organizationId: string;
  timestamp: Date;
  severity: AlertSeverity;
  message: string;
  triggerValue: number;
  thresholdValue: number | null;
  acknowledged: boolean;
  acknowledgedAt: Date | null;
  acknowledgedBy: string | null;
  notes: string | null;
  protocol: Protocol;
  metadata: Record<string, string>;

  // Navigation property
  sensor?: Sensor;
}

/**
 * Input type for creating a new alert
 */
export interface CreateAlertInput {
  sensorId: number;
  organizationId: string;
  severity: AlertSeverity;
  message: string;
  triggerValue: number;
  thresholdValue?: number | null;
  protocol?: Protocol;
  metadata?: Record<string, string>;
}

/**
 * Input type for acknowledging an alert
 */
export interface AcknowledgeAlertInput {
  acknowledgedBy: string;
  notes?: string | null;
}

/**
 * Query parameters for fetching alerts
 */
export interface AlertQueryParams {
  organizationId: string;
  sensorId?: number;
  severity?: AlertSeverity;
  acknowledged?: boolean;
  startTime?: Date;
  endTime?: Date;
  limit?: number;
}

/**
 * Statistics for alerts
 */
export interface AlertStats {
  total: number;
  bySeverity: Record<AlertSeverity, number>;
  byStatus: {
    acknowledged: number;
    unacknowledged: number;
  };
  trends: {
    daily: number; // Percentage change vs yesterday
    weekly: number; // Percentage change vs last week
    critical: number; // Percentage change for critical/emergency vs yesterday
  };
  recentTrend: {
    date: string;
    count: number;
    severity: AlertSeverity;
  }[];
}
</file>

<file path="packages/domain/src/models/asset.ts">
import type { AssetStatus } from "../enums/asset-status";
import type { Sensor } from "./sensor";

/**
 * Represents an industrial asset (machine, equipment, facility) being monitored
 */
export interface Asset {
  id: number;
  organizationId: string;
  name: string;
  type: string; // e.g., "Pump", "Tank", "Valve", "Compressor"
  location: string;
  status: AssetStatus;
  lastSeen: Date | null;
  description: string | null;
  manufacturer: string | null;
  modelNumber: string | null;
  installationDate: Date | null;
  metadata: Record<string, string>;

  // Navigation property
  sensors?: Sensor[];
}

/**
 * Input type for creating a new asset
 */
export interface CreateAssetInput {
  organizationId: string;
  name: string;
  type: string;
  location?: string;
  status?: AssetStatus;
  description?: string | null;
  manufacturer?: string | null;
  modelNumber?: string | null;
  installationDate?: Date | null;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating an existing asset
 */
export interface UpdateAssetInput {
  name?: string;
  type?: string;
  location?: string;
  status?: AssetStatus;
  description?: string | null;
  manufacturer?: string | null;
  modelNumber?: string | null;
  installationDate?: Date | null;
  metadata?: Record<string, string>;
}
</file>

<file path="packages/domain/src/models/command.ts">
import type { CommandStatus } from "../enums/command-status";
import type { Protocol } from "../enums/protocol";
import type { Sensor } from "./sensor";

/**
 * Represents a command sent to a device/sensor
 */
export interface Command {
  id: number;
  sensorId: number;
  organizationId: string;
  userId: string;
  action: string; // e.g., "TURN_ON", "TURN_OFF", "SET_INTERVAL", "CALIBRATE"
  parameters: Record<string, unknown>;
  status: CommandStatus;
  protocol: Protocol;
  createdAt: Date;
  sentAt: Date | null;
  completedAt: Date | null;
  errorMessage: string | null;
  metadata: Record<string, string>;

  // Navigation property
  sensor?: Sensor;
}

/**
 * Input type for creating a new command
 */
export interface CreateCommandInput {
  sensorId: number;
  organizationId: string;
  userId: string;
  action: string;
  parameters?: Record<string, unknown>;
  protocol?: Protocol;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating command status
 */
export interface UpdateCommandStatusInput {
  status: CommandStatus;
  errorMessage?: string | null;
}
</file>

<file path="packages/domain/src/models/connection-credential.ts">
import type { Protocol } from "../enums/protocol";

/**
 * Represents connection credentials for external services (MQTT brokers, etc.)
 */
export interface ConnectionCredential {
  id: number;
  organizationId: string;
  name: string;
  protocol: Protocol;
  endpointUri: string;
  username: string;
  encryptedPassword: string;
  encryptionIV: string;
  clientId: string | null;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
  metadata: Record<string, string>;
}

/**
 * Input type for creating connection credentials
 */
export interface CreateCredentialInput {
  organizationId: string;
  name: string;
  protocol: Protocol;
  endpointUri: string;
  username: string;
  password: string; // Plain text, will be encrypted
  clientId?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating connection credentials
 */
export interface UpdateCredentialInput {
  name?: string;
  endpointUri?: string;
  username?: string;
  password?: string; // Plain text, will be encrypted
  clientId?: string | null;
  isActive?: boolean;
  metadata?: Record<string, string>;
}
</file>

<file path="packages/domain/src/models/index.ts">
// Models barrel export
export type { Asset, CreateAssetInput, UpdateAssetInput } from "./asset";

export type { Sensor, CreateSensorInput, UpdateSensorInput } from "./sensor";

export type {
  Reading,
  CreateReadingInput,
  ReadingStats,
  ReadingQueryParams,
  AggregatedReading,
} from "./reading";

export type {
  Alert,
  CreateAlertInput,
  AcknowledgeAlertInput,
  AlertQueryParams,
  AlertStats,
} from "./alert";

export type {
  Command,
  CreateCommandInput,
  UpdateCommandStatusInput,
} from "./command";

export type { User, UpsertUserInput } from "./user";

export type {
  Organization,
  OrganizationMembership,
  UpsertOrganizationInput,
  UpsertMembershipInput,
} from "./organization";

export type {
  ConnectionCredential,
  CreateCredentialInput,
  UpdateCredentialInput,
} from "./connection-credential";
</file>

<file path="packages/domain/src/models/organization.ts">
import type { UserRole } from "../enums/user-role";
import type { User } from "./user";

/**
 * Represents an organization (synced from Clerk)
 */
export interface Organization {
  id: string; // Clerk organization ID
  name: string;
  slug: string | null;
  imageUrl: string | null;
  ownerId: string;
  createdAt: Date;
  updatedAt: Date;

  // Navigation property
  memberships?: OrganizationMembership[];
}

/**
 * Represents a user's membership in an organization
 */
export interface OrganizationMembership {
  userId: string;
  organizationId: string;
  role: UserRole;
  createdAt: Date;

  // Navigation properties
  user?: User;
  organization?: Organization;
}

/**
 * Input type for creating/updating an organization (from Clerk webhook)
 */
export interface UpsertOrganizationInput {
  id: string;
  name: string;
  slug?: string | null;
  imageUrl?: string | null;
  ownerId: string;
}

/**
 * Input type for managing organization membership
 */
export interface UpsertMembershipInput {
  userId: string;
  organizationId: string;
  role: UserRole;
}
</file>

<file path="packages/domain/src/models/reading.ts">
import type { Parameter } from "../enums/parameter";
import type { Protocol } from "../enums/protocol";
import type { ReadingQuality } from "../enums/reading-quality";
import type { Sensor } from "./sensor";

/**
 * Represents a single time-series reading from a sensor
 */
export interface Reading {
  sensorId: number;
  organizationId: string;
  timestamp: Date;
  value: number;
  parameter: Parameter;
  protocol: Protocol;
  quality: ReadingQuality;
  notes: string | null;
  metadata: Record<string, string>;

  // Navigation property
  sensor?: Sensor;
}

/**
 * Input type for creating a new reading (from MQTT ingestion)
 */
export interface CreateReadingInput {
  sensorId: number;
  organizationId: string;
  timestamp?: Date;
  value: number;
  parameter: Parameter;
  protocol: Protocol;
  quality?: ReadingQuality;
  notes?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Query parameters for fetching readings
 */
export interface ReadingQueryParams {
  sensorId?: number;
  organizationId: string;
  startTime?: Date;
  endTime?: Date;
  limit?: number;
  aggregation?: "raw" | "avg" | "min" | "max" | "count";
  bucketInterval?: string; // e.g., '1 hour', '1 day'
}

/**
 * Aggregated reading result
 */
export interface AggregatedReading {
  bucket: Date;
  sensorId: number;
  avg: number | null;
  min: number | null;
  max: number | null;
  count: number;
}

/**
 * Readings statistics
 */
export interface ReadingStats {
  total: number;
  dailyTrend: number; // Percentage change vs yesterday
  qualityScore: number; // Percentage of 'good' readings (0-100)
  trends: {
    bucket: string;
    count: number;
  }[];
}
</file>

<file path="packages/domain/src/models/sensor.ts">
import type { SensorType } from "../enums/sensor-type";
import type { Parameter } from "../enums/parameter";
import type { Protocol } from "../enums/protocol";
import type { Asset } from "./asset";
import type { Reading } from "./reading";
import type { Alert } from "./alert";
import type { Command } from "./command";

/**
 * Represents a sensor attached to an asset
 */
export interface Sensor {
  id: number;
  assetId: number;
  organizationId: string;
  name: string;
  type: SensorType;
  parameter: Parameter;
  unit: string; // e.g., "°C", "PSI", "Hz", "L/min"
  thresholdLow: number | null;
  thresholdHigh: number | null;
  minValue: number | null;
  maxValue: number | null;
  samplingIntervalMs: number; // Default 1000 (1 second)
  isActive: boolean;
  protocol: Protocol;
  description: string | null;
  metadata: Record<string, string>;

  // Navigation properties
  asset?: Asset;
  readings?: Reading[];
  alerts?: Alert[];
  commands?: Command[];
}

/**
 * Input type for creating a new sensor
 */
export interface CreateSensorInput {
  assetId: number;
  organizationId: string;
  name: string;
  type: SensorType;
  parameter: Parameter;
  unit: string;
  thresholdLow?: number | null;
  thresholdHigh?: number | null;
  minValue?: number | null;
  maxValue?: number | null;
  samplingIntervalMs?: number;
  isActive?: boolean;
  protocol: Protocol;
  description?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating an existing sensor
 */
export interface UpdateSensorInput {
  name?: string;
  type?: SensorType;
  parameter?: Parameter;
  unit?: string;
  thresholdLow?: number | null;
  thresholdHigh?: number | null;
  minValue?: number | null;
  maxValue?: number | null;
  samplingIntervalMs?: number;
  isActive?: boolean;
  protocol?: Protocol;
  description?: string | null;
  metadata?: Record<string, string>;
}
</file>

<file path="packages/domain/src/models/user.ts">
import type { OrganizationMembership } from "./organization";

/**
 * Represents a user in the system (synced from Clerk)
 */
export interface User {
  id: string; // Clerk user ID
  email: string;
  username: string | null;
  firstName: string | null;
  lastName: string | null;
  imageUrl: string | null;
  createdAt: Date;
  updatedAt: Date;

  // Navigation property
  memberships?: OrganizationMembership[];
}

/**
 * Input type for creating/updating a user (from Clerk webhook)
 */
export interface UpsertUserInput {
  id: string;
  email: string;
  username?: string | null;
  firstName?: string | null;
  lastName?: string | null;
  imageUrl?: string | null;
}
</file>

<file path="packages/domain/src/schemas/index.ts">
import { z } from "zod";
import { Parameter } from "../enums/parameter";
import { Protocol } from "../enums/protocol";
import { SensorType } from "../enums/sensor-type";
import { ReadingQuality } from "../enums/reading-quality";
import { AssetStatus } from "../enums/asset-status";

// Common schemas
export const IdParamSchema = z.object({
  id: z
    .string()
    .refine((val) => !isNaN(parseInt(val, 10)), {
      message: "ID must be a number",
    })
    .transform((val) => parseInt(val, 10)),
});

export const AssetIdParamSchema = z.object({
  assetId: z
    .string()
    .refine((val) => !isNaN(parseInt(val, 10)), {
      message: "Asset ID must be a number",
    })
    .transform((val) => parseInt(val, 10)),
});

// Asset schemas
export const CreateAssetSchema = z.object({
  name: z.string().min(1, "Name is required"),
  type: z.string().min(1, "Type is required"),
  location: z.string().optional(),
  status: z.nativeEnum(AssetStatus).optional(),
  description: z.string().nullable().optional(),
  manufacturer: z.string().nullable().optional(),
  modelNumber: z.string().nullable().optional(),
  installationDate: z
    .string()
    .datetime()
    .optional()
    .transform((v) => (v ? new Date(v) : undefined)),
  metadata: z.record(z.string()).optional(),
});

export const UpdateAssetSchema = z.object({
  name: z.string().min(1, "Name is required").optional(),
  type: z.string().optional(),
  location: z.string().optional(),
  status: z.nativeEnum(AssetStatus).optional(),
  description: z.string().nullable().optional(),
  manufacturer: z.string().nullable().optional(),
  modelNumber: z.string().nullable().optional(),
  installationDate: z
    .string()
    .datetime()
    .optional()
    .transform((v) => (v ? new Date(v) : undefined)),
  metadata: z.record(z.string()).optional(),
});

// Sensor schemas
export const CreateSensorSchema = z.object({
  assetId: z.number().int().positive(),
  name: z.string().min(1, "Name is required"),
  type: z.nativeEnum(SensorType),
  parameter: z.nativeEnum(Parameter),
  unit: z.string().min(1, "Unit is required"),
  thresholdLow: z.number().nullable().optional(),
  thresholdHigh: z.number().nullable().optional(),
  minValue: z.number().nullable().optional(),
  maxValue: z.number().nullable().optional(),
  samplingIntervalMs: z.number().int().positive().default(1000),
  isActive: z.boolean().default(true),
  protocol: z.nativeEnum(Protocol),
  description: z.string().nullable().optional(),
  metadata: z.record(z.string()).optional(),
});

export const UpdateSensorSchema = z.object({
  name: z.string().min(1).optional(),
  type: z.nativeEnum(SensorType).optional(),
  parameter: z.nativeEnum(Parameter).optional(),
  unit: z.string().optional(),
  thresholdLow: z.number().nullable().optional(),
  thresholdHigh: z.number().nullable().optional(),
  minValue: z.number().nullable().optional(),
  maxValue: z.number().nullable().optional(),
  samplingIntervalMs: z.number().int().positive().optional(),
  isActive: z.boolean().optional(),
  protocol: z.nativeEnum(Protocol).optional(),
  description: z.string().nullable().optional(),
  metadata: z.record(z.string()).optional(),
});

// Reading schemas
export const CreateReadingSchema = z.object({
  sensorId: z.number().int().positive(),
  timestamp: z
    .string()
    .datetime()
    .optional()
    .transform((v) => (v ? new Date(v) : undefined)),
  value: z.number(),
  parameter: z.nativeEnum(Parameter),
  protocol: z.nativeEnum(Protocol),
  quality: z.nativeEnum(ReadingQuality).optional(),
  notes: z.string().nullable().optional(),
  metadata: z.record(z.string()).optional(),
});
</file>

<file path="packages/domain/src/index.ts">
// @moondesk/domain - Core domain package
// Pure TypeScript types, interfaces, and business logic with no external dependencies

// Enums
export * from "./enums/index";

// Models
export * from "./models/index";

// Interfaces (repositories & services)
export * from "./interfaces/index";

// Schemas (Zod)
export * from "./schemas/index";

// Errors
export * from "./errors/index";
</file>

<file path="packages/domain/package.json">
{
  "name": "@moondesk/domain",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./src/index.ts",
  "types": "./src/index.ts",
  "exports": {
    ".": {
      "types": "./src/index.ts",
      "default": "./src/index.ts"
    },
    "./models": {
      "types": "./src/models/index.ts",
      "default": "./src/models/index.ts"
    },
    "./enums": {
      "types": "./src/enums/index.ts",
      "default": "./src/enums/index.ts"
    },
    "./interfaces": {
      "types": "./src/interfaces/index.ts",
      "default": "./src/interfaces/index.ts"
    }
  },
  "scripts": {
    "check-types": "tsc --noEmit",
    "lint": "eslint src/"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:*",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "eslint": "^9.15.0",
    "typescript": "5.9.2"
  },
  "dependencies": {
    "zod": "^3.24.2"
  }
}
</file>

<file path="packages/logger/src/index.ts">
import pino, { type Logger } from "pino";

const isDevelopment = process.env["NODE_ENV"] !== "production";

/**
 * Create a Pino logger instance with appropriate configuration
 */
export function createLogger(name: string): Logger {
  return pino({
    name,
    level: process.env["LOG_LEVEL"] ?? (isDevelopment ? "debug" : "info"),
    transport: isDevelopment
      ? {
          target: "pino-pretty",
          options: {
            colorize: true,
            translateTime: "SYS:standard",
            ignore: "pid,hostname",
          },
        }
      : undefined,
    formatters: {
      level: (label: string) => ({ level: label }),
    },
    base: {
      env: process.env["NODE_ENV"] ?? "development",
    },
  });
}

/**
 * Default application logger
 */
export const logger = createLogger("moondesk");

/**
 * Create a child logger with additional context
 */
export function createChildLogger(
  parent: Logger,
  context: Record<string, unknown>,
): Logger {
  return parent.child(context);
}

// Re-export pino types
export type { Logger } from "pino";
</file>

<file path="packages/logger/package.json">
{
    "name": "@moondesk/logger",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "main": "./src/index.ts",
    "types": "./src/index.ts",
    "exports": {
        ".": {
            "types": "./src/index.ts",
            "default": "./src/index.ts"
        }
    },
    "scripts": {
        "check-types": "tsc --noEmit",
        "lint": "eslint src/"
    },
    "dependencies": {
        "pino": "^10.1.0",
        "pino-pretty": "^13.1.3"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:*",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "eslint": "^9.15.0",
        "typescript": "5.9.2"
    }
}
</file>

<file path="README.md">
# Moondesk

Moondesk is a comprehensive IoT Dashboard and Edge Simulation platform built as a monorepo using [Turborepo](https://turbo.build/repo). It provides a full stack solution for managing, monitoring, and simulating IoT devices.

## Architecture

The project is structured as a monorepo with the following components:

### Apps (`/apps`)

- **`moondesk-dash`**: The main dashboard application built with [Next.js](https://nextjs.org/). It provides the user interface for monitoring assets, managing organizations, and visualizing data.
- **`@moondesk/api`**: The backend API service (Node.js/Fastify) that handles data ingestion, user management, and communication with the database and message broker.
- **`edge-simulator`**: A CLI/Service built with TypeScript that simulates edge devices, generating telemetry data for testing and development.
- **`mqtt-worker`**: A dedicated worker service for handling high-throughput MQTT messages and processing telemetry data.
- **`docs`**: Project documentation site built with Next.js.

### Packages (`/packages`)

Shared libraries used across the applications:

- **`@moondesk/database`**: Database schema, migrations (Prisma/TimescaleDB), and repository patterns.
- **`@moondesk/domain`**: Shared domain types, interfaces, and business logic definitions.
- **`@moondesk/config`**: Centralized configuration management.
- **`@moondesk/logger`**: shared logging utilities.
- **`@moondesk/ui`**: Shared UI component library.
- **`@moondesk/eslint-config`**: Shared ESLint configurations.
- **`@moondesk/typescript-config`**: Shared TSConfig bases.

## Prerequisites

- **Node.js**: >= 18
- **pnpm**: >= 9
- **Docker & Docker Compose**: For running infrastructure services (TimescaleDB, Mosquitto, Redis).

## Getting Started

1. **Clone the repository:**

   ```bash
   git clone <repository-url>
   cd moondesk
   ```

2. **Install dependencies:**

   ```bash
   pnpm install
   ```

3. **Start Infrastructure:**
   Spin up the required database and message broker services using Docker Compose.

   ```bash
   docker-compose up -d
   ```

4. **Run Development Server:**
   Start all applications in development mode.

   ```bash
   pnpm dev
   ```

   - Dashboard: [http://localhost:3000](http://localhost:3000)
   - API: [http://localhost:3001](http://localhost:3001) (check logs for exact port)
   - Documentation: [http://localhost:3002](http://localhost:3002)

## Common Commands

- **Build**: `pnpm build` - Builds all apps and packages.
- **Lint**: `pnpm lint` - Lints all workspaces.
- **Test**: `pnpm test` - Runs tests across the monorepo.
- **Development**: `pnpm dev` - Starts the development environment.

## Environment Variables

Check `.env.example` in respective applications for required environment variables. Ensure `globalEnv` in `turbo.json` is updated if adding new shared environment variables.

## License

Not set yet
</file>

<file path="turbo.json">
{
  "$schema": "https://turborepo.com/schema.json",
  "ui": "tui",
  "globalEnv": [
    "NODE_ENV",
    "LOG_LEVEL",
    "DATABASE_URL",
    "CORS_ORIGINS",
    "API_URL",
    "INTERNAL_SERVICE_TOKEN"
  ],
  "tasks": {
    "build": {
      "dependsOn": [
        "^build"
      ],
      "inputs": [
        "$TURBO_DEFAULT$",
        ".env*"
      ],
      "outputs": [
        "dist/**",
        ".next/**",
        "!.next/cache/**"
      ]
    },
    "lint": {
      "dependsOn": [
        "^lint"
      ]
    },
    "test": {
      "dependsOn": [
        "^build"
      ]
    },
    "check-types": {
      "dependsOn": [
        "^check-types"
      ]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
</file>

<file path="packages/database/src/repositories/asset.repository.ts">
import { eq, and, desc } from "drizzle-orm";
import type {
  Asset,
  CreateAssetInput,
  UpdateAssetInput,
} from "@moondesk/domain";
import type { IAssetRepository } from "@moondesk/domain";
import { getDb } from "../client";
import { assets, sensors } from "../schema/index";
import { AssetStatus } from "@moondesk/domain";

/**
 * Asset repository implementation using Drizzle ORM
 */
export class AssetRepository implements IAssetRepository {
  private db = getDb();

  async getAll(organizationId: string): Promise<Asset[]> {
    const results = await this.db
      .select()
      .from(assets)
      .where(eq(assets.organizationId, organizationId))
      .orderBy(desc(assets.createdAt));

    return results.map(this.mapToAsset);
  }

  async getById(id: number, organizationId: string): Promise<Asset | null> {
    const results = await this.db
      .select()
      .from(assets)
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)))
      .limit(1);

    return results[0] ? this.mapToAsset(results[0]) : null;
  }

  async getByIdWithSensors(
    id: number,
    organizationId: string,
  ): Promise<Asset | null> {
    const asset = await this.getById(id, organizationId);
    if (!asset) return null;

    const sensorResults = await this.db
      .select()
      .from(sensors)
      .where(eq(sensors.assetId, id));

    return {
      ...asset,
      sensors: sensorResults.map((s) => ({
        id: s.id,
        assetId: s.assetId,
        organizationId,
        name: s.name,
        type: s.type as import("@moondesk/domain").SensorType,
        parameter: s.parameter as import("@moondesk/domain").Parameter,
        unit: s.unit,
        thresholdLow: s.thresholdLow,
        thresholdHigh: s.thresholdHigh,
        minValue: s.minValue,
        maxValue: s.maxValue,
        samplingIntervalMs: s.samplingIntervalMs,
        isActive: s.isActive,
        protocol: s.protocol as import("@moondesk/domain").Protocol,
        description: s.description,
        metadata: s.metadata ?? {},
      })),
    };
  }

  async create(input: CreateAssetInput): Promise<Asset> {
    const results = await this.db
      .insert(assets)
      .values({
        organizationId: input.organizationId,
        name: input.name,
        type: input.type,
        location: input.location,
        status: input.status ?? AssetStatus.Unknown,
        description: input.description,
        manufacturer: input.manufacturer,
        modelNumber: input.modelNumber,
        installationDate: input.installationDate,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToAsset(results[0]!);
  }

  async update(
    id: number,
    organizationId: string,
    input: UpdateAssetInput,
  ): Promise<Asset | null> {
    const results = await this.db
      .update(assets)
      .set({
        ...input,
        updatedAt: new Date(),
      })
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)))
      .returning();

    return results[0] ? this.mapToAsset(results[0]) : null;
  }

  async delete(id: number, organizationId: string): Promise<boolean> {
    const result = await this.db
      .delete(assets)
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)))
      .returning({ id: assets.id });

    return result.length > 0;
  }

  async updateLastSeen(id: number, organizationId: string): Promise<void> {
    await this.db
      .update(assets)
      .set({
        lastSeen: new Date(),
        status: AssetStatus.Online,
        updatedAt: new Date(),
      })
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)));
  }

  private mapToAsset(record: typeof assets.$inferSelect): Asset {
    return {
      id: record.id,
      organizationId: record.organizationId,
      name: record.name,
      type: record.type,
      location: record.location,
      status: record.status as import("@moondesk/domain").AssetStatus,
      lastSeen: record.lastSeen,
      description: record.description,
      manufacturer: record.manufacturer,
      modelNumber: record.modelNumber,
      installationDate: record.installationDate,
      metadata: record.metadata ?? {},
    };
  }
}
</file>

<file path="packages/database/package.json">
{
    "name": "@moondesk/database",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "main": "./src/index.ts",
    "types": "./src/index.ts",
    "exports": {
        ".": {
            "types": "./src/index.ts",
            "default": "./src/index.ts"
        },
        "./schema": {
            "types": "./src/schema/index.ts",
            "default": "./src/schema/index.ts"
        },
        "./repositories": {
            "types": "./src/repositories/index.ts",
            "default": "./src/repositories/index.ts"
        }
    },
    "scripts": {
        "check-types": "tsc --noEmit",
        "lint": "eslint src/",
        "db:generate": "drizzle-kit generate",
        "db:migrate": "drizzle-kit migrate",
        "db:push": "drizzle-kit push",
        "db:studio": "drizzle-kit studio"
    },
    "dependencies": {
        "@moondesk/domain": "workspace:*",
        "@types/pg": "^8.16.0",
        "drizzle-orm": "^0.45.0",
        "pg": "^8.16.3"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:*",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "drizzle-kit": "^0.30.1",
        "eslint": "^9.15.0",
        "typescript": "5.9.2"
    }
}
</file>

</files>
````

## File: .husky/pre-commit
````
#!/bin/sh
branch_name=$(git symbolic-ref --short HEAD)

if [ "$branch_name" = "main" ] || [ "$branch_name" = "master" ]; then
  echo "❌ Error: Direct commits to $branch_name are not allowed."
  echo "Please create a new branch following the convention: mndsk-<number>-<title>"
  exit 1
fi

if ! echo "$branch_name" | grep -qE '^mndsk-[0-9]+-.+$'; then
  echo "❌ Error: Branch name '$branch_name' does not follow the convention."
  echo "Required format: mndsk-<number>-<title> (e.g., mndsk-38-data-repositories)"
  echo "This naming convention is required to link commits to Linear tickets."
  exit 1
fi
````

## File: .husky/pre-push
````
#!/bin/sh
while read local_ref local_sha remote_ref remote_sha
do
    if [ "$remote_ref" = "refs/heads/main" ] || [ "$remote_ref" = "refs/heads/master" ]; then
        echo "❌ Error: Direct pushes to main/master are not allowed."
        echo "Please push to a feature branch and create a Pull Request."
        exit 1
    fi
done

exit 0
````

## File: apps/docs/app/globals.css
````css
:root {
  --background: #ffffff;
  --foreground: #171717;
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

html,
body {
  max-width: 100vw;
  overflow-x: hidden;
}

body {
  color: var(--foreground);
  background: var(--background);
}

* {
  box-sizing: border-box;
  padding: 0;
  margin: 0;
}

a {
  color: inherit;
  text-decoration: none;
}

.imgDark {
  display: none;
}

@media (prefers-color-scheme: dark) {
  html {
    color-scheme: dark;
  }

  .imgLight {
    display: none;
  }
  .imgDark {
    display: unset;
  }
}
````

## File: apps/docs/app/layout.tsx
````typescript
import type { Metadata } from "next";
import localFont from "next/font/local";
import "./globals.css";

const geistSans = localFont({
  src: "./fonts/GeistVF.woff",
  variable: "--font-geist-sans",
});
const geistMono = localFont({
  src: "./fonts/GeistMonoVF.woff",
  variable: "--font-geist-mono",
});

export const metadata: Metadata = {
  title: "Create Next App",
  description: "Generated by create next app",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en">
      <body className={`${geistSans.variable} ${geistMono.variable}`}>
        {children}
      </body>
    </html>
  );
}
````

## File: apps/docs/app/page.module.css
````css
.page {
  padding: 2rem;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
    Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
  line-height: 1.6;
}

.main {
  max-width: 800px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

.header {
  border-bottom: 1px solid #eaeaea;
  padding-bottom: 1rem;
}

.header h1 {
  font-size: 2.5rem;
  margin: 0;
}

.section {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.section h2 {
  font-size: 2rem;
  margin: 0;
  border-bottom: 1px solid #ccc;
  padding-bottom: 0.5rem;
}

.section h3 {
  font-size: 1.5rem;
  margin: 0;
}

.section ul,
.section ol {
  padding-left: 20px;
  margin: 0;
}

.section ul ul {
  padding-left: 20px;
  margin-top: 0.5rem;
}

.section li {
  margin-bottom: 0.5rem;
}

.section p,
.section li {
  color: #333;
}

@media (prefers-color-scheme: dark) {
  .page {
    background-color: #1a1a1a;
    color: #f0f0f0;
  }

  .header {
    border-bottom-color: #333;
  }

  .section h2 {
    border-bottom-color: #444;
  }

  .section p,
  .section li {
    color: #ccc;
  }
}
````

## File: apps/docs/app/page.tsx
````typescript
import styles from "./page.module.css";

export default function Home() {
  return (
    <div className={styles.page}>
      <main className={styles.main}>
        <header className={styles.header}>
          <h1>Moondesk Documentation</h1>
          <p>
            Welcome to the official documentation for Moondesk, a scalable,
            protocol-agnostic IoT platform.
          </p>
        </header>

        <section id="overview" className={styles.section}>
          <h2>Project Overview</h2>
          <p>
            Moondesk is designed to handle high-throughput data ingestion,
            real-time analytics, and device management for IoT ecosystems.
          </p>
        </section>

        <section id="architecture" className={styles.section}>
          <h2>System Architecture</h2>
          <p>
            The system follows an event-driven microservices architecture. Below
            is a brief overview of the key components:
          </p>
          <ul>
            <li>
              <strong>Edge Devices</strong>: Simulate or real devices sending
              data via MQTT.
            </li>
            <li>
              <strong>Broker (Mosquitto)</strong>: Handles MQTT messsaging.
            </li>
            <li>
              <strong>Worker (MQTT Worker)</strong>: Subscribes to broker,
              processes ingestion, and broadcasts &quot;hot&quot; data to API.
            </li>
            <li>
              <strong>API (Fastify)</strong>: REST & WebSocket API for frontend
              clients. Handles command dispatching and real-time updates.
            </li>
            <li>
              <strong>Storage</strong>:
              <ul>
                <li>
                  <strong>TimescaleDB (PostgreSQL)</strong>: Time-series data
                  (sensor readings).
                </li>
                <li>
                  <strong>Redis</strong>: Caching, pub/sub for scaling
                  WebSockets, and short-term state.
                </li>
              </ul>
            </li>
            <li>
              <strong>Frontend (Next.js)</strong>: Dashboard for visualization
              and admin controls.
            </li>
          </ul>
        </section>

        <section id="repo-structure" className={styles.section}>
          <h2>Repository Structure</h2>
          <p>
            This is a Monorepo managed by <strong>Turbo</strong> and{" "}
            <strong>pnpm</strong> workspaces.
          </p>
          <h3>apps/</h3>
          <ul>
            <li>
              <strong>api</strong>: Fastify backend.
            </li>
            <li>
              <strong>mqtt-worker</strong>: Node.js worker for MQTT traffic.
            </li>
            <li>
              <strong>edge-simulator</strong>: Tool to generate synthetic load.
            </li>
            <li>
              <strong>moondesk-dash</strong>: Next.js frontend application.
            </li>
            <li>
              <strong>docs</strong>: This documentation site.
            </li>
          </ul>
          <h3>packages/</h3>
          <ul>
            <li>
              <strong>config</strong>: Shared configuration (env vars, schemas).
            </li>
            <li>
              <strong>database</strong>: Drizzle ORM schemas.
            </li>
            <li>
              <strong>domain</strong>: Shared interfaces, types, and Models.
            </li>
            <li>
              <strong>logger</strong>: Standardized Pino logger.
            </li>
            <li>
              <strong>ui</strong>: Shared React UI components.
            </li>
            <li>
              <strong>typescript-config</strong>: Shared `tsconfig.json` bases.
            </li>
          </ul>
        </section>

        <section id="tech-stack" className={styles.section}>
          <h2>Technology Stack</h2>
          <ul>
            <li>
              <strong>Runtime</strong>: Node.js (v20+), strictly TypeScript.
            </li>
            <li>
              <strong>Package Manager</strong>: pnpm (Corepack enabled).
            </li>
            <li>
              <strong>Build System</strong>: Turbo and tsup.
            </li>
            <li>
              <strong>Database</strong>: PostgreSQL with TimescaleDB.
            </li>
            <li>
              <strong>ORM</strong>: Drizzle ORM.
            </li>
            <li>
              <strong>Auth</strong>: Clerk and Internal Tokens.
            </li>
            <li>
              <strong>Infrastructure</strong>: Docker Compose.
            </li>
          </ul>
        </section>

        <section id="dev-philosophy" className={styles.section}>
          <h2>Development Philosophy</h2>
          <ol>
            <li>
              <strong>Strict Types</strong>: No `any` is allowed.
            </li>
            <li>
              <strong>Docker First</strong>: The entire backend stack runs in
              Docker.
            </li>
            <li>
              <strong>Branch Protection</strong>: `main` is protected. Work on
              `develop` or feature branches.
            </li>
            <li>
              <strong>Environment Variables</strong>: Validated with Zod.
            </li>
          </ol>
        </section>
      </main>
    </div>
  );
}
````

## File: apps/docs/public/file-text.svg
````xml
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 13.5V6.5V5.41421C14.5 5.149 14.3946 4.89464 14.2071 4.70711L9.79289 0.292893C9.60536 0.105357 9.351 0 9.08579 0H8H3H1.5V1.5V13.5C1.5 14.8807 2.61929 16 4 16H12C13.3807 16 14.5 14.8807 14.5 13.5ZM13 13.5V6.5H9.5H8V5V1.5H3V13.5C3 14.0523 3.44772 14.5 4 14.5H12C12.5523 14.5 13 14.0523 13 13.5ZM9.5 5V2.12132L12.3787 5H9.5ZM5.13 5.00062H4.505V6.25062H5.13H6H6.625V5.00062H6H5.13ZM4.505 8H5.13H11H11.625V9.25H11H5.13H4.505V8ZM5.13 11H4.505V12.25H5.13H11H11.625V11H11H5.13Z" fill="#666666"/>
</svg>
````

## File: apps/docs/public/globe.svg
````xml
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_868_525)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.268 14.0934C11.9051 13.4838 13.2303 12.2333 13.9384 10.6469C13.1192 10.7941 12.2138 10.9111 11.2469 10.9925C11.0336 12.2005 10.695 13.2621 10.268 14.0934ZM8 16C12.4183 16 16 12.4183 16 8C16 3.58172 12.4183 0 8 0C3.58172 0 0 3.58172 0 8C0 12.4183 3.58172 16 8 16ZM8.48347 14.4823C8.32384 14.494 8.16262 14.5 8 14.5C7.83738 14.5 7.67616 14.494 7.51654 14.4823C7.5132 14.4791 7.50984 14.4759 7.50647 14.4726C7.2415 14.2165 6.94578 13.7854 6.67032 13.1558C6.41594 12.5744 6.19979 11.8714 6.04101 11.0778C6.67605 11.1088 7.33104 11.125 8 11.125C8.66896 11.125 9.32395 11.1088 9.95899 11.0778C9.80021 11.8714 9.58406 12.5744 9.32968 13.1558C9.05422 13.7854 8.7585 14.2165 8.49353 14.4726C8.49016 14.4759 8.4868 14.4791 8.48347 14.4823ZM11.4187 9.72246C12.5137 9.62096 13.5116 9.47245 14.3724 9.28806C14.4561 8.87172 14.5 8.44099 14.5 8C14.5 7.55901 14.4561 7.12828 14.3724 6.71194C13.5116 6.52755 12.5137 6.37904 11.4187 6.27753C11.4719 6.83232 11.5 7.40867 11.5 8C11.5 8.59133 11.4719 9.16768 11.4187 9.72246ZM10.1525 6.18401C10.2157 6.75982 10.25 7.36805 10.25 8C10.25 8.63195 10.2157 9.24018 10.1525 9.81598C9.46123 9.85455 8.7409 9.875 8 9.875C7.25909 9.875 6.53877 9.85455 5.84749 9.81598C5.7843 9.24018 5.75 8.63195 5.75 8C5.75 7.36805 5.7843 6.75982 5.84749 6.18401C6.53877 6.14545 7.25909 6.125 8 6.125C8.74091 6.125 9.46123 6.14545 10.1525 6.18401ZM11.2469 5.00748C12.2138 5.08891 13.1191 5.20593 13.9384 5.35306C13.2303 3.7667 11.9051 2.51622 10.268 1.90662C10.695 2.73788 11.0336 3.79953 11.2469 5.00748ZM8.48347 1.51771C8.4868 1.52089 8.49016 1.52411 8.49353 1.52737C8.7585 1.78353 9.05422 2.21456 9.32968 2.84417C9.58406 3.42562 9.80021 4.12856 9.95899 4.92219C9.32395 4.89118 8.66896 4.875 8 4.875C7.33104 4.875 6.67605 4.89118 6.04101 4.92219C6.19978 4.12856 6.41594 3.42562 6.67032 2.84417C6.94578 2.21456 7.2415 1.78353 7.50647 1.52737C7.50984 1.52411 7.51319 1.52089 7.51653 1.51771C7.67615 1.50597 7.83738 1.5 8 1.5C8.16262 1.5 8.32384 1.50597 8.48347 1.51771ZM5.73202 1.90663C4.0949 2.51622 2.76975 3.7667 2.06159 5.35306C2.88085 5.20593 3.78617 5.08891 4.75309 5.00748C4.96639 3.79953 5.30497 2.73788 5.73202 1.90663ZM4.58133 6.27753C3.48633 6.37904 2.48837 6.52755 1.62761 6.71194C1.54392 7.12828 1.5 7.55901 1.5 8C1.5 8.44099 1.54392 8.87172 1.62761 9.28806C2.48837 9.47245 3.48633 9.62096 4.58133 9.72246C4.52807 9.16768 4.5 8.59133 4.5 8C4.5 7.40867 4.52807 6.83232 4.58133 6.27753ZM4.75309 10.9925C3.78617 10.9111 2.88085 10.7941 2.06159 10.6469C2.76975 12.2333 4.0949 13.4838 5.73202 14.0934C5.30497 13.2621 4.96639 12.2005 4.75309 10.9925Z" fill="#666666"/>
</g>
<defs>
<clipPath id="clip0_868_525">
<rect width="16" height="16" fill="white"/>
</clipPath>
</defs>
</svg>
````

## File: apps/docs/public/next.svg
````xml
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
````

## File: apps/docs/public/turborepo-dark.svg
````xml
<svg width="473" height="76" viewBox="0 0 473 76" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M130.998 30.6565V22.3773H91.0977V30.6565H106.16V58.1875H115.935V30.6565H130.998Z" fill="black"/>
<path d="M153.542 58.7362C165.811 58.7362 172.544 52.5018 172.544 42.2275V22.3773H162.768V41.2799C162.768 47.0155 159.776 50.2574 153.542 50.2574C147.307 50.2574 144.315 47.0155 144.315 41.2799V22.3773H134.539V42.2275C134.539 52.5018 141.272 58.7362 153.542 58.7362Z" fill="black"/>
<path d="M187.508 46.3173H197.234L204.914 58.1875H216.136L207.458 45.2699C212.346 43.5243 215.338 39.634 215.338 34.3473C215.338 26.6665 209.603 22.3773 200.874 22.3773H177.732V58.1875H187.508V46.3173ZM187.508 38.5867V30.5568H200.376C203.817 30.5568 205.712 32.053 205.712 34.5967C205.712 36.9907 203.817 38.5867 200.376 38.5867H187.508Z" fill="black"/>
<path d="M219.887 58.1875H245.472C253.452 58.1875 258.041 54.397 258.041 48.0629C258.041 43.8235 255.348 40.9308 252.156 39.634C254.35 38.5867 257.043 36.0929 257.043 32.1528C257.043 25.8187 252.555 22.3773 244.625 22.3773H219.887V58.1875ZM229.263 36.3922V30.3074H243.627C246.32 30.3074 247.817 31.3548 247.817 33.3498C247.817 35.3448 246.32 36.3922 243.627 36.3922H229.263ZM229.263 43.7238H244.525C247.168 43.7238 248.615 45.0205 248.615 46.9657C248.615 48.9108 247.168 50.2075 244.525 50.2075H229.263V43.7238Z" fill="black"/>
<path d="M281.942 21.7788C269.423 21.7788 260.396 29.6092 260.396 40.2824C260.396 50.9557 269.423 58.786 281.942 58.786C294.461 58.786 303.438 50.9557 303.438 40.2824C303.438 29.6092 294.461 21.7788 281.942 21.7788ZM281.942 30.2575C288.525 30.2575 293.463 34.1478 293.463 40.2824C293.463 46.417 288.525 50.3073 281.942 50.3073C275.359 50.3073 270.421 46.417 270.421 40.2824C270.421 34.1478 275.359 30.2575 281.942 30.2575Z" fill="black"/>
<path d="M317.526 46.3173H327.251L334.932 58.1875H346.154L337.476 45.2699C342.364 43.5243 345.356 39.634 345.356 34.3473C345.356 26.6665 339.62 22.3773 330.892 22.3773H307.75V58.1875H317.526V46.3173ZM317.526 38.5867V30.5568H330.394C333.835 30.5568 335.73 32.053 335.73 34.5967C335.73 36.9907 333.835 38.5867 330.394 38.5867H317.526Z" fill="black"/>
<path d="M349.904 22.3773V58.1875H384.717V49.9083H359.48V44.0729H381.874V35.9932H359.48V30.6565H384.717V22.3773H349.904Z" fill="black"/>
<path d="M399.204 46.7662H412.221C420.95 46.7662 426.685 42.5767 426.685 34.5967C426.685 26.5668 420.95 22.3773 412.221 22.3773H389.428V58.1875H399.204V46.7662ZM399.204 38.6365V30.5568H411.673C415.164 30.5568 417.059 32.053 417.059 34.5967C417.059 37.0904 415.164 38.6365 411.673 38.6365H399.204Z" fill="black"/>
<path d="M450.948 21.7788C438.43 21.7788 429.402 29.6092 429.402 40.2824C429.402 50.9557 438.43 58.786 450.948 58.786C463.467 58.786 472.444 50.9557 472.444 40.2824C472.444 29.6092 463.467 21.7788 450.948 21.7788ZM450.948 30.2575C457.532 30.2575 462.469 34.1478 462.469 40.2824C462.469 46.417 457.532 50.3073 450.948 50.3073C444.365 50.3073 439.427 46.417 439.427 40.2824C439.427 34.1478 444.365 30.2575 450.948 30.2575Z" fill="black"/>
<path d="M38.5017 18.0956C27.2499 18.0956 18.0957 27.2498 18.0957 38.5016C18.0957 49.7534 27.2499 58.9076 38.5017 58.9076C49.7535 58.9076 58.9077 49.7534 58.9077 38.5016C58.9077 27.2498 49.7535 18.0956 38.5017 18.0956ZM38.5017 49.0618C32.6687 49.0618 27.9415 44.3346 27.9415 38.5016C27.9415 32.6686 32.6687 27.9414 38.5017 27.9414C44.3347 27.9414 49.0619 32.6686 49.0619 38.5016C49.0619 44.3346 44.3347 49.0618 38.5017 49.0618Z" fill="black"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M40.2115 14.744V7.125C56.7719 8.0104 69.9275 21.7208 69.9275 38.5016C69.9275 55.2824 56.7719 68.989 40.2115 69.8782V62.2592C52.5539 61.3776 62.3275 51.0644 62.3275 38.5016C62.3275 25.9388 52.5539 15.6256 40.2115 14.744ZM20.5048 54.0815C17.233 50.3043 15.124 45.4935 14.7478 40.2115H7.125C7.5202 47.6025 10.4766 54.3095 15.1088 59.4737L20.501 54.0815H20.5048ZM36.7916 69.8782V62.2592C31.5058 61.883 26.695 59.7778 22.9178 56.5022L17.5256 61.8944C22.6936 66.5304 29.4006 69.483 36.7878 69.8782H36.7916Z" fill="url(#paint0_linear_2028_278)"/>
<defs>
<linearGradient id="paint0_linear_2028_278" x1="41.443" y1="11.5372" x2="10.5567" y2="42.4236" gradientUnits="userSpaceOnUse">
<stop stop-color="#0096FF"/>
<stop offset="1" stop-color="#FF1E56"/>
</linearGradient>
</defs>
</svg>
````

## File: apps/docs/public/turborepo-light.svg
````xml
<svg width="473" height="76" viewBox="0 0 473 76" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M130.998 30.6566V22.3773H91.0977V30.6566H106.16V58.1876H115.935V30.6566H130.998Z" fill="white"/>
<path d="M153.542 58.7362C165.811 58.7362 172.544 52.5018 172.544 42.2276V22.3773H162.768V41.2799C162.768 47.0156 159.776 50.2574 153.542 50.2574C147.307 50.2574 144.315 47.0156 144.315 41.2799V22.3773H134.539V42.2276C134.539 52.5018 141.272 58.7362 153.542 58.7362Z" fill="white"/>
<path d="M187.508 46.3173H197.234L204.914 58.1876H216.136L207.458 45.2699C212.346 43.5243 215.338 39.6341 215.338 34.3473C215.338 26.6666 209.603 22.3773 200.874 22.3773H177.732V58.1876H187.508V46.3173ZM187.508 38.5867V30.5568H200.376C203.817 30.5568 205.712 32.0531 205.712 34.5967C205.712 36.9907 203.817 38.5867 200.376 38.5867H187.508Z" fill="white"/>
<path d="M219.887 58.1876H245.472C253.452 58.1876 258.041 54.3971 258.041 48.0629C258.041 43.8236 255.348 40.9308 252.156 39.6341C254.35 38.5867 257.043 36.0929 257.043 32.1528C257.043 25.8187 252.555 22.3773 244.625 22.3773H219.887V58.1876ZM229.263 36.3922V30.3074H243.627C246.32 30.3074 247.817 31.3548 247.817 33.3498C247.817 35.3448 246.32 36.3922 243.627 36.3922H229.263ZM229.263 43.7238H244.525C247.168 43.7238 248.615 45.0206 248.615 46.9657C248.615 48.9108 247.168 50.2076 244.525 50.2076H229.263V43.7238Z" fill="white"/>
<path d="M281.942 21.7788C269.423 21.7788 260.396 29.6092 260.396 40.2824C260.396 50.9557 269.423 58.7861 281.942 58.7861C294.461 58.7861 303.438 50.9557 303.438 40.2824C303.438 29.6092 294.461 21.7788 281.942 21.7788ZM281.942 30.2576C288.525 30.2576 293.463 34.1478 293.463 40.2824C293.463 46.4171 288.525 50.3073 281.942 50.3073C275.359 50.3073 270.421 46.4171 270.421 40.2824C270.421 34.1478 275.359 30.2576 281.942 30.2576Z" fill="white"/>
<path d="M317.526 46.3173H327.251L334.932 58.1876H346.154L337.476 45.2699C342.364 43.5243 345.356 39.6341 345.356 34.3473C345.356 26.6666 339.62 22.3773 330.892 22.3773H307.75V58.1876H317.526V46.3173ZM317.526 38.5867V30.5568H330.394C333.835 30.5568 335.73 32.0531 335.73 34.5967C335.73 36.9907 333.835 38.5867 330.394 38.5867H317.526Z" fill="white"/>
<path d="M349.904 22.3773V58.1876H384.717V49.9083H359.48V44.0729H381.874V35.9932H359.48V30.6566H384.717V22.3773H349.904Z" fill="white"/>
<path d="M399.204 46.7662H412.221C420.95 46.7662 426.685 42.5767 426.685 34.5967C426.685 26.5668 420.95 22.3773 412.221 22.3773H389.428V58.1876H399.204V46.7662ZM399.204 38.6366V30.5568H411.673C415.164 30.5568 417.059 32.0531 417.059 34.5967C417.059 37.0904 415.164 38.6366 411.673 38.6366H399.204Z" fill="white"/>
<path d="M450.948 21.7788C438.43 21.7788 429.402 29.6092 429.402 40.2824C429.402 50.9557 438.43 58.7861 450.948 58.7861C463.467 58.7861 472.444 50.9557 472.444 40.2824C472.444 29.6092 463.467 21.7788 450.948 21.7788ZM450.948 30.2576C457.532 30.2576 462.469 34.1478 462.469 40.2824C462.469 46.4171 457.532 50.3073 450.948 50.3073C444.365 50.3073 439.427 46.4171 439.427 40.2824C439.427 34.1478 444.365 30.2576 450.948 30.2576Z" fill="white"/>
<path d="M38.5017 18.0956C27.2499 18.0956 18.0957 27.2498 18.0957 38.5016C18.0957 49.7534 27.2499 58.9076 38.5017 58.9076C49.7535 58.9076 58.9077 49.7534 58.9077 38.5016C58.9077 27.2498 49.7535 18.0956 38.5017 18.0956ZM38.5017 49.0618C32.6687 49.0618 27.9415 44.3346 27.9415 38.5016C27.9415 32.6686 32.6687 27.9414 38.5017 27.9414C44.3347 27.9414 49.0619 32.6686 49.0619 38.5016C49.0619 44.3346 44.3347 49.0618 38.5017 49.0618Z" fill="white"/>
<path fill-rule="evenodd" clip-rule="evenodd" d="M40.2115 14.744V7.125C56.7719 8.0104 69.9275 21.7208 69.9275 38.5016C69.9275 55.2824 56.7719 68.989 40.2115 69.8782V62.2592C52.5539 61.3776 62.3275 51.0644 62.3275 38.5016C62.3275 25.9388 52.5539 15.6256 40.2115 14.744ZM20.5048 54.0815C17.233 50.3043 15.124 45.4935 14.7478 40.2115H7.125C7.5202 47.6025 10.4766 54.3095 15.1088 59.4737L20.501 54.0815H20.5048ZM36.7916 69.8782V62.2592C31.5058 61.883 26.695 59.7778 22.9178 56.5022L17.5256 61.8944C22.6936 66.5304 29.4006 69.483 36.7878 69.8782H36.7916Z" fill="url(#paint0_linear_2028_477)"/>
<defs>
<linearGradient id="paint0_linear_2028_477" x1="41.443" y1="11.5372" x2="10.5567" y2="42.4236" gradientUnits="userSpaceOnUse">
<stop stop-color="#0096FF"/>
<stop offset="1" stop-color="#FF1E56"/>
</linearGradient>
</defs>
</svg>
````

## File: apps/docs/public/vercel.svg
````xml
<svg width="21" height="20" viewBox="0 0 21 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<g clip-path="url(#clip0_977_547)">
<path fill-rule="evenodd" clip-rule="evenodd" d="M10.5 3L18.5 17H2.5L10.5 3Z" fill="white"/>
</g>
<defs>
<clipPath id="clip0_977_547">
<rect width="16" height="16" fill="white" transform="translate(2.5 2)"/>
</clipPath>
</defs>
</svg>
````

## File: apps/docs/public/window.svg
````xml
<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
<path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5H14.5V12.5C14.5 13.0523 14.0523 13.5 13.5 13.5H2.5C1.94772 13.5 1.5 13.0523 1.5 12.5V2.5ZM0 1H1.5H14.5H16V2.5V12.5C16 13.8807 14.8807 15 13.5 15H2.5C1.11929 15 0 13.8807 0 12.5V2.5V1ZM3.75 5.5C4.16421 5.5 4.5 5.16421 4.5 4.75C4.5 4.33579 4.16421 4 3.75 4C3.33579 4 3 4.33579 3 4.75C3 5.16421 3.33579 5.5 3.75 5.5ZM7 4.75C7 5.16421 6.66421 5.5 6.25 5.5C5.83579 5.5 5.5 5.16421 5.5 4.75C5.5 4.33579 5.83579 4 6.25 4C6.66421 4 7 4.33579 7 4.75ZM8.75 5.5C9.16421 5.5 9.5 5.16421 9.5 4.75C9.5 4.33579 9.16421 4 8.75 4C8.33579 4 8 4.33579 8 4.75C8 5.16421 8.33579 5.5 8.75 5.5Z" fill="#666666"/>
</svg>
````

## File: apps/docs/.gitignore
````
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js
.yarn/install-state.gz

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# env files (can opt-in for commiting if needed)
.env*

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
````

## File: apps/docs/eslint.config.js
````javascript
import { nextJsConfig } from "@moondesk/eslint-config/next-js";

/** @type {import("eslint").Linter.Config[]} */
export default nextJsConfig;
````

## File: apps/docs/next.config.js
````javascript
/** @type {import('next').NextConfig} */
const nextConfig = {};

export default nextConfig;
````

## File: apps/docs/package.json
````json
{
  "name": "docs",
  "version": "0.1.0",
  "type": "module",
  "private": true,
  "scripts": {
    "dev": "next dev --port 3001",
    "build": "next build",
    "start": "next start",
    "lint": "eslint --max-warnings 0",
    "check-types": "next typegen && tsc --noEmit"
  },
  "dependencies": {
    "@moondesk/ui": "workspace:*",
    "next": "^16.0.1",
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:*",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "@types/react": "19.2.2",
    "@types/react-dom": "19.2.2",
    "eslint": "^9.39.1",
    "typescript": "5.9.2"
  }
}
````

## File: apps/docs/README.md
````markdown
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load Inter, a custom Google Font.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
````

## File: apps/docs/tsconfig.json
````json
{
  "extends": "@moondesk/typescript-config/nextjs.json",
  "compilerOptions": {
    "plugins": [
      {
        "name": "next"
      }
    ]
  },
  "include": [
    "**/*.ts",
    "**/*.tsx",
    "next-env.d.ts",
    "next.config.js",
    ".next/types/**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}
````

## File: apps/edge-simulator/Dockerfile
````
FROM node:22-alpine AS base
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable

FROM base AS builder
RUN apk add --no-cache libc6-compat
WORKDIR /app
COPY . .
RUN pnpm install --frozen-lockfile
RUN pnpm --filter @moondesk/edge-simulator build

FROM base AS runner
WORKDIR /app

# Copy root config files
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/pnpm-lock.yaml ./pnpm-lock.yaml
COPY --from=builder /app/pnpm-workspace.yaml ./pnpm-workspace.yaml

# Copy shared packages
COPY --from=builder /app/packages ./packages

# Copy app source and build
COPY --from=builder /app/apps/edge-simulator ./apps/edge-simulator

# Install production dependencies
RUN pnpm install --prod --frozen-lockfile

ENV NODE_ENV=production
WORKDIR /app/apps/edge-simulator

CMD ["node", "dist/main.js"]
````

## File: apps/edge-simulator/eslint.config.mjs
````javascript
import { config } from "@moondesk/eslint-config/base";

export default [...config];
````

## File: apps/edge-simulator/tsconfig.json
````json
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "outDir": "dist",
        "rootDir": "src"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
````

## File: apps/moondesk-dash/.husky/pre-commit
````
npm run generate:presets
git add src/types/preferences/theme.ts
npx lint-staged
````

## File: apps/moondesk-dash/src/app/(external)/page.tsx
````typescript
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Factory, Gauge, Zap } from "lucide-react";

import { Button } from "@/components/ui/button";

export default async function Home() {
  const { userId } = await auth();

  // If user is signed in, redirect to dashboard
  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <div className="flex min-h-screen flex-col items-center justify-center bg-gradient-to-b from-slate-50 to-slate-100 dark:from-slate-950 dark:to-slate-900">
      <div className="container mx-auto px-4 text-center">
        <div className="mb-8 flex justify-center gap-4">
          <Factory className="h-12 w-12 text-slate-700 dark:text-slate-300" />
          <Gauge className="h-12 w-12 text-slate-700 dark:text-slate-300" />
          <Zap className="h-12 w-12 text-slate-700 dark:text-slate-300" />
        </div>

        <h1 className="mb-4 text-4xl font-bold tracking-tight text-slate-900 sm:text-6xl dark:text-slate-100">
          Industrial IoT Dashboard
        </h1>

        <p className="mb-8 text-lg text-slate-600 sm:text-xl dark:text-slate-400">
          Monitor and manage your industrial assets in real-time.
          <br />
          Solar Panels, PLCs, Sensors, and more.
        </p>

        <div className="flex flex-col items-center justify-center gap-4 sm:flex-row">
          <Link href="/auth/v2/login">
            <Button size="lg" variant="outline" className="min-w-[140px]">
              Sign In
            </Button>
          </Link>
          <Link href="/auth/v2/register">
            <Button size="lg" className="min-w-[140px]">
              Get Started
            </Button>
          </Link>
        </div>

        <div className="mt-16 grid gap-8 sm:grid-cols-3">
          <div className="rounded-lg border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900">
            <Factory className="mx-auto mb-4 h-8 w-8 text-slate-700 dark:text-slate-300" />
            <h3 className="mb-2 font-semibold text-slate-900 dark:text-slate-100">Device Management</h3>
            <p className="text-sm text-slate-600 dark:text-slate-400">
              Provision and monitor industrial devices with ease
            </p>
          </div>

          <div className="rounded-lg border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900">
            <Gauge className="mx-auto mb-4 h-8 w-8 text-slate-700 dark:text-slate-300" />
            <h3 className="mb-2 font-semibold text-slate-900 dark:text-slate-100">Real-time Monitoring</h3>
            <p className="text-sm text-slate-600 dark:text-slate-400">
              Track telemetry data and device status in real-time
            </p>
          </div>

          <div className="rounded-lg border border-slate-200 bg-white p-6 dark:border-slate-800 dark:bg-slate-900">
            <Zap className="mx-auto mb-4 h-8 w-8 text-slate-700 dark:text-slate-300" />
            <h3 className="mb-2 font-semibold text-slate-900 dark:text-slate-100">Multi-tenancy</h3>
            <p className="text-sm text-slate-600 dark:text-slate-400">
              Manage multiple organizations and teams securely
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/_components/social-auth/google-button.tsx
````typescript
"use client";

import { useSignIn } from "@clerk/nextjs";
import { siGoogle } from "simple-icons";
import { toast } from "sonner";

import { SimpleIcon } from "@/components/simple-icon";
import { Button } from "@/components/ui/button";
import { cn } from "@/lib/utils";

export function GoogleButton({ className, ...props }: React.ComponentProps<typeof Button>) {
  const { signIn, isLoaded } = useSignIn();

  const signInWithGoogle = async () => {
    if (!isLoaded) return;

    try {
      await signIn.authenticateWithRedirect({
        strategy: "oauth_google",
        redirectUrl: "/sso-callback",
        redirectUrlComplete: "/dashboard/iiot",
      });
    } catch (err: unknown) {
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Failed to sign in with Google");
    }
  };

  return (
    <Button variant="secondary" className={cn(className)} onClick={signInWithGoogle} {...props}>
      <SimpleIcon icon={siGoogle} className="size-4" />
      Continue with Google
    </Button>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/_components/login-form.tsx
````typescript
"use client";

import { useState } from "react";

import { useRouter } from "next/navigation";

import { useSignIn } from "@clerk/nextjs";
import { zodResolver } from "@hookform/resolvers/zod";
import { useForm } from "react-hook-form";
import { toast } from "sonner";
import { z } from "zod";

import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";

const FormSchema = z.object({
  email: z.string().email({ message: "Please enter a valid email address." }),
  password: z.string().min(6, { message: "Password must be at least 6 characters." }),
  remember: z.boolean().optional(),
});

export function LoginForm() {
  const { isLoaded, signIn, setActive } = useSignIn();
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);

  const form = useForm<z.infer<typeof FormSchema>>({
    resolver: zodResolver(FormSchema),
    defaultValues: {
      email: "",
      password: "",
      remember: false,
    },
  });

  const onSubmit = async (data: z.infer<typeof FormSchema>) => {
    if (!isLoaded) return;

    setIsLoading(true);
    try {
      const result = await signIn.create({
        identifier: data.email,
        password: data.password,
      });

      if (result.status === "complete") {
        await setActive({ session: result.createdSessionId });
        toast.success("Welcome back!");
        router.push("/dashboard/iiot");
      }
    } catch (err: unknown) {
      // Clerk errors usually follow this structure
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Invalid email or password");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email Address</FormLabel>
              <FormControl>
                <Input id="email" type="email" placeholder="you@example.com" autoComplete="email" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="password"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Password</FormLabel>
              <FormControl>
                <Input
                  id="password"
                  type="password"
                  placeholder="••••••••"
                  autoComplete="current-password"
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="remember"
          render={({ field }) => (
            <FormItem className="flex flex-row items-center">
              <FormControl>
                <Checkbox
                  id="login-remember"
                  checked={field.value}
                  onCheckedChange={field.onChange}
                  className="size-4"
                />
              </FormControl>
              <FormLabel htmlFor="login-remember" className="text-muted-foreground ml-1 text-sm font-medium">
                Remember me for 30 days
              </FormLabel>
            </FormItem>
          )}
        />
        <Button className="w-full" type="submit" disabled={isLoading}>
          {isLoading ? "Logging in..." : "Login"}
        </Button>
      </form>
    </Form>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/_components/register-form.tsx
````typescript
"use client";

import { useState } from "react";

import { useRouter } from "next/navigation";

import { useSignUp } from "@clerk/nextjs";
import { zodResolver } from "@hookform/resolvers/zod";
import { useForm } from "react-hook-form";
import { toast } from "sonner";
import { z } from "zod";

import { Button } from "@/components/ui/button";
import { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from "@/components/ui/form";
import { Input } from "@/components/ui/input";

const FormSchema = z
  .object({
    email: z.string().email({ message: "Please enter a valid email address." }),
    password: z.string().min(8, { message: "Password must be at least 8 characters." }),
    confirmPassword: z.string().min(8, { message: "Confirm Password must be at least 8 characters." }),
  })
  .refine((data) => data.password === data.confirmPassword, {
    message: "Passwords do not match.",
    path: ["confirmPassword"],
  });

export function RegisterForm() {
  const { isLoaded, signUp, setActive } = useSignUp();
  const router = useRouter();
  const [isLoading, setIsLoading] = useState(false);
  const [pendingVerification, setPendingVerification] = useState(false);
  const [code, setCode] = useState("");

  const form = useForm<z.infer<typeof FormSchema>>({
    resolver: zodResolver(FormSchema),
    defaultValues: {
      email: "",
      password: "",
      confirmPassword: "",
    },
  });

  const onSubmit = async (data: z.infer<typeof FormSchema>) => {
    if (!isLoaded) return;

    setIsLoading(true);
    try {
      await signUp.create({
        emailAddress: data.email,
        password: data.password,
      });

      await signUp.prepareEmailAddressVerification({ strategy: "email_code" });
      setPendingVerification(true);
      toast.success("Verification code sent to your email");
    } catch (err: unknown) {
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Failed to create account");
    } finally {
      setIsLoading(false);
    }
  };

  const onVerify = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!isLoaded) return;

    setIsLoading(true);
    try {
      const result = await signUp.attemptEmailAddressVerification({ code });

      if (result.status === "complete") {
        await setActive({ session: result.createdSessionId });
        toast.success("Account created successfully!");
        router.push("/dashboard/iiot");
      }
    } catch (err: unknown) {
      const error = err as { errors?: { message: string }[] };
      toast.error(error.errors?.[0]?.message ?? "Invalid verification code");
    } finally {
      setIsLoading(false);
    }
  };

  if (pendingVerification) {
    return (
      <form onSubmit={onVerify} className="space-y-4">
        <div className="space-y-2">
          <label htmlFor="code" className="text-sm font-medium">
            Verification Code
          </label>
          <Input
            id="code"
            value={code}
            onChange={(e) => setCode(e.target.value)}
            placeholder="Enter verification code"
          />
          <p className="text-muted-foreground text-xs">Check your email for the verification code</p>
        </div>
        <Button className="w-full" type="submit" disabled={isLoading}>
          {isLoading ? "Verifying..." : "Verify Email"}
        </Button>
      </form>
    );
  }

  return (
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email Address</FormLabel>
              <FormControl>
                <Input id="email" type="email" placeholder="you@example.com" autoComplete="email" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="password"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Password</FormLabel>
              <FormControl>
                <Input id="password" type="password" placeholder="••••••••" autoComplete="new-password" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <FormField
          control={form.control}
          name="confirmPassword"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Confirm Password</FormLabel>
              <FormControl>
                <Input
                  id="confirmPassword"
                  type="password"
                  placeholder="••••••••"
                  autoComplete="new-password"
                  {...field}
                />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        <Button className="w-full" type="submit" disabled={isLoading}>
          {isLoading ? "Creating account..." : "Register"}
        </Button>
      </form>
    </Form>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/v1/login/page.tsx
````typescript
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Factory } from "lucide-react";

import { LoginForm } from "../../_components/login-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function LoginV1() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <div className="flex h-dvh">
      <div className="bg-primary hidden lg:block lg:w-1/3">
        <div className="flex h-full flex-col items-center justify-center p-12 text-center">
          <div className="space-y-6">
            <Factory className="text-primary-foreground mx-auto size-12" />
            <div className="space-y-2">
              <h1 className="text-primary-foreground text-5xl font-light">Hello again</h1>
              <p className="text-primary-foreground/80 text-xl">Login to continue</p>
            </div>
          </div>
        </div>
      </div>

      <div className="bg-background flex w-full items-center justify-center p-8 lg:w-2/3">
        <div className="w-full max-w-md space-y-10 py-24 lg:py-32">
          <div className="space-y-4 text-center">
            <div className="font-medium tracking-tight">Login</div>
            <div className="text-muted-foreground mx-auto max-w-xl">
              Welcome back to Moondesk. Monitor your industrial assets in real-time.
            </div>
          </div>
          <div className="space-y-4">
            <LoginForm />
            <GoogleButton className="w-full" variant="outline" />
            <p className="text-muted-foreground text-center text-xs">
              Don&apos;t have an account?{" "}
              <Link href="register" className="text-primary">
                Register
              </Link>
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/v1/register/page.tsx
````typescript
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Factory } from "lucide-react";

import { RegisterForm } from "../../_components/register-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function RegisterV1() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <div className="flex h-dvh">
      <div className="bg-background flex w-full items-center justify-center p-8 lg:w-2/3">
        <div className="w-full max-w-md space-y-10 py-24 lg:py-32">
          <div className="space-y-4 text-center">
            <div className="font-medium tracking-tight">Register</div>
            <div className="text-muted-foreground mx-auto max-w-xl">
              Create your Moondesk account and start monitoring your industrial assets.
            </div>
          </div>
          <div className="space-y-4">
            <RegisterForm />
            <GoogleButton className="w-full" variant="outline" />
            <p className="text-muted-foreground text-center text-xs">
              Already have an account?{" "}
              <Link href="login" className="text-primary">
                Login
              </Link>
            </p>
          </div>
        </div>
      </div>

      <div className="bg-primary hidden lg:block lg:w-1/3">
        <div className="flex h-full flex-col items-center justify-center p-12 text-center">
          <div className="space-y-6">
            <Factory className="text-primary-foreground mx-auto size-12" />
            <div className="space-y-2">
              <h1 className="text-primary-foreground text-5xl font-light">Welcome!</h1>
              <p className="text-primary-foreground/80 text-xl">You&apos;re in the right place.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/v2/login/page.tsx
````typescript
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Globe } from "lucide-react";

import { APP_CONFIG } from "@/config";

import { LoginForm } from "../../_components/login-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function LoginV2() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <>
      <div className="mx-auto flex w-full flex-col justify-center space-y-8 sm:w-[350px]">
        <div className="space-y-2 text-center">
          <h1 className="text-3xl font-medium">Login to your account</h1>
          <p className="text-muted-foreground text-sm">Please enter your details to login.</p>
        </div>
        <div className="space-y-4">
          <GoogleButton className="w-full" />
          <div className="after:border-border relative text-center text-sm after:absolute after:inset-0 after:top-1/2 after:z-0 after:flex after:items-center after:border-t">
            <span className="bg-background text-muted-foreground relative z-10 px-2">Or continue with</span>
          </div>
          <LoginForm />
        </div>
      </div>

      <div className="absolute top-5 flex w-full justify-end px-10">
        <div className="text-muted-foreground text-sm">
          Don&apos;t have an account?{" "}
          <Link className="text-foreground" href="register">
            Register
          </Link>
        </div>
      </div>

      <div className="absolute bottom-5 flex w-full justify-between px-10">
        <div className="text-sm">{APP_CONFIG.copyright}</div>
        <div className="flex items-center gap-1 text-sm">
          <Globe className="text-muted-foreground size-4" />
          ENG
        </div>
      </div>
    </>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/v2/register/page.tsx
````typescript
import Link from "next/link";
import { redirect } from "next/navigation";

import { auth } from "@clerk/nextjs/server";
import { Globe } from "lucide-react";

import { APP_CONFIG } from "@/config";

import { RegisterForm } from "../../_components/register-form";
import { GoogleButton } from "../../_components/social-auth/google-button";

export default async function RegisterV2() {
  const { userId } = await auth();

  if (userId) {
    redirect("/dashboard/iiot");
  }

  return (
    <>
      <div className="mx-auto flex w-full flex-col justify-center space-y-8 sm:w-[350px]">
        <div className="space-y-2 text-center">
          <h1 className="text-3xl font-medium">Create your account</h1>
          <p className="text-muted-foreground text-sm">Please enter your details to register.</p>
        </div>
        <div className="space-y-4">
          <GoogleButton className="w-full" />
          <div className="after:border-border relative text-center text-sm after:absolute after:inset-0 after:top-1/2 after:z-0 after:flex after:items-center after:border-t">
            <span className="bg-background text-muted-foreground relative z-10 px-2">Or continue with</span>
          </div>
          <RegisterForm />
        </div>
      </div>

      <div className="absolute top-5 flex w-full justify-end px-10">
        <div className="text-muted-foreground text-sm">
          Already have an account?{" "}
          <Link className="text-foreground" href="login">
            Login
          </Link>
        </div>
      </div>

      <div className="absolute bottom-5 flex w-full justify-between px-10">
        <div className="text-sm">{APP_CONFIG.copyright}</div>
        <div className="flex items-center gap-1 text-sm">
          <Globe className="text-muted-foreground size-4" />
          ENG
        </div>
      </div>
    </>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/auth/v2/layout.tsx
````typescript
import { ReactNode } from "react";

import { Factory } from "lucide-react";

import { Separator } from "@/components/ui/separator";
import { APP_CONFIG } from "@/config";

export default function Layout({ children }: Readonly<{ children: ReactNode }>) {
  return (
    <main>
      <div className="grid h-dvh justify-center p-2 lg:grid-cols-2">
        <div className="bg-primary relative order-2 hidden h-full rounded-3xl lg:flex">
          <div className="text-primary-foreground absolute top-10 space-y-1 px-10">
            <Factory className="size-10" />
            <h1 className="text-2xl font-medium">{APP_CONFIG.name}</h1>
            <p className="text-sm">Industrial IoT Dashboard</p>
          </div>

          <div className="absolute bottom-10 flex w-full justify-between px-10">
            <div className="text-primary-foreground flex-1 space-y-1">
              <h2 className="font-medium">Real-time Monitoring</h2>
              <p className="text-sm">Track your solar panels, PLCs, sensors, and industrial devices in real-time.</p>
            </div>
            <Separator orientation="vertical" className="mx-3 !h-auto" />
            <div className="text-primary-foreground flex-1 space-y-1">
              <h2 className="font-medium">Multi-tenancy</h2>
              <p className="text-sm">
                Secure organization-based access control for managing multiple teams and assets.
              </p>
            </div>
          </div>
        </div>
        <div className="relative order-1 flex h-full">{children}</div>
      </div>
    </main>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/account-switcher.tsx
````typescript
"use client";

import { useState } from "react";

import { BadgeCheck, Bell, CreditCard, LogOut } from "lucide-react";

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
  DropdownMenuGroup,
} from "@/components/ui/dropdown-menu";
import { cn, getInitials } from "@/lib/utils";

export function AccountSwitcher({
  users,
}: {
  readonly users: ReadonlyArray<{
    readonly id: string;
    readonly name: string;
    readonly email: string;
    readonly avatar: string;
    readonly role: string;
  }>;
}) {
  const [activeUser, setActiveUser] = useState(users[0]);

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Avatar className="size-9 rounded-lg">
          <AvatarImage src={activeUser.avatar || undefined} alt={activeUser.name} />
          <AvatarFallback className="rounded-lg">{getInitials(activeUser.name)}</AvatarFallback>
        </Avatar>
      </DropdownMenuTrigger>
      <DropdownMenuContent className="min-w-56 space-y-1 rounded-lg" side="bottom" align="end" sideOffset={4}>
        {users.map((user) => (
          <DropdownMenuItem
            key={user.email}
            className={cn("p-0", user.id === activeUser.id && "bg-accent/50 border-l-primary border-l-2")}
            onClick={() => setActiveUser(user)}
          >
            <div className="flex w-full items-center justify-between gap-2 px-1 py-1.5">
              <Avatar className="size-9 rounded-lg">
                <AvatarImage src={user.avatar || undefined} alt={user.name} />
                <AvatarFallback className="rounded-lg">{getInitials(user.name)}</AvatarFallback>
              </Avatar>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-semibold">{user.name}</span>
                <span className="truncate text-xs capitalize">{user.role}</span>
              </div>
            </div>
          </DropdownMenuItem>
        ))}
        <DropdownMenuSeparator />
        <DropdownMenuGroup>
          <DropdownMenuItem>
            <BadgeCheck />
            Account
          </DropdownMenuItem>
          <DropdownMenuItem>
            <CreditCard />
            Billing
          </DropdownMenuItem>
          <DropdownMenuItem>
            <Bell />
            Notifications
          </DropdownMenuItem>
        </DropdownMenuGroup>
        <DropdownMenuSeparator />
        <DropdownMenuItem>
          <LogOut />
          Log out
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/app-sidebar.tsx
````typescript
"use client";

import Link from "next/link";

import { Command } from "lucide-react";

import {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarHeader,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
} from "@/components/ui/sidebar";
import { APP_CONFIG } from "@/config";
import { sidebarItems } from "@/navigation/sidebar/sidebar-items";

import { NavMain } from "./nav-main";
import { NavUserClerk } from "./nav-user-clerk";

export function AppSidebar({ ...props }: React.ComponentProps<typeof Sidebar>) {
  return (
    <Sidebar {...props}>
      <SidebarHeader>
        <SidebarMenu>
          <SidebarMenuItem>
            <SidebarMenuButton asChild className="data-[slot=sidebar-menu-button]:!p-1.5">
              <Link href="/dashboard/default">
                <Command />
                <span className="text-base font-semibold">{APP_CONFIG.name}</span>
              </Link>
            </SidebarMenuButton>
          </SidebarMenuItem>
        </SidebarMenu>
      </SidebarHeader>
      <SidebarContent>
        <NavMain items={sidebarItems} />
      </SidebarContent>
      <SidebarFooter>
        <NavUserClerk />
      </SidebarFooter>
    </Sidebar>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/clerk-auth.tsx
````typescript
"use client";

import { SignInButton, SignUpButton, SignedIn, SignedOut, UserButton, OrganizationSwitcher } from "@clerk/nextjs";

import { Button } from "@/components/ui/button";

export function ClerkAuth() {
  return (
    <>
      <SignedOut>
        <div className="flex items-center gap-2">
          <SignInButton mode="modal">
            <Button variant="ghost" size="sm">
              Sign In
            </Button>
          </SignInButton>
          <SignUpButton mode="modal">
            <Button size="sm" className="bg-primary text-primary-foreground">
              Sign Up
            </Button>
          </SignUpButton>
        </div>
      </SignedOut>
      <SignedIn>
        <UserButton
          appearance={{
            elements: {
              avatarBox: "size-9 rounded-lg",
            },
          }}
        />
      </SignedIn>
    </>
  );
}

export function ClerkOrgSwitcher() {
  return (
    <SignedIn>
      <OrganizationSwitcher
        appearance={{
          elements: {
            rootBox: "flex items-center",
            organizationSwitcherTrigger:
              "rounded-lg border border-input bg-background hover:bg-accent hover:text-accent-foreground px-3 py-2",
          },
        }}
        hidePersonal={false}
        afterCreateOrganizationUrl="/organization"
        afterSelectOrganizationUrl="/dashboard"
      />
    </SignedIn>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-documents.tsx
````typescript
"use client";

import { LucideIcon, Ellipsis, Folder, Forward, Trash2 } from "lucide-react";

import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  SidebarGroup,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuButton,
  SidebarMenuItem,
  useSidebar,
} from "@/components/ui/sidebar";

export function NavDocuments({
  items,
}: {
  readonly items: readonly {
    readonly name: string;
    readonly url: string;
    readonly icon: LucideIcon;
  }[];
}) {
  const { isMobile } = useSidebar();

  return (
    <SidebarGroup className="group-data-[collapsible=icon]:hidden">
      <SidebarGroupLabel>Documents</SidebarGroupLabel>
      <SidebarMenu>
        {items.map((item) => (
          <SidebarMenuItem key={item.name}>
            <SidebarMenuButton asChild>
              <a href={item.url}>
                <item.icon />
                <span>{item.name}</span>
              </a>
            </SidebarMenuButton>
            <DropdownMenu>
              <DropdownMenuTrigger asChild>
                <SidebarMenuAction showOnHover className="data-[state=open]:bg-accent rounded-sm">
                  <Ellipsis />
                  <span className="sr-only">More</span>
                </SidebarMenuAction>
              </DropdownMenuTrigger>
              <DropdownMenuContent
                className="w-24 rounded-lg"
                side={isMobile ? "bottom" : "right"}
                align={isMobile ? "end" : "start"}
              >
                <DropdownMenuItem>
                  <Folder />
                  <span>Open</span>
                </DropdownMenuItem>
                <DropdownMenuItem>
                  <Forward />
                  <span>Share</span>
                </DropdownMenuItem>
                <DropdownMenuSeparator />
                <DropdownMenuItem variant="destructive">
                  <Trash2 />
                  <span>Delete</span>
                </DropdownMenuItem>
              </DropdownMenuContent>
            </DropdownMenu>
          </SidebarMenuItem>
        ))}
        <SidebarMenuItem>
          <SidebarMenuButton className="text-sidebar-foreground/70">
            <Ellipsis className="text-sidebar-foreground/70" />
            <span>More</span>
          </SidebarMenuButton>
        </SidebarMenuItem>
      </SidebarMenu>
    </SidebarGroup>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-main.tsx
````typescript
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";

import { PlusCircleIcon, MailIcon, ChevronRight } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Collapsible, CollapsibleContent, CollapsibleTrigger } from "@/components/ui/collapsible";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import {
  SidebarGroup,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  useSidebar,
} from "@/components/ui/sidebar";
import { type NavGroup, type NavMainItem } from "@/navigation/sidebar/sidebar-items";

interface NavMainProps {
  readonly items: readonly NavGroup[];
}

const IsComingSoon = () => (
  <span className="ml-auto rounded-md bg-gray-200 px-2 py-1 text-xs dark:text-gray-800">Soon</span>
);

const NavItemExpanded = ({
  item,
  isActive,
  isSubmenuOpen,
}: {
  item: NavMainItem;
  isActive: (url: string, subItems?: NavMainItem["subItems"]) => boolean;
  isSubmenuOpen: (subItems?: NavMainItem["subItems"]) => boolean;
}) => {
  return (
    <Collapsible key={item.title} asChild defaultOpen={isSubmenuOpen(item.subItems)} className="group/collapsible">
      <SidebarMenuItem>
        <CollapsibleTrigger asChild>
          {item.subItems ? (
            <SidebarMenuButton
              disabled={item.comingSoon}
              isActive={isActive(item.url, item.subItems)}
              tooltip={item.title}
            >
              {item.icon && <item.icon />}
              <span>{item.title}</span>
              {item.comingSoon && <IsComingSoon />}
              <ChevronRight className="ml-auto transition-transform duration-200 group-data-[state=open]/collapsible:rotate-90" />
            </SidebarMenuButton>
          ) : (
            <SidebarMenuButton
              asChild
              aria-disabled={item.comingSoon}
              isActive={isActive(item.url)}
              tooltip={item.title}
            >
              <Link href={item.url} target={item.newTab ? "_blank" : undefined}>
                {item.icon && <item.icon />}
                <span>{item.title}</span>
                {item.comingSoon && <IsComingSoon />}
              </Link>
            </SidebarMenuButton>
          )}
        </CollapsibleTrigger>
        {item.subItems && (
          <CollapsibleContent>
            <SidebarMenuSub>
              {item.subItems.map((subItem) => (
                <SidebarMenuSubItem key={subItem.title}>
                  <SidebarMenuSubButton aria-disabled={subItem.comingSoon} isActive={isActive(subItem.url)} asChild>
                    <Link href={subItem.url} target={subItem.newTab ? "_blank" : undefined}>
                      {subItem.icon && <subItem.icon />}
                      <span>{subItem.title}</span>
                      {subItem.comingSoon && <IsComingSoon />}
                    </Link>
                  </SidebarMenuSubButton>
                </SidebarMenuSubItem>
              ))}
            </SidebarMenuSub>
          </CollapsibleContent>
        )}
      </SidebarMenuItem>
    </Collapsible>
  );
};

const NavItemCollapsed = ({
  item,
  isActive,
}: {
  item: NavMainItem;
  isActive: (url: string, subItems?: NavMainItem["subItems"]) => boolean;
}) => {
  return (
    <SidebarMenuItem key={item.title}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <SidebarMenuButton
            disabled={item.comingSoon}
            tooltip={item.title}
            isActive={isActive(item.url, item.subItems)}
          >
            {item.icon && <item.icon />}
            <span>{item.title}</span>
            <ChevronRight />
          </SidebarMenuButton>
        </DropdownMenuTrigger>
        <DropdownMenuContent className="w-50 space-y-1" side="right" align="start">
          {item.subItems?.map((subItem) => (
            <DropdownMenuItem key={subItem.title} asChild>
              <SidebarMenuSubButton
                key={subItem.title}
                asChild
                className="focus-visible:ring-0"
                aria-disabled={subItem.comingSoon}
                isActive={isActive(subItem.url)}
              >
                <Link href={subItem.url} target={subItem.newTab ? "_blank" : undefined}>
                  {subItem.icon && <subItem.icon className="[&>svg]:text-sidebar-foreground" />}
                  <span>{subItem.title}</span>
                  {subItem.comingSoon && <IsComingSoon />}
                </Link>
              </SidebarMenuSubButton>
            </DropdownMenuItem>
          ))}
        </DropdownMenuContent>
      </DropdownMenu>
    </SidebarMenuItem>
  );
};

export function NavMain({ items }: NavMainProps) {
  const path = usePathname();
  const { state, isMobile } = useSidebar();

  const isItemActive = (url: string, subItems?: NavMainItem["subItems"]) => {
    if (subItems?.length) {
      return subItems.some((sub) => path.startsWith(sub.url));
    }
    return path === url;
  };

  const isSubmenuOpen = (subItems?: NavMainItem["subItems"]) => {
    return subItems?.some((sub) => path.startsWith(sub.url)) ?? false;
  };

  return (
    <>
      <SidebarGroup>
        <SidebarGroupContent className="flex flex-col gap-2">
          <SidebarMenu>
            <SidebarMenuItem className="flex items-center gap-2">
              <SidebarMenuButton
                tooltip="Quick Create"
                className="bg-primary text-primary-foreground hover:bg-primary/90 hover:text-primary-foreground active:bg-primary/90 active:text-primary-foreground min-w-8 duration-200 ease-linear"
              >
                <PlusCircleIcon />
                <span>Quick Create</span>
              </SidebarMenuButton>
              <Button
                size="icon"
                className="h-9 w-9 shrink-0 group-data-[collapsible=icon]:opacity-0"
                variant="outline"
              >
                <MailIcon />
                <span className="sr-only">Inbox</span>
              </Button>
            </SidebarMenuItem>
          </SidebarMenu>
        </SidebarGroupContent>
      </SidebarGroup>
      {items.map((group) => (
        <SidebarGroup key={group.id}>
          {group.label && <SidebarGroupLabel>{group.label}</SidebarGroupLabel>}
          <SidebarGroupContent className="flex flex-col gap-2">
            <SidebarMenu>
              {group.items.map((item) => {
                if (state === "collapsed" && !isMobile) {
                  // If no subItems, just render the button as a link
                  if (!item.subItems) {
                    return (
                      <SidebarMenuItem key={item.title}>
                        <SidebarMenuButton
                          asChild
                          aria-disabled={item.comingSoon}
                          tooltip={item.title}
                          isActive={isItemActive(item.url)}
                        >
                          <Link href={item.url} target={item.newTab ? "_blank" : undefined}>
                            {item.icon && <item.icon />}
                            <span>{item.title}</span>
                          </Link>
                        </SidebarMenuButton>
                      </SidebarMenuItem>
                    );
                  }
                  // Otherwise, render the dropdown as before
                  return <NavItemCollapsed key={item.title} item={item} isActive={isItemActive} />;
                }
                // Expanded view
                return (
                  <NavItemExpanded key={item.title} item={item} isActive={isItemActive} isSubmenuOpen={isSubmenuOpen} />
                );
              })}
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      ))}
    </>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-secondary.tsx
````typescript
"use client";

import * as React from "react";

import { LucideIcon } from "lucide-react";

import {
  SidebarGroup,
  SidebarGroupContent,
  SidebarMenu,
  SidebarMenuButton,
  SidebarMenuItem,
} from "@/components/ui/sidebar";

export function NavSecondary({
  items,
  ...props
}: {
  items: {
    title: string;
    url: string;
    icon: LucideIcon;
  }[];
} & React.ComponentPropsWithoutRef<typeof SidebarGroup>) {
  return (
    <SidebarGroup {...props}>
      <SidebarGroupContent>
        <SidebarMenu>
          {items.map((item) => (
            <SidebarMenuItem key={item.title}>
              <SidebarMenuButton asChild>
                <a href={item.url}>
                  <item.icon />
                  <span>{item.title}</span>
                </a>
              </SidebarMenuButton>
            </SidebarMenuItem>
          ))}
        </SidebarMenu>
      </SidebarGroupContent>
    </SidebarGroup>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-user-clerk.tsx
````typescript
"use client";

import { useUser, useClerk } from "@clerk/nextjs";
import { EllipsisVertical, CircleUser, CreditCard, MessageSquareDot, LogOut } from "lucide-react";

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { SidebarMenu, SidebarMenuButton, SidebarMenuItem, useSidebar } from "@/components/ui/sidebar";
import { getInitials } from "@/lib/utils";

export function NavUserClerk() {
  const { isMobile } = useSidebar();
  const { user } = useUser();
  const { signOut, openUserProfile } = useClerk();

  if (!user) {
    return null;
  }

  const userName = user.fullName ?? user.username ?? "User";
  const userEmail = user.primaryEmailAddress?.emailAddress ?? "";
  const userAvatar = user.imageUrl;

  return (
    <SidebarMenu>
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <SidebarMenuButton
              size="lg"
              className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground"
            >
              <Avatar className="h-8 w-8 rounded-lg">
                <AvatarImage src={userAvatar} alt={userName} />
                <AvatarFallback className="rounded-lg">{getInitials(userName)}</AvatarFallback>
              </Avatar>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-medium">{userName}</span>
                <span className="text-muted-foreground truncate text-xs">{userEmail}</span>
              </div>
              <EllipsisVertical className="ml-auto size-4" />
            </SidebarMenuButton>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            className="w-(--radix-dropdown-menu-trigger-width) min-w-56 rounded-lg"
            side={isMobile ? "bottom" : "right"}
            align="end"
            sideOffset={4}
          >
            <DropdownMenuLabel className="p-0 font-normal">
              <div className="flex items-center gap-2 px-1 py-1.5 text-left text-sm">
                <Avatar className="h-8 w-8 rounded-lg">
                  <AvatarImage src={userAvatar} alt={userName} />
                  <AvatarFallback className="rounded-lg">{getInitials(userName)}</AvatarFallback>
                </Avatar>
                <div className="grid flex-1 text-left text-sm leading-tight">
                  <span className="truncate font-medium">{userName}</span>
                  <span className="text-muted-foreground truncate text-xs">{userEmail}</span>
                </div>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuGroup>
              <DropdownMenuItem onClick={() => openUserProfile()}>
                <CircleUser />
                Account
              </DropdownMenuItem>
              <DropdownMenuItem>
                <CreditCard />
                Billing
              </DropdownMenuItem>
              <DropdownMenuItem>
                <MessageSquareDot />
                Notifications
              </DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator />
            <DropdownMenuItem onClick={() => signOut()}>
              <LogOut />
              Log out
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    </SidebarMenu>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/nav-user.tsx
````typescript
"use client";

import { EllipsisVertical, CircleUser, CreditCard, MessageSquareDot, LogOut } from "lucide-react";

import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuItem,
  DropdownMenuLabel,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { SidebarMenu, SidebarMenuButton, SidebarMenuItem, useSidebar } from "@/components/ui/sidebar";
import { getInitials } from "@/lib/utils";

export function NavUser({
  user,
}: {
  readonly user: {
    readonly name: string;
    readonly email: string;
    readonly avatar: string;
  };
}) {
  const { isMobile } = useSidebar();

  return (
    <SidebarMenu>
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <SidebarMenuButton
              size="lg"
              className="data-[state=open]:bg-sidebar-accent data-[state=open]:text-sidebar-accent-foreground"
            >
              <Avatar className="h-8 w-8 rounded-lg grayscale">
                <AvatarImage src={user.avatar || undefined} alt={user.name} />
                <AvatarFallback className="rounded-lg">{getInitials(user.name)}</AvatarFallback>
              </Avatar>
              <div className="grid flex-1 text-left text-sm leading-tight">
                <span className="truncate font-medium">{user.name}</span>
                <span className="text-muted-foreground truncate text-xs">{user.email}</span>
              </div>
              <EllipsisVertical className="ml-auto size-4" />
            </SidebarMenuButton>
          </DropdownMenuTrigger>
          <DropdownMenuContent
            className="w-(--radix-dropdown-menu-trigger-width) min-w-56 rounded-lg"
            side={isMobile ? "bottom" : "right"}
            align="end"
            sideOffset={4}
          >
            <DropdownMenuLabel className="p-0 font-normal">
              <div className="flex items-center gap-2 px-1 py-1.5 text-left text-sm">
                <Avatar className="h-8 w-8 rounded-lg">
                  <AvatarImage src={user.avatar || undefined} alt={user.name} />
                  <AvatarFallback className="rounded-lg">{getInitials(user.name)}</AvatarFallback>
                </Avatar>
                <div className="grid flex-1 text-left text-sm leading-tight">
                  <span className="truncate font-medium">{user.name}</span>
                  <span className="text-muted-foreground truncate text-xs">{user.email}</span>
                </div>
              </div>
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            <DropdownMenuGroup>
              <DropdownMenuItem>
                <CircleUser />
                Account
              </DropdownMenuItem>
              <DropdownMenuItem>
                <CreditCard />
                Billing
              </DropdownMenuItem>
              <DropdownMenuItem>
                <MessageSquareDot />
                Notifications
              </DropdownMenuItem>
            </DropdownMenuGroup>
            <DropdownMenuSeparator />
            <DropdownMenuItem>
              <LogOut />
              Log out
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    </SidebarMenu>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/theme-switcher.tsx
````typescript
"use client";

import { Moon, Sun } from "lucide-react";

import { Button } from "@/components/ui/button";
import { updateThemeMode } from "@/lib/theme-utils";
import { setValueToCookie } from "@/server/server-actions";
import { usePreferencesStore } from "@/stores/preferences/preferences-provider";

export function ThemeSwitcher() {
  const themeMode = usePreferencesStore((s) => s.themeMode);
  const setThemeMode = usePreferencesStore((s) => s.setThemeMode);

  const handleValueChange = async () => {
    const newTheme = themeMode === "dark" ? "light" : "dark";
    updateThemeMode(newTheme);
    setThemeMode(newTheme);
    await setValueToCookie("theme_mode", newTheme);
  };

  return (
    <Button size="icon" onClick={handleValueChange}>
      {themeMode === "dark" ? <Sun /> : <Moon />}
    </Button>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/[...not-found]/page.tsx
````typescript
"use client";

export default function DashboardNotFound() {
  return (
    <div className="flex h-full flex-col items-center justify-center space-y-2 text-center">
      <h1 className="text-2xl font-semibold">Page not found.</h1>
      <p className="text-muted-foreground">This section will be added in future updates.</p>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/performance-metrics.tsx
````typescript
"use client";

import { Area, AreaChart, CartesianGrid, XAxis } from "recharts";

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";

const performanceData = Array.from({ length: 24 }, (_, i) => ({
  hour: `${i}:00`,
  responseTime: 50 + Math.random() * 100,
  throughput: 1000 + Math.random() * 500,
}));

export function PerformanceMetrics() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Performance Metrics</CardTitle>
        <CardDescription>Response time and throughput over 24 hours</CardDescription>
      </CardHeader>
      <CardContent>
        <ChartContainer
          config={{
            responseTime: { label: "Response Time (ms)", color: "hsl(var(--chart-1))" },
            throughput: { label: "Throughput (req/s)", color: "hsl(var(--chart-2))" },
          }}
        >
          <AreaChart accessibilityLayer data={performanceData} margin={{ left: 12, right: 12 }}>
            <CartesianGrid vertical={false} />
            <XAxis dataKey="hour" tickLine={false} axisLine={false} tickMargin={8} minTickGap={32} />
            <ChartTooltip cursor={false} content={<ChartTooltipContent indicator="dot" />} />
            <Area
              dataKey="responseTime"
              type="natural"
              fill="var(--color-responseTime)"
              fillOpacity={0.4}
              stroke="var(--color-responseTime)"
              stackId="a"
            />
            <Area
              dataKey="throughput"
              type="natural"
              fill="var(--color-throughput)"
              fillOpacity={0.4}
              stroke="var(--color-throughput)"
              stackId="b"
            />
          </AreaChart>
        </ChartContainer>
      </CardContent>
    </Card>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/system-health.tsx
````typescript
"use client";

import { Activity, CheckCircle, AlertCircle, XCircle } from "lucide-react";

import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Separator } from "@/components/ui/separator";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";

const systemComponents = [
  { name: "API Gateway", status: "operational", uptime: "99.9%", icon: CheckCircle, color: "text-green-500" },
  { name: "Database", status: "operational", uptime: "99.8%", icon: CheckCircle, color: "text-green-500" },
  { name: "Message Queue", status: "degraded", uptime: "98.2%", icon: AlertCircle, color: "text-amber-500" },
  { name: "Data Pipeline", status: "operational", uptime: "99.5%", icon: CheckCircle, color: "text-green-500" },
  { name: "Analytics Engine", status: "operational", uptime: "99.7%", icon: CheckCircle, color: "text-green-500" },
];

export function SystemHealth() {
  return (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <Activity className="size-5" />
          System Health
        </CardTitle>
        <CardDescription>Real-time component status</CardDescription>
      </CardHeader>
      <CardContent>
        <Tabs defaultValue="status">
          <TabsList className="grid w-full grid-cols-2">
            <TabsTrigger value="status">Status</TabsTrigger>
            <TabsTrigger value="uptime">Uptime</TabsTrigger>
          </TabsList>
          <TabsContent value="status" className="space-y-4">
            {systemComponents.map((component, i) => (
              <div key={i}>
                <div className="flex items-center justify-between">
                  <div className="flex items-center gap-2">
                    <component.icon className={`size-4 ${component.color}`} />
                    <span className="text-sm font-medium">{component.name}</span>
                  </div>
                  <span className="text-muted-foreground text-xs capitalize">{component.status}</span>
                </div>
                {i < systemComponents.length - 1 && <Separator className="mt-4" />}
              </div>
            ))}
          </TabsContent>
          <TabsContent value="uptime" className="space-y-4">
            {systemComponents.map((component, i) => (
              <div key={i}>
                <div className="flex items-center justify-between">
                  <span className="text-sm font-medium">{component.name}</span>
                  <span className="text-sm font-semibold tabular-nums">{component.uptime}</span>
                </div>
                {i < systemComponents.length - 1 && <Separator className="mt-4" />}
              </div>
            ))}
          </TabsContent>
        </Tabs>
      </CardContent>
    </Card>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/assets/[assetId]/page.tsx
````typescript
export default function AssetPage() {
  return (
    <div className="flex h-full flex-col items-center justify-center p-8 text-center">
      <h1 className="text-2xl font-bold">Asset Detail</h1>
      <p className="text-muted-foreground">This page is under construction.</p>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/assets/page.tsx
````typescript
import { auth } from "@clerk/nextjs/server";
import { Asset } from "@moondesk/domain";

import { DataTable } from "@/app/(main)/dashboard/overview/_components/data-table";
import { adaptAssetsToDistribution, adaptAssetsToTableRows } from "@/lib/adapters/dashboard-adapter";
import { moondeskApi } from "@/lib/api/api-client";

import { AssetInsightCards } from "./_components/asset-insight-cards";

export default async function Page() {
  const { getToken } = await auth();
  const token = await getToken();

  if (token) {
    moondeskApi.setToken(token);
  }

  const assets = await moondeskApi.getAssets().catch(() => []);

  const distributionData = adaptAssetsToDistribution(assets);
  const tableData = adaptAssetsToTableRows(assets);

  return (
    <div className="flex flex-col gap-4 md:gap-6">
      <AssetInsightCards data={distributionData} />
      <div className="@container/main">
        <DataTable data={tableData} />
      </div>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/coming-soon/page.tsx
````typescript
export default function Page() {
  return (
    <div className="flex h-full flex-col items-center justify-center space-y-2 text-center">
      <h1 className="text-2xl font-semibold">Page not found.</h1>
      <p className="text-muted-foreground">This page is under development and will be available in future updates.</p>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/columns.tsx
````typescript
import { ColumnDef } from "@tanstack/react-table";
import { CircleCheck, EllipsisVertical, AlertCircle, Clock, MapPin, Activity } from "lucide-react";
import { z } from "zod";

import { DataTableColumnHeader } from "@/components/data-table/data-table-column-header";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Checkbox } from "@/components/ui/checkbox";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";

import { assetSchema } from "./schema";

export const assetColumns: ColumnDef<z.infer<typeof assetSchema>>[] = [
  {
    id: "select",
    header: ({ table }) => (
      <div className="flex items-center justify-center">
        <Checkbox
          checked={table.getIsAllPageRowsSelected() || (table.getIsSomePageRowsSelected() && "indeterminate")}
          onCheckedChange={(value) => table.toggleAllPageRowsSelected(!!value)}
          aria-label="Select all"
        />
      </div>
    ),
    cell: ({ row }) => (
      <div className="flex items-center justify-center">
        <Checkbox
          checked={row.getIsSelected()}
          onCheckedChange={(value) => row.toggleSelected(!!value)}
          aria-label="Select row"
        />
      </div>
    ),
    enableSorting: false,
    enableHiding: false,
  },
  {
    accessorKey: "name",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Asset Name" />,
    cell: ({ row }) => <span className="font-medium">{row.getValue("name") as string}</span>,
    enableSorting: true,
  },
  {
    accessorKey: "type",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Type" />,
    cell: ({ row }) => (
      <div className="w-32">
        <Badge variant="outline" className="text-muted-foreground px-1.5">
          {row.getValue("type") as string}
        </Badge>
      </div>
    ),
    enableSorting: true,
  },
  {
    accessorKey: "status",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Status" />,
    cell: ({ row }) => {
      const status = row.getValue("status") as string;
      const isOnline = status === "Online";
      return (
        <Badge variant="outline" className="text-muted-foreground gap-1.5 px-1.5">
          {isOnline ? (
            <CircleCheck className="size-3.5 fill-green-500 dark:fill-green-400" />
          ) : (
            <AlertCircle className="fill-destructive/20 text-destructive size-3.5" />
          )}
          {status}
        </Badge>
      );
    },
    enableSorting: true,
  },
  {
    accessorKey: "location",
    header: ({ column }) => <DataTableColumnHeader column={column} title="Location" />,
    cell: ({ row }) => (
      <div className="text-muted-foreground flex items-center gap-1.5">
        <MapPin className="size-3.5" />
        <span>{row.getValue("location")}</span>
      </div>
    ),
    enableSorting: true,
  },
  {
    accessorKey: "lastReading",
    header: ({ column }) => <DataTableColumnHeader className="text-right" column={column} title="Last Reading" />,
    cell: ({ row }) => (
      <div className="flex items-center justify-end gap-1.5">
        <Activity className="text-muted-foreground size-3.5" />
        <span className="font-mono">{row.getValue("lastReading")}</span>
      </div>
    ),
    enableSorting: false,
  },
  {
    accessorKey: "lastSeen",
    header: ({ column }) => <DataTableColumnHeader className="text-right" column={column} title="Last Seen" />,
    cell: ({ row }) => (
      <div className="text-muted-foreground flex items-center justify-end gap-1.5">
        <Clock className="size-3.5" />
        <span>{row.getValue("lastSeen")}</span>
      </div>
    ),
    enableSorting: true,
  },
  {
    id: "actions",
    cell: () => (
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="ghost" className="data-[state=open]:bg-muted text-muted-foreground flex size-8" size="icon">
            <EllipsisVertical />
            <span className="sr-only">Open menu</span>
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="end" className="w-32">
          <DropdownMenuItem>View Details</DropdownMenuItem>
          <DropdownMenuItem>View Sensors</DropdownMenuItem>
          <DropdownMenuSeparator />
          <DropdownMenuItem variant="destructive">Maintenance</DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    ),
    enableSorting: false,
  },
];
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/schema.ts
````typescript
import { z } from "zod";

export const assetSchema = z.object({
  id: z.string(),
  name: z.string(),
  status: z.string(),
  type: z.string(),
  location: z.string(),
  lastReading: z.string(),
  lastSeen: z.string(),
  activeAlerts: z.number(),
});

// Legacy schema for table-cell-viewer (from demo template)
export const sectionSchema = z.object({
  id: z.string(),
  header: z.string(),
  type: z.string(),
  status: z.string(),
  target: z.string(),
  limit: z.string(),
  reviewer: z.string(),
});
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/overview/page.tsx
````typescript
import { auth } from "@clerk/nextjs/server";
import { Reading } from "@moondesk/domain";

import { ChartAreaInteractive } from "@/app/(main)/dashboard/overview/_components/chart-area-interactive";
import { DataTable } from "@/app/(main)/dashboard/overview/_components/data-table";
import { SectionCards } from "@/app/(main)/dashboard/overview/_components/section-cards";
import {
  adaptToMetricTrends,
  adaptReadingsToTimeSeries,
  adaptAssetsToTableRows,
} from "@/lib/adapters/dashboard-adapter";
import { moondeskApi } from "@/lib/api/api-client";

export default async function Page() {
  const { getToken } = await auth();
  const token = await getToken();

  if (token) {
    moondeskApi.setToken(token);
  }

  // Fetch data in parallel
  const [assets, alertStats, readingStats] = await Promise.all([
    moondeskApi.getAssets().catch(() => []),
    moondeskApi.getAlertStats().catch(() => undefined),
    moondeskApi.getReadingStats().catch(() => undefined),
  ]);

  // Fetch readings for chart (e.g., from the first asset with a sensor)
  // This is a simplification for the overview; a real dashboard might aggregate
  let readings: Reading[] = [];
  const firstAssetWithSensor = assets.find((a) => a.sensors && a.sensors.length > 0);
  if (firstAssetWithSensor && firstAssetWithSensor.sensors?.[0]) {
    readings = await moondeskApi.getRecentReadings(firstAssetWithSensor.sensors[0].id).catch(() => []);
  }

  // Adapt data
  const stats = adaptToMetricTrends(assets, readingStats, alertStats);
  const chartData = adaptReadingsToTimeSeries(readings);
  const tableData = adaptAssetsToTableRows(assets);

  return (
    <div className="@container/main flex flex-col gap-4 md:gap-6">
      <SectionCards stats={stats} />
      <ChartAreaInteractive data={chartData} />
      <DataTable data={tableData} />
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/page.tsx
````typescript
export default function Page() {
  return <>Coming Soon</>;
}
````

## File: apps/moondesk-dash/src/app/organization/[[...organization]]/page.tsx
````typescript
import { OrganizationProfile } from "@clerk/nextjs";

export default function OrganizationPage() {
  return (
    <div className="bg-background flex min-h-screen items-center justify-center">
      <OrganizationProfile />
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/sentry-example-page/page.tsx
````typescript
"use client";

import { useState, useEffect } from "react";

import Head from "next/head";

import * as Sentry from "@sentry/nextjs";

class SentryExampleFrontendError extends Error {
  constructor(message: string | undefined) {
    super(message);
    this.name = "SentryExampleFrontendError";
  }
}

export default function Page() {
  const [hasSentError, setHasSentError] = useState(false);
  const [isConnected, setIsConnected] = useState(true);

  useEffect(() => {
    async function checkConnectivity() {
      const result = await Sentry.diagnoseSdkConnectivity();
      setIsConnected(result !== "sentry-unreachable");
    }
    checkConnectivity();
  }, []);

  return (
    <div>
      <Head>
        <title>sentry-example-page</title>
        <meta name="description" content="Test Sentry for your Next.js app!" />
      </Head>

      <main>
        <div className="flex-spacer" />
        <svg height="40" width="40" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M21.85 2.995a3.698 3.698 0 0 1 1.353 1.354l16.303 28.278a3.703 3.703 0 0 1-1.354 5.053 3.694 3.694 0 0 1-1.848.496h-3.828a31.149 31.149 0 0 0 0-3.09h3.815a.61.61 0 0 0 .537-.917L20.523 5.893a.61.61 0 0 0-1.057 0l-3.739 6.494a28.948 28.948 0 0 1 9.63 10.453 28.988 28.988 0 0 1 3.499 13.78v1.542h-9.852v-1.544a19.106 19.106 0 0 0-2.182-8.85 19.08 19.08 0 0 0-6.032-6.829l-1.85 3.208a15.377 15.377 0 0 1 6.382 12.484v1.542H3.696A3.694 3.694 0 0 1 0 34.473c0-.648.17-1.286.494-1.849l2.33-4.074a8.562 8.562 0 0 1 2.689 1.536L3.158 34.17a.611.611 0 0 0 .538.917h8.448a12.481 12.481 0 0 0-6.037-9.09l-1.344-.772 4.908-8.545 1.344.77a22.16 22.16 0 0 1 7.705 7.444 22.193 22.193 0 0 1 3.316 10.193h3.699a25.892 25.892 0 0 0-3.811-12.033 25.856 25.856 0 0 0-9.046-8.796l-1.344-.772 5.269-9.136a3.698 3.698 0 0 1 3.2-1.849c.648 0 1.285.17 1.847.495Z"
            fill="currentcolor"
          />
        </svg>
        <h1>sentry-example-page</h1>

        <p className="description">
          Click the button below, and view the sample error on the Sentry{" "}
          <a target="_blank" href="https://moondesk.sentry.io/issues/?project=4510518434463824">
            Issues Page
          </a>
          . For more details about setting up Sentry,{" "}
          <a target="_blank" href="https://docs.sentry.io/platforms/javascript/guides/nextjs/">
            read our docs
          </a>
          .
        </p>

        <button
          type="button"
          onClick={async () => {
            await Sentry.startSpan(
              {
                name: "Example Frontend/Backend Span",
                op: "test",
              },
              async () => {
                const res = await fetch("/api/sentry-example-api");
                if (!res.ok) {
                  setHasSentError(true);
                }
              },
            );
            throw new SentryExampleFrontendError("This error is raised on the frontend of the example page.");
          }}
          disabled={!isConnected}
        >
          <span>Throw Sample Error</span>
        </button>

        {hasSentError ? (
          <p className="success">Error sent to Sentry.</p>
        ) : !isConnected ? (
          <div className="connectivity-error">
            <p>
              It looks like network requests to Sentry are being blocked, which will prevent errors from being captured.
              Try disabling your ad-blocker to complete the test.
            </p>
          </div>
        ) : (
          <div className="success_placeholder" />
        )}

        <div className="flex-spacer" />
      </main>

      <style>{`
        main {
          display: flex;
          min-height: 100vh;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 16px;
          padding: 16px;
          font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif;
        }

        h1 {
          padding: 0px 4px;
          border-radius: 4px;
          background-color: rgba(24, 20, 35, 0.03);
          font-family: monospace;
          font-size: 20px;
          line-height: 1.2;
        }

        p {
          margin: 0;
          font-size: 20px;
        }

        a {
          color: #6341F0;
          text-decoration: underline;
          cursor: pointer;

          @media (prefers-color-scheme: dark) {
            color: #B3A1FF;
          }
        }

        button {
          border-radius: 8px;
          color: white;
          cursor: pointer;
          background-color: #553DB8;
          border: none;
          padding: 0;
          margin-top: 4px;

          & > span {
            display: inline-block;
            padding: 12px 16px;
            border-radius: inherit;
            font-size: 20px;
            font-weight: bold;
            line-height: 1;
            background-color: #7553FF;
            border: 1px solid #553DB8;
            transform: translateY(-4px);
          }

          &:hover > span {
            transform: translateY(-8px);
          }

          &:active > span {
            transform: translateY(0);
          }

          &:disabled {
	            cursor: not-allowed;
	            opacity: 0.6;
	
	            & > span {
	              transform: translateY(0);
	              border: none
	            }
	          }
        }

        .description {
          text-align: center;
          color: #6E6C75;
          max-width: 500px;
          line-height: 1.5;
          font-size: 20px;

          @media (prefers-color-scheme: dark) {
            color: #A49FB5;
          }
        }

        .flex-spacer {
          flex: 1;
        }

        .success {
          padding: 12px 16px;
          border-radius: 8px;
          font-size: 20px;
          line-height: 1;
          background-color: #00F261;
          border: 1px solid #00BF4D;
          color: #181423;
        }

        .success_placeholder {
          height: 46px;
        }

        .connectivity-error {
          padding: 12px 16px;
          background-color: #E50045;
          border-radius: 8px;
          width: 500px;
          color: #FFFFFF;
          border: 1px solid #A80033;
          text-align: center;
          margin: 0;
        }
        
        .connectivity-error a {
          color: #FFFFFF;
          text-decoration: underline;
        }
      `}</style>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/sso-callback/page.tsx
````typescript
import { AuthenticateWithRedirectCallback } from "@clerk/nextjs";

export default function SSOCallback() {
  return <AuthenticateWithRedirectCallback />;
}
````

## File: apps/moondesk-dash/src/app/global-error.tsx
````typescript
"use client";

import { useEffect } from "react";

import NextError from "next/error";

import * as Sentry from "@sentry/nextjs";

export default function GlobalError({ error }: { error: Error & { digest?: string } }) {
  useEffect(() => {
    Sentry.captureException(error);
  }, [error]);

  return (
    <html>
      <body>
        {/* `NextError` is the default Next.js error page component. Its type
        definition requires a `statusCode` prop. However, since the App Router
        does not expose status codes for errors, we simply pass 0 to render a
        generic error message. */}
        <NextError statusCode={0} />
      </body>
    </html>
  );
}
````

## File: apps/moondesk-dash/src/app/globals.css
````css
@import "tailwindcss";
/* @import "tw-animate-css"; */

/* Theme preset styles: these override CSS variables based on the selected data-theme-preset */
@import "../styles/presets/brutalist.css";
@import "../styles/presets/soft-pop.css";
@import "../styles/presets/tangerine.css";

@import "@clerk/themes/shadcn.css";

@custom-variant dark (&:is(.dark *));

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-sidebar-ring: var(--sidebar-ring);
  --color-sidebar-border: var(--sidebar-border);
  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
  --color-sidebar-accent: var(--sidebar-accent);
  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
  --color-sidebar-primary: var(--sidebar-primary);
  --color-sidebar-foreground: var(--sidebar-foreground);
  --color-sidebar: var(--sidebar);
  --color-chart-5: var(--chart-5);
  --color-chart-4: var(--chart-4);
  --color-chart-3: var(--chart-3);
  --color-chart-2: var(--chart-2);
  --color-chart-1: var(--chart-1);
  --color-ring: var(--ring);
  --color-input: var(--input);
  --color-border: var(--border);
  --color-destructive: var(--destructive);
  --color-accent-foreground: var(--accent-foreground);
  --color-accent: var(--accent);
  --color-muted-foreground: var(--muted-foreground);
  --color-muted: var(--muted);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-secondary: var(--secondary);
  --color-primary-foreground: var(--primary-foreground);
  --color-primary: var(--primary);
  --color-popover-foreground: var(--popover-foreground);
  --color-popover: var(--popover);
  --color-card-foreground: var(--card-foreground);
  --color-card: var(--card);
  --radius-sm: calc(var(--radius) - 4px);
  --radius-md: calc(var(--radius) - 2px);
  --radius-lg: var(--radius);
  --radius-xl: calc(var(--radius) + 4px);
}

/* Default theme styles (used when no data-theme-preset is set or when 'default' is selected).
These serve as the fallback; there is no separate default.css file. */
:root {
  --radius: 0.625rem;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.145 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --secondary: oklch(0.97 0 0);
  --secondary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --accent: oklch(0.97 0 0);
  --accent-foreground: oklch(0.205 0 0);
  --destructive: oklch(0.577 0.245 27.325);
  --border: oklch(0.922 0 0);
  --input: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
  --chart-1: oklch(0.3211 0 0);
  --chart-2: oklch(0.4495 0 0);
  --chart-3: oklch(0.5693 0 0);
  --chart-4: oklch(0.683 0 0);
  --chart-5: oklch(0.7921 0 0);
  --sidebar: oklch(0.985 0 0);
  --sidebar-foreground: oklch(0.145 0 0);
  --sidebar-primary: oklch(0.205 0 0);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.97 0 0);
  --sidebar-accent-foreground: oklch(0.205 0 0);
  --sidebar-border: oklch(0.922 0 0);
  --sidebar-ring: oklch(0.708 0 0);
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
}

.dark {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --card: oklch(0.205 0 0);
  --card-foreground: oklch(0.985 0 0);
  --popover: oklch(0.205 0 0);
  --popover-foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --secondary: oklch(0.269 0 0);
  --secondary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --accent: oklch(0.269 0 0);
  --accent-foreground: oklch(0.985 0 0);
  --destructive: oklch(0.704 0.191 22.216);
  --border: oklch(1 0 0 / 10%);
  --input: oklch(1 0 0 / 15%);
  --ring: oklch(0.556 0 0);
  --chart-1: oklch(0.9521 0 0);
  --chart-2: oklch(0.8576 0 0);
  --chart-3: oklch(0.7572 0 0);
  --chart-4: oklch(0.6534 0 0);
  --chart-5: oklch(0.5452 0 0);
  --sidebar: oklch(0.205 0 0);
  --sidebar-foreground: oklch(0.985 0 0);
  --sidebar-primary: oklch(0.488 0.243 264.376);
  --sidebar-primary-foreground: oklch(0.985 0 0);
  --sidebar-accent: oklch(0.269 0 0);
  --sidebar-accent-foreground: oklch(0.985 0 0);
  --sidebar-border: oklch(1 0 0 / 10%);
  --sidebar-ring: oklch(0.556 0 0);
}

@layer utilities {
  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-2xs {
    box-shadow: var(--shadow-2xs);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-xs {
    box-shadow: var(--shadow-xs);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-sm {
    box-shadow: var(--shadow-sm);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow {
    box-shadow: var(--shadow);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-md {
    box-shadow: var(--shadow-md);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-lg {
    box-shadow: var(--shadow-lg);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-xl {
    box-shadow: var(--shadow-xl);
  }

  [data-theme-preset]:not([data-theme-preset="default"]) .shadow-2xl {
    box-shadow: var(--shadow-2xl);
  }
}

@layer base {
  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply bg-background text-foreground;
  }
}

html {
  overscroll-behavior: none;
}

.disable-transitions * {
  transition: none !important;
}
````

## File: apps/moondesk-dash/src/app/layout.tsx
````typescript
import { ReactNode } from "react";

import type { Metadata } from "next";
import { Inter } from "next/font/google";

import { ClerkProvider } from "@clerk/nextjs";
import { dark } from "@clerk/themes";

import { Toaster } from "@/components/ui/sonner";
import { APP_CONFIG } from "@/config";
import { getPreference } from "@/server/server-actions";
import { PreferencesStoreProvider } from "@/stores/preferences/preferences-provider";
import { THEME_MODE_VALUES, THEME_PRESET_VALUES, type ThemePreset, type ThemeMode } from "@/types/preferences/theme";

import "./globals.css";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: APP_CONFIG.meta.title,
  description: APP_CONFIG.meta.description,
};

export default async function RootLayout({ children }: Readonly<{ children: ReactNode }>) {
  const themeMode = await getPreference<ThemeMode>("theme_mode", THEME_MODE_VALUES, "light");
  const themePreset = await getPreference<ThemePreset>("theme_preset", THEME_PRESET_VALUES, "default");

  return (
    <ClerkProvider
      appearance={{
        baseTheme: themeMode === "dark" ? dark : undefined,
      }}
    >
      <html
        lang="en"
        className={themeMode === "dark" ? "dark" : ""}
        data-theme-preset={themePreset}
        suppressHydrationWarning
      >
        <body className={`${inter.className} min-h-screen antialiased`}>
          <PreferencesStoreProvider themeMode={themeMode} themePreset={themePreset}>
            {children}
            <Toaster />
          </PreferencesStoreProvider>
        </body>
      </html>
    </ClerkProvider>
  );
}
````

## File: apps/moondesk-dash/src/app/not-found.tsx
````typescript
"use client";

import Link from "next/link";

import { Button } from "@/components/ui/button";

export default function NotFound() {
  return (
    <div className="flex h-dvh flex-col items-center justify-center space-y-2 text-center">
      <h1 className="text-2xl font-semibold">Page not found.</h1>
      <p className="text-muted-foreground">The page you are looking for could not be found.</p>
      <Link replace href="/dashboard/default">
        <Button variant="outline">Go back home</Button>
      </Link>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/components/data-table/data-table-column-header.tsx
````typescript
import { Column } from "@tanstack/react-table";
import { ArrowDown, ArrowUp, ChevronsUpDown, EyeOff } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
} from "@/components/ui/dropdown-menu";
import { cn } from "@/lib/utils";

interface DataTableColumnHeaderProps<TData, TValue> extends React.HTMLAttributes<HTMLDivElement> {
  column: Column<TData, TValue>;
  title: string;
}

function getSortIcon(sort: "asc" | "desc" | false | undefined) {
  switch (sort) {
    case "desc":
      return <ArrowDown />;
    case "asc":
      return <ArrowUp />;
    default:
      return <ChevronsUpDown />;
  }
}

export function DataTableColumnHeader<TData, TValue>({
  column,
  title,
  className,
}: DataTableColumnHeaderProps<TData, TValue>) {
  if (!column.getCanSort()) {
    return <div className={cn(className)}>{title}</div>;
  }
  return (
    <div className={cn("flex items-center space-x-2", className)}>
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <Button variant="ghost" size="sm" className="data-[state=open]:bg-accent -ml-3 h-8">
            <span>{title}</span>
            {getSortIcon(column.getIsSorted())}
          </Button>
        </DropdownMenuTrigger>
        <DropdownMenuContent align="start">
          <DropdownMenuItem onClick={() => column.toggleSorting(false)}>
            <ArrowUp className="text-muted-foreground/70 h-3.5 w-3.5" />
            Asc
          </DropdownMenuItem>
          <DropdownMenuItem onClick={() => column.toggleSorting(true)}>
            <ArrowDown className="text-muted-foreground/70 h-3.5 w-3.5" />
            Desc
          </DropdownMenuItem>
          {column.columnDef.enableHiding !== false && (
            <>
              <DropdownMenuSeparator />
              <DropdownMenuItem onClick={() => column.toggleVisibility(false)}>
                <EyeOff className="text-muted-foreground/70 h-3.5 w-3.5" />
                Hide
              </DropdownMenuItem>
            </>
          )}
        </DropdownMenuContent>
      </DropdownMenu>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/components/data-table/data-table-pagination.tsx
````typescript
import { Table } from "@tanstack/react-table";
import { ChevronRight, ChevronsRight, ChevronLeft, ChevronsLeft } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";

interface DataTablePaginationProps<TData> {
  table: Table<TData>;
}

export function DataTablePagination<TData>({ table }: DataTablePaginationProps<TData>) {
  return (
    <div className="flex items-center justify-between px-4">
      <div className="text-muted-foreground hidden flex-1 text-sm lg:flex">
        {table.getFilteredSelectedRowModel().rows.length} of {table.getFilteredRowModel().rows.length} row(s) selected.
      </div>
      <div className="flex w-full items-center gap-8 lg:w-fit">
        <div className="hidden items-center gap-2 lg:flex">
          <Label htmlFor="rows-per-page" className="text-sm font-medium">
            Rows per page
          </Label>
          <Select
            value={`${table.getState().pagination.pageSize}`}
            onValueChange={(value) => {
              table.setPageSize(Number(value));
            }}
          >
            <SelectTrigger size="sm" className="w-20" id="rows-per-page">
              <SelectValue placeholder={table.getState().pagination.pageSize} />
            </SelectTrigger>
            <SelectContent side="top">
              {[10, 20, 30, 40, 50].map((pageSize) => (
                <SelectItem key={pageSize} value={`${pageSize}`}>
                  {pageSize}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
        <div className="flex w-fit items-center justify-center text-sm font-medium">
          Page {table.getState().pagination.pageIndex + 1} of {table.getPageCount()}
        </div>
        <div className="ml-auto flex items-center gap-2 lg:ml-0">
          <Button
            variant="outline"
            className="hidden h-8 w-8 p-0 lg:flex"
            onClick={() => table.setPageIndex(0)}
            disabled={!table.getCanPreviousPage()}
          >
            <span className="sr-only">Go to first page</span>
            <ChevronsLeft />
          </Button>
          <Button
            variant="outline"
            className="size-8"
            size="icon"
            onClick={() => table.previousPage()}
            disabled={!table.getCanPreviousPage()}
          >
            <span className="sr-only">Go to previous page</span>
            <ChevronLeft />
          </Button>
          <Button
            variant="outline"
            className="size-8"
            size="icon"
            onClick={() => table.nextPage()}
            disabled={!table.getCanNextPage()}
          >
            <span className="sr-only">Go to next page</span>
            <ChevronRight />
          </Button>
          <Button
            variant="outline"
            className="hidden size-8 lg:flex"
            size="icon"
            onClick={() => table.setPageIndex(table.getPageCount() - 1)}
            disabled={!table.getCanNextPage()}
          >
            <span className="sr-only">Go to last page</span>
            <ChevronsRight />
          </Button>
        </div>
      </div>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/components/data-table/data-table-view-options.tsx
````typescript
"use client";

import { Table } from "@tanstack/react-table";
import { Settings2 } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  DropdownMenu,
  DropdownMenuTrigger,
  DropdownMenuCheckboxItem,
  DropdownMenuContent,
  DropdownMenuLabel,
  DropdownMenuSeparator,
} from "@/components/ui/dropdown-menu";

interface DataTableViewOptionsProps<TData> {
  table: Table<TData>;
}

export function DataTableViewOptions<TData>({ table }: DataTableViewOptionsProps<TData>) {
  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <Button variant="outline" size="sm" className="ml-auto hidden h-8 lg:flex">
          <Settings2 />
          View
        </Button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-[150px]">
        <DropdownMenuLabel>Toggle columns</DropdownMenuLabel>
        <DropdownMenuSeparator />
        {table
          .getAllColumns()
          .filter((column) => typeof column.accessorFn !== "undefined" && column.getCanHide())
          .map((column) => {
            return (
              <DropdownMenuCheckboxItem
                key={column.id}
                className="capitalize"
                checked={column.getIsVisible()}
                onCheckedChange={(value) => column.toggleVisibility(!!value)}
              >
                {column.id}
              </DropdownMenuCheckboxItem>
            );
          })}
      </DropdownMenuContent>
    </DropdownMenu>
  );
}
````

## File: apps/moondesk-dash/src/components/data-table/data-table.tsx
````typescript
import * as React from "react";

import {
  KeyboardSensor,
  MouseSensor,
  TouchSensor,
  useSensor,
  useSensors,
  DndContext,
  closestCenter,
  type UniqueIdentifier,
  type DragEndEvent,
} from "@dnd-kit/core";
import { restrictToVerticalAxis } from "@dnd-kit/modifiers";
import { SortableContext, verticalListSortingStrategy, arrayMove } from "@dnd-kit/sortable";
import { ColumnDef, flexRender, type Table as TanStackTable } from "@tanstack/react-table";

import { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from "@/components/ui/table";

import { DraggableRow } from "./draggable-row";

interface DataTableProps<TData, TValue> {
  table: TanStackTable<TData>;
  columns: ColumnDef<TData, TValue>[];
  dndEnabled?: boolean;
  onReorder?: (newData: TData[]) => void;
}

function renderTableBody<TData, TValue>({
  table,
  columns,
  dndEnabled,
  dataIds,
}: {
  table: TanStackTable<TData>;
  columns: ColumnDef<TData, TValue>[];
  dndEnabled: boolean;
  dataIds: UniqueIdentifier[];
}) {
  if (!table.getRowModel().rows.length) {
    return (
      <TableRow>
        <TableCell colSpan={columns.length} className="h-24 text-center">
          No results.
        </TableCell>
      </TableRow>
    );
  }
  if (dndEnabled) {
    return (
      <SortableContext items={dataIds} strategy={verticalListSortingStrategy}>
        {table.getRowModel().rows.map((row) => (
          <DraggableRow key={row.id} row={row} />
        ))}
      </SortableContext>
    );
  }
  return table.getRowModel().rows.map((row) => (
    <TableRow key={row.id} data-state={row.getIsSelected() && "selected"}>
      {row.getVisibleCells().map((cell) => (
        <TableCell key={cell.id}>{flexRender(cell.column.columnDef.cell, cell.getContext())}</TableCell>
      ))}
    </TableRow>
  ));
}

export function DataTable<TData, TValue>({
  table,
  columns,
  dndEnabled = false,
  onReorder,
}: DataTableProps<TData, TValue>) {
  const dataIds: UniqueIdentifier[] = table.getRowModel().rows.map((row) => Number(row.id) as UniqueIdentifier);
  const sortableId = React.useId();
  const sensors = useSensors(useSensor(MouseSensor, {}), useSensor(TouchSensor, {}), useSensor(KeyboardSensor, {}));

  function handleDragEnd(event: DragEndEvent) {
    const { active, over } = event;
    if (over && active.id !== over.id && onReorder) {
      const oldIndex = dataIds.indexOf(active.id);
      const newIndex = dataIds.indexOf(over.id);

      // Call parent with new data order (parent manages state)
      const newData = arrayMove(table.options.data, oldIndex, newIndex);
      onReorder(newData);
    }
  }

  const tableContent = (
    <Table>
      <TableHeader className="bg-muted sticky top-0 z-10">
        {table.getHeaderGroups().map((headerGroup) => (
          <TableRow key={headerGroup.id}>
            {headerGroup.headers.map((header) => {
              return (
                <TableHead key={header.id} colSpan={header.colSpan}>
                  {header.isPlaceholder ? null : flexRender(header.column.columnDef.header, header.getContext())}
                </TableHead>
              );
            })}
          </TableRow>
        ))}
      </TableHeader>
      <TableBody className="**:data-[slot=table-cell]:first:w-8">
        {renderTableBody({ table, columns, dndEnabled, dataIds })}
      </TableBody>
    </Table>
  );

  if (dndEnabled) {
    return (
      <DndContext
        collisionDetection={closestCenter}
        modifiers={[restrictToVerticalAxis]}
        onDragEnd={handleDragEnd}
        sensors={sensors}
        id={sortableId}
      >
        {tableContent}
      </DndContext>
    );
  }

  return tableContent;
}
````

## File: apps/moondesk-dash/src/components/data-table/drag-column.tsx
````typescript
import { useSortable } from "@dnd-kit/sortable";
import { ColumnDef } from "@tanstack/react-table";
import { GripVertical } from "lucide-react";

import { Button } from "@/components/ui/button";

function DragHandle({ id }: { id: number }) {
  const { attributes, listeners } = useSortable({
    id,
  });

  return (
    <Button
      {...attributes}
      {...listeners}
      variant="ghost"
      size="icon"
      className="text-muted-foreground size-7 hover:bg-transparent"
    >
      <GripVertical className="text-muted-foreground size-3" />
      <span className="sr-only">Drag to reorder</span>
    </Button>
  );
}

export const dragColumn: ColumnDef<any> = {
  id: "drag",
  header: () => null,
  cell: ({ row }) => <DragHandle id={row.original.id} />,
  enableSorting: false,
  enableHiding: false,
};
````

## File: apps/moondesk-dash/src/components/data-table/draggable-row.tsx
````typescript
import { useSortable } from "@dnd-kit/sortable";
import { CSS } from "@dnd-kit/utilities";
import { Row, flexRender } from "@tanstack/react-table";

import { TableCell, TableRow } from "@/components/ui/table";

export function DraggableRow<TData>({ row }: { row: Row<TData> }) {
  const { transform, transition, setNodeRef, isDragging } = useSortable({
    id: (row.original as { id: number }).id,
  });
  return (
    <TableRow
      data-state={row.getIsSelected() && "selected"}
      data-dragging={isDragging}
      ref={setNodeRef}
      className="relative z-0 data-[dragging=true]:z-10 data-[dragging=true]:opacity-80"
      style={{
        transform: CSS.Transform.toString(transform),
        transition: transition,
      }}
    >
      {row.getVisibleCells().map((cell) => (
        <TableCell key={cell.id}>{flexRender(cell.column.columnDef.cell, cell.getContext())}</TableCell>
      ))}
    </TableRow>
  );
}
````

## File: apps/moondesk-dash/src/components/data-table/table-utils.ts
````typescript
import type { ColumnDef } from "@tanstack/react-table";

import { dragColumn } from "./drag-column";

export function withDndColumn<T>(columns: ColumnDef<T>[]): ColumnDef<T>[] {
  return [dragColumn as ColumnDef<T>, ...columns];
}
````

## File: apps/moondesk-dash/src/components/providers/query-provider.tsx
````typescript
"use client";

import { useState } from "react";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";

export function QueryProvider({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60 * 1000,
          },
        },
      }),
  );

  return <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>;
}
````

## File: apps/moondesk-dash/src/components/simple-icon.tsx
````typescript
"use client";

import * as React from "react";

import type { SimpleIcon } from "simple-icons";

import { cn } from "@/lib/utils";

type SimpleIconProps = {
  icon: SimpleIcon;
  className?: string;
} & React.SVGProps<SVGSVGElement>;

export function SimpleIcon({ icon, className, ...props }: SimpleIconProps) {
  const { title, path } = icon;

  return (
    <svg
      viewBox="0 0 24 24"
      aria-label={title}
      aria-hidden="false"
      focusable="false"
      className={cn("fill-foreground size-5", className)}
      {...props}
    >
      <title>{title}</title>
      <path d={path} />
    </svg>
  );
}
````

## File: apps/moondesk-dash/src/hooks/__tests__/use-signalr.test.ts
````typescript
import { HubConnectionBuilder } from "@microsoft/signalr";
import { describe, it, expect, vi } from "vitest";

import { useSignalR } from "../use-signalr";

// Mock SignalR module
vi.mock("@microsoft/signalr", () => {
  const mockConnection = {
    on: vi.fn(),
    start: vi.fn().mockResolvedValue(undefined),
    stop: vi.fn().mockResolvedValue(undefined),
    state: "Connected",
  };

  return {
    HubConnectionBuilder: vi.fn().mockImplementation(() => ({
      withUrl: vi.fn().mockReturnThis(),
      withAutomaticReconnect: vi.fn().mockReturnThis(),
      build: vi.fn().mockReturnValue(mockConnection),
    })),
    HubConnectionState: {
      Connected: "Connected",
      Disconnected: "Disconnected",
    },
  };
});

describe("useSignalR", () => {
  it("hook is defined", () => {
    expect(useSignalR).toBeDefined();
    expect(typeof useSignalR).toBe("function");
  });

  it("SignalR builder is mocked correctly", () => {
    const builder = new HubConnectionBuilder();

    expect(builder.withUrl).toBeDefined();
    expect(builder.withAutomaticReconnect).toBeDefined();
    expect(builder.build).toBeDefined();
  });
});
````

## File: apps/moondesk-dash/src/hooks/use-data-table-instance.ts
````typescript
import * as React from "react";

import {
  ColumnDef,
  ColumnFiltersState,
  SortingState,
  VisibilityState,
  getCoreRowModel,
  getFacetedRowModel,
  getFacetedUniqueValues,
  getFilteredRowModel,
  getPaginationRowModel,
  getSortedRowModel,
  useReactTable,
} from "@tanstack/react-table";

type UseDataTableInstanceProps<TData, TValue> = {
  data: TData[];
  columns: ColumnDef<TData, TValue>[];
  enableRowSelection?: boolean;
  defaultPageIndex?: number;
  defaultPageSize?: number;
  getRowId?: (row: TData, index: number) => string;
};

export function useDataTableInstance<TData, TValue>({
  data,
  columns,
  enableRowSelection = true,
  defaultPageIndex,
  defaultPageSize,
  getRowId,
}: UseDataTableInstanceProps<TData, TValue>) {
  const [rowSelection, setRowSelection] = React.useState({});
  const [columnVisibility, setColumnVisibility] = React.useState<VisibilityState>({});
  const [columnFilters, setColumnFilters] = React.useState<ColumnFiltersState>([]);
  const [sorting, setSorting] = React.useState<SortingState>([]);
  const [pagination, setPagination] = React.useState({
    pageIndex: defaultPageIndex ?? 0,
    pageSize: defaultPageSize ?? 10,
  });

  const table = useReactTable({
    data,
    columns,
    state: {
      sorting,
      columnVisibility,
      rowSelection,
      columnFilters,
      pagination,
    },
    enableRowSelection,
    getRowId: getRowId ?? ((row) => (row as { id: string | number }).id.toString()),
    onRowSelectionChange: setRowSelection,
    onSortingChange: setSorting,
    onColumnFiltersChange: setColumnFilters,
    onColumnVisibilityChange: setColumnVisibility,
    onPaginationChange: setPagination,
    getCoreRowModel: getCoreRowModel(),
    getFilteredRowModel: getFilteredRowModel(),
    getPaginationRowModel: getPaginationRowModel(),
    getSortedRowModel: getSortedRowModel(),
    getFacetedRowModel: getFacetedRowModel(),
    getFacetedUniqueValues: getFacetedUniqueValues(),
  });

  return table;
}
````

## File: apps/moondesk-dash/src/hooks/use-mobile.ts
````typescript
import * as React from "react";

const MOBILE_BREAKPOINT = 768;

export function useIsMobile() {
  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined);

  React.useEffect(() => {
    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`);
    const onChange = () => {
      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    };
    mql.addEventListener("change", onChange);
    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT);
    return () => mql.removeEventListener("change", onChange);
  }, []);

  return !!isMobile;
}
````

## File: apps/moondesk-dash/src/hooks/use-signalr.ts
````typescript
import { useEffect, useState } from "react";

import { HubConnection, HubConnectionBuilder, HubConnectionState } from "@microsoft/signalr";
import { Alert, Reading } from "@moondesk/domain";
import { useQueryClient } from "@tanstack/react-query";

const HUB_URL = process.env.NEXT_PUBLIC_API_URL?.replace("/api", "") + "/hubs/iot" || "http://localhost:5000/hubs/iot";

export function useSignalR() {
  const [connection, setConnection] = useState<HubConnection | null>(null);
  const queryClient = useQueryClient();

  useEffect(() => {
    const newConnection = new HubConnectionBuilder().withUrl(HUB_URL).withAutomaticReconnect().build();

    newConnection.on("ReceiveReading", (reading: Reading) => {
      queryClient.setQueryData(["readings", reading.sensorId, 24], (old: Reading[] = []) =>
        [...old, reading].slice(-100),
      );
    });

    newConnection.on("ReceiveAlert", (alert: Alert) => {
      queryClient.setQueryData(["alerts"], (old: Alert[] = []) => [alert, ...old]);
      queryClient.invalidateQueries({ queryKey: ["stats"] });
    });

    newConnection.on("AssetStatusChanged", () => {
      queryClient.invalidateQueries({ queryKey: ["assets"] });
      queryClient.invalidateQueries({ queryKey: ["stats"] });
    });

    newConnection
      .start()
      .then(() => setConnection(newConnection))
      .catch(console.error);

    return () => {
      if (newConnection.state === HubConnectionState.Connected) {
        newConnection.stop();
      }
    };
  }, [queryClient]);

  return connection;
}
````

## File: apps/moondesk-dash/src/lib/adapters/__tests__/dashboard-adapter.test.ts
````typescript
import {
  Asset,
  Alert,
  ReadingStats,
  AssetStatus,
  SensorType,
  Parameter,
  Protocol,
  AlertSeverity,
} from "@moondesk/domain";
import { describe, it, expect } from "vitest";

import { adaptToMetricTrends } from "../dashboard-adapter";

describe("dashboard-adapter", () => {
  it("should adapt ReadingStats to MetricTrend", () => {
    const assets: Asset[] = [];
    const alerts: Alert[] = [];
    const readingStats: ReadingStats = {
      total: 1234567,
      dailyTrend: 0,
      qualityScore: 0,
      trends: [
        { bucket: "2023-01-01", count: 100 },
        { bucket: "2023-01-02", count: 5000 }, // Last bucket
      ],
    };

    const trends = adaptToMetricTrends(assets, readingStats, undefined);

    const readingsCard = trends.find((t) => t.title === "Total Readings");
    expect(readingsCard).toBeDefined();
    expect(readingsCard?.value).toBe("1,234,567");
    expect(readingsCard?.trend).toBe(5000); // Last bucket count
    expect(readingsCard?.status).toBe("up");
  });

  it("should handle undefined stats gracefully", () => {
    const trends = adaptToMetricTrends([], undefined, undefined);
    const readingsCard = trends.find((t) => t.title === "Total Readings");
    expect(readingsCard?.value).toBe("0");
    expect(readingsCard?.trend).toBe(0);
  });
});
````

## File: apps/moondesk-dash/src/lib/adapters/dashboard-adapter.ts
````typescript
import { AlertStats, Asset, AssetStatus, Reading, ReadingStats } from "@moondesk/domain";

// --- Frontend View Models ---

export interface MetricTrend {
  title: string;
  value: string | number;
  noTrendData?: boolean;
  trend?: number;
  label: string;
  status: "up" | "down" | "neutral";
  description: string;
  icon?: "trending-up" | "trending-down" | "users" | "activity" | "alert-circle";
}

export interface TimeSeriesPoint {
  date: string;
  [key: string]: number | string; // e.g., "temperature": 24.5
}

export interface AssetTableRow {
  id: string;
  name: string;
  status: string; // AssetStatus enum string
  type: string;
  location: string;
  lastReading: string;
  lastSeen: string;
  activeAlerts: number;
}

export interface PieChartData {
  name: string;
  value: number;
  fill: string;
}

// --- Adapter Functions ---

function getOnlineStatus(assets: Asset[]): MetricTrend {
  const totalAssets = assets.length;
  const onlineAssets = assets.filter((a) => a.status === AssetStatus.Online).length;

  if (totalAssets > 0) {
    return {
      title: "Online Status",
      value: `${onlineAssets}/${totalAssets}`,
      noTrendData: true,
      label: onlineAssets < totalAssets ? "All assets online" : "Some assets need attention",
      status: "neutral",
      description:
        onlineAssets < totalAssets
          ? "All assets are online and operational"
          : "Configure connections in the assets page",
      icon: "activity",
    };
  }

  return {
    title: "Online Status",
    value: "0/0",
    noTrendData: true,
    label: "No assets found",
    status: "neutral",
    description: "Please configure assets",
    icon: "activity",
  };
}

function getActiveAlertsStatus(stats: AlertStats): MetricTrend {
  const activeAlerts = stats.byStatus.unacknowledged;
  const alertTrendValue = stats.trends.weekly;

  let label: string;
  let description: string;

  if (stats.total > 0) {
    label = "vs last week";
    description = activeAlerts > 0 ? "Requires attention" : "No active alerts";
  } else {
    label = "No alert history";
    description = "System is running smoothly";
  }

  return {
    title: "Active Alerts",
    value: activeAlerts,
    trend: alertTrendValue,
    label,
    status: alertTrendValue > 0 ? "up" : alertTrendValue < 0 ? "down" : "neutral",
    description,
    icon: "alert-circle",
  };
}

function getReadingsStatus(stats: ReadingStats): MetricTrend {
  const readingsCount = stats.total;
  const readingsTrendValue = stats.dailyTrend;

  let label: string;
  let description: string;

  if (readingsCount > 0) {
    label = "vs yesterday";
    description = "Total data points collected";
  } else {
    label = "No data";
    description = "No readings recorded yet";
  }

  return {
    title: "Total Readings",
    value: readingsCount.toLocaleString(),
    trend: readingsTrendValue,
    noTrendData: false,
    label,
    status: readingsTrendValue > 0 ? "up" : readingsTrendValue < 0 ? "down" : "neutral",
    description,
    icon: "activity",
  };
}

function getSignalQualityStatus(stats: ReadingStats): MetricTrend {
  const readingsCount = stats.total;

  let value: string;
  let label: string;
  let description: string;

  if (readingsCount > 0) {
    value = `${stats.qualityScore}%`;
    label = "Good readings";
    description = "Overall data reliability";
  } else {
    value = "N/A";
    label = "No data";
    description = "No readings to analyze";
  }

  return {
    title: "Signal Quality",
    value,
    noTrendData: true,
    trend: 0,
    label,
    status: "neutral",
    description,
    icon: "activity",
  };
}

/**
 * Adapts Asset and Alert data into MetricTrends for SectionCards
 */
export function adaptToMetricTrends(
  assets: Asset[] | undefined,
  readingStats: ReadingStats | undefined,
  alertStats: AlertStats | undefined,
): MetricTrend[] {
  const safeAssets = assets ?? [];
  const safeReadingStats = readingStats ?? { total: 0, dailyTrend: 0, qualityScore: 0, trends: [] };
  const safeAlertStats = alertStats ?? {
    byStatus: { unacknowledged: 0, acknowledged: 0 },
    bySeverity: { info: 0, warning: 0, critical: 0, emergency: 0 },
    trends: { daily: 0, weekly: 0, critical: 0 },
    recentTrend: [],
    total: 0,
  };

  return [
    getOnlineStatus(safeAssets),
    getActiveAlertsStatus(safeAlertStats),
    getReadingsStatus(safeReadingStats),
    getSignalQualityStatus(safeReadingStats),
  ];
}

/**
 * Adapts raw Readings into TimeSeriesPoints for ChartAreaInteractive
 */
export function adaptReadingsToTimeSeries(readings: Reading[]): TimeSeriesPoint[] {
  const grouped = new Map<string, { sum: number; count: number }>();

  readings.forEach((reading) => {
    const date = new Date(reading.timestamp).toISOString().split("T")[0];
    const current = grouped.get(date) ?? { sum: 0, count: 0 };
    current.sum += reading.value;
    current.count += 1;
    grouped.set(date, current);
  });

  return Array.from(grouped.entries())
    .map(([date, { sum, count }]) => ({
      date,
      desktop: Math.round(sum / count),
      mobile: Math.round((sum / count) * 0.8),
    }))
    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());
}

/**
 * Adapts Assets into AssetTableRows for DataTable
 */
export function adaptAssetsToTableRows(assets: Asset[]): AssetTableRow[] {
  return assets.map((asset) => ({
    id: asset.id.toString(),
    name: asset.name,
    status: asset.status,
    type: asset.type,
    location: asset.location,
    lastReading: "N/A", // Needs sensor join
    lastSeen: asset.lastSeen ? new Date(asset.lastSeen).toLocaleDateString() : "Never",
    activeAlerts: 0, // Needs alert join
  }));
}

/**
 * Adapts Assets to Pie Chart Data (by Type)
 */
export function adaptAssetsToDistribution(assets: Asset[]): PieChartData[] {
  const typeCounts = new Map<string, number>();

  assets.forEach((asset) => {
    const current = typeCounts.get(asset.type) ?? 0;
    typeCounts.set(asset.type, current + 1);
  });

  const colors = ["var(--chart-1)", "var(--chart-2)", "var(--chart-3)", "var(--chart-4)", "var(--chart-5)"];

  return Array.from(typeCounts.entries()).map(([name, value], index) => ({
    name,
    value,
    fill: colors[index % colors.length],
  }));
}
````

## File: apps/moondesk-dash/src/lib/mock-data/iot-data.ts
````typescript
/* eslint-disable max-lines */
import type { Asset, Reading, DashboardStats, AssetStatus, Parameter } from "@/types/iot";

export const mockStats: DashboardStats = {
  totalAssets: 12,
  onlineAssets: 9,
  offlineAssets: 3,
  activeAlerts: 2,
};

export const mockAssets: Asset[] = [
  {
    id: 1,
    organizationId: "org_123",
    name: "Water Treatment Plant A",
    type: "Treatment Facility",
    location: "North District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 5 * 60000).toISOString(),
    manufacturer: "AquaTech",
    modelNumber: "WTP-2000",
    sensors: [
      {
        id: 101,
        assetId: 1,
        name: "pH Sensor",
        parameter: 1 as Parameter,
        unit: "pH",
        thresholdLow: 6.5,
        thresholdHigh: 8.5,
        isActive: true,
      },
      {
        id: 102,
        assetId: 1,
        name: "Chlorine Monitor",
        parameter: 2 as Parameter,
        unit: "mg/L",
        thresholdLow: 0.5,
        thresholdHigh: 2.0,
        isActive: true,
      },
      {
        id: 103,
        assetId: 1,
        name: "Turbidity Sensor",
        parameter: 10 as Parameter,
        unit: "NTU",
        thresholdHigh: 5,
        isActive: true,
      },
    ],
  },
  {
    id: 2,
    organizationId: "org_123",
    name: "Pump Station 5",
    type: "Pump Station",
    location: "East District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 2 * 60000).toISOString(),
    manufacturer: "FlowTech",
    modelNumber: "PS-500",
    sensors: [
      {
        id: 201,
        assetId: 2,
        name: "Flow Rate",
        parameter: 20 as Parameter,
        unit: "L/min",
        thresholdLow: 100,
        thresholdHigh: 500,
        isActive: true,
      },
      {
        id: 202,
        assetId: 2,
        name: "Pressure Sensor",
        parameter: 21 as Parameter,
        unit: "bar",
        thresholdLow: 2,
        thresholdHigh: 8,
        isActive: true,
      },
    ],
  },
  {
    id: 3,
    organizationId: "org_123",
    name: "Storage Tank B",
    type: "Storage",
    location: "Central District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 10 * 60000).toISOString(),
    sensors: [
      {
        id: 301,
        assetId: 3,
        name: "Level Sensor",
        parameter: 22 as Parameter,
        unit: "m",
        thresholdLow: 2,
        thresholdHigh: 10,
        isActive: true,
      },
      {
        id: 302,
        assetId: 3,
        name: "Temperature",
        parameter: 11 as Parameter,
        unit: "°C",
        thresholdLow: 5,
        thresholdHigh: 25,
        isActive: true,
      },
    ],
  },
  {
    id: 4,
    organizationId: "org_123",
    name: "Filtration Unit 3",
    type: "Filtration",
    location: "South District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 1 * 60000).toISOString(),
    sensors: [
      {
        id: 401,
        assetId: 4,
        name: "Turbidity",
        parameter: 10 as Parameter,
        unit: "NTU",
        thresholdHigh: 3,
        isActive: true,
      },
      {
        id: 402,
        assetId: 4,
        name: "Flow Rate",
        parameter: 20 as Parameter,
        unit: "L/min",
        thresholdLow: 50,
        thresholdHigh: 300,
        isActive: true,
      },
    ],
  },
  {
    id: 5,
    organizationId: "org_123",
    name: "Monitoring Station 7",
    type: "Monitoring",
    location: "West District",
    status: 2 as AssetStatus,
    lastSeen: new Date(Date.now() - 120 * 60000).toISOString(),
    sensors: [
      {
        id: 501,
        assetId: 5,
        name: "Dissolved Oxygen",
        parameter: 5 as Parameter,
        unit: "mg/L",
        thresholdLow: 5,
        isActive: false,
      },
      {
        id: 502,
        assetId: 5,
        name: "Conductivity",
        parameter: 12 as Parameter,
        unit: "μS/cm",
        thresholdHigh: 1500,
        isActive: false,
      },
    ],
  },
  {
    id: 6,
    organizationId: "org_123",
    name: "Treatment Plant C",
    type: "Treatment Facility",
    location: "North District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 3 * 60000).toISOString(),
    sensors: [
      {
        id: 601,
        assetId: 6,
        name: "pH Monitor",
        parameter: 1 as Parameter,
        unit: "pH",
        thresholdLow: 6.5,
        thresholdHigh: 8.5,
        isActive: true,
      },
      {
        id: 602,
        assetId: 6,
        name: "Free Chlorine",
        parameter: 2 as Parameter,
        unit: "mg/L",
        thresholdLow: 0.5,
        thresholdHigh: 2.0,
        isActive: true,
      },
    ],
  },
  {
    id: 7,
    organizationId: "org_123",
    name: "Pump Station 12",
    type: "Pump Station",
    location: "East District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 7 * 60000).toISOString(),
    sensors: [
      {
        id: 701,
        assetId: 7,
        name: "Pressure",
        parameter: 21 as Parameter,
        unit: "bar",
        thresholdLow: 2,
        thresholdHigh: 8,
        isActive: true,
      },
    ],
  },
  {
    id: 8,
    organizationId: "org_123",
    name: "Reservoir D",
    type: "Storage",
    location: "Central District",
    status: 3 as AssetStatus,
    lastSeen: new Date(Date.now() - 30 * 60000).toISOString(),
    sensors: [
      {
        id: 801,
        assetId: 8,
        name: "Water Level",
        parameter: 22 as Parameter,
        unit: "m",
        thresholdLow: 3,
        thresholdHigh: 12,
        isActive: true,
      },
    ],
  },
  {
    id: 9,
    organizationId: "org_123",
    name: "Quality Monitor 4",
    type: "Monitoring",
    location: "South District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 4 * 60000).toISOString(),
    sensors: [
      {
        id: 901,
        assetId: 9,
        name: "TDS Sensor",
        parameter: 13 as Parameter,
        unit: "ppm",
        thresholdHigh: 500,
        isActive: true,
      },
      {
        id: 902,
        assetId: 9,
        name: "Temperature",
        parameter: 11 as Parameter,
        unit: "°C",
        thresholdLow: 5,
        thresholdHigh: 25,
        isActive: true,
      },
    ],
  },
  {
    id: 10,
    organizationId: "org_123",
    name: "Pump Station 8",
    type: "Pump Station",
    location: "West District",
    status: 2 as AssetStatus,
    lastSeen: new Date(Date.now() - 180 * 60000).toISOString(),
    sensors: [
      {
        id: 1001,
        assetId: 10,
        name: "Flow Meter",
        parameter: 20 as Parameter,
        unit: "L/min",
        thresholdLow: 100,
        thresholdHigh: 400,
        isActive: false,
      },
    ],
  },
  {
    id: 11,
    organizationId: "org_123",
    name: "Filtration Unit 7",
    type: "Filtration",
    location: "North District",
    status: 1 as AssetStatus,
    lastSeen: new Date(Date.now() - 6 * 60000).toISOString(),
    sensors: [
      {
        id: 1101,
        assetId: 11,
        name: "Turbidity Monitor",
        parameter: 10 as Parameter,
        unit: "NTU",
        thresholdHigh: 4,
        isActive: true,
      },
    ],
  },
  {
    id: 12,
    organizationId: "org_123",
    name: "Distribution Point 3",
    type: "Distribution",
    location: "East District",
    status: 2 as AssetStatus,
    lastSeen: new Date(Date.now() - 240 * 60000).toISOString(),
    sensors: [
      {
        id: 1201,
        assetId: 12,
        name: "Pressure Gauge",
        parameter: 21 as Parameter,
        unit: "bar",
        thresholdLow: 2,
        thresholdHigh: 6,
        isActive: false,
      },
    ],
  },
];

// Generate 24 hours of readings for sensor 101 (pH)
export const mockReadings: Reading[] = Array.from({ length: 48 }, (_, i) => ({
  sensorId: 101,
  timestamp: new Date(Date.now() - (47 - i) * 30 * 60000).toISOString(),
  value: 7.2 + Math.sin(i / 8) * 0.5 + (Math.random() - 0.5) * 0.2,
  parameter: 1 as Parameter,
}));
````

## File: apps/moondesk-dash/src/lib/layout-utils.ts
````typescript
export function updateContentLayout(value: "centered" | "full-width") {
  const target = document.querySelector('[data-slot="sidebar-inset"]');
  if (target) {
    target.setAttribute("data-content-layout", value);
  }
}

export function updateNavbarStyle(value: "sticky" | "scroll") {
  const target = document.querySelector("header[data-navbar-style]");
  if (target) {
    target.setAttribute("data-navbar-style", value);
  }
}
````

## File: apps/moondesk-dash/src/lib/theme-utils.ts
````typescript
export function updateThemeMode(value: "light" | "dark") {
  const doc = document.documentElement;
  doc.classList.add("disable-transitions");
  doc.classList.toggle("dark", value === "dark");
  requestAnimationFrame(() => {
    doc.classList.remove("disable-transitions");
  });
}

export function updateThemePreset(value: string) {
  document.documentElement.setAttribute("data-theme-preset", value);
}
````

## File: apps/moondesk-dash/src/lib/utils.ts
````typescript
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

export const getInitials = (str: string): string => {
  if (typeof str !== "string" || !str.trim()) return "?";

  return (
    str
      .trim()
      .split(/\s+/)
      .filter(Boolean)
      .map((word) => word[0])
      .join("")
      .toUpperCase() || "?"
  );
};

export function formatCurrency(
  amount: number,
  opts?: {
    currency?: string;
    locale?: string;
    minimumFractionDigits?: number;
    maximumFractionDigits?: number;
    noDecimals?: boolean;
  },
) {
  const { currency = "USD", locale = "en-US", minimumFractionDigits, maximumFractionDigits, noDecimals } = opts ?? {};

  const formatOptions: Intl.NumberFormatOptions = {
    style: "currency",
    currency,
    minimumFractionDigits: noDecimals ? 0 : minimumFractionDigits,
    maximumFractionDigits: noDecimals ? 0 : maximumFractionDigits,
  };

  return new Intl.NumberFormat(locale, formatOptions).format(amount);
}
````

## File: apps/moondesk-dash/src/navigation/sidebar/sidebar-items.ts
````typescript
import {
  Mail,
  Logs,
  ReceiptText,
  Users,
  Lock,
  LayoutDashboard,
  ChartBar,
  Banknote,
  Gauge,
  type LucideIcon,
  Settings,
} from "lucide-react";

export interface NavSubItem {
  title: string;
  url: string;
  icon?: LucideIcon;
  comingSoon?: boolean;
  newTab?: boolean;
  isNew?: boolean;
}

export interface NavMainItem {
  title: string;
  url: string;
  icon?: LucideIcon;
  subItems?: NavSubItem[];
  comingSoon?: boolean;
  newTab?: boolean;
  isNew?: boolean;
}

export interface NavGroup {
  id: number;
  label?: string;
  items: NavMainItem[];
}

export const sidebarItems: NavGroup[] = [
  {
    id: 1,
    label: "Dashboards",
    items: [
      {
        title: "Overview",
        url: "/dashboard/overview",
        icon: LayoutDashboard,
      },
      {
        title: "Inventory",
        url: "/dashboard/assets",
        icon: ChartBar,
      },
      {
        title: "Analytics",
        url: "/dashboard/coming-soon",
        icon: Gauge,
        comingSoon: true,
      },
      {
        title: "Settings",
        url: "dashboard/settings",
        icon: Settings,
      },
      {
        title: "Logs",
        url: "/dashboard/logs",
        icon: Logs,
      },
    ],
  },
  {
    id: 2,
    label: "Pages",
    items: [
      {
        title: "Email",
        url: "/dashboard/coming-soon",
        icon: Mail,
        comingSoon: true,
      },
      {
        title: "Invoice",
        url: "/dashboard/coming-soon",
        icon: ReceiptText,
        comingSoon: true,
      },
      {
        title: "Users",
        url: "/dashboard/coming-soon",
        icon: Users,
        comingSoon: true,
      },
      {
        title: "Roles",
        url: "/dashboard/coming-soon",
        icon: Lock,
        comingSoon: true,
      },
    ],
  },
];
````

## File: apps/moondesk-dash/src/scripts/generate-theme-presets.ts
````typescript
/**
 * Script: generate-theme-presets.ts
 *
 * This script scans the /styles/presets directory for CSS files containing theme definitions.
 * It extracts `label:`, `value:`, and primary color definitions (`--primary`) for both light and dark modes.
 * These primary colors are used to visually represent each theme in the UI (e.g., colored dots or theme previews).
 * Default theme colors are fetched from /app/globals.css.
 * All extracted metadata is injected into a marked section of the /types/preferences/theme.ts file.
 *
 * Usage:
 * - During local development, run manually after adding any new theme preset:
 *     npm run generate:presets
 * - Ensure that each new CSS preset includes `label:` and `value:` comments.
 * - This generation step is currently automated using a Husky pre-push hook.
 * - You may optionally integrate it directly into a build step if preferred.
 */
import fs from "fs";
import path from "path";

import prettier from "prettier";

const presetDir = path.resolve(__dirname, "../styles/presets");

if (!fs.existsSync(presetDir)) {
  console.error(`❌ Preset directory not found at: ${presetDir}`);
  process.exit(1);
}

const outputPath = path.resolve(__dirname, "../types/preferences/theme.ts");

const files = fs.readdirSync(presetDir).filter((file) => file.endsWith(".css"));

if (files.length === 0) {
  console.warn("⚠️ No preset CSS files found. Only default preset will be included.");
}

// eslint-disable-next-line complexity
const presets = files.map((file) => {
  const filePath = path.join(presetDir, file);
  // eslint-disable-next-line security/detect-non-literal-fs-filename
  const content = fs.readFileSync(filePath, "utf8");

  const labelMatch = content.match(/label:\s*(.+)/);
  const valueMatch = content.match(/value:\s*(.+)/);

  if (!labelMatch) {
    console.warn(`⚠️ No 'label:' found in ${file}, using filename as fallback.`);
  }
  if (!valueMatch) {
    console.warn(`⚠️ No 'value:' found in ${file}, using filename as fallback.`);
  }

  const label = labelMatch?.[1]?.trim() ?? file.replace(".css", "");
  const value = valueMatch?.[1]?.trim() ?? file.replace(".css", "");

  const lightPrimaryMatch = content.match(/:root\[data-theme-preset="[^"]*"\][\s\S]*?--primary:\s*([^;]+);/);
  const darkPrimaryMatch = content.match(/\.dark:root\[data-theme-preset="[^"]*"\][\s\S]*?--primary:\s*([^;]+);/);

  const primary = {
    light: lightPrimaryMatch?.[1]?.trim() ?? "",
    dark: darkPrimaryMatch?.[1]?.trim() ?? "",
  };

  if (!lightPrimaryMatch || !darkPrimaryMatch) {
    console.warn(`⚠️ Missing --primary for ${file} (light or dark). Check CSS syntax.`);
  }

  return { label, value, primary };
});

const globalStylesPath = path.resolve(__dirname, "../app/globals.css");

let globalContent = "";
try {
  globalContent = fs.readFileSync(globalStylesPath, "utf8");
} catch (err) {
  console.error(`❌ Could not read globals.css at ${globalStylesPath}`);
  console.error(err);
  process.exit(1);
}

const defaultLightPrimaryRegex = /:root\s*{[^}]*--primary:\s*([^;]+);/;
const defaultDarkPrimaryRegex = /\.dark\s*{[^}]*--primary:\s*([^;]+);/;

const defaultLightPrimaryMatch = defaultLightPrimaryRegex.exec(globalContent);
const defaultDarkPrimaryMatch = defaultDarkPrimaryRegex.exec(globalContent);

const defaultPrimary = {
  light: defaultLightPrimaryMatch?.[1]?.trim() ?? "",
  dark: defaultDarkPrimaryMatch?.[1]?.trim() ?? "",
};

presets.unshift({ label: "Default", value: "default", primary: defaultPrimary });

const generatedBlock = `// --- generated:themePresets:start ---

export const THEME_PRESET_OPTIONS = ${JSON.stringify(presets, null, 2)} as const;

export const THEME_PRESET_VALUES = THEME_PRESET_OPTIONS.map((p) => p.value);

export type ThemePreset = (typeof THEME_PRESET_OPTIONS)[number]["value"];

// --- generated:themePresets:end ---`;

const fileContent = fs.readFileSync(outputPath, "utf8");

const updated = fileContent.replace(
  /\/\/ --- generated:themePresets:start ---[\s\S]*?\/\/ --- generated:themePresets:end ---/,
  generatedBlock,
);

async function main() {
  const formatted = await prettier.format(updated, { parser: "typescript" });

  if (formatted === fileContent) {
    console.log("ℹ️  No changes in theme.ts");
    return;
  }

  fs.writeFileSync(outputPath, formatted);
  console.log("✅ theme.ts updated with new theme presets");
}

main().catch((err) => {
  console.error("❌ Unexpected error while generating theme presets:", err);
  process.exit(1);
});
````

## File: apps/moondesk-dash/src/server/server-actions.ts
````typescript
"use server";

import { cookies } from "next/headers";

export async function getValueFromCookie(key: string): Promise<string | undefined> {
  const cookieStore = await cookies();
  return cookieStore.get(key)?.value;
}

export async function setValueToCookie(
  key: string,
  value: string,
  options: { path?: string; maxAge?: number } = {},
): Promise<void> {
  const cookieStore = await cookies();
  cookieStore.set(key, value, {
    path: options.path ?? "/",
    maxAge: options.maxAge ?? 60 * 60 * 24 * 7, // default: 7 days
  });
}

export async function getPreference<T extends string>(key: string, allowed: readonly T[], fallback: T): Promise<T> {
  const cookieStore = await cookies();
  const cookie = cookieStore.get(key);
  const value = cookie ? cookie.value.trim() : undefined;
  return allowed.includes(value as T) ? (value as T) : fallback;
}
````

## File: apps/moondesk-dash/src/services/api-client.ts
````typescript
import { auth } from "@clerk/nextjs/server";
import axios, { type AxiosInstance, type AxiosRequestConfig } from "axios";

// API Client with Clerk JWT integration
class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: process.env.NEXT_PUBLIC_API_URL ?? "http://localhost:5000",
      headers: {
        "Content-Type": "application/json",
      },
    });
  }

  // Attach Clerk JWT token to requests
  private async getAuthHeaders() {
    const { getToken } = await auth();
    const token = await getToken();

    return token
      ? {
          Authorization: `Bearer ${token}`,
        }
      : {};
  }

  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.get<T>(url, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }

  async post<T>(url: string, data?: unknown, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.post<T>(url, data, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }

  async put<T>(url: string, data?: unknown, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.put<T>(url, data, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }

  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const authHeaders = await this.getAuthHeaders();
    const response = await this.client.delete<T>(url, {
      ...config,
      headers: {
        ...config?.headers,
        ...authHeaders,
      },
    });
    return response.data;
  }
}

export const apiClient = new ApiClient();
````

## File: apps/moondesk-dash/src/services/device-service.ts
````typescript

````

## File: apps/moondesk-dash/src/stores/preferences/preferences-provider.tsx
````typescript
"use client";

import { createContext, useContext, useRef } from "react";

import { useStore, type StoreApi } from "zustand";

import { createPreferencesStore, PreferencesState } from "./preferences-store";

const PreferencesStoreContext = createContext<StoreApi<PreferencesState> | null>(null);

export const PreferencesStoreProvider = ({
  children,
  themeMode,
  themePreset,
}: {
  children: React.ReactNode;
  themeMode: PreferencesState["themeMode"];
  themePreset: PreferencesState["themePreset"];
}) => {
  const storeRef = useRef<StoreApi<PreferencesState> | null>(null);

  storeRef.current ??= createPreferencesStore({ themeMode, themePreset });

  return <PreferencesStoreContext.Provider value={storeRef.current}>{children}</PreferencesStoreContext.Provider>;
};

export const usePreferencesStore = <T,>(selector: (state: PreferencesState) => T): T => {
  const store = useContext(PreferencesStoreContext);
  if (!store) throw new Error("Missing PreferencesStoreProvider");
  return useStore(store, selector);
};
````

## File: apps/moondesk-dash/src/stores/preferences/preferences-store.ts
````typescript
import { createStore } from "zustand/vanilla";

import type { ThemeMode, ThemePreset } from "@/types/preferences/theme";

export type PreferencesState = {
  themeMode: ThemeMode;
  themePreset: ThemePreset;
  setThemeMode: (mode: ThemeMode) => void;
  setThemePreset: (preset: ThemePreset) => void;
};

export const createPreferencesStore = (init?: Partial<PreferencesState>) =>
  createStore<PreferencesState>()((set) => ({
    themeMode: init?.themeMode ?? "light",
    themePreset: init?.themePreset ?? "default",
    setThemeMode: (mode) => set({ themeMode: mode }),
    setThemePreset: (preset) => set({ themePreset: preset }),
  }));
````

## File: apps/moondesk-dash/src/styles/presets/brutalist.css
````css
/* 
label: Brutalist
value: brutalist 
*/

:root[data-theme-preset="brutalist"] {
  --radius: 0px;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0 0 0);
  --primary: oklch(0.6489 0.237 26.9728);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.968 0.211 109.7692);
  --secondary-foreground: oklch(0 0 0);
  --muted: oklch(0.9551 0 0);
  --muted-foreground: oklch(0.3211 0 0);
  --accent: oklch(0.5635 0.2408 260.8178);
  --accent-foreground: oklch(1 0 0);
  --destructive: oklch(0 0 0);
  --border: oklch(0 0 0);
  --input: oklch(0 0 0);
  --ring: oklch(0.6489 0.237 26.9728);
  --chart-1: oklch(0.6489 0.237 26.9728);
  --chart-2: oklch(0.968 0.211 109.7692);
  --chart-3: oklch(0.5635 0.2408 260.8178);
  --chart-4: oklch(0.7323 0.2492 142.4953);
  --chart-5: oklch(0.5931 0.2726 328.3634);
  --sidebar: oklch(0.9551 0 0);
  --sidebar-foreground: oklch(0 0 0);
  --sidebar-primary: oklch(0.6489 0.237 26.9728);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.5635 0.2408 260.8178);
  --sidebar-accent-foreground: oklch(1 0 0);
  --sidebar-border: oklch(0 0 0);
  --sidebar-ring: oklch(0.6489 0.237 26.9728);
  --background: oklch(1 0 0);
  --foreground: oklch(0 0 0);
  --shadow-2xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-sm: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow-md: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 2px 4px -1px hsl(0 0% 0% / 1);
  --shadow-lg: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 4px 6px -1px hsl(0 0% 0% / 1);
  --shadow-xl: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 8px 10px -1px hsl(0 0% 0% / 1);
  --shadow-2xl: 4px 4px 0px 0px hsl(0 0% 0% / 2.5);
}

.dark:root[data-theme-preset="brutalist"] {
  --background: oklch(0 0 0);
  --foreground: oklch(1 0 0);
  --card: oklch(0.3211 0 0);
  --card-foreground: oklch(1 0 0);
  --popover: oklch(0.3211 0 0);
  --popover-foreground: oklch(1 0 0);
  --primary: oklch(0.7044 0.1872 23.1858);
  --primary-foreground: oklch(0 0 0);
  --secondary: oklch(0.9691 0.2005 109.6228);
  --secondary-foreground: oklch(0 0 0);
  --muted: oklch(0.3211 0 0);
  --muted-foreground: oklch(0.8452 0 0);
  --accent: oklch(0.6755 0.1765 252.2592);
  --accent-foreground: oklch(0 0 0);
  --destructive: oklch(1 0 0);
  --border: oklch(1 0 0);
  --input: oklch(1 0 0);
  --ring: oklch(0.7044 0.1872 23.1858);
  --chart-1: oklch(0.7044 0.1872 23.1858);
  --chart-2: oklch(0.9691 0.2005 109.6228);
  --chart-3: oklch(0.6755 0.1765 252.2592);
  --chart-4: oklch(0.7395 0.2268 142.8504);
  --chart-5: oklch(0.6131 0.2458 328.0714);
  --sidebar: oklch(0 0 0);
  --sidebar-foreground: oklch(1 0 0);
  --sidebar-primary: oklch(0.7044 0.1872 23.1858);
  --sidebar-primary-foreground: oklch(0 0 0);
  --sidebar-accent: oklch(0.6755 0.1765 252.2592);
  --sidebar-accent-foreground: oklch(0 0 0);
  --sidebar-border: oklch(1 0 0);
  --sidebar-ring: oklch(0.7044 0.1872 23.1858);
  --shadow-2xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-xs: 4px 4px 0px 0px hsl(0 0% 0% / 0.5);
  --shadow-sm: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 1px 2px -1px hsl(0 0% 0% / 1);
  --shadow-md: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 2px 4px -1px hsl(0 0% 0% / 1);
  --shadow-lg: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 4px 6px -1px hsl(0 0% 0% / 1);
  --shadow-xl: 4px 4px 0px 0px hsl(0 0% 0% / 1), 4px 8px 10px -1px hsl(0 0% 0% / 1);
  --shadow-2xl: 4px 4px 0px 0px hsl(0 0% 0% / 2.5);
}
````

## File: apps/moondesk-dash/src/styles/presets/soft-pop.css
````css
/* 
label: Soft Pop
value: soft-pop 
*/

:root[data-theme-preset="soft-pop"] {
  --radius: 1rem;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0 0 0);
  --primary: oklch(0.5106 0.2301 276.9656);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.7038 0.123 182.5025);
  --secondary-foreground: oklch(1 0 0);
  --muted: oklch(0.9551 0 0);
  --muted-foreground: oklch(0.3211 0 0);
  --accent: oklch(0.7686 0.1647 70.0804);
  --accent-foreground: oklch(0 0 0);
  --destructive: oklch(0.6368 0.2078 25.3313);
  --border: oklch(0 0 0);
  --input: oklch(0.5555 0 0);
  --ring: oklch(0.7853 0.1041 274.7134);
  --chart-1: oklch(0.5106 0.2301 276.9656);
  --chart-2: oklch(0.7038 0.123 182.5025);
  --chart-3: oklch(0.7686 0.1647 70.0804);
  --chart-4: oklch(0.6559 0.2118 354.3084);
  --chart-5: oklch(0.7227 0.192 149.5793);
  --sidebar: oklch(0.9789 0.0082 121.6272);
  --sidebar-foreground: oklch(0 0 0);
  --sidebar-primary: oklch(0.5106 0.2301 276.9656);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.7686 0.1647 70.0804);
  --sidebar-accent-foreground: oklch(0 0 0);
  --sidebar-border: oklch(0 0 0);
  --sidebar-ring: oklch(0.7853 0.1041 274.7134);
  --background: oklch(0.9789 0.0082 121.6272);
  --foreground: oklch(0 0 0);
  --shadow-2xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-sm: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-md: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 2px 4px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-lg: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 4px 6px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 8px 10px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-2xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.13);
}

.dark:root[data-theme-preset="soft-pop"] {
  --background: oklch(0 0 0);
  --foreground: oklch(1 0 0);
  --card: oklch(0.2455 0.0217 257.2823);
  --card-foreground: oklch(1 0 0);
  --popover: oklch(0.2455 0.0217 257.2823);
  --popover-foreground: oklch(1 0 0);
  --primary: oklch(0.6801 0.1583 276.9349);
  --primary-foreground: oklch(0 0 0);
  --secondary: oklch(0.7845 0.1325 181.912);
  --secondary-foreground: oklch(0 0 0);
  --muted: oklch(0.3211 0 0);
  --muted-foreground: oklch(0.8452 0 0);
  --accent: oklch(0.879 0.1534 91.6054);
  --accent-foreground: oklch(0 0 0);
  --destructive: oklch(0.7106 0.1661 22.2162);
  --border: oklch(0.4459 0 0);
  --input: oklch(1 0 0);
  --ring: oklch(0.6801 0.1583 276.9349);
  --chart-1: oklch(0.6801 0.1583 276.9349);
  --chart-2: oklch(0.7845 0.1325 181.912);
  --chart-3: oklch(0.879 0.1534 91.6054);
  --chart-4: oklch(0.7253 0.1752 349.7607);
  --chart-5: oklch(0.8003 0.1821 151.711);
  --sidebar: oklch(0 0 0);
  --sidebar-foreground: oklch(1 0 0);
  --sidebar-primary: oklch(0.6801 0.1583 276.9349);
  --sidebar-primary-foreground: oklch(0 0 0);
  --sidebar-accent: oklch(0.879 0.1534 91.6054);
  --sidebar-accent-foreground: oklch(0 0 0);
  --sidebar-border: oklch(1 0 0);
  --sidebar-ring: oklch(0.6801 0.1583 276.9349);
  --shadow-2xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-xs: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.03);
  --shadow-sm: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 1px 2px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-md: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 2px 4px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-lg: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 4px 6px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.05), 0px 8px 10px -1px hsl(0 0% 10.1961% / 0.05);
  --shadow-2xl: 0px 0px 0px 0px hsl(0 0% 10.1961% / 0.13);
}
````

## File: apps/moondesk-dash/src/styles/presets/tangerine.css
````css
/* 
label: Tangerine
value: tangerine  
*/

:root[data-theme-preset="tangerine"] {
  --radius: 0.625rem;
  --card: oklch(1 0 0);
  --card-foreground: oklch(0.32 0 0);
  --popover: oklch(1 0 0);
  --popover-foreground: oklch(0.32 0 0);
  --primary: oklch(0.64 0.17 36.44);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.97 0 264.54);
  --secondary-foreground: oklch(0.45 0.03 256.8);
  --muted: oklch(0.98 0 247.84);
  --muted-foreground: oklch(0.55 0.02 264.36);
  --accent: oklch(0.91 0.02 243.82);
  --accent-foreground: oklch(0.38 0.14 265.52);
  --destructive: oklch(0.64 0.21 25.33);
  --border: oklch(0.9 0.01 247.88);
  --input: oklch(0.97 0 264.54);
  --ring: oklch(0.64 0.17 36.44);
  --chart-1: oklch(0.72 0.06 248.68);
  --chart-2: oklch(0.79 0.09 35.96);
  --chart-3: oklch(0.58 0.08 254.16);
  --chart-4: oklch(0.5 0.08 259.49);
  --chart-5: oklch(0.42 0.1 264.03);
  --sidebar: oklch(0.9 0 258.33);
  --sidebar-foreground: oklch(0.32 0 0);
  --sidebar-primary: oklch(0.64 0.17 36.44);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.91 0.02 243.82);
  --sidebar-accent-foreground: oklch(0.38 0.14 265.52);
  --sidebar-border: oklch(0.93 0.01 264.53);
  --sidebar-ring: oklch(0.64 0.17 36.44);
  --background: oklch(0.94 0 236.5);
  --foreground: oklch(0.32 0 0);
  --shadow-2xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-sm: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow-md: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 2px 4px -1px hsl(0 0% 0% / 0.1);
  --shadow-lg: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 4px 6px -1px hsl(0 0% 0% / 0.1);
  --shadow-xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 8px 10px -1px hsl(0 0% 0% / 0.1);
  --shadow-2xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.25);
}

.dark:root[data-theme-preset="tangerine"] {
  --background: oklch(0.26 0.03 262.67);
  --foreground: oklch(0.92 0 0);
  --card: oklch(0.31 0.03 268.64);
  --card-foreground: oklch(0.92 0 0);
  --popover: oklch(0.29 0.02 268.4);
  --popover-foreground: oklch(0.92 0 0);
  --primary: oklch(0.64 0.17 36.44);
  --primary-foreground: oklch(1 0 0);
  --secondary: oklch(0.31 0.03 266.71);
  --secondary-foreground: oklch(0.92 0 0);
  --muted: oklch(0.31 0.03 266.71);
  --muted-foreground: oklch(0.72 0 0);
  --accent: oklch(0.34 0.06 267.59);
  --accent-foreground: oklch(0.88 0.06 254.13);
  --destructive: oklch(0.64 0.21 25.33);
  --border: oklch(0.38 0.03 269.73);
  --input: oklch(0.38 0.03 269.73);
  --ring: oklch(0.64 0.17 36.44);
  --chart-1: oklch(0.72 0.06 248.68);
  --chart-2: oklch(0.77 0.09 34.19);
  --chart-3: oklch(0.58 0.08 254.16);
  --chart-4: oklch(0.5 0.08 259.49);
  --chart-5: oklch(0.42 0.1 264.03);
  --sidebar: oklch(0.31 0.03 267.74);
  --sidebar-foreground: oklch(0.92 0 0);
  --sidebar-primary: oklch(0.64 0.17 36.44);
  --sidebar-primary-foreground: oklch(1 0 0);
  --sidebar-accent: oklch(0.34 0.06 267.59);
  --sidebar-accent-foreground: oklch(0.88 0.06 254.13);
  --sidebar-border: oklch(0.38 0.03 269.73);
  --sidebar-ring: oklch(0.64 0.17 36.44);
  --shadow-2xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-xs: 0px 1px 3px 0px hsl(0 0% 0% / 0.05);
  --shadow-sm: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 1px 2px -1px hsl(0 0% 0% / 0.1);
  --shadow-md: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 2px 4px -1px hsl(0 0% 0% / 0.1);
  --shadow-lg: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 4px 6px -1px hsl(0 0% 0% / 0.1);
  --shadow-xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.1), 0px 8px 10px -1px hsl(0 0% 0% / 0.1);
  --shadow-2xl: 0px 1px 3px 0px hsl(0 0% 0% / 0.25);
}
````

## File: apps/moondesk-dash/src/styles/clerk-custom.css
````css

````

## File: apps/moondesk-dash/src/test/setup.ts
````typescript
import "@testing-library/jest-dom";
import { cleanup } from "@testing-library/react";
import { afterEach } from "vitest";

// Mock ResizeObserver for Recharts
global.ResizeObserver = class ResizeObserver {
  observe() {}
  unobserve() {}
  disconnect() {}
};

afterEach(() => {
  cleanup();
});
````

## File: apps/moondesk-dash/src/test/utils.tsx
````typescript
import { ReactElement } from "react";

import { QueryClient, QueryClientProvider } from "@tanstack/react-query";
import { render, RenderOptions } from "@testing-library/react";

const createTestQueryClient = () =>
  new QueryClient({
    defaultOptions: {
      queries: { retry: false },
      mutations: { retry: false },
    },
  });

export function renderWithProviders(ui: ReactElement, options?: Omit<RenderOptions, "wrapper">) {
  const queryClient = createTestQueryClient();

  return render(ui, {
    wrapper: ({ children }) => <QueryClientProvider client={queryClient}>{children}</QueryClientProvider>,
    ...options,
  });
}
````

## File: apps/moondesk-dash/src/types/preferences/layout.ts
````typescript
// Sidebar Variant
export const SIDEBAR_VARIANT_OPTIONS = [
  { label: "Inset", value: "inset" },
  { label: "Sidebar", value: "sidebar" },
  { label: "Floating", value: "floating" },
] as const;
export const SIDEBAR_VARIANT_VALUES = SIDEBAR_VARIANT_OPTIONS.map((v) => v.value);
export type SidebarVariant = (typeof SIDEBAR_VARIANT_VALUES)[number];

// Sidebar Collapsible
export const SIDEBAR_COLLAPSIBLE_OPTIONS = [
  { label: "Icon", value: "icon" },
  { label: "Offcanvas", value: "offcanvas" },
] as const;
export const SIDEBAR_COLLAPSIBLE_VALUES = SIDEBAR_COLLAPSIBLE_OPTIONS.map((v) => v.value);
export type SidebarCollapsible = (typeof SIDEBAR_COLLAPSIBLE_VALUES)[number];

// Content Layout
export const CONTENT_LAYOUT_OPTIONS = [
  { label: "Centered", value: "centered" },
  { label: "Full Width", value: "full-width" },
] as const;
export const CONTENT_LAYOUT_VALUES = CONTENT_LAYOUT_OPTIONS.map((v) => v.value);
export type ContentLayout = (typeof CONTENT_LAYOUT_VALUES)[number];

// Navbar Style
export const NAVBAR_STYLE_OPTIONS = [
  { label: "Sticky", value: "sticky" },
  { label: "Scroll", value: "scroll" },
] as const;
export const NAVBAR_STYLE_VALUES = NAVBAR_STYLE_OPTIONS.map((v) => v.value);
export type NavbarStyle = (typeof NAVBAR_STYLE_VALUES)[number];
````

## File: apps/moondesk-dash/src/types/preferences/theme.ts
````typescript
export const THEME_MODE_OPTIONS = [
  {
    label: "Light",
    value: "light",
  },
  {
    label: "Dark",
    value: "dark",
  },
] as const;

export const THEME_MODE_VALUES = THEME_MODE_OPTIONS.map((m) => m.value);

export type ThemeMode = (typeof THEME_MODE_VALUES)[number];

// --- generated:themePresets:start ---

export const THEME_PRESET_OPTIONS = [
  {
    label: "Default",
    value: "default",
    primary: {
      light: "oklch(0.205 0 0)",
      dark: "oklch(0.922 0 0)",
    },
  },
  {
    label: "Brutalist",
    value: "brutalist",
    primary: {
      light: "oklch(0.6489 0.2370 26.9728)",
      dark: "oklch(0.7044 0.1872 23.1858)",
    },
  },
  {
    label: "Soft Pop",
    value: "soft-pop",
    primary: {
      light: "oklch(0.5106 0.2301 276.9656)",
      dark: "oklch(0.6801 0.1583 276.9349)",
    },
  },
  {
    label: "Tangerine",
    value: "tangerine",
    primary: {
      light: "oklch(0.64 0.17 36.44)",
      dark: "oklch(0.64 0.17 36.44)",
    },
  },
] as const;

export const THEME_PRESET_VALUES = THEME_PRESET_OPTIONS.map((p) => p.value);

export type ThemePreset = (typeof THEME_PRESET_OPTIONS)[number]["value"];

// --- generated:themePresets:end ---
````

## File: apps/moondesk-dash/src/types/iot.ts
````typescript
export enum AssetStatus {
  Unknown = 0,
  Online = 1,
  Offline = 2,
  Maintenance = 3,
  Error = 4,
}

export enum AlertSeverity {
  Info = 0,
  Warning = 1,
  Critical = 2,
}

export enum Parameter {
  None = 0,
  pH = 1,
  FreeChlorine = 2,
  TotalChlorine = 3,
  Fluoride = 4,
  DissolvedOxygen = 5,
  Turbidity = 10,
  Temperature = 11,
  Conductivity = 12,
  TotalDissolvedSolids = 13,
  FlowRate = 20,
  Pressure = 21,
  Level = 22,
}

export interface Asset {
  id: number;
  organizationId: string;
  name: string;
  type: string;
  location: string;
  status: AssetStatus;
  lastSeen?: string;
  description?: string;
  manufacturer?: string;
  modelNumber?: string;
  sensors: Sensor[];
}

export interface Sensor {
  id: number;
  assetId: number;
  name: string;
  parameter: Parameter;
  unit: string;
  thresholdLow?: number;
  thresholdHigh?: number;
  isActive: boolean;
}

export interface Reading {
  sensorId: number;
  timestamp: string;
  value: number;
  parameter: Parameter;
}

export interface Alert {
  id: number;
  sensorId: number;
  timestamp: string;
  severity: AlertSeverity;
  message: string;
  triggerValue: number;
  acknowledged: boolean;
}

export interface DashboardStats {
  totalAssets: number;
  onlineAssets: number;
  offlineAssets: number;
  activeAlerts: number;
}
````

## File: apps/moondesk-dash/src/config.ts
````typescript
import packageJson from "../package.json";

const currentYear = new Date().getFullYear();

export const APP_CONFIG = {
  name: "Moondesk",
  version: packageJson.version,
  copyright: `© ${currentYear}, Moondesk.`,
  meta: {
    title: "Moondesk - Industrial IoT Dashboard",
    description:
      "Moondesk is a modern Industrial IoT dashboard for monitoring and managing industrial assets. Track solar panels, PLCs, sensors, and more in real-time.",
  },
};
````

## File: apps/moondesk-dash/src/instrumentation-client.ts
````typescript
// This file configures the initialization of Sentry on the client.
// The added config here will be used whenever a users loads a page in their browser.
// https://docs.sentry.io/platforms/javascript/guides/nextjs/

import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: "https://12d4e362381e912751acf2f4d2ea7e21@o4509589925527552.ingest.de.sentry.io/4510518434463824",

  // Define how likely traces are sampled. Adjust this value in production, or use tracesSampler for greater control.
  tracesSampleRate: 1,
  // Enable logs to be sent to Sentry
  enableLogs: true,

  // Enable sending user PII (Personally Identifiable Information)
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
});

export const onRouterTransitionStart = Sentry.captureRouterTransitionStart;
````

## File: apps/moondesk-dash/src/instrumentation.ts
````typescript
import * as Sentry from "@sentry/nextjs";

export async function register() {
  if (process.env.NEXT_RUNTIME === "nodejs") {
    await import("../sentry.server.config");
  }

  if (process.env.NEXT_RUNTIME === "edge") {
    await import("../sentry.edge.config");
  }
}

export const onRequestError = Sentry.captureRequestError;
````

## File: apps/moondesk-dash/src/proxy.disabled.ts
````typescript
// Proxy disabled.
// Rename this file to `proxy.ts` to enable it.
import { NextRequest, NextResponse } from "next/server";

/**
 * Runs before requests complete.
 * Use for rewrites, redirects, or header changes.
 * Refer to Next.js Proxy docs for more examples.
 */
export function proxy(req: NextRequest) {
  // Example: redirect to dashboard if user is logged in
  // const token = req.cookies.get("session_token")?.value;
  // if (token && req.nextUrl.pathname === "/auth/login")
  //   return NextResponse.redirect(new URL("/dashboard", req.url));

  return NextResponse.next();
}

/**
 * Matcher runs for all routes.
 * To skip assets or APIs, use a negative matcher from docs.
 */
export const config = {
  matcher: "/:path*",
};
````

## File: apps/moondesk-dash/src/proxy.ts
````typescript
import { clerkMiddleware, createRouteMatcher } from "@clerk/nextjs/server";

const isPublicRoute = createRouteMatcher([
  "/",
  "/auth/v1/login(.*)",
  "/auth/v1/register(.*)",
  "/auth/v2/login(.*)",
  "/auth/v2/register(.*)",
  "/sso-callback(.*)",
]);

export default clerkMiddleware(async (auth, request) => {
  if (!isPublicRoute(request)) {
    await auth.protect();
  }
});

export const config = {
  matcher: [
    // Skip Next.js internals and all static files, unless found in search params
    "/((?!_next|[^?]*\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)",
    // Always run for API routes
    "/(api|trpc)(.*)",
  ],
};
````

## File: apps/moondesk-dash/.env.local.example
````
# Clerk Authentication Keys
# Get these from https://dashboard.clerk.com
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...

# Clerk URLs (using v2 auth pages)
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/auth/v2/login
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/auth/v2/register
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_ORGANIZATION_PROFILE_URL=/organization

# Backend API URL (your .NET C# backend)
NEXT_PUBLIC_API_URL=http://localhost:5000
````

## File: apps/moondesk-dash/.gitignore
````
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js
.yarn/install-state.gz

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem
*.sh

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# local env files
.env*.local

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts

# Sentry Config File
.env.sentry-build-plugin
````

## File: apps/moondesk-dash/.prettierignore
````
node_modules
.next
.prettierrc
components.json
next.config.mjs
package-lock.json
package.json
postcss.config.mjs
README.md
tsconfig.json
.env
src/components/ui
````

## File: apps/moondesk-dash/.prettierrc
````
{
  "semi": true,
  "singleQuote": false,
  "trailingComma": "all",
  "tabWidth": 2,
  "printWidth": 120,
  "bracketSpacing": true,
  "plugins": ["prettier-plugin-tailwindcss"]
}
````

## File: apps/moondesk-dash/CLERK_AUTH_INTEGRATION.md
````markdown
# Clerk Authentication Integration

This document outlines the Clerk authentication integration into the existing custom auth components (v1 and v2).

## Changes Made

### 1. Updated App Configuration

- **File**: `src/config.ts`
- Changed app name from "Studio Admin" to "Moondesk"
- Updated meta title and description for Industrial IoT focus

### 2. Updated README

- **File**: `README.md`
- Replaced generic admin template content with Moondesk IIoT dashboard information
- Added proper tech stack and features for industrial IoT

### 3. Integrated Clerk into Login Form

- **File**: `src/app/(main)/auth/_components/login-form.tsx`
- Added Clerk's `useSignIn` hook
- Implemented email/password authentication with Clerk
- Added loading states and error handling
- Redirects to `/dashboard/iiot` on successful login

### 4. Integrated Clerk into Register Form

- **File**: `src/app/(main)/auth/_components/register-form.tsx`
- Added Clerk's `useSignUp` hook
- Implemented email/password registration with Clerk
- Added email verification flow (sends code, user verifies)
- Shows verification code input after initial registration
- Redirects to `/dashboard/iiot` after successful verification

### 5. Updated Google OAuth Button

- **File**: `src/app/(main)/auth/_components/social-auth/google-button.tsx`
- Integrated Clerk's OAuth authentication
- Uses `authenticateWithRedirect` for Google sign-in
- Redirects to SSO callback page

### 6. Created SSO Callback Page

- **File**: `src/app/sso-callback/page.tsx`
- Handles OAuth redirects from Google and other providers
- Uses Clerk's `AuthenticateWithRedirectCallback` component

### 7. Updated Auth Pages with Moondesk Branding

- **Files**:
  - `src/app/(main)/auth/v1/login/page.tsx`
  - `src/app/(main)/auth/v1/register/page.tsx`
  - `src/app/(main)/auth/v2/layout.tsx`
- Replaced generic Command icon with Factory icon (industrial theme)
- Updated copy to reflect Moondesk and Industrial IoT focus
- Maintained original v1 and v2 design layouts

### 8. Updated Sign-In/Sign-Up Pages

- **Files**:
  - `src/app/sign-in/[[...sign-in]]/page.tsx`
  - `src/app/sign-up/[[...sign-up]]/page.tsx`
- Added Moondesk branding and Factory icon
- Wrapped Clerk's default components with custom styling
- These are fallback pages; main auth uses v1/v2 custom components

## Authentication Flow

### Email/Password Login (v1 or v2)

1. User enters email and password
2. Form validates with Zod schema
3. Clerk's `signIn.create()` authenticates user
4. On success, redirects to `/dashboard/iiot`
5. On error, shows toast notification

### Email/Password Registration (v1 or v2)

1. User enters email, password, and confirms password
2. Form validates with Zod schema (including password match)
3. Clerk's `signUp.create()` creates account
4. Clerk sends verification code to email
5. User enters verification code
6. Clerk's `attemptEmailAddressVerification()` verifies code
7. On success, redirects to `/dashboard/iiot`

### Google OAuth

1. User clicks "Continue with Google"
2. Clerk redirects to Google OAuth
3. User authorizes on Google
4. Google redirects to `/sso-callback`
5. Clerk completes authentication
6. Redirects to `/dashboard/iiot`

## Available Auth Routes

- `/auth/v1/login` - Version 1 login page (split layout)
- `/auth/v1/register` - Version 1 register page (split layout)
- `/auth/v2/login` - Version 2 login page (centered with sidebar)
- `/auth/v2/register` - Version 2 register page (centered with sidebar)
- `/sign-in` - Fallback Clerk default sign-in (with custom wrapper)
- `/sign-up` - Fallback Clerk default sign-up (with custom wrapper)
- `/sso-callback` - OAuth callback handler

## Environment Variables Required

Make sure these are set in `.env.local`:

```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/auth/v2/login
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/auth/v2/register
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard/iiot
```

## Design Preserved

Both v1 and v2 auth page designs have been preserved:

- **v1**: Split layout with colored sidebar (left for login, right for register)
- **v2**: Centered form with large colored sidebar panel

All original styling, layouts, and visual designs remain intact. Only the authentication logic has been replaced with Clerk integration.

## Next Steps

1. Configure Clerk dashboard with Google OAuth provider
2. Test email verification flow
3. Test Google OAuth flow
4. Customize Clerk email templates (optional)
5. Add password reset functionality (optional)
6. Remove CRM/Finance dashboard placeholders if not needed
````

## File: apps/moondesk-dash/CLERK_SETUP.md
````markdown
# Clerk Authentication Setup

## ✅ What's Been Configured

### 1. Clerk Integration

- ✅ `@clerk/nextjs` installed
- ✅ `ClerkProvider` wrapping the app in `src/app/layout.tsx`
- ✅ `proxy.ts` middleware configured (Next.js 16+)

### 2. Authentication Components

- ✅ **ClerkAuth** - Sign In/Sign Up buttons + UserButton in header
- ✅ **ClerkOrgSwitcher** - Organization switcher in header for multi-tenancy
- ✅ **NavUserClerk** - Sidebar user menu with Clerk integration

### 3. Pages

- ✅ **Landing Page** (`/`) - Shows sign-in/sign-up for unauthenticated users
- ✅ **Dashboard** - Protected, redirects to `/dashboard/iiot` when signed in

## 🔧 Setup Instructions

### Step 1: Get Clerk Keys

1. Go to [https://dashboard.clerk.com](https://dashboard.clerk.com)
2. Create a new application (or use existing)
3. Copy your API keys from the dashboard

### Step 2: Configure Environment Variables

Create `.env.local` file in `apps/moondesk-dash/`:

```bash
# Copy from .env.local.example
cp .env.local.example .env.local
```

Then add your Clerk keys:

```env
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...
CLERK_SECRET_KEY=sk_test_...
```

### Step 3: Enable Organizations in Clerk

1. In Clerk Dashboard, go to **Settings** → **Organizations**
2. Enable Organizations feature
3. Configure organization settings as needed

### Step 4: Run the App

```bash
pnpm dev
```

Visit `http://localhost:3000` - you should see the landing page with sign-in/sign-up buttons.

## 🎯 What's Next

Now that authentication is set up, you can:

1. **Create IIoT Dashboard Pages** - Device overview, device list, device details
2. **Implement API Integration** - Connect to your .NET backend
3. **Add Device Provisioning** - Modal for adding new devices
4. **Build Charts** - Time-series visualization with Recharts

## 📝 Key Files

- `src/proxy.ts` - Clerk middleware (Next.js 16+)
- `src/app/layout.tsx` - ClerkProvider wrapper
- `src/app/(main)/dashboard/layout.tsx` - Dashboard layout with auth components
- `src/app/(main)/dashboard/_components/sidebar/clerk-auth.tsx` - Auth components
- `src/app/(main)/dashboard/_components/sidebar/nav-user-clerk.tsx` - Sidebar user menu
- `src/app/(external)/page.tsx` - Landing page with auth redirect

## 🔐 How It Works

1. **Unauthenticated users** see the landing page with sign-in/sign-up buttons
2. **After signing in**, users are redirected to `/dashboard/iiot`
3. **Organization Switcher** in header allows switching between organizations
4. **All API calls** will include Clerk JWT token (via `src/services/api-client.ts`)
5. **User profile** accessible via UserButton in header or sidebar menu
````

## File: apps/moondesk-dash/components.json
````json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "",
    "css": "src/app/globals.css",
    "baseColor": "neutral",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
````

## File: apps/moondesk-dash/CONTRIBUTING.md
````markdown
# Contributing to Studio Admin

Thanks for showing interest in improving **Studio Admin** (repo: `next-shadcn-admin-dashboard`).  
This guide will help you set up your environment and understand how to contribute.

---

## Overview

This project is built with **Next.js 16**, **TypeScript**, **Tailwind CSS v4**, and **Shadcn UI**.  
The goal is to keep the codebase modular, scalable, and easy to extend.

---

## Project Layout

We use a **colocation-based file system**. Each feature keeps its own pages, components, and logic.

```
src
├── app               # Next.js routes (App Router)
│   ├── (auth)        # Auth layouts & screens
│   ├── (main)        # Main dashboard routes
│   │   └── (dashboard)
│   │       ├── crm
│   │       ├── finance
│   │       ├── default
│   │       └── ...
│   └── layout.tsx
├── components        # Shared UI components
├── hooks             # Reusable hooks
├── lib               # Config & utilities
├── styles            # Tailwind / theme setup
└── types             # TypeScript definitions
```

If you’d like a more detailed example of this setup, check out the [Next Colocation Template](https://github.com/arhamkhnz/next-colocation-template), where the full structure is explained with examples.

---

## Getting Started

### Fork and Clone the Repository

1. Fork the Repository

   Click [here](https://github.com/arhamkhnz/next-shadcn-admin-dashboard/fork) to fork the repository.

2. Clone the Repository
   ```bash
   git clone https://github.com/YOUR_USERNAME/next-shadcn-admin-dashboard.git
   ```
3. Navigate into the Project

   ```bash
   cd next-shadcn-admin-dashboard
   ```

4. **Install dependencies**

   ```bash
   npm install
   ```

5. **Run the dev server**
   ```bash
   npm run dev
   ```
   App will be available at [http://localhost:3000](http://localhost:3000).

---

## Contribution Flow

- Always create a new branch before working on changes:

  ```bash
  git checkout -b feature/my-update
  ```

- Use clear commit messages:

  ```bash
  git commit -m "feat: add finance dashboard screen"
  ```

- Open a Pull Request once ready.
- If your change adds a new UI screen or component, include a screenshot in your PR description.

---

## Where to Contribute

- **External Pages**: Landing pages or other non-dashboard routes → `src/app/(external)/`
- **Auth Screens**: Login, register, and authentication layouts → `src/app/(main)/auth/`
- **Dashboard Screens**: Feature dashboards like CRM, Finance, Analytics → `src/app/(main)/dashboard/`
- **Components**: Reusable UI goes in `src/components/`
- **Hooks**: Custom logic goes in `src/hooks/`
- **Themes**: New presets under `src/styles/presets/`

---

## Guidelines

- Prefer **TypeScript types** over `any`
- Husky pre-commit hooks are enabled - linting and formatting run automatically when you commit, and if there are errors the commit will be blocked until they are fixed.
- Follow **Shadcn UI** style & Tailwind v4 conventions
- Keep accessibility in mind (ARIA, keyboard nav)
- Use clear commit messages with conventional prefixes (`feat:`, `fix:`, `chore:`, etc.)
- Avoid unnecessary dependencies — prefer existing utilities where possible

---

## Submitting PRs

- Open a Pull Request once your changes are ready.
- Ensure your branch is up to date with `main` before submitting.
- Reference any related issue in your PR for context.

---

## Questions & Support

- Report bugs, suggestions, or issues via [GitHub Issues](https://github.com/arhamkhnz/next-shadcn-admin-dashboard/issues)

---

Your contributions keep this project growing. 🚀

**Happy Vibe Coding!**
````

## File: apps/moondesk-dash/IIOT_DASHBOARD_SPEC.md
````markdown
# Industrial IoT Dashboard - Feature Specification

## Overview

Build a Next.js dashboard for monitoring and managing industrial assets (Solar Panels, PLCs, Sensors) with real-time telemetry visualization and device provisioning capabilities.

---

## 1. Navigation & Sidebar

### Requirements

- Add IIoT section to sidebar navigation
- Replace existing demo dashboards with IIoT-specific pages

### Implementation

**File:** `src/navigation/sidebar/sidebar-items.ts`

Add new navigation group:

```typescript
{
  id: 1,
  label: "Industrial IoT",
  items: [
    {
      title: "Overview",
      url: "/dashboard/iiot",
      icon: LayoutDashboard,
    },
    {
      title: "Devices",
      url: "/dashboard/iiot/devices",
      icon: Factory,
    },
    {
      title: "Analytics",
      url: "/dashboard/iiot/analytics",
      icon: ChartBar,
      comingSoon: true,
    },
  ],
}
```

---

## 2. IIoT Overview Page (Dashboard Home)

### Requirements

- Display grid of device status cards
- Show real-time device metrics (last reported value)
- Visual status indicators (Online/Offline/Alarm)
- Click card to navigate to device detail page

### Page Structure

**File:** `src/app/(main)/dashboard/iiot/page.tsx`

### Components Needed

1. **DeviceStatusCard** - Individual device widget
   - Device name
   - Device type badge (Solar/Sensor/PLC)
   - Status indicator (colored dot + text)
   - Last value display (e.g., "24.5 °C", "450W")
   - Last seen timestamp
   - Click to navigate to detail page

2. **DeviceGrid** - Responsive grid layout
   - 1 column on mobile
   - 2-3 columns on tablet
   - 3-4 columns on desktop

### Data Requirements

- Fetch devices for current organization
- Include last telemetry value for each device
- Real-time status updates (optional: use polling or WebSocket)

### Design Notes

- Industrial modern aesthetic
- Slate/Zinc color scheme
- Green for Online, Red for Alarm/Offline, Yellow for Maintenance
- Data-dense but clean layout

---

## 3. Devices Page (Inventory)

### Requirements

- Table listing all devices for current organization
- Sortable and filterable columns
- Search functionality
- "Add Device" button to open provisioning modal

### Page Structure

**File:** `src/app/(main)/dashboard/iiot/devices/page.tsx`

### Table Columns

1. **Name** - Device name (clickable to detail page)
2. **Type** - Badge showing Solar/Sensor/PLC
3. **Device ID** - Unique identifier
4. **Status** - Status badge with color
5. **Last Seen** - Relative time (e.g., "2 minutes ago")
6. **Actions** - Dropdown menu (View, Edit, Delete)

### Components Needed

1. **DevicesTable** - Uses existing `data-table` component
2. **DeviceTypeFilter** - Filter by device type
3. **StatusFilter** - Filter by status
4. **AddDeviceButton** - Opens provisioning modal

### Features

- Use TanStack Table (already installed)
- Pagination (10, 25, 50 per page)
- Column sorting
- Global search across name and ID
- Export to CSV (optional)

---

## 4. Device Provisioning Modal

### Requirements

- Modal/Dialog form to add new device
- Collect device name and type
- On success, display device credentials
- Credentials shown only once (copy-pasteable)

### Flow

1. User clicks "Add Device" button
2. Modal opens with form:
   - **Device Name** (text input, required)
   - **Device Type** (dropdown: Solar, Sensor, PLC)
   - **Submit** button

3. On submit:
   - POST to `/api/devices`
   - Show loading state

4. On success:
   - Show "Device Created" success state
   - Display credentials card with:
     - Host
     - Client ID
     - Username
     - Password/Token
   - Copy buttons for each field
   - Warning: "Save these credentials - they won't be shown again"
   - "Done" button to close modal

### Components Needed

**File:** `src/app/(main)/dashboard/iiot/devices/_components/add-device-modal.tsx`

1. **AddDeviceModal** - Main modal component
2. **DeviceForm** - Form with validation (react-hook-form + zod)
3. **CredentialsCard** - Display credentials with copy buttons

### Validation

- Device name: Required, 3-50 characters
- Device type: Required, one of enum values

---

## 5. Device Detail Page (Digital Twin)

### Requirements

- Show device metadata
- Display time-series chart (last 24 hours)
- Real-time current value
- Device actions (Edit, Delete, Restart)

### Page Structure

**File:** `src/app/(main)/dashboard/iiot/devices/[deviceId]/page.tsx`

### Layout Sections

#### A. Header Section

- Device name (editable inline)
- Device type badge
- Status indicator
- Last seen timestamp
- Action buttons (Edit, Delete, Restart)

#### B. Current Metrics Card

- Large display of current value
- Metric name and unit
- Trend indicator (up/down arrow)
- Comparison to previous value

#### C. Time-Series Chart

- Recharts line chart
- X-axis: Time (last 24 hours)
- Y-axis: Value with unit
- Responsive design
- Zoom/pan controls (optional)
- Time range selector (1h, 6h, 24h, 7d)

#### D. Device Information Card

- Device ID
- Organization
- Firmware version
- Location
- Model
- Created date
- Last updated

### Components Needed

1. **DeviceHeader** - Top section with name and actions
2. **CurrentMetricsCard** - Real-time value display
3. **TelemetryChart** - Recharts time-series visualization
4. **DeviceInfoCard** - Metadata display
5. **TimeRangeSelector** - Button group for time range

### Data Requirements

- Fetch device details by ID
- Fetch telemetry data for selected time range
- Real-time updates for current value (polling every 5-10s)

---

## 6. API Service Layer

### Requirements

- Centralized API client with Clerk JWT integration
- Type-safe API methods
- Error handling
- Mock data for development

### Files Structure

```
src/services/
├── api-client.ts          (✅ Already created)
├── devices-api.ts         (Device CRUD operations)
└── telemetry-api.ts       (Telemetry data fetching)
```

### API Methods Needed

#### devices-api.ts

```typescript
- getDevices(organizationId: string): Promise<Device[]>
- getDevice(deviceId: string): Promise<Device>
- createDevice(data: CreateDeviceRequest): Promise<DeviceCredentials>
- updateDevice(deviceId: string, data: Partial<Device>): Promise<Device>
- deleteDevice(deviceId: string): Promise<void>
```

#### telemetry-api.ts

```typescript
- getTelemetry(deviceId: string, timeRange: TimeRange): Promise<TelemetryData[]>
- getLatestValue(deviceId: string): Promise<TelemetryData>
```

### Mock Data Strategy

- Create mock data generators for development
- Use realistic industrial values:
  - Solar: 0-500W power output
  - Sensor: 15-35°C temperature
  - PLC: 0-100% utilization
- Add flag to switch between mock and real API

**File:** `src/services/mock-data.ts`

---

## 7. React Query Integration

### Requirements

- Use TanStack Query for data fetching
- Implement caching and refetching strategies
- Optimistic updates for mutations

### Query Keys Structure

```typescript
const queryKeys = {
  devices: {
    all: (orgId: string) => ["devices", orgId],
    detail: (deviceId: string) => ["devices", deviceId],
  },
  telemetry: {
    range: (deviceId: string, range: string) => ["telemetry", deviceId, range],
    latest: (deviceId: string) => ["telemetry", deviceId, "latest"],
  },
};
```

### Hooks to Create

**File:** `src/hooks/use-devices.ts`

```typescript
- useDevices(organizationId: string)
- useDevice(deviceId: string)
- useCreateDevice()
- useUpdateDevice()
- useDeleteDevice()
```

**File:** `src/hooks/use-telemetry.ts`

```typescript
- useTelemetry(deviceId: string, timeRange: TimeRange)
- useLatestValue(deviceId: string)
```

### Refetch Strategies

- Devices list: Refetch on window focus
- Device detail: Refetch every 10s
- Latest telemetry: Refetch every 5s
- Historical telemetry: Cache for 5 minutes

---

## 8. Type Definitions

### Files

**File:** `src/types/iiot.ts` (✅ Already created)

Ensure all types are defined:

- Device
- DeviceType
- DeviceStatus
- DeviceCredentials
- TelemetryData
- CreateDeviceRequest
- DeviceWithLastValue
- TimeRange

---

## 9. Styling & Design System

### Color Palette (Industrial Theme)

```css
/* Status Colors */
--status-online: #10b981 (green-500) --status-offline: #ef4444 (red-500) --status-alarm: #ef4444 (red-500)
  --status-maintenance: #f59e0b (amber-500) /* Device Type Colors */ --device-solar: #f59e0b (amber-500)
  --device-sensor: #3b82f6 (blue-500) --device-plc: #8b5cf6 (violet-500) /* Background */ Use existing slate/zinc from
  Tailwind;
```

### Component Styling Guidelines

- Use existing shadcn/ui components
- Consistent spacing (p-4, p-6 for cards)
- Border radius: rounded-lg
- Shadows: shadow-sm for cards
- Hover states on interactive elements
- Loading skeletons for async data

---

## 10. Error Handling & Loading States

### Requirements

- Loading skeletons for all async content
- Error boundaries for page-level errors
- Toast notifications for actions (success/error)
- Empty states for no data

### Components Needed

1. **DeviceCardSkeleton** - Loading state for device cards
2. **TableSkeleton** - Loading state for devices table
3. **ChartSkeleton** - Loading state for charts
4. **EmptyState** - No devices found
5. **ErrorState** - Error loading data

### Toast Messages

- Device created successfully
- Device updated successfully
- Device deleted successfully
- Failed to load devices
- Failed to create device
- Credentials copied to clipboard

---

## 11. Organization Context

### Requirements

- Get current organization from Clerk
- Filter all data by organization ID
- Handle organization switching

### Implementation

**File:** `src/hooks/use-organization.ts`

```typescript
export function useOrganization() {
  const { organization } = useOrganization();
  return {
    organizationId: organization?.id,
    organizationName: organization?.name,
  };
}
```

### Usage

- Pass organizationId to all API calls
- Refetch data when organization changes
- Show organization name in breadcrumbs

---

## 12. Breadcrumbs

### Requirements

- Show current page path
- Clickable navigation
- Update on route change

### Examples

- Overview: `Home / IIoT / Overview`
- Devices: `Home / IIoT / Devices`
- Device Detail: `Home / IIoT / Devices / [Device Name]`

**File:** Update existing breadcrumb component or create new one

---

## Implementation Priority

### Phase 1: Core Pages (MVP)

1. ✅ Clerk authentication setup
2. Update sidebar navigation
3. Create IIoT Overview page with device cards
4. Create Devices page with table
5. Implement mock API service

### Phase 2: Device Management

6. Add Device provisioning modal
7. Device detail page with metadata
8. Device CRUD operations
9. React Query hooks

### Phase 3: Visualization

10. Time-series chart with Recharts
11. Time range selector
12. Real-time updates

### Phase 4: Polish

13. Loading states and skeletons
14. Error handling
15. Empty states
16. Toast notifications
17. Responsive design refinement

---

## Testing Checklist

- [ ] Sign in/sign up flow works
- [ ] Organization switcher changes data
- [ ] Device cards display correctly
- [ ] Device table sorting/filtering works
- [ ] Add device modal creates device
- [ ] Credentials are copyable
- [ ] Device detail page loads
- [ ] Chart displays telemetry data
- [ ] Time range selector updates chart
- [ ] Real-time updates work
- [ ] Mobile responsive
- [ ] Dark mode works
- [ ] Loading states show
- [ ] Error states show
- [ ] Empty states show

---

## Notes

- Start with mock data to build UI quickly
- Add `// TODO: Replace with real .NET API` comments
- Keep components small and focused
- Use existing shadcn/ui components
- Follow existing code patterns in the project
- Industrial aesthetic: clean, data-dense, professional
````

## File: apps/moondesk-dash/LICENSE
````
MIT License

Copyright (c) 2024 Mohammed Arham Khan

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
````

## File: apps/moondesk-dash/next.config.mjs
````javascript
import { withSentryConfig } from "@sentry/nextjs";
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactCompiler: true,
  compiler: {
    removeConsole: process.env.NODE_ENV === "production",
  },
  async redirects() {
    return [
      {
        source: "/dashboard",
        destination: "/dashboard/default",
        permanent: false,
      },
    ];
  },
}

export default withSentryConfig(nextConfig, {
  // For all available options, see:
  // https://www.npmjs.com/package/@sentry/webpack-plugin#options

  org: "moondesk",

  project: "moondesk-dash",

  // Only print logs for uploading source maps in CI
  silent: !process.env.CI,

  // For all available options, see:
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/manual-setup/

  // Upload a larger set of source maps for prettier stack traces (increases build time)
  widenClientFileUpload: true,

  // Route browser requests to Sentry through a Next.js rewrite to circumvent ad-blockers.
  // This can increase your server load as well as your hosting bill.
  // Note: Check that the configured route will not match with your Next.js middleware, otherwise reporting of client-
  // side errors will fail.
  tunnelRoute: "/monitoring",

  // Automatically tree-shake Sentry logger statements to reduce bundle size
  disableLogger: true,

  // Enables automatic instrumentation of Vercel Cron Monitors. (Does not yet work with App Router route handlers.)
  // See the following for more information:
  // https://docs.sentry.io/product/crons/
  // https://vercel.com/docs/cron-jobs
  automaticVercelMonitors: true,
});
````

## File: apps/moondesk-dash/package.json
````json
{
  "name": "moondesk-dash",
  "version": "2.0.0",
  "type": "module",
  "private": true,
  "scripts": {
    "dev": "next dev --port 3000",
    "build": "next build",
    "start": "next start",
    "lint": "eslint",
    "check-types": "next typegen && tsc --noEmit",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "generate:presets": "tsx src/scripts/generate-theme-presets.ts",
    "test": "vitest",
    "test:ui": "vitest --ui",
    "test:coverage": "vitest --coverage"
  },
  "devDependencies": {
    "@eslint/eslintrc": "^3.3.1",
    "@eslint/js": "^9.16.0",
    "@moondesk/typescript-config": "workspace:*",
    "@tailwindcss/postcss": "^4.1.17",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@types/node": "^22.15.3",
    "@types/react": "19.2.2",
    "@types/react-dom": "19.2.2",
    "@typescript-eslint/parser": "^8.26.0",
    "@vitejs/plugin-react": "^5.1.1",
    "@vitest/coverage-v8": "4.0.13",
    "babel-plugin-react-compiler": "^19.0.0-beta-df7b47d-20241124",
    "eslint": "^9.39.1",
    "eslint-config-next": "^16.0.1",
    "eslint-plugin-import": "^2.32.0",
    "eslint-plugin-prettier": "^5.5.4",
    "eslint-plugin-security": "^3.0.1",
    "eslint-plugin-sonarjs": "^3.0.5",
    "eslint-plugin-unicorn": "^56.0.1",
    "globals": "^15.15.0",
    "jsdom": "^27.2.0",
    "postcss": "^8.5.6",
    "prettier": "^3.6.2",
    "prettier-plugin-tailwindcss": "^0.6.14",
    "tailwindcss": "^4.1.17",
    "tsx": "^4.19.2",
    "typescript": "5.9.2",
    "typescript-eslint": "^8.46.4",
    "vitest": "^4.0.13"
  },
  "dependencies": {
    "@clerk/nextjs": "^6.35.2",
    "@clerk/themes": "^2.4.37",
    "@dnd-kit/core": "^6.3.1",
    "@dnd-kit/modifiers": "^9.0.0",
    "@dnd-kit/sortable": "^10.0.0",
    "@dnd-kit/utilities": "^3.2.2",
    "@hookform/resolvers": "^3.10.0",
    "@microsoft/signalr": "^10.0.0",
    "@moondesk/domain": "workspace:*",
    "@moondesk/ui": "workspace:*",
    "@sentry/nextjs": "^10.30.0",
    "@tanstack/react-query": "^5.90.8",
    "@tanstack/react-table": "^8.21.3",
    "@vitest/ui": "^4.0.13",
    "axios": "^1.13.2",
    "class-variance-authority": "^0.7.1",
    "clsx": "^2.1.1",
    "cmdk": "^1.1.1",
    "date-fns": "^4.1.0",
    "embla-carousel-react": "^8.6.0",
    "import-in-the-middle": "^2.0.0",
    "input-otp": "^1.4.2",
    "lucide-react": "^0.454.0",
    "next": "^16.0.1",
    "next-themes": "^0.4.6",
    "radix-ui": "^1.4.3",
    "react": "^19.2.0",
    "react-day-picker": "^9.11.1",
    "react-dom": "^19.2.0",
    "react-hook-form": "^7.66.0",
    "react-resizable-panels": "^3.0.6",
    "recharts": "^2.15.4",
    "require-in-the-middle": "^8.0.1",
    "simple-icons": "^15.20.0",
    "sonner": "^2.0.7",
    "tailwind-merge": "^3.4.0",
    "tailwindcss-animate": "^1.0.7",
    "vaul": "^1.1.2",
    "zod": "^3.24.2",
    "zustand": "^5.0.8"
  }
}
````

## File: apps/moondesk-dash/postcss.config.mjs
````javascript
/** @type {import('postcss-load-config').Config} */
const config = {
  plugins: {
    '@tailwindcss/postcss': {},
  },
}

export default config
````

## File: apps/moondesk-dash/sentry.edge.config.ts
````typescript
// This file configures the initialization of Sentry for edge features (middleware, edge routes, and so on).
// The config you add here will be used whenever one of the edge features is loaded.
// Note that this config is unrelated to the Vercel Edge Runtime and is also required when running locally.
// https://docs.sentry.io/platforms/javascript/guides/nextjs/

import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: "https://12d4e362381e912751acf2f4d2ea7e21@o4509589925527552.ingest.de.sentry.io/4510518434463824",

  // Define how likely traces are sampled. Adjust this value in production, or use tracesSampler for greater control.
  tracesSampleRate: 1,

  // Enable logs to be sent to Sentry
  enableLogs: true,

  // Enable sending user PII (Personally Identifiable Information)
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
});
````

## File: apps/moondesk-dash/sentry.server.config.ts
````typescript
// This file configures the initialization of Sentry on the server.
// The config you add here will be used whenever the server handles a request.
// https://docs.sentry.io/platforms/javascript/guides/nextjs/

import * as Sentry from "@sentry/nextjs";

Sentry.init({
  dsn: "https://12d4e362381e912751acf2f4d2ea7e21@o4509589925527552.ingest.de.sentry.io/4510518434463824",

  // Define how likely traces are sampled. Adjust this value in production, or use tracesSampler for greater control.
  tracesSampleRate: 1,

  // Enable logs to be sent to Sentry
  enableLogs: true,

  // Enable sending user PII (Personally Identifiable Information)
  // https://docs.sentry.io/platforms/javascript/guides/nextjs/configuration/options/#sendDefaultPii
  sendDefaultPii: true,
});
````

## File: apps/moondesk-dash/tsconfig.json
````json
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts", ".next/dev/types/**/*.ts"],
  "exclude": ["node_modules"]
}
````

## File: apps/moondesk-dash/vitest.config.ts
````typescript
import { defineConfig } from "vitest/config";
import react from "@vitejs/plugin-react";
import path from "path";

export default defineConfig({
  plugins: [react()],
  test: {
    environment: "jsdom",
    globals: true,
    setupFiles: ["./src/test/setup.ts"],
  },
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
});
````

## File: apps/mqtt-worker/Dockerfile
````
FROM node:22-alpine AS base
ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
RUN corepack enable

FROM base AS builder
RUN apk add --no-cache libc6-compat
WORKDIR /app
COPY . .
RUN pnpm install --frozen-lockfile
RUN pnpm --filter @moondesk/mqtt-worker build

FROM base AS runner
WORKDIR /app

# Copy root config files
COPY --from=builder /app/package.json ./package.json
COPY --from=builder /app/pnpm-lock.yaml ./pnpm-lock.yaml
COPY --from=builder /app/pnpm-workspace.yaml ./pnpm-workspace.yaml

# Copy shared packages
COPY --from=builder /app/packages ./packages

# Copy app source and build
COPY --from=builder /app/apps/mqtt-worker ./apps/mqtt-worker

# Install production dependencies
RUN pnpm install --prod --frozen-lockfile

ENV NODE_ENV=production
WORKDIR /app/apps/mqtt-worker

CMD ["node", "dist/index.js"]
````

## File: apps/mqtt-worker/eslint.config.mjs
````javascript
import { config } from "@moondesk/eslint-config/base";

export default [...config];
````

## File: apps/mqtt-worker/tsconfig.json
````json
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "outDir": "dist",
        "rootDir": "src"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
````

## File: docker/mosquitto/config/mosquitto.conf
````ini
persistence true
persistence_location /mosquitto/data/
log_dest file /mosquitto/log/mosquitto.log

listener 1883
allow_anonymous true

listener 9001
protocol websockets
allow_anonymous true
````

## File: packages/config/eslint.config.mjs
````javascript
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
````

## File: packages/config/tsconfig.json
````json
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
````

## File: packages/database/src/migrations/meta/_journal.json
````json
{
  "version": "7",
  "dialect": "postgresql",
  "entries": [
    {
      "idx": 0,
      "version": "7",
      "when": 1765314902081,
      "tag": "0000_tranquil_shotgun",
      "breakpoints": true
    }
  ]
}
````

## File: packages/database/src/migrations/meta/0000_snapshot.json
````json
{
  "id": "15b2b1cb-4e94-4e6f-b3ff-8aa46f9916cc",
  "prevId": "00000000-0000-0000-0000-000000000000",
  "version": "7",
  "dialect": "postgresql",
  "tables": {
    "public.assets": {
      "name": "assets",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "location": {
          "name": "location",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "''"
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'unknown'"
        },
        "last_seen": {
          "name": "last_seen",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "manufacturer": {
          "name": "manufacturer",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "model_number": {
          "name": "model_number",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "installation_date": {
          "name": "installation_date",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_assets_organization_id": {
          "name": "idx_assets_organization_id",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_assets_status": {
          "name": "idx_assets_status",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "status",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.sensors": {
      "name": "sensors",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "asset_id": {
          "name": "asset_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "type": {
          "name": "type",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "parameter": {
          "name": "parameter",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'none'"
        },
        "unit": {
          "name": "unit",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "threshold_low": {
          "name": "threshold_low",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "threshold_high": {
          "name": "threshold_high",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "min_value": {
          "name": "min_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "max_value": {
          "name": "max_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "sampling_interval_ms": {
          "name": "sampling_interval_ms",
          "type": "integer",
          "primaryKey": false,
          "notNull": true,
          "default": 1000
        },
        "is_active": {
          "name": "is_active",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": true
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "description": {
          "name": "description",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_sensors_asset_id": {
          "name": "idx_sensors_asset_id",
          "columns": [
            {
              "expression": "asset_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "sensors_asset_id_assets_id_fk": {
          "name": "sensors_asset_id_assets_id_fk",
          "tableFrom": "sensors",
          "tableTo": "assets",
          "columnsFrom": [
            "asset_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.readings": {
      "name": "readings",
      "schema": "",
      "columns": {
        "sensor_id": {
          "name": "sensor_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "timestamp": {
          "name": "timestamp",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "value": {
          "name": "value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": true
        },
        "parameter": {
          "name": "parameter",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'none'"
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "quality": {
          "name": "quality",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'good'"
        },
        "notes": {
          "name": "notes",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        }
      },
      "indexes": {
        "idx_readings_org_sensor_time": {
          "name": "idx_readings_org_sensor_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sensor_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "timestamp",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_readings_org_time": {
          "name": "idx_readings_org_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "timestamp",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "readings_sensor_id_sensors_id_fk": {
          "name": "readings_sensor_id_sensors_id_fk",
          "tableFrom": "readings",
          "tableTo": "sensors",
          "columnsFrom": [
            "sensor_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "readings_sensor_id_timestamp_pk": {
          "name": "readings_sensor_id_timestamp_pk",
          "columns": [
            "sensor_id",
            "timestamp"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.alerts": {
      "name": "alerts",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "sensor_id": {
          "name": "sensor_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "timestamp": {
          "name": "timestamp",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "severity": {
          "name": "severity",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'info'"
        },
        "message": {
          "name": "message",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "trigger_value": {
          "name": "trigger_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": true
        },
        "threshold_value": {
          "name": "threshold_value",
          "type": "double precision",
          "primaryKey": false,
          "notNull": false
        },
        "acknowledged": {
          "name": "acknowledged",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": false
        },
        "acknowledged_at": {
          "name": "acknowledged_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "acknowledged_by": {
          "name": "acknowledged_by",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "notes": {
          "name": "notes",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        }
      },
      "indexes": {
        "idx_alerts_org_acknowledged_time": {
          "name": "idx_alerts_org_acknowledged_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "acknowledged",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "timestamp",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_alerts_org_sensor": {
          "name": "idx_alerts_org_sensor",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "sensor_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "alerts_sensor_id_sensors_id_fk": {
          "name": "alerts_sensor_id_sensors_id_fk",
          "tableFrom": "alerts",
          "tableTo": "sensors",
          "columnsFrom": [
            "sensor_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.commands": {
      "name": "commands",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "sensor_id": {
          "name": "sensor_id",
          "type": "integer",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "action": {
          "name": "action",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "parameters": {
          "name": "parameters",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "status": {
          "name": "status",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'pending'"
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'mqtt'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "sent_at": {
          "name": "sent_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "completed_at": {
          "name": "completed_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": false
        },
        "error_message": {
          "name": "error_message",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        }
      },
      "indexes": {
        "idx_commands_org_status_time": {
          "name": "idx_commands_org_status_time",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "status",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "created_at",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_commands_org_user": {
          "name": "idx_commands_org_user",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "user_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {
        "commands_sensor_id_sensors_id_fk": {
          "name": "commands_sensor_id_sensors_id_fk",
          "tableFrom": "commands",
          "tableTo": "sensors",
          "columnsFrom": [
            "sensor_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.users": {
      "name": "users",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "email": {
          "name": "email",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "username": {
          "name": "username",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "first_name": {
          "name": "first_name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "last_name": {
          "name": "last_name",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "image_url": {
          "name": "image_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_users_email": {
          "name": "idx_users_email",
          "columns": [
            {
              "expression": "email",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "users_email_unique": {
          "name": "users_email_unique",
          "nullsNotDistinct": false,
          "columns": [
            "email"
          ]
        },
        "users_username_unique": {
          "name": "users_username_unique",
          "nullsNotDistinct": false,
          "columns": [
            "username"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organization_memberships": {
      "name": "organization_memberships",
      "schema": "",
      "columns": {
        "user_id": {
          "name": "user_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "role": {
          "name": "role",
          "type": "text",
          "primaryKey": false,
          "notNull": true,
          "default": "'member'"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {},
      "foreignKeys": {
        "organization_memberships_user_id_users_id_fk": {
          "name": "organization_memberships_user_id_users_id_fk",
          "tableFrom": "organization_memberships",
          "tableTo": "users",
          "columnsFrom": [
            "user_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        },
        "organization_memberships_organization_id_organizations_id_fk": {
          "name": "organization_memberships_organization_id_organizations_id_fk",
          "tableFrom": "organization_memberships",
          "tableTo": "organizations",
          "columnsFrom": [
            "organization_id"
          ],
          "columnsTo": [
            "id"
          ],
          "onDelete": "cascade",
          "onUpdate": "no action"
        }
      },
      "compositePrimaryKeys": {
        "organization_memberships_user_id_organization_id_pk": {
          "name": "organization_memberships_user_id_organization_id_pk",
          "columns": [
            "user_id",
            "organization_id"
          ]
        }
      },
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.organizations": {
      "name": "organizations",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "text",
          "primaryKey": true,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "slug": {
          "name": "slug",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "image_url": {
          "name": "image_url",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "owner_id": {
          "name": "owner_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_organizations_owner": {
          "name": "idx_organizations_owner",
          "columns": [
            {
              "expression": "owner_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {
        "organizations_slug_unique": {
          "name": "organizations_slug_unique",
          "nullsNotDistinct": false,
          "columns": [
            "slug"
          ]
        }
      },
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    },
    "public.connection_credentials": {
      "name": "connection_credentials",
      "schema": "",
      "columns": {
        "id": {
          "name": "id",
          "type": "serial",
          "primaryKey": true,
          "notNull": true
        },
        "organization_id": {
          "name": "organization_id",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "name": {
          "name": "name",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "protocol": {
          "name": "protocol",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "endpoint_uri": {
          "name": "endpoint_uri",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "username": {
          "name": "username",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "encrypted_password": {
          "name": "encrypted_password",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "encryption_iv": {
          "name": "encryption_iv",
          "type": "text",
          "primaryKey": false,
          "notNull": true
        },
        "client_id": {
          "name": "client_id",
          "type": "text",
          "primaryKey": false,
          "notNull": false
        },
        "is_active": {
          "name": "is_active",
          "type": "boolean",
          "primaryKey": false,
          "notNull": true,
          "default": true
        },
        "metadata": {
          "name": "metadata",
          "type": "jsonb",
          "primaryKey": false,
          "notNull": false,
          "default": "'{}'::jsonb"
        },
        "created_at": {
          "name": "created_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        },
        "updated_at": {
          "name": "updated_at",
          "type": "timestamp with time zone",
          "primaryKey": false,
          "notNull": true,
          "default": "now()"
        }
      },
      "indexes": {
        "idx_credentials_org_protocol": {
          "name": "idx_credentials_org_protocol",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "protocol",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        },
        "idx_credentials_org_active": {
          "name": "idx_credentials_org_active",
          "columns": [
            {
              "expression": "organization_id",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            },
            {
              "expression": "is_active",
              "isExpression": false,
              "asc": true,
              "nulls": "last"
            }
          ],
          "isUnique": false,
          "concurrently": false,
          "method": "btree",
          "with": {}
        }
      },
      "foreignKeys": {},
      "compositePrimaryKeys": {},
      "uniqueConstraints": {},
      "policies": {},
      "checkConstraints": {},
      "isRLSEnabled": false
    }
  },
  "enums": {},
  "schemas": {},
  "sequences": {},
  "roles": {},
  "policies": {},
  "views": {},
  "_meta": {
    "columns": {},
    "schemas": {},
    "tables": {}
  }
}
````

## File: packages/database/src/migrations/0000_tranquil_shotgun.sql
````sql
CREATE TABLE "assets" (
	"id" serial PRIMARY KEY NOT NULL,
	"organization_id" text NOT NULL,
	"name" text NOT NULL,
	"type" text NOT NULL,
	"location" text DEFAULT '' NOT NULL,
	"status" text DEFAULT 'unknown' NOT NULL,
	"last_seen" timestamp with time zone,
	"description" text,
	"manufacturer" text,
	"model_number" text,
	"installation_date" timestamp with time zone,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "sensors" (
	"id" serial PRIMARY KEY NOT NULL,
	"asset_id" integer NOT NULL,
	"name" text NOT NULL,
	"type" text NOT NULL,
	"parameter" text DEFAULT 'none' NOT NULL,
	"unit" text NOT NULL,
	"threshold_low" double precision,
	"threshold_high" double precision,
	"min_value" double precision,
	"max_value" double precision,
	"sampling_interval_ms" integer DEFAULT 1000 NOT NULL,
	"is_active" boolean DEFAULT true NOT NULL,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"description" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
CREATE TABLE "readings" (
	"sensor_id" integer NOT NULL,
	"organization_id" text NOT NULL,
	"timestamp" timestamp with time zone DEFAULT now() NOT NULL,
	"value" double precision NOT NULL,
	"parameter" text DEFAULT 'none' NOT NULL,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"quality" text DEFAULT 'good' NOT NULL,
	"notes" text,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	CONSTRAINT "readings_sensor_id_timestamp_pk" PRIMARY KEY("sensor_id","timestamp")
);
--> statement-breakpoint
CREATE TABLE "alerts" (
	"id" serial PRIMARY KEY NOT NULL,
	"sensor_id" integer NOT NULL,
	"organization_id" text NOT NULL,
	"timestamp" timestamp with time zone DEFAULT now() NOT NULL,
	"severity" text DEFAULT 'info' NOT NULL,
	"message" text NOT NULL,
	"trigger_value" double precision NOT NULL,
	"threshold_value" double precision,
	"acknowledged" boolean DEFAULT false NOT NULL,
	"acknowledged_at" timestamp with time zone,
	"acknowledged_by" text,
	"notes" text,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb
);
--> statement-breakpoint
CREATE TABLE "commands" (
	"id" serial PRIMARY KEY NOT NULL,
	"sensor_id" integer NOT NULL,
	"organization_id" text NOT NULL,
	"user_id" text NOT NULL,
	"action" text NOT NULL,
	"parameters" jsonb DEFAULT '{}'::jsonb,
	"status" text DEFAULT 'pending' NOT NULL,
	"protocol" text DEFAULT 'mqtt' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"sent_at" timestamp with time zone,
	"completed_at" timestamp with time zone,
	"error_message" text,
	"metadata" jsonb DEFAULT '{}'::jsonb
);
--> statement-breakpoint
CREATE TABLE "users" (
	"id" text PRIMARY KEY NOT NULL,
	"email" text NOT NULL,
	"username" text,
	"first_name" text,
	"last_name" text,
	"image_url" text,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "users_email_unique" UNIQUE("email"),
	CONSTRAINT "users_username_unique" UNIQUE("username")
);
--> statement-breakpoint
CREATE TABLE "organization_memberships" (
	"user_id" text NOT NULL,
	"organization_id" text NOT NULL,
	"role" text DEFAULT 'member' NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "organization_memberships_user_id_organization_id_pk" PRIMARY KEY("user_id","organization_id")
);
--> statement-breakpoint
CREATE TABLE "organizations" (
	"id" text PRIMARY KEY NOT NULL,
	"name" text NOT NULL,
	"slug" text,
	"image_url" text,
	"owner_id" text NOT NULL,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL,
	CONSTRAINT "organizations_slug_unique" UNIQUE("slug")
);
--> statement-breakpoint
CREATE TABLE "connection_credentials" (
	"id" serial PRIMARY KEY NOT NULL,
	"organization_id" text NOT NULL,
	"name" text NOT NULL,
	"protocol" text NOT NULL,
	"endpoint_uri" text NOT NULL,
	"username" text NOT NULL,
	"encrypted_password" text NOT NULL,
	"encryption_iv" text NOT NULL,
	"client_id" text,
	"is_active" boolean DEFAULT true NOT NULL,
	"metadata" jsonb DEFAULT '{}'::jsonb,
	"created_at" timestamp with time zone DEFAULT now() NOT NULL,
	"updated_at" timestamp with time zone DEFAULT now() NOT NULL
);
--> statement-breakpoint
ALTER TABLE "sensors" ADD CONSTRAINT "sensors_asset_id_assets_id_fk" FOREIGN KEY ("asset_id") REFERENCES "public"."assets"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "readings" ADD CONSTRAINT "readings_sensor_id_sensors_id_fk" FOREIGN KEY ("sensor_id") REFERENCES "public"."sensors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "alerts" ADD CONSTRAINT "alerts_sensor_id_sensors_id_fk" FOREIGN KEY ("sensor_id") REFERENCES "public"."sensors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "commands" ADD CONSTRAINT "commands_sensor_id_sensors_id_fk" FOREIGN KEY ("sensor_id") REFERENCES "public"."sensors"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_memberships" ADD CONSTRAINT "organization_memberships_user_id_users_id_fk" FOREIGN KEY ("user_id") REFERENCES "public"."users"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
ALTER TABLE "organization_memberships" ADD CONSTRAINT "organization_memberships_organization_id_organizations_id_fk" FOREIGN KEY ("organization_id") REFERENCES "public"."organizations"("id") ON DELETE cascade ON UPDATE no action;--> statement-breakpoint
CREATE INDEX "idx_assets_organization_id" ON "assets" USING btree ("organization_id");--> statement-breakpoint
CREATE INDEX "idx_assets_status" ON "assets" USING btree ("organization_id","status");--> statement-breakpoint
CREATE INDEX "idx_sensors_asset_id" ON "sensors" USING btree ("asset_id");--> statement-breakpoint
CREATE INDEX "idx_readings_org_sensor_time" ON "readings" USING btree ("organization_id","sensor_id","timestamp");--> statement-breakpoint
CREATE INDEX "idx_readings_org_time" ON "readings" USING btree ("organization_id","timestamp");--> statement-breakpoint
CREATE INDEX "idx_alerts_org_acknowledged_time" ON "alerts" USING btree ("organization_id","acknowledged","timestamp");--> statement-breakpoint
CREATE INDEX "idx_alerts_org_sensor" ON "alerts" USING btree ("organization_id","sensor_id");--> statement-breakpoint
CREATE INDEX "idx_commands_org_status_time" ON "commands" USING btree ("organization_id","status","created_at");--> statement-breakpoint
CREATE INDEX "idx_commands_org_user" ON "commands" USING btree ("organization_id","user_id");--> statement-breakpoint
CREATE INDEX "idx_users_email" ON "users" USING btree ("email");--> statement-breakpoint
CREATE INDEX "idx_organizations_owner" ON "organizations" USING btree ("owner_id");--> statement-breakpoint
CREATE INDEX "idx_credentials_org_protocol" ON "connection_credentials" USING btree ("organization_id","protocol");--> statement-breakpoint
CREATE INDEX "idx_credentials_org_active" ON "connection_credentials" USING btree ("organization_id","is_active");
````

## File: packages/database/eslint.config.mjs
````javascript
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
````

## File: packages/database/tsconfig.json
````json
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
````

## File: packages/domain/eslint.config.mjs
````javascript
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
````

## File: packages/domain/tsconfig.json
````json
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
````

## File: packages/eslint-config/base.js
````javascript
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";
import turboPlugin from "eslint-plugin-turbo";
import tseslint from "typescript-eslint";
import onlyWarn from "eslint-plugin-only-warn";

/**
 * A shared ESLint configuration for the repository.
 *
 * @type {import("eslint").Linter.Config[]}
 * */
export const config = [
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  {
    plugins: {
      turbo: turboPlugin,
    },
    rules: {
      "turbo/no-undeclared-env-vars": "warn",
    },
  },
  {
    plugins: {
      onlyWarn,
    },
  },
  {
    ignores: ["dist/**"],
  },
];
````

## File: packages/eslint-config/next.js
````javascript
import js from "@eslint/js";
import { globalIgnores } from "eslint/config";
import eslintConfigPrettier from "eslint-config-prettier";
import tseslint from "typescript-eslint";
import pluginReactHooks from "eslint-plugin-react-hooks";
import pluginReact from "eslint-plugin-react";
import globals from "globals";
import pluginNext from "@next/eslint-plugin-next";
import { config as baseConfig } from "./base.js";

/**
 * A custom ESLint configuration for libraries that use Next.js.
 *
 * @type {import("eslint").Linter.Config[]}
 * */
export const nextJsConfig = [
  ...baseConfig,
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
  {
    ...pluginReact.configs.flat.recommended,
    languageOptions: {
      ...pluginReact.configs.flat.recommended.languageOptions,
      globals: {
        ...globals.serviceworker,
      },
    },
  },
  {
    plugins: {
      "@next/next": pluginNext,
    },
    rules: {
      ...pluginNext.configs.recommended.rules,
      ...pluginNext.configs["core-web-vitals"].rules,
    },
  },
  {
    plugins: {
      "react-hooks": pluginReactHooks,
    },
    settings: { react: { version: "detect" } },
    rules: {
      ...pluginReactHooks.configs.recommended.rules,
      // React scope no longer necessary with new JSX transform.
      "react/react-in-jsx-scope": "off",
    },
  },
];
````

## File: packages/eslint-config/package.json
````json
{
  "name": "@moondesk/eslint-config",
  "version": "0.0.0",
  "type": "module",
  "private": true,
  "exports": {
    "./base": "./base.js",
    "./next-js": "./next.js",
    "./react-internal": "./react-internal.js"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@next/eslint-plugin-next": "^15.5.0",
    "eslint": "^9.39.1",
    "eslint-config-prettier": "^10.1.1",
    "eslint-plugin-only-warn": "^1.1.0",
    "eslint-plugin-react": "^7.37.5",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-turbo": "^2.6.0",
    "globals": "^16.5.0",
    "typescript": "^5.9.2",
    "typescript-eslint": "^8.46.3"
  }
}
````

## File: packages/eslint-config/react-internal.js
````javascript
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";
import tseslint from "typescript-eslint";
import pluginReactHooks from "eslint-plugin-react-hooks";
import pluginReact from "eslint-plugin-react";
import globals from "globals";
import { config as baseConfig } from "./base.js";

/**
 * A custom ESLint configuration for libraries that use React.
 *
 * @type {import("eslint").Linter.Config[]} */
export const config = [
  ...baseConfig,
  js.configs.recommended,
  eslintConfigPrettier,
  ...tseslint.configs.recommended,
  pluginReact.configs.flat.recommended,
  {
    languageOptions: {
      ...pluginReact.configs.flat.recommended.languageOptions,
      globals: {
        ...globals.serviceworker,
        ...globals.browser,
      },
    },
  },
  {
    plugins: {
      "react-hooks": pluginReactHooks,
    },
    settings: { react: { version: "detect" } },
    rules: {
      ...pluginReactHooks.configs.recommended.rules,
      // React scope no longer necessary with new JSX transform.
      "react/react-in-jsx-scope": "off",
    },
  },
];
````

## File: packages/eslint-config/README.md
````markdown
# `@turbo/eslint-config`

Collection of internal eslint configurations.
````

## File: packages/logger/eslint.config.mjs
````javascript
import { config } from "@moondesk/eslint-config/base";

/** @type {import("eslint").Linter.Config[]} */
export default config;
````

## File: packages/logger/tsconfig.json
````json
{
    "extends": "@moondesk/typescript-config/base.json",
    "compilerOptions": {
        "rootDir": "./src",
        "outDir": "./dist"
    },
    "include": [
        "src/**/*"
    ],
    "exclude": [
        "node_modules",
        "dist"
    ]
}
````

## File: packages/typescript-config/base.json
````json
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "compilerOptions": {
    "declaration": true,
    "declarationMap": true,
    "esModuleInterop": true,
    "incremental": false,
    "isolatedModules": true,
    "lib": [
      "es2022",
      "DOM",
      "DOM.Iterable"
    ],
    "module": "ESNext",
    "moduleDetection": "force",
    "moduleResolution": "bundler",
    "noUncheckedIndexedAccess": true,
    "resolveJsonModule": true,
    "skipLibCheck": true,
    "strict": true,
    "target": "ES2022"
  }
}
````

## File: packages/typescript-config/nextjs.json
````json
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./base.json",
  "compilerOptions": {
    "plugins": [{ "name": "next" }],
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "allowJs": true,
    "jsx": "preserve",
    "noEmit": true
  }
}
````

## File: packages/typescript-config/package.json
````json
{
  "name": "@moondesk/typescript-config",
  "version": "0.0.0",
  "private": true,
  "license": "MIT",
  "publishConfig": {
    "access": "public"
  }
}
````

## File: packages/typescript-config/react-library.json
````json
{
  "$schema": "https://json.schemastore.org/tsconfig",
  "extends": "./base.json",
  "compilerOptions": {
    "jsx": "react-jsx"
  }
}
````

## File: packages/ui/src/button.tsx
````typescript
"use client";

import { type MouseEventHandler, type ReactNode } from "react";

interface ButtonProps {
  children: ReactNode;
  className?: string;
  onClick?: MouseEventHandler<HTMLButtonElement>;
}

export const Button = ({ children, className, onClick }: ButtonProps) => {
  return (
    <button type="button" className={className} onClick={onClick}>
      {children}
    </button>
  );
};
````

## File: packages/ui/src/card.tsx
````typescript
import { type JSX, type ReactNode } from "react";

interface CardProps {
  className?: string;
  title: string;
  children: ReactNode;
  href: string;
}

export function Card({
  className,
  title,
  children,
  href,
}: CardProps): JSX.Element {
  return (
    <div className={className}>
      <h2>
        <a href={href} rel="noopener noreferrer" target="_blank">
          {title} <span>-&gt;</span>
        </a>
      </h2>
      <p>{children}</p>
    </div>
  );
}
````

## File: packages/ui/src/code.tsx
````typescript
import { type JSX, type ReactNode } from "react";

interface CodeProps {
  children: ReactNode;
  className?: string;
}

export function Code({ children, className }: CodeProps): JSX.Element {
  return (
    <pre>
      <code className={className}>{children}</code>
    </pre>
  );
}
````

## File: packages/ui/eslint.config.mjs
````javascript
import { config } from "@moondesk/eslint-config/react-internal";

/** @type {import("eslint").Linter.Config} */
export default config;
````

## File: packages/ui/package.json
````json
{
  "name": "@moondesk/ui",
  "version": "0.0.0",
  "private": true,
  "exports": {
    "./*": "./src/*.tsx"
  },
  "scripts": {
    "lint": "eslint . --max-warnings 0",
    "generate:component": "turbo gen react-component",
    "check-types": "tsc --noEmit"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:*",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "@types/react": "19.2.2",
    "@types/react-dom": "19.2.2",
    "eslint": "^9.39.1",
    "typescript": "5.9.2"
  },
  "dependencies": {
    "react": "^19.2.0",
    "react-dom": "^19.2.0"
  }
}
````

## File: packages/ui/tsconfig.json
````json
{
  "extends": "@moondesk/typescript-config/react-library.json",
  "compilerOptions": {
    "outDir": "dist"
  },
  "include": [
    "src"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}
````

## File: .env.example
````
# === Backend / General ===
NODE_ENV=development

# Database (Defaults for local Docker)
DB_HOST=localhost
DB_PORT=5435
DB_USER=moondeskdb
DB_NAME=moondeskdb
# Secret: Provide in Jules/Env
DB_PASSWORD=

# MQTT (Mosquitto)
MQTT_HOST=localhost
MQTT_PORT=1883
# Secrets: Leave blank if using anonymous or provide in Jules
MQTT_USERNAME=
MQTT_PASSWORD=

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379

# Internal Service Auth
# Secret: Used for Worker <-> API communication
INTERNAL_SERVICE_TOKEN=

# === Frontend (Next.js) / Auth ===
# Secret: Clerk Keys
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=
CLERK_SECRET_KEY=

# Clerk Routes (Standard Defaults)
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/auth/v2/login
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/auth/v2/register
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard/iiot
NEXT_PUBLIC_CLERK_ORGANIZATION_PROFILE_URL=/organization

# API URL
NEXT_PUBLIC_API_URL=http://localhost:3000/api/v1
````

## File: docker-compose.yml
````yaml
services:
  timescaledb:
    image: timescale/timescaledb:latest-pg17
    container_name: moondesk_db
    environment:
      POSTGRES_USER: ${DB_USER:-postgres}
      POSTGRES_PASSWORD: ${DB_PASSWORD:-postgres}
      POSTGRES_DB: ${DB_NAME:-moondesk}
    ports:
      - "${DB_PORT:-5432}:5432"
    volumes:
      - timescaledb_data:/var/lib/postgresql/data
    networks:
      - moondesk_net
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${DB_USER:-postgres}"]
      interval: 5s
      timeout: 5s
      retries: 5

  mosquitto:
    image: eclipse-mosquitto:2
    container_name: moondesk_mqtt
    ports:
      - "${MQTT_PORT:-1883}:1883"
      - "9001:9001"
    volumes:
      - ./docker/mosquitto/config:/mosquitto/config
      - mosquitto_data:/mosquitto/data
      - mosquitto_log:/mosquitto/log
    networks:
      - moondesk_net

  redis:
    image: redis:alpine
    container_name: moondesk_redis
    ports:
      - "${REDIS_PORT:-6379}:6379"
    volumes:
      - redis_data:/data
    networks:
      - moondesk_net

  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    container_name: moondesk_api
    environment:
      - PORT=3000
      - HOST=0.0.0.0
      - DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@timescaledb:5432/${DB_NAME}
      - MQTT_HOST=mosquitto
      - REDIS_HOST=redis
      - CLERK_SECRET_KEY=${CLERK_SECRET_KEY}
      - CLERK_PUBLISHABLE_KEY=${CLERK_PUBLISHABLE_KEY}
      - INTERNAL_SERVICE_TOKEN=${INTERNAL_SERVICE_TOKEN}
    ports:
      - "3000:3000"
    depends_on:
      timescaledb:
        condition: service_healthy
      mosquitto:
        condition: service_started
    networks:
      - moondesk_net

  mqtt-worker:
    build:
      context: .
      dockerfile: apps/mqtt-worker/Dockerfile
    container_name: moondesk_worker
    environment:
      - DATABASE_URL=postgres://${DB_USER}:${DB_PASSWORD}@timescaledb:5432/${DB_NAME}
      - MQTT_HOST=mosquitto
      - INTERNAL_SERVICE_TOKEN=${INTERNAL_SERVICE_TOKEN}
      - API_URL=http://api:3000
    depends_on:
      timescaledb:
        condition: service_healthy
      mosquitto:
        condition: service_started
      api:
        condition: service_started
    networks:
      - moondesk_net

  edge-simulator:
    build:
      context: .
      dockerfile: apps/edge-simulator/Dockerfile
    container_name: moondesk_simulator
    environment:
      - MQTT_HOST=mosquitto
    depends_on:
      mosquitto:
        condition: service_started
    networks:
      - moondesk_net
    profiles:
      - tools  # Don't run by default with 'docker-compose up', explicit only


volumes:
  timescaledb_data:
  mosquitto_data:
  mosquitto_log:
  redis_data:

networks:
  moondesk_net:
    driver: bridge
````

## File: pnpm-workspace.yaml
````yaml
packages:
  - "apps/*"
  - "packages/*"
````

## File: .github/workflows/ci.yml
````yaml
name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'pnpm'

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Format
        run: pnpm format:check

      - name: Lint
        run: pnpm lint

      - name: Check Types
        run: pnpm check-types

      - name: Test
        run: pnpm test

      - name: Build
        run: pnpm build
````

## File: .husky/commit-msg
````
#!/bin/sh

# Get the current branch name
branch_name=$(git symbolic-ref --short HEAD)

# Check if branch matches the pattern mndsk-<number>-...
if echo "$branch_name" | grep -qE '^mndsk-[0-9]+-'; then
  # Extract the identifier (e.g., mndsk-39)
  ticket_id=$(echo "$branch_name" | grep -oE 'mndsk-[0-9]+' | tr '[:lower:]' '[:upper:]')
  
  # Get the current commit message
  commit_msg=$(cat "$1")
  
  # Check if the message already starts with the ticket ID
  if ! echo "$commit_msg" | grep -qE "^$ticket_id"; then
    # Prepend the ticket ID to the message
    echo "$ticket_id $commit_msg" > "$1"
  fi
fi
````

## File: apps/edge-simulator/src/__tests__/generators.test.ts
````typescript
import { describe, it, expect } from "vitest";
import { generateValue } from "../generators";
import { SimulationProfile } from "../types";
import { Parameter } from "@moondesk/domain";

// Helper to create a basic profile
const createProfile = (
  overrides: Partial<SimulationProfile> = {},
): SimulationProfile => ({
  waveform: "constant",
  min: 0,
  max: 10,
  frequency: 1,
  noise: 0,
  parameter: Parameter.None,
  ...overrides,
});

describe("generateValue", () => {
  it("should generate constant value correctly", () => {
    const profile = createProfile({
      waveform: "constant",
      min: 10,
      max: 10,
      noise: 0,
    });
    const val = generateValue(profile, 0);
    expect(val).toBe(10);
  });

  it("should respect explicit offset in constant waveform", () => {
    const profile = createProfile({
      waveform: "constant",
      offset: 42,
      noise: 0,
    });
    const val = generateValue(profile, 0);
    expect(val).toBe(42);
  });

  it("should generate linear values correctly", () => {
    const profile = createProfile({
      waveform: "linear",
      min: 10,
      max: 2,
      noise: 0,
    }); // start 10, slope 2 (max used as slope)
    // t=0 => 10
    expect(generateValue(profile, 0)).toBe(10);
    // t=1s (1000ms) => 12
    expect(generateValue(profile, 1000)).toBe(12);
    // t=10s (10000ms) => 30
    expect(generateValue(profile, 10000)).toBe(30);
  });

  it("should generate sine wave within min/max bounds (ignoring noise)", () => {
    const profile = createProfile({
      waveform: "sine",
      min: -10,
      max: 10,
      frequency: 1,
      noise: 0,
    });
    // t=0, sin(0)=0. Base value is center (0) + 0 = 0?
    // Let's check impl: baseValue = center + amplitude * sin(...)
    // center = (-10+10)/2 = 0. amplitude = (10 - -10)/2 = 10.
    // t=0 -> 0
    expect(generateValue(profile, 0)).toBe(0);

    // t=0.25s (250ms) -> sin(2pi * 1 * 0.25) = 1. Val = 10.
    expect(generateValue(profile, 250)).toBe(10);

    // t=0.75s (750ms) -> sin(2pi * 1 * 0.75) = -1. Val = -10.
    expect(generateValue(profile, 750)).toBe(-10);
  });

  it("should return number with max 4 decimal places", () => {
    const profile = createProfile({
      waveform: "random",
      min: 0,
      max: 1,
      noise: 0.123456,
    });
    const val = generateValue(profile, 0);
    // Check string representation length logic or just formatting check
    const decimalPart = val.toString().split(".")[1];
    if (decimalPart) {
      expect(decimalPart.length).toBeLessThanOrEqual(4);
    }
  });
});
````

## File: apps/edge-simulator/src/__tests__/presets.test.ts
````typescript
import { describe, it, expect } from "vitest";
import { EnergyProfiles, ProcessProfiles } from "../presets";
import { Parameter } from "@moondesk/domain";

describe("Presets", () => {
  it("EnergyProfiles should have valid parameters", () => {
    expect(EnergyProfiles.GridVoltage.parameter).toBe(Parameter.Voltage);
    expect(EnergyProfiles.MotorCurrent.parameter).toBe(Parameter.Current);
    expect(EnergyProfiles.ActivePower.parameter).toBe(Parameter.Power);
    expect(EnergyProfiles.EnergyConsumption.parameter).toBe(Parameter.Energy);
  });

  it("EnergyConsumption should use linear waveform", () => {
    expect(EnergyProfiles.EnergyConsumption.waveform).toBe("linear");
  });

  it("ProcessProfiles should have valid parameters", () => {
    expect(ProcessProfiles.TankLevel.parameter).toBe(Parameter.Level);
    expect(ProcessProfiles.PipePressure.parameter).toBe(Parameter.Pressure);
    expect(ProcessProfiles.WaterTemperature.parameter).toBe(
      Parameter.Temperature,
    );
    expect(ProcessProfiles.PipeFlow.parameter).toBe(Parameter.Flow);
  });

  it("All profiles should have min <= max", () => {
    const allProfiles = { ...EnergyProfiles, ...ProcessProfiles };
    Object.values(allProfiles).forEach((profile) => {
      // For linear, max is slope, so min<=max doesn't strictly apply, but let's check non-linear ones
      if (profile.waveform !== "linear") {
        expect(profile.min).toBeLessThanOrEqual(profile.max);
      }
    });
  });
});
````

## File: apps/edge-simulator/src/generators.ts
````typescript
import { SimulationProfile } from "./types";

/**
 * Generate a value based on the simulation profile and current time
 */
export function generateValue(
  profile: SimulationProfile,
  timestamp: number,
): number {
  const { waveform, min, max, frequency, noise, offset = 0 } = profile;
  const timeSec = timestamp / 1000;
  const amplitude = (max - min) / 2;
  const center = min + amplitude;

  let baseValue = 0;

  switch (waveform) {
    case "sine":
      baseValue =
        center + amplitude * Math.sin(2 * Math.PI * frequency * timeSec);
      break;
    case "cosine":
      baseValue =
        center + amplitude * Math.cos(2 * Math.PI * frequency * timeSec);
      break;
    case "triangle": {
      const period = 1 / frequency;
      const t = (timeSec % period) / period;
      baseValue = center + amplitude * (2 * Math.abs(2 * t - 1) - 1);
      break;
    }
    case "sawtooth": {
      const period = 1 / frequency;
      const t = (timeSec % period) / period;
      baseValue = min + (max - min) * t;
      break;
    }
    case "square":
      baseValue = Math.sin(2 * Math.PI * frequency * timeSec) >= 0 ? max : min;
      break;
    case "random":
      baseValue = min + Math.random() * (max - min);
      break;
    case "constant":
      baseValue = center; // or just offset? let's stick to center + offset logic if needed
      if (offset !== 0)
        baseValue = offset; // override if explicit offset given for constant
      else baseValue = (min + max) / 2;
      break;
    case "linear":
      // For linear, we use 'max' as the rate (slope) and 'min' as the starting value (intercept)
      // Value = start + slope * time
      // To prevent unbounded growth in simple tests, we might want to modulo it or just let it grow.
      // Requirement mentions "Energy consumption (increasing)", so unbounded growth is expected.
      // However, timeSec is absolute simulation time? Or request time?
      // Usually simulators run indefinitely. Let's assume linear is strictly T * slope + offset
      // We use 'max' field for slope, 'min' for initial value.
      baseValue = min + max * timeSec;
      break;
  }

  // Add noise
  if (noise > 0) {
    const noiseValue = (Math.random() - 0.5) * 2 * noise;
    baseValue += noiseValue;
  }

  // Apply global offset if not constant (already handled)
  if (waveform !== "constant" && offset) {
    baseValue += offset;
  }

  // Clamping just in case noise pushed it way out?
  // Actually real sensors might go out of range, so let's allow it to float unless explicitly clamped.
  // But usually we want some boundaries. Let's return raw value for now.

  return Number(baseValue.toFixed(4));
}
````

## File: apps/edge-simulator/src/main.ts
````typescript
import { createLogger } from "@moondesk/logger";
import { MqttPublisher } from "./mqtt-publisher";
import { SimulationEngine } from "./simulation-engine";
import { SimulationScenario } from "./types";
import { Parameter, SensorType } from "@moondesk/domain";

const logger = createLogger("simulator-main");

const DEFAULT_SCENARIO: SimulationScenario = {
  id: "default-factory",
  name: "Default Smart Factory",
  description: "A basic factory setup with various sensors",
  sensors: [
    {
      id: 101, // Temperature Sensor
      organizationId: "org_1",
      type: SensorType.Temperature,
      enabled: true,
      intervalMs: 2000,
      profile: {
        waveform: "sine",
        parameter: Parameter.Temperature,
        min: 20,
        max: 80,
        frequency: 0.1, // Slow cycle
        noise: 1.5,
      },
    },
    {
      id: 102, // Vibration Sensor (High frequency)
      organizationId: "org_1",
      type: SensorType.Vibration,
      enabled: true,
      intervalMs: 500, // Fast sampling
      profile: {
        waveform: "random", // Noisy
        parameter: Parameter.Vibration,
        min: 0,
        max: 5,
        frequency: 1,
        noise: 0.5,
      },
    },
    {
      id: 103, // Pressure Sensor (Sawtooth - building up then release)
      organizationId: "org_1",
      type: SensorType.Pressure,
      enabled: true,
      intervalMs: 1000,
      profile: {
        waveform: "sawtooth",
        parameter: Parameter.Pressure,
        min: 100,
        max: 500,
        frequency: 0.05,
        noise: 5,
      },
    },
  ],
};

async function main() {
  logger.info("Starting Edge Simulator...");

  const publisher = new MqttPublisher();
  const engine = new SimulationEngine(publisher);

  try {
    await publisher.connect();

    // Load default scenario
    engine.startScenario(DEFAULT_SCENARIO);

    // Keep process alive
    process.stdin.resume();

    // Handle shutdown
    const shutdown = async () => {
      logger.info("Shutting down...");
      engine.stopAll();
      await publisher.disconnect();
      process.exit(0);
    };

    process.on("SIGINT", shutdown);
    process.on("SIGTERM", shutdown);
  } catch (error) {
    logger.error({ error }, "Failed to start simulator");
    process.exit(1);
  }
}

main();
````

## File: apps/edge-simulator/src/mqtt-publisher.ts
````typescript
import mqtt, { MqttClient, IClientOptions } from "mqtt";
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";

const logger = createLogger("simulator-mqtt");

export class MqttPublisher {
  private client: MqttClient | null = null;
  private isConnected = false;

  async connect(): Promise<void> {
    const env = getEnv();
    const options: IClientOptions = {
      host: env.MQTT_HOST ?? "localhost",
      port: env.MQTT_PORT ?? 1883,
      username: env.MQTT_USERNAME,
      password: env.MQTT_PASSWORD,
      clientId: `simulator-${process.pid}`,
    };

    return new Promise((resolve, reject) => {
      logger.info({ host: options.host }, "Connecting to MQTT broker...");
      this.client = mqtt.connect(options);

      this.client.on("connect", () => {
        logger.info("Connected to MQTT broker");
        this.isConnected = true;
        resolve();
      });

      this.client.on("error", (err) => {
        logger.error({ err }, "MQTT connection error");
        if (!this.isConnected) reject(err);
      });

      this.client.on("close", () => {
        this.isConnected = false;
        logger.warn("MQTT connection closed");
      });
    });
  }

  publish(topic: string, payload: object): void {
    if (!this.client || !this.isConnected) return;

    const message = JSON.stringify(payload);
    this.client.publish(topic, message, { qos: 0 }, (err) => {
      if (err) logger.error({ err, topic }, "Failed to publish message");
    });
  }

  async disconnect(): Promise<void> {
    if (this.client) {
      await new Promise<void>((resolve) =>
        this.client!.end(false, {}, () => resolve()),
      );
      this.isConnected = false;
    }
  }
}
````

## File: apps/edge-simulator/src/presets.ts
````typescript
import { Parameter } from "@moondesk/domain";

export const EnergyProfiles = {
  GridVoltage: {
    waveform: "sine",
    min: 228,
    max: 232,
    frequency: 50, // 50 Hz mains
    noise: 0.1,
    parameter: Parameter.Voltage,
  },
  MotorCurrent: {
    waveform: "random", // Fluctuating load
    min: 5,
    max: 15,
    frequency: 1, // variation speed check
    noise: 0.5,
    parameter: Parameter.Current,
  },
  ActivePower: {
    waveform: "square", // Different operating modes
    min: 2000,
    max: 3500,
    frequency: 0.05, // changes every 20 seconds
    noise: 50,
    parameter: Parameter.Power,
  },
  EnergyConsumption: {
    waveform: "linear",
    min: 1000, // Starting kWh Reading
    max: 0.5, // 0.5 kWh per second? value increase rate.
    frequency: 0,
    noise: 0,
    parameter: Parameter.Energy,
  },
};

export const ProcessProfiles = {
  TankLevel: {
    waveform: "triangle", // Filling and emptying
    min: 10,
    max: 90,
    frequency: 0.005, // Slow cycle
    noise: 0.2,
    parameter: Parameter.Level,
  },
  PipePressure: {
    waveform: "constant",
    min: 4.8,
    max: 5.2,
    frequency: 0,
    offset: 5.0, // Target pressure
    noise: 0.1,
    parameter: Parameter.Pressure,
  },
  WaterTemperature: {
    waveform: "sine", // Daily cycle
    min: 15,
    max: 25,
    frequency: 0.00001157, // One cycle per day (rough)
    noise: 0.05,
    parameter: Parameter.Temperature,
  },
  PipeFlow: {
    waveform: "sine",
    min: 50,
    max: 150,
    frequency: 0.1,
    noise: 2,
    parameter: Parameter.Flow,
  },
};
````

## File: apps/edge-simulator/src/simulation-engine.ts
````typescript
import { createLogger } from "@moondesk/logger";
import { MqttPublisher } from "./mqtt-publisher";
import { generateValue } from "./generators";
import { SimulatedSensorConfig, SimulationScenario } from "./types";
import { ReadingQuality } from "@moondesk/domain";

const logger = createLogger("simulation-engine");

export class SimulationEngine {
  private sensors: Map<number, NodeJS.Timeout> = new Map();
  private configs: Map<number, SimulatedSensorConfig> = new Map();
  private publisher: MqttPublisher;

  constructor(publisher: MqttPublisher) {
    this.publisher = publisher;
  }

  startScenario(scenario: SimulationScenario) {
    logger.info({ scenario: scenario.name }, "Starting scenario");
    this.stopAll();

    for (const sensorConfig of scenario.sensors) {
      this.addSensor(sensorConfig);
    }
  }

  addSensor(config: SimulatedSensorConfig) {
    if (this.configs.has(config.id)) {
      this.removeSensor(config.id);
    }
    this.configs.set(config.id, config);

    if (config.enabled) {
      this.startSensor(config.id);
    }
  }

  private startSensor(id: number) {
    const config = this.configs.get(id);
    if (!config) return;

    logger.info(
      { sensorId: id, type: config.type },
      "Starting sensor simulation",
    );

    // Initial reading
    this.emitReading(config);

    const interval = setInterval(() => {
      this.emitReading(config);
    }, config.intervalMs);

    this.sensors.set(id, interval);
  }

  private emitReading(config: SimulatedSensorConfig) {
    const value = generateValue(config.profile, Date.now());
    const topic = `moondesk/${config.organizationId}/sensors/${config.id}/readings`;

    const payload = {
      sensorId: config.id,
      value: value,
      timestamp: new Date().toISOString(),
      parameter: config.profile.parameter,
      quality: ReadingQuality.Good,
      metadata: {
        generator: "edge-simulator",
        waveform: config.profile.waveform,
      },
    };

    this.publisher.publish(topic, payload);
  }

  removeSensor(id: number) {
    const interval = this.sensors.get(id);
    if (interval) {
      clearInterval(interval);
      this.sensors.delete(id);
    }
    this.configs.delete(id);
  }

  stopAll() {
    for (const interval of this.sensors.values()) {
      clearInterval(interval);
    }
    this.sensors.clear();
    this.configs.clear();
    logger.info("Stopped all simulations");
  }
}
````

## File: apps/edge-simulator/src/types.ts
````typescript
import { Parameter, SensorType } from "@moondesk/domain";

export type WaveForm =
  | "sine"
  | "cosine"
  | "triangle"
  | "sawtooth"
  | "square"
  | "random"
  | "constant"
  | "linear";

export interface SimulationProfile {
  waveform: WaveForm;
  min: number;
  max: number;
  /** Frequency in Hz (cycles per second) */
  frequency: number;
  /** Noise amplitude (random variation added to value) */
  noise: number;
  /** Offset to shift the wave up/down */
  offset?: number;
  /** Parameter this profile simulates */
  parameter: Parameter;
}

export interface SimulatedSensorConfig {
  id: number;
  organizationId: string;
  type: SensorType;
  profile: SimulationProfile;
  /** Interval in milliseconds between readings */
  intervalMs: number;
  enabled: boolean;
}

export interface SimulationScenario {
  id: string;
  name: string;
  description?: string;
  sensors: SimulatedSensorConfig[];
}
````

## File: apps/edge-simulator/package.json
````json
{
    "name": "@moondesk/edge-simulator",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "scripts": {
        "dev": "tsx watch src/main.ts",
        "build": "tsup",
        "start": "node dist/main.js",
        "check-types": "tsc --noEmit",
        "lint": "eslint src/",
        "test": "vitest run"
    },
    "dependencies": {
        "@moondesk/config": "workspace:*",
        "@moondesk/domain": "workspace:*",
        "@moondesk/logger": "workspace:*",
        "mqtt": "^5.14.1",
        "zod": "^3.24.2"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:^",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "tsup": "^8.5.1",
        "tsx": "^4.19.4",
        "typescript": "5.9.2",
        "vitest": "^4.0.15"
    }
}
````

## File: apps/edge-simulator/tsup.config.ts
````typescript
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/main.ts"],
  format: ["esm"],
  clean: true,
  outDir: "dist",
  noExternal: [/^@moondesk\/.*/],
  sourcemap: true,
  banner: {
    js: "import { createRequire } from 'module';const require = createRequire(import.meta.url);",
  },
});
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/layout-controls.tsx
````typescript
"use client";

import { Settings } from "lucide-react";

import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Popover, PopoverContent, PopoverTrigger } from "@/components/ui/popover";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { ToggleGroup, ToggleGroupItem } from "@/components/ui/toggle-group";
import { updateContentLayout, updateNavbarStyle } from "@/lib/layout-utils";
import { updateThemeMode, updateThemePreset } from "@/lib/theme-utils";
import { setValueToCookie } from "@/server/server-actions";
import { usePreferencesStore } from "@/stores/preferences/preferences-provider";
import type { SidebarVariant, SidebarCollapsible, ContentLayout, NavbarStyle } from "@/types/preferences/layout";
import { THEME_PRESET_OPTIONS, type ThemePreset, type ThemeMode } from "@/types/preferences/theme";

type LayoutControlsProps = {
  readonly variant: SidebarVariant;
  readonly collapsible: SidebarCollapsible;
  readonly contentLayout: ContentLayout;
  readonly navbarStyle: NavbarStyle;
};

export function LayoutControls(props: LayoutControlsProps) {
  const { variant, collapsible, contentLayout, navbarStyle } = props;

  const themeMode = usePreferencesStore((s) => s.themeMode);
  const setThemeMode = usePreferencesStore((s) => s.setThemeMode);
  const themePreset = usePreferencesStore((s) => s.themePreset);
  const setThemePreset = usePreferencesStore((s) => s.setThemePreset);

  const handleValueChange = async (key: string, value: any) => {
    if (key === "theme_mode") {
      updateThemeMode(value);
      setThemeMode(value as ThemeMode);
    }

    if (key === "theme_preset") {
      updateThemePreset(value);
      setThemePreset(value as ThemePreset);
    }

    if (key === "content_layout") {
      updateContentLayout(value);
    }

    if (key === "navbar_style") {
      updateNavbarStyle(value);
    }
    await setValueToCookie(key, value);
  };

  return (
    <Popover>
      <PopoverTrigger asChild>
        <Button size="icon">
          <Settings />
        </Button>
      </PopoverTrigger>
      <PopoverContent align="end">
        <div className="flex flex-col gap-5">
          <div className="space-y-1.5">
            <h4 className="text-sm font-medium leading-none">Layout Settings</h4>
            <p className="text-muted-foreground text-xs">Customize your dashboard layout preferences.</p>
          </div>
          <div className="space-y-3">
            <div className="space-y-1">
              <Label className="text-xs font-medium">Preset</Label>
              <Select value={themePreset} onValueChange={(value) => handleValueChange("theme_preset", value)}>
                <SelectTrigger size="sm" className="w-full text-xs">
                  <SelectValue placeholder="Preset" />
                </SelectTrigger>
                <SelectContent>
                  {THEME_PRESET_OPTIONS.map((preset) => (
                    <SelectItem key={preset.value} className="text-xs" value={preset.value}>
                      <span
                        className="size-2.5 rounded-full"
                        style={{
                          backgroundColor: themeMode === "dark" ? preset.primary.dark : preset.primary.light,
                        }}
                      />
                      {preset.label}
                    </SelectItem>
                  ))}
                </SelectContent>
              </Select>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Mode</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={themeMode}
                onValueChange={(value) => handleValueChange("theme_mode", value)}
              >
                <ToggleGroupItem value="light" aria-label="Toggle inset">
                  Light
                </ToggleGroupItem>
                <ToggleGroupItem value="dark" aria-label="Toggle sidebar">
                  Dark
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Sidebar Variant</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={variant}
                onValueChange={(value) => handleValueChange("sidebar_variant", value)}
              >
                <ToggleGroupItem value="inset" aria-label="Toggle inset">
                  Inset
                </ToggleGroupItem>
                <ToggleGroupItem value="sidebar" aria-label="Toggle sidebar">
                  Sidebar
                </ToggleGroupItem>
                <ToggleGroupItem value="floating" aria-label="Toggle floating">
                  Floating
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Navbar Style</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={navbarStyle}
                onValueChange={(value) => handleValueChange("navbar_style", value)}
              >
                <ToggleGroupItem value="sticky" aria-label="Toggle sticky">
                  Sticky
                </ToggleGroupItem>
                <ToggleGroupItem value="scroll" aria-label="Toggle scroll">
                  Scroll
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Sidebar Collapsible</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={collapsible}
                onValueChange={(value) => handleValueChange("sidebar_collapsible", value)}
              >
                <ToggleGroupItem value="icon" aria-label="Toggle icon">
                  Icon
                </ToggleGroupItem>
                <ToggleGroupItem value="offcanvas" aria-label="Toggle offcanvas">
                  OffCanvas
                </ToggleGroupItem>
              </ToggleGroup>
            </div>

            <div className="space-y-1">
              <Label className="text-xs font-medium">Content Layout</Label>
              <ToggleGroup
                className="**:data-[slot=toggle-group-item]:flex-1 **:data-[slot=toggle-group-item]:text-xs w-full"
                size="sm"
                variant="outline"
                type="single"
                value={contentLayout}
                onValueChange={(value) => handleValueChange("content_layout", value)}
              >
                <ToggleGroupItem value="centered" aria-label="Toggle centered">
                  Centered
                </ToggleGroupItem>
                <ToggleGroupItem value="full-width" aria-label="Toggle full-width">
                  Full Width
                </ToggleGroupItem>
              </ToggleGroup>
            </div>
          </div>
        </div>
      </PopoverContent>
    </Popover>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/_components/sidebar/search-dialog.tsx
````typescript
"use client";
import * as React from "react";

import { LayoutDashboard, ChartBar, Gauge, ShoppingBag, GraduationCap, Forklift, Search } from "lucide-react";

import { Button } from "@/components/ui/button";
import {
  CommandDialog,
  CommandEmpty,
  CommandGroup,
  CommandInput,
  CommandItem,
  CommandList,
  CommandSeparator,
} from "@/components/ui/command";

const searchItems = [
  { group: "Dashboards", icon: LayoutDashboard, label: "Default" },
  { group: "Dashboards", icon: ChartBar, label: "CRM", disabled: true },
  { group: "Dashboards", icon: Gauge, label: "Analytics", disabled: true },
  { group: "Dashboards", icon: ShoppingBag, label: "E-Commerce", disabled: true },
  { group: "Dashboards", icon: GraduationCap, label: "Academy", disabled: true },
  { group: "Dashboards", icon: Forklift, label: "Logistics", disabled: true },
  { group: "Authentication", label: "Login v1" },
  { group: "Authentication", label: "Login v2" },
  { group: "Authentication", label: "Register v1" },
  { group: "Authentication", label: "Register v2" },
];

export function SearchDialog() {
  const [open, setOpen] = React.useState(false);
  React.useEffect(() => {
    const down = (e: KeyboardEvent) => {
      if (e.key === "j" && (e.metaKey || e.ctrlKey)) {
        e.preventDefault();
        setOpen((open) => !open);
      }
    };
    document.addEventListener("keydown", down);
    return () => document.removeEventListener("keydown", down);
  }, []);

  return (
    <>
      <Button
        variant="link"
        className="text-muted-foreground !px-0 font-normal hover:no-underline"
        onClick={() => setOpen(true)}
      >
        <Search className="size-4" />
        Search
        <kbd className="bg-muted inline-flex h-5 select-none items-center gap-1 rounded border px-1.5 text-[10px] font-medium">
          <span className="text-xs">⌘</span>J
        </kbd>
      </Button>
      <CommandDialog open={open} onOpenChange={setOpen}>
        <CommandInput placeholder="Search dashboards, users, and more…" />
        <CommandList>
          <CommandEmpty>No results found.</CommandEmpty>
          {[...new Set(searchItems.map((item) => item.group))].map((group, i) => (
            <React.Fragment key={group}>
              {i !== 0 && <CommandSeparator />}
              <CommandGroup heading={group} key={group}>
                {searchItems
                  .filter((item) => item.group === group)
                  .map((item) => (
                    <CommandItem className="!py-1.5" key={item.label} onSelect={() => setOpen(false)}>
                      {item.icon && <item.icon />}
                      <span>{item.label}</span>
                    </CommandItem>
                  ))}
              </CommandGroup>
            </React.Fragment>
          ))}
        </CommandList>
      </CommandDialog>
    </>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/data-usage.tsx
````typescript
"use client";

import { Label, PolarGrid, PolarRadiusAxis, RadialBar, RadialBarChart } from "recharts";

import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer } from "@/components/ui/chart";

const chartData = [{ usage: 68, fill: "hsl(var(--chart-2))" }];

export function DataUsage() {
  return (
    <Card className="flex flex-col">
      <CardHeader className="pb-0">
        <CardTitle>Data Usage</CardTitle>
        <CardDescription>Storage consumption</CardDescription>
      </CardHeader>
      <CardContent className="flex-1 pb-0">
        <ChartContainer
          config={{ usage: { label: "Usage", color: "hsl(var(--chart-2))" } }}
          className="mx-auto aspect-square max-h-[250px]"
        >
          <RadialBarChart data={chartData} startAngle={0} endAngle={250} innerRadius={80} outerRadius={110}>
            <PolarGrid
              gridType="circle"
              radialLines={false}
              stroke="none"
              className="first:fill-muted last:fill-background"
              polarRadius={[86, 74]}
            />
            <RadialBar dataKey="usage" background cornerRadius={10} />
            <PolarRadiusAxis tick={false} tickLine={false} axisLine={false}>
              <Label
                content={({ viewBox }) => {
                  if (viewBox && "cx" in viewBox && "cy" in viewBox) {
                    return (
                      <text x={viewBox.cx} y={viewBox.cy} textAnchor="middle" dominantBaseline="middle">
                        <tspan x={viewBox.cx} y={viewBox.cy} className="fill-foreground text-4xl font-bold">
                          {chartData[0].usage}%
                        </tspan>
                        <tspan x={viewBox.cx} y={(viewBox.cy ?? 0) + 24} className="fill-muted-foreground">
                          Used
                        </tspan>
                      </text>
                    );
                  }
                }}
              />
            </PolarRadiusAxis>
          </RadialBarChart>
        </ChartContainer>
      </CardContent>
      <CardFooter className="flex-col gap-2 text-sm">
        <div className="flex items-center gap-2 font-medium leading-none">6.8 TB of 10 TB used</div>
        <div className="text-muted-foreground leading-none">3.2 TB remaining</div>
      </CardFooter>
    </Card>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/analytics/_components/energy-consumption.tsx
````typescript
"use client";

import { TrendingUp } from "lucide-react";
import { Bar, BarChart, CartesianGrid, XAxis } from "recharts";

import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";

const chartData = [
  { month: "Jan", consumption: 186 },
  { month: "Feb", consumption: 205 },
  { month: "Mar", consumption: 237 },
  { month: "Apr", consumption: 173 },
  { month: "May", consumption: 209 },
  { month: "Jun", consumption: 214 },
];

export function EnergyConsumption() {
  return (
    <Card>
      <CardHeader>
        <CardTitle>Energy Consumption</CardTitle>
        <CardDescription>Monthly usage in kWh</CardDescription>
      </CardHeader>
      <CardContent>
        <ChartContainer config={{ consumption: { label: "Consumption", color: "hsl(var(--chart-3))" } }}>
          <BarChart accessibilityLayer data={chartData}>
            <CartesianGrid vertical={false} />
            <XAxis dataKey="month" tickLine={false} tickMargin={10} axisLine={false} />
            <ChartTooltip cursor={false} content={<ChartTooltipContent hideLabel />} />
            <Bar dataKey="consumption" fill="var(--color-consumption)" radius={8} />
          </BarChart>
        </ChartContainer>
      </CardContent>
      <CardFooter className="flex-col items-start gap-2 text-sm">
        <div className="flex gap-2 font-medium leading-none">
          Trending up by 5.2% this month <TrendingUp className="size-4" />
        </div>
        <div className="text-muted-foreground leading-none">Showing last 6 months</div>
      </CardFooter>
    </Card>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/analytics/page.tsx
````typescript
import { DataUsage } from "./_components/data-usage";
import { EnergyConsumption } from "./_components/energy-consumption";
import { PerformanceMetrics } from "./_components/performance-metrics";
import { SystemHealth } from "./_components/system-health";

export default function Page() {
  return (
    <div className="grid grid-cols-1 gap-4 lg:grid-cols-3">
      <div className="flex flex-col gap-4 lg:col-span-1">
        <SystemHealth />
      </div>

      <div className="flex flex-col gap-4 lg:col-span-2">
        <div className="flex-1">
          <PerformanceMetrics />
        </div>
        <div className="*:data-[slot=card]:shadow-xs grid flex-1 grid-cols-1 gap-4 md:grid-cols-2">
          <DataUsage />
          <EnergyConsumption />
        </div>
      </div>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/assets/_components/asset-insight-cards.tsx
````typescript
"use client";

import { Pie, PieChart, Label, Cell } from "recharts";

import { Button } from "@/components/ui/button";
import { Card, CardContent, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartConfig } from "@/components/ui/chart";
import { PieChartData } from "@/lib/adapters/dashboard-adapter";

const chartConfig = {
  count: {
    label: "Assets",
  },
  // Dynamic colors will be applied from data
} satisfies ChartConfig;

export function AssetInsightCards({ data }: { data: PieChartData[] }) {
  const totalAssets = data.reduce((acc, curr) => acc + curr.value, 0);

  return (
    <div className="*:data-[slot=card]:shadow-xs grid grid-cols-1 gap-4 sm:grid-cols-2 xl:grid-cols-3">
      <Card className="col-span-1 xl:col-span-1">
        <CardHeader>
          <CardTitle>Asset Distribution</CardTitle>
        </CardHeader>
        <CardContent className="max-h-64">
          <ChartContainer config={chartConfig} className="size-full">
            <PieChart className="m-0" margin={{ top: 0, right: 0, left: 0, bottom: 0 }}>
              <ChartTooltip cursor={false} content={<ChartTooltipContent hideLabel />} />
              <Pie
                data={data}
                dataKey="value"
                nameKey="name"
                innerRadius={65}
                outerRadius={90}
                paddingAngle={2}
                cornerRadius={4}
              >
                {data.map((entry, index) => (
                  <Cell key={`cell-${index}`} fill={entry.fill} />
                ))}
                <Label
                  content={({ viewBox }) => {
                    if (viewBox && "cx" in viewBox && "cy" in viewBox) {
                      return (
                        <text x={viewBox.cx} y={viewBox.cy} textAnchor="middle" dominantBaseline="middle">
                          <tspan
                            x={viewBox.cx}
                            y={viewBox.cy}
                            className="fill-foreground text-3xl font-bold tabular-nums"
                          >
                            {totalAssets.toLocaleString()}
                          </tspan>
                          <tspan x={viewBox.cx} y={(viewBox.cy ?? 0) + 24} className="fill-muted-foreground">
                            Assets
                          </tspan>
                        </text>
                      );
                    }
                  }}
                />
              </Pie>
              <ChartLegend
                layout="vertical"
                verticalAlign="middle"
                align="right"
                content={() => (
                  <ul className="ml-4 flex flex-col gap-2">
                    {data.map((item) => (
                      <li key={item.name} className="flex items-center justify-between gap-2">
                        <span className="flex items-center gap-2 text-sm">
                          <span className="size-2.5 rounded-full" style={{ background: item.fill }} />
                          {item.name}
                        </span>
                        <span className="font-mono text-sm font-bold">{item.value}</span>
                      </li>
                    ))}
                  </ul>
                )}
              />
            </PieChart>
          </ChartContainer>
        </CardContent>
        <CardFooter className="gap-2">
          <Button size="sm" variant="outline" className="w-full">
            Download Report
          </Button>
        </CardFooter>
      </Card>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/chart-area-interactive.tsx
````typescript
"use client";

import * as React from "react";

import { Area, AreaChart, CartesianGrid, XAxis } from "recharts";

import { Card, CardAction, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { ChartConfig, ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { ToggleGroup, ToggleGroupItem } from "@/components/ui/toggle-group";
import { useIsMobile } from "@/hooks/use-mobile";
import { TimeSeriesPoint } from "@/lib/adapters/dashboard-adapter";

export const description = "An interactive area chart";

const chartConfig = {
  readings: {
    label: "Readings",
  },
  desktop: {
    label: "Average Value",
    color: "var(--chart-1)",
  },
  mobile: {
    label: "Min/Max",
    color: "var(--chart-2)",
  },
} satisfies ChartConfig;

export function ChartAreaInteractive({ data = [] }: { data?: TimeSeriesPoint[] }) {
  const isMobile = useIsMobile();
  const [timeRange, setTimeRange] = React.useState("90d");

  React.useEffect(() => {
    if (isMobile) {
      setTimeRange("7d");
    }
  }, [isMobile]);

  const filteredData = data.filter((item) => {
    const date = new Date(item.date);
    const referenceDate = new Date(); // Use current date as reference
    let daysToSubtract = 90;
    if (timeRange === "30d") {
      daysToSubtract = 30;
    } else if (timeRange === "7d") {
      daysToSubtract = 7;
    }
    const startDate = new Date(referenceDate);
    startDate.setDate(startDate.getDate() - daysToSubtract);
    return date >= startDate;
  });

  return (
    <Card className="@container/card">
      <CardHeader>
        <CardTitle>Sensor Readings</CardTitle>
        <CardDescription>
          <span className="@[540px]/card:block hidden">Average readings over time</span>
          <span className="@[540px]/card:hidden">Readings trend</span>
        </CardDescription>
        <CardAction>
          <ToggleGroup
            type="single"
            value={timeRange}
            onValueChange={setTimeRange}
            variant="outline"
            className="@[767px]/card:flex hidden *:data-[slot=toggle-group-item]:!px-4"
          >
            <ToggleGroupItem value="90d">Last 3 months</ToggleGroupItem>
            <ToggleGroupItem value="30d">Last 30 days</ToggleGroupItem>
            <ToggleGroupItem value="7d">Last 7 days</ToggleGroupItem>
          </ToggleGroup>
          <Select value={timeRange} onValueChange={setTimeRange}>
            <SelectTrigger
              className="**:data-[slot=select-value]:block **:data-[slot=select-value]:truncate @[767px]/card:hidden flex w-40"
              size="sm"
              aria-label="Select a value"
            >
              <SelectValue placeholder="Last 3 months" />
            </SelectTrigger>
            <SelectContent className="rounded-xl">
              <SelectItem value="90d" className="rounded-lg">
                Last 3 months
              </SelectItem>
              <SelectItem value="30d" className="rounded-lg">
                Last 30 days
              </SelectItem>
              <SelectItem value="7d" className="rounded-lg">
                Last 7 days
              </SelectItem>
            </SelectContent>
          </Select>
        </CardAction>
      </CardHeader>
      <CardContent className="px-2 pt-4 sm:px-6 sm:pt-6">
        <ChartContainer config={chartConfig} className="aspect-auto h-[250px] w-full">
          <AreaChart data={filteredData}>
            <defs>
              <linearGradient id="fillDesktop" x1="0" y1="0" x2="0" y2="1">
                <stop offset="5%" stopColor="var(--color-desktop)" stopOpacity={1.0} />
                <stop offset="95%" stopColor="var(--color-desktop)" stopOpacity={0.1} />
              </linearGradient>
              <linearGradient id="fillMobile" x1="0" y1="0" x2="0" y2="1">
                <stop offset="5%" stopColor="var(--color-mobile)" stopOpacity={0.8} />
                <stop offset="95%" stopColor="var(--color-mobile)" stopOpacity={0.1} />
              </linearGradient>
            </defs>
            <CartesianGrid vertical={false} />
            <XAxis
              dataKey="date"
              tickLine={false}
              axisLine={false}
              tickMargin={8}
              minTickGap={32}
              tickFormatter={(value) => {
                const date = new Date(value);
                return date.toLocaleDateString("en-US", {
                  month: "short",
                  day: "numeric",
                });
              }}
            />
            <ChartTooltip
              cursor={false}
              defaultIndex={isMobile ? -1 : 10}
              content={
                <ChartTooltipContent
                  labelFormatter={(value) => {
                    return new Date(value).toLocaleDateString("en-US", {
                      month: "short",
                      day: "numeric",
                    });
                  }}
                  indicator="dot"
                />
              }
            />
            <Area dataKey="mobile" type="natural" fill="url(#fillMobile)" stroke="var(--color-mobile)" stackId="a" />
            <Area dataKey="desktop" type="natural" fill="url(#fillDesktop)" stroke="var(--color-desktop)" stackId="a" />
          </AreaChart>
        </ChartContainer>
      </CardContent>
    </Card>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/data-table.tsx
````typescript
"use client";

import * as React from "react";

import { Plus } from "lucide-react";
import { z } from "zod";

import { DataTable as DataTableNew } from "@/components/data-table/data-table";
import { DataTablePagination } from "@/components/data-table/data-table-pagination";
import { DataTableViewOptions } from "@/components/data-table/data-table-view-options";
import { withDndColumn } from "@/components/data-table/table-utils";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { useDataTableInstance } from "@/hooks/use-data-table-instance";

import { assetColumns } from "./columns";
import { assetSchema } from "./schema";

export function DataTable({ data: initialData }: { data: z.infer<typeof assetSchema>[] }) {
  const [data, setData] = React.useState(() => initialData);
  const columns = withDndColumn(assetColumns);
  const table = useDataTableInstance({ data, columns, getRowId: (row) => row.id });

  return (
    <Tabs defaultValue="all" className="w-full flex-col justify-start gap-6">
      <div className="flex items-center justify-between">
        <Label htmlFor="view-selector" className="sr-only">
          View
        </Label>
        <Select defaultValue="all">
          <SelectTrigger className="@4xl/main:hidden flex w-fit" size="sm" id="view-selector">
            <SelectValue placeholder="Select a view" />
          </SelectTrigger>
          <SelectContent>
            <SelectItem value="all">All Assets</SelectItem>
            <SelectItem value="online">Online</SelectItem>
            <SelectItem value="offline">Offline</SelectItem>
            <SelectItem value="maintenance">Maintenance</SelectItem>
          </SelectContent>
        </Select>
        <TabsList className="**:data-[slot=badge]:bg-muted-foreground/30 **:data-[slot=badge]:size-5 **:data-[slot=badge]:rounded-full **:data-[slot=badge]:px-1 @4xl/main:flex hidden">
          <TabsTrigger value="all">All Assets</TabsTrigger>
          <TabsTrigger value="online">
            Online <Badge variant="secondary">{data.filter((a) => a.status === "Online").length}</Badge>
          </TabsTrigger>
          <TabsTrigger value="offline">
            Offline <Badge variant="secondary">{data.filter((a) => a.status === "Offline").length}</Badge>
          </TabsTrigger>
          <TabsTrigger value="maintenance">Maintenance</TabsTrigger>
        </TabsList>
        <div className="flex items-center gap-2">
          <DataTableViewOptions table={table} />
          <Button variant="outline" size="sm">
            <Plus />
            <span className="hidden lg:inline">Add Asset</span>
          </Button>
        </div>
      </div>
      <TabsContent value="all" className="relative flex flex-col gap-4 overflow-auto">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
        <DataTablePagination table={table} />
      </TabsContent>
      <TabsContent value="online" className="flex flex-col">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
      </TabsContent>
      <TabsContent value="offline" className="flex flex-col">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
      </TabsContent>
      <TabsContent value="maintenance" className="flex flex-col">
        <div className="overflow-hidden rounded-lg border">
          <DataTableNew dndEnabled table={table} columns={columns} onReorder={setData} />
        </div>
      </TabsContent>
    </Tabs>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/section-cards.tsx
````typescript
import { TrendingUp, TrendingDown, Activity, AlertCircle, Users } from "lucide-react";

import { Badge } from "@/components/ui/badge";
import { Card, CardAction, CardDescription, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { MetricTrend } from "@/lib/adapters/dashboard-adapter";

export function SectionCards({ stats }: { stats: MetricTrend[] }) {
  return (
    <div className="*:data-[slot=card]:from-primary/5 *:data-[slot=card]:to-card dark:*:data-[slot=card]:bg-card *:data-[slot=card]:shadow-xs @xl/main:grid-cols-2 @5xl/main:grid-cols-4 grid grid-cols-1 gap-4 *:data-[slot=card]:bg-gradient-to-t">
      {stats.map((stat, index) => {
        const TrendIcon = stat.status === "up" ? TrendingUp : stat.status === "down" ? TrendingDown : Activity;

        return (
          <Card key={index} className="@container/card">
            <CardHeader>
              <CardDescription>{stat.title}</CardDescription>
              <CardTitle className="@[250px]/card:text-3xl text-2xl font-semibold tabular-nums">{stat.value}</CardTitle>
              <CardAction>
                {!stat.noTrendData && typeof stat.trend === "number" && (
                  <Badge variant="outline">
                    <TrendIcon />
                    {stat.trend > 0 ? "+" : ""}
                    {stat.trend}%
                  </Badge>
                )}
              </CardAction>
            </CardHeader>
            <CardFooter className="flex-col items-start gap-1.5 text-sm">
              <div className="line-clamp-1 flex gap-2 font-medium">
                {stat.label}{" "}
                {!stat.noTrendData && typeof stat.trend === "number" && stat.trend !== 0 && (
                  <TrendIcon className="size-4" />
                )}
              </div>
              <div className="text-muted-foreground">{stat.description}</div>
            </CardFooter>
          </Card>
        );
      })}
    </div>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/overview/_components/table-cell-viewer.tsx
````typescript
import { TrendingUp } from "lucide-react";
import { Area, AreaChart, CartesianGrid, XAxis } from "recharts";
import { z } from "zod";

import { Button } from "@/components/ui/button";
import { ChartConfig, ChartContainer, ChartTooltip, ChartTooltipContent } from "@/components/ui/chart";
import {
  Drawer,
  DrawerClose,
  DrawerContent,
  DrawerDescription,
  DrawerFooter,
  DrawerHeader,
  DrawerTitle,
  DrawerTrigger,
} from "@/components/ui/drawer";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";
import { Separator } from "@/components/ui/separator";
import { useIsMobile } from "@/hooks/use-mobile";

import { sectionSchema } from "./schema";

const chartData = [
  { month: "January", desktop: 186, mobile: 80 },
  { month: "February", desktop: 305, mobile: 200 },
  { month: "March", desktop: 237, mobile: 120 },
  { month: "April", desktop: 73, mobile: 190 },
  { month: "May", desktop: 209, mobile: 130 },
  { month: "June", desktop: 214, mobile: 140 },
];

const chartConfig = {
  desktop: {
    label: "Desktop",
    color: "var(--primary)",
  },
  mobile: {
    label: "Mobile",
    color: "var(--primary)",
  },
} satisfies ChartConfig;

export function TableCellViewer({ item }: { item: z.infer<typeof sectionSchema> }) {
  const isMobile = useIsMobile();

  return (
    <Drawer direction={isMobile ? "bottom" : "right"}>
      <DrawerTrigger asChild>
        <Button variant="link" className="text-foreground w-fit px-0 text-left">
          {item.header}
        </Button>
      </DrawerTrigger>
      <DrawerContent>
        <DrawerHeader className="gap-1">
          <DrawerTitle>{item.header}</DrawerTitle>
          <DrawerDescription>Showing total visitors for the last 6 months</DrawerDescription>
        </DrawerHeader>
        <div className="flex flex-col gap-4 overflow-y-auto px-4 text-sm">
          {!isMobile && (
            <>
              <ChartContainer config={chartConfig}>
                <AreaChart
                  accessibilityLayer
                  data={chartData}
                  margin={{
                    left: 0,
                    right: 10,
                  }}
                >
                  <CartesianGrid vertical={false} />
                  <XAxis
                    dataKey="month"
                    tickLine={false}
                    axisLine={false}
                    tickMargin={8}
                    tickFormatter={(value) => value.slice(0, 3)}
                    hide
                  />
                  <ChartTooltip cursor={false} content={<ChartTooltipContent indicator="dot" />} />
                  <Area
                    dataKey="mobile"
                    type="natural"
                    fill="var(--color-mobile)"
                    fillOpacity={0.6}
                    stroke="var(--color-mobile)"
                    stackId="a"
                  />
                  <Area
                    dataKey="desktop"
                    type="natural"
                    fill="var(--color-desktop)"
                    fillOpacity={0.4}
                    stroke="var(--color-desktop)"
                    stackId="a"
                  />
                </AreaChart>
              </ChartContainer>
              <Separator />
              <div className="grid gap-2">
                <div className="flex gap-2 font-medium leading-none">
                  Trending up by 5.2% this month <TrendingUp className="size-4" />
                </div>
                <div className="text-muted-foreground">
                  Showing total visitors for the last 6 months. This is just some random text to test the layout. It
                  spans multiple lines and should wrap around.
                </div>
              </div>
              <Separator />
            </>
          )}
          <form className="flex flex-col gap-4">
            <div className="flex flex-col gap-3">
              <Label htmlFor="header">Header</Label>
              <Input id="header" defaultValue={item.header} />
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div className="flex flex-col gap-3">
                <Label htmlFor="type">Type</Label>
                <Select defaultValue={item.type}>
                  <SelectTrigger id="type" className="w-full">
                    <SelectValue placeholder="Select a type" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="Table of Contents">Table of Contents</SelectItem>
                    <SelectItem value="Executive Summary">Executive Summary</SelectItem>
                    <SelectItem value="Technical Approach">Technical Approach</SelectItem>
                    <SelectItem value="Design">Design</SelectItem>
                    <SelectItem value="Capabilities">Capabilities</SelectItem>
                    <SelectItem value="Focus Documents">Focus Documents</SelectItem>
                    <SelectItem value="Narrative">Narrative</SelectItem>
                    <SelectItem value="Cover Page">Cover Page</SelectItem>
                  </SelectContent>
                </Select>
              </div>
              <div className="flex flex-col gap-3">
                <Label htmlFor="status">Status</Label>
                <Select defaultValue={item.status}>
                  <SelectTrigger id="status" className="w-full">
                    <SelectValue placeholder="Select a status" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="Done">Done</SelectItem>
                    <SelectItem value="In Progress">In Progress</SelectItem>
                    <SelectItem value="Not Started">Not Started</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            </div>
            <div className="grid grid-cols-2 gap-4">
              <div className="flex flex-col gap-3">
                <Label htmlFor="target">Target</Label>
                <Input id="target" defaultValue={item.target} />
              </div>
              <div className="flex flex-col gap-3">
                <Label htmlFor="limit">Limit</Label>
                <Input id="limit" defaultValue={item.limit} />
              </div>
            </div>
            <div className="flex flex-col gap-3">
              <Label htmlFor="reviewer">Reviewer</Label>
              <Select defaultValue={item.reviewer}>
                <SelectTrigger id="reviewer" className="w-full">
                  <SelectValue placeholder="Select a reviewer" />
                </SelectTrigger>
                <SelectContent>
                  <SelectItem value="Eddie Lake">Eddie Lake</SelectItem>
                  <SelectItem value="Jamik Tashpulatov">Jamik Tashpulatov</SelectItem>
                  <SelectItem value="Emily Whalen">Emily Whalen</SelectItem>
                </SelectContent>
              </Select>
            </div>
          </form>
        </div>
        <DrawerFooter>
          <Button>Submit</Button>
          <DrawerClose asChild>
            <Button variant="outline">Done</Button>
          </DrawerClose>
        </DrawerFooter>
      </DrawerContent>
    </Drawer>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/dashboard/layout.tsx
````typescript
import { ReactNode } from "react";

import { cookies } from "next/headers";

import { AppSidebar } from "@/app/(main)/dashboard/_components/sidebar/app-sidebar";
import { Separator } from "@/components/ui/separator";
import { SidebarInset, SidebarProvider, SidebarTrigger } from "@/components/ui/sidebar";
import { cn } from "@/lib/utils";
import { getPreference } from "@/server/server-actions";
import {
  SIDEBAR_VARIANT_VALUES,
  SIDEBAR_COLLAPSIBLE_VALUES,
  CONTENT_LAYOUT_VALUES,
  NAVBAR_STYLE_VALUES,
  type SidebarVariant,
  type SidebarCollapsible,
  type ContentLayout,
  type NavbarStyle,
} from "@/types/preferences/layout";

import { ClerkAuth, ClerkOrgSwitcher } from "./_components/sidebar/clerk-auth";
import { LayoutControls } from "./_components/sidebar/layout-controls";
import { SearchDialog } from "./_components/sidebar/search-dialog";
import { ThemeSwitcher } from "./_components/sidebar/theme-switcher";

export default async function Layout({ children }: Readonly<{ children: ReactNode }>) {
  const cookieStore = await cookies();
  const defaultOpen = cookieStore.get("sidebar_state")?.value === "true";

  const [sidebarVariant, sidebarCollapsible, contentLayout, navbarStyle] = await Promise.all([
    getPreference<SidebarVariant>("sidebar_variant", SIDEBAR_VARIANT_VALUES, "inset"),
    getPreference<SidebarCollapsible>("sidebar_collapsible", SIDEBAR_COLLAPSIBLE_VALUES, "icon"),
    getPreference<ContentLayout>("content_layout", CONTENT_LAYOUT_VALUES, "centered"),
    getPreference<NavbarStyle>("navbar_style", NAVBAR_STYLE_VALUES, "scroll"),
  ]);

  const layoutPreferences = {
    contentLayout,
    variant: sidebarVariant,
    collapsible: sidebarCollapsible,
    navbarStyle,
  };

  return (
    <SidebarProvider defaultOpen={defaultOpen}>
      <AppSidebar variant={sidebarVariant} collapsible={sidebarCollapsible} />
      <SidebarInset
        data-content-layout={contentLayout}
        className={cn(
          "data-[content-layout=centered]:!mx-auto data-[content-layout=centered]:max-w-screen-2xl",
          // Adds right margin for inset sidebar in centered layout up to 113rem.
          // On wider screens with collapsed sidebar, removes margin and sets margin auto for alignment.
          "max-[113rem]:peer-data-[variant=inset]:!mr-2 min-[101rem]:peer-data-[variant=inset]:peer-data-[state=collapsed]:!mr-auto",
        )}
      >
        <header
          data-navbar-style={navbarStyle}
          className={cn(
            "group-has-data-[collapsible=icon]/sidebar-wrapper:h-12 flex h-12 shrink-0 items-center gap-2 border-b transition-[width,height] ease-linear",
            // Handle sticky navbar style with conditional classes so blur, background, z-index, and rounded corners remain consistent across all SidebarVariant layouts.
            "data-[navbar-style=sticky]:bg-background/50 data-[navbar-style=sticky]:sticky data-[navbar-style=sticky]:top-0 data-[navbar-style=sticky]:z-50 data-[navbar-style=sticky]:overflow-hidden data-[navbar-style=sticky]:rounded-t-[inherit] data-[navbar-style=sticky]:backdrop-blur-md",
          )}
        >
          <div className="flex w-full items-center justify-between px-4 lg:px-6">
            <div className="flex items-center gap-1 lg:gap-2">
              <SidebarTrigger className="-ml-1" />
              <Separator orientation="vertical" className="mx-2 data-[orientation=vertical]:h-4" />
              <SearchDialog />
            </div>
            <div className="flex items-center gap-2">
              <ClerkOrgSwitcher />
              <LayoutControls {...layoutPreferences} />
              <ThemeSwitcher />
              <ClerkAuth />
            </div>
          </div>
        </header>
        <div className="h-full p-4 md:p-6">{children}</div>
      </SidebarInset>
    </SidebarProvider>
  );
}
````

## File: apps/moondesk-dash/src/app/(main)/unauthorized/page.tsx
````typescript
import Link from "next/link";

import { Lock } from "lucide-react";

export default function page() {
  return (
    <div className="bg-background flex min-h-dvh flex-col items-center justify-center px-4 py-12 sm:px-6 lg:px-8">
      <div className="mx-auto max-w-md text-center">
        <Lock className="text-primary mx-auto size-12" />
        <h1 className="mt-4 text-3xl font-bold tracking-tight sm:text-4xl">Unauthorized Access</h1>
        <p className="text-muted-foreground mt-4">
          You do not have permission to view the requested content. Please contact the site administrator if you believe
          this is an error.
        </p>
        <div className="mt-6">
          <Link
            href="dashboard"
            className="bg-primary text-primary-foreground hover:bg-primary/90 focus:ring-primary shadow-xs focus:outline-hidden inline-flex items-center rounded-md px-4 py-2 text-sm font-medium transition-colors focus:ring-2 focus:ring-offset-2"
            prefetch={false}
          >
            Go to Homepage
          </Link>
        </div>
      </div>
    </div>
  );
}
````

## File: apps/moondesk-dash/src/components/ui/accordion.tsx
````typescript
"use client";

import * as React from "react";
import { Accordion as AccordionPrimitive } from "radix-ui";
import { ChevronDownIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Accordion({ ...props }: React.ComponentProps<typeof AccordionPrimitive.Root>) {
  return <AccordionPrimitive.Root data-slot="accordion" {...props} />;
}

function AccordionItem({ className, ...props }: React.ComponentProps<typeof AccordionPrimitive.Item>) {
  return (
    <AccordionPrimitive.Item
      data-slot="accordion-item"
      className={cn("border-b last:border-b-0", className)}
      {...props}
    />
  );
}

function AccordionTrigger({ className, children, ...props }: React.ComponentProps<typeof AccordionPrimitive.Trigger>) {
  return (
    <AccordionPrimitive.Header className="flex">
      <AccordionPrimitive.Trigger
        data-slot="accordion-trigger"
        className={cn(
          "focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium outline-none transition-all hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",
          className,
        )}
        {...props}
      >
        {children}
        <ChevronDownIcon className="text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200" />
      </AccordionPrimitive.Trigger>
    </AccordionPrimitive.Header>
  );
}

function AccordionContent({ className, children, ...props }: React.ComponentProps<typeof AccordionPrimitive.Content>) {
  return (
    <AccordionPrimitive.Content
      data-slot="accordion-content"
      className="data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm"
      {...props}
    >
      <div className={cn("pb-4 pt-0", className)}>{children}</div>
    </AccordionPrimitive.Content>
  );
}

export { Accordion, AccordionItem, AccordionTrigger, AccordionContent };
````

## File: apps/moondesk-dash/src/components/ui/alert-dialog.tsx
````typescript
"use client";

import * as React from "react";
import { AlertDialog as AlertDialogPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";
import { buttonVariants } from "@/components/ui/button";

function AlertDialog({ ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Root>) {
  return <AlertDialogPrimitive.Root data-slot="alert-dialog" {...props} />;
}

function AlertDialogTrigger({ ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Trigger>) {
  return <AlertDialogPrimitive.Trigger data-slot="alert-dialog-trigger" {...props} />;
}

function AlertDialogPortal({ ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Portal>) {
  return <AlertDialogPrimitive.Portal data-slot="alert-dialog-portal" {...props} />;
}

function AlertDialogOverlay({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Overlay>) {
  return (
    <AlertDialogPrimitive.Overlay
      data-slot="alert-dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function AlertDialogContent({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Content>) {
  return (
    <AlertDialogPortal>
      <AlertDialogOverlay />
      <AlertDialogPrimitive.Content
        data-slot="alert-dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed left-[50%] top-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      />
    </AlertDialogPortal>
  );
}

function AlertDialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function AlertDialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function AlertDialogTitle({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Title>) {
  return (
    <AlertDialogPrimitive.Title
      data-slot="alert-dialog-title"
      className={cn("text-lg font-semibold", className)}
      {...props}
    />
  );
}

function AlertDialogDescription({
  className,
  ...props
}: React.ComponentProps<typeof AlertDialogPrimitive.Description>) {
  return (
    <AlertDialogPrimitive.Description
      data-slot="alert-dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function AlertDialogAction({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Action>) {
  return <AlertDialogPrimitive.Action className={cn(buttonVariants(), className)} {...props} />;
}

function AlertDialogCancel({ className, ...props }: React.ComponentProps<typeof AlertDialogPrimitive.Cancel>) {
  return <AlertDialogPrimitive.Cancel className={cn(buttonVariants({ variant: "outline" }), className)} {...props} />;
}

export {
  AlertDialog,
  AlertDialogPortal,
  AlertDialogOverlay,
  AlertDialogTrigger,
  AlertDialogContent,
  AlertDialogHeader,
  AlertDialogFooter,
  AlertDialogTitle,
  AlertDialogDescription,
  AlertDialogAction,
  AlertDialogCancel,
};
````

## File: apps/moondesk-dash/src/components/ui/alert.tsx
````typescript
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const alertVariants = cva(
  "relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",
  {
    variants: {
      variant: {
        default: "bg-card text-card-foreground",
        destructive:
          "text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Alert({ className, variant, ...props }: React.ComponentProps<"div"> & VariantProps<typeof alertVariants>) {
  return <div data-slot="alert" role="alert" className={cn(alertVariants({ variant }), className)} {...props} />;
}

function AlertTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-title"
      className={cn("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight", className)}
      {...props}
    />
  );
}

function AlertDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="alert-description"
      className={cn(
        "text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",
        className,
      )}
      {...props}
    />
  );
}

export { Alert, AlertTitle, AlertDescription };
````

## File: apps/moondesk-dash/src/components/ui/aspect-ratio.tsx
````typescript
"use client";

import { AspectRatio as AspectRatioPrimitive } from "radix-ui";

function AspectRatio({ ...props }: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {
  return <AspectRatioPrimitive.Root data-slot="aspect-ratio" {...props} />;
}

export { AspectRatio };
````

## File: apps/moondesk-dash/src/components/ui/avatar.tsx
````typescript
"use client";

import * as React from "react";
import { Avatar as AvatarPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Avatar({ className, ...props }: React.ComponentProps<typeof AvatarPrimitive.Root>) {
  return (
    <AvatarPrimitive.Root
      data-slot="avatar"
      className={cn("relative flex size-8 shrink-0 overflow-hidden rounded-full", className)}
      {...props}
    />
  );
}

function AvatarImage({ className, ...props }: React.ComponentProps<typeof AvatarPrimitive.Image>) {
  return (
    <AvatarPrimitive.Image data-slot="avatar-image" className={cn("aspect-square size-full", className)} {...props} />
  );
}

function AvatarFallback({ className, ...props }: React.ComponentProps<typeof AvatarPrimitive.Fallback>) {
  return (
    <AvatarPrimitive.Fallback
      data-slot="avatar-fallback"
      className={cn("bg-muted flex size-full items-center justify-center rounded-full", className)}
      {...props}
    />
  );
}

export { Avatar, AvatarImage, AvatarFallback };
````

## File: apps/moondesk-dash/src/components/ui/badge.tsx
````typescript
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",
  {
    variants: {
      variant: {
        default: "border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",
        secondary: "border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",
        destructive:
          "border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline: "text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function Badge({
  className,
  variant,
  asChild = false,
  ...props
}: React.ComponentProps<"span"> & VariantProps<typeof badgeVariants> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "span";

  return <Comp data-slot="badge" className={cn(badgeVariants({ variant }), className)} {...props} />;
}

export { Badge, badgeVariants };
````

## File: apps/moondesk-dash/src/components/ui/breadcrumb.tsx
````typescript
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { ChevronRight, MoreHorizontal } from "lucide-react";

import { cn } from "@/lib/utils";

function Breadcrumb({ ...props }: React.ComponentProps<"nav">) {
  return <nav aria-label="breadcrumb" data-slot="breadcrumb" {...props} />;
}

function BreadcrumbList({ className, ...props }: React.ComponentProps<"ol">) {
  return (
    <ol
      data-slot="breadcrumb-list"
      className={cn(
        "text-muted-foreground flex flex-wrap items-center gap-1.5 break-words text-sm sm:gap-2.5",
        className,
      )}
      {...props}
    />
  );
}

function BreadcrumbItem({ className, ...props }: React.ComponentProps<"li">) {
  return <li data-slot="breadcrumb-item" className={cn("inline-flex items-center gap-1.5", className)} {...props} />;
}

function BreadcrumbLink({
  asChild,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "a";

  return (
    <Comp data-slot="breadcrumb-link" className={cn("hover:text-foreground transition-colors", className)} {...props} />
  );
}

function BreadcrumbPage({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-page"
      role="link"
      aria-disabled="true"
      aria-current="page"
      className={cn("text-foreground font-normal", className)}
      {...props}
    />
  );
}

function BreadcrumbSeparator({ children, className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="breadcrumb-separator"
      role="presentation"
      aria-hidden="true"
      className={cn("[&>svg]:size-3.5", className)}
      {...props}
    >
      {children ?? <ChevronRight />}
    </li>
  );
}

function BreadcrumbEllipsis({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="breadcrumb-ellipsis"
      role="presentation"
      aria-hidden="true"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontal className="size-4" />
      <span className="sr-only">More</span>
    </span>
  );
}

export {
  Breadcrumb,
  BreadcrumbList,
  BreadcrumbItem,
  BreadcrumbLink,
  BreadcrumbPage,
  BreadcrumbSeparator,
  BreadcrumbEllipsis,
};
````

## File: apps/moondesk-dash/src/components/ui/button-group.tsx
````typescript
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Separator } from "@/components/ui/separator";

const buttonGroupVariants = cva(
  "flex w-fit items-stretch [&>*]:focus-visible:z-10 [&>*]:focus-visible:relative [&>[data-slot=select-trigger]:not([class*='w-'])]:w-fit [&>input]:flex-1 has-[select[aria-hidden=true]:last-child]:[&>[data-slot=select-trigger]:last-of-type]:rounded-r-md has-[>[data-slot=button-group]]:gap-2",
  {
    variants: {
      orientation: {
        horizontal:
          "[&>*:not(:first-child)]:rounded-l-none [&>*:not(:first-child)]:border-l-0 [&>*:not(:last-child)]:rounded-r-none",
        vertical:
          "flex-col [&>*:not(:first-child)]:rounded-t-none [&>*:not(:first-child)]:border-t-0 [&>*:not(:last-child)]:rounded-b-none",
      },
    },
    defaultVariants: {
      orientation: "horizontal",
    },
  },
);

function ButtonGroup({
  className,
  orientation,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof buttonGroupVariants>) {
  return (
    <div
      role="group"
      data-slot="button-group"
      data-orientation={orientation}
      className={cn(buttonGroupVariants({ orientation }), className)}
      {...props}
    />
  );
}

function ButtonGroupText({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & {
  asChild?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "div";

  return (
    <Comp
      className={cn(
        "bg-muted shadow-xs flex items-center gap-2 rounded-md border px-4 text-sm font-medium [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none",
        className,
      )}
      {...props}
    />
  );
}

function ButtonGroupSeparator({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="button-group-separator"
      orientation={orientation}
      className={cn("bg-input relative !m-0 self-stretch data-[orientation=vertical]:h-auto", className)}
      {...props}
    />
  );
}

export { ButtonGroup, ButtonGroupSeparator, ButtonGroupText, buttonGroupVariants };
````

## File: apps/moondesk-dash/src/components/ui/button.tsx
````typescript
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground hover:bg-primary/90",
        destructive:
          "bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
        outline:
          "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
        secondary: "bg-secondary text-secondary-foreground hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
        "icon-sm": "size-8",
        "icon-lg": "size-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean;
  }) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";

  return <Comp data-slot="button" className={cn(buttonVariants({ variant, size, className }))} {...props} />;
}

export { Button, buttonVariants };
````

## File: apps/moondesk-dash/src/components/ui/calendar.tsx
````typescript
"use client";

import * as React from "react";
import { ChevronDownIcon, ChevronLeftIcon, ChevronRightIcon } from "lucide-react";
import { DayButton, DayPicker, getDefaultClassNames } from "react-day-picker";

import { cn } from "@/lib/utils";
import { Button, buttonVariants } from "@/components/ui/button";

function Calendar({
  className,
  classNames,
  showOutsideDays = true,
  captionLayout = "label",
  buttonVariant = "ghost",
  formatters,
  components,
  ...props
}: React.ComponentProps<typeof DayPicker> & {
  buttonVariant?: React.ComponentProps<typeof Button>["variant"];
}) {
  const defaultClassNames = getDefaultClassNames();

  return (
    <DayPicker
      showOutsideDays={showOutsideDays}
      className={cn(
        "bg-background group/calendar p-3 [--cell-size:--spacing(8)] [[data-slot=card-content]_&]:bg-transparent [[data-slot=popover-content]_&]:bg-transparent",
        String.raw`rtl:**:[.rdp-button\_next>svg]:rotate-180`,
        String.raw`rtl:**:[.rdp-button\_previous>svg]:rotate-180`,
        className,
      )}
      captionLayout={captionLayout}
      formatters={{
        formatMonthDropdown: (date) => date.toLocaleString("default", { month: "short" }),
        ...formatters,
      }}
      classNames={{
        root: cn("w-fit", defaultClassNames.root),
        months: cn("flex gap-4 flex-col md:flex-row relative", defaultClassNames.months),
        month: cn("flex flex-col w-full gap-4", defaultClassNames.month),
        nav: cn("flex items-center gap-1 w-full absolute top-0 inset-x-0 justify-between", defaultClassNames.nav),
        button_previous: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_previous,
        ),
        button_next: cn(
          buttonVariants({ variant: buttonVariant }),
          "size-(--cell-size) aria-disabled:opacity-50 p-0 select-none",
          defaultClassNames.button_next,
        ),
        month_caption: cn(
          "flex items-center justify-center h-(--cell-size) w-full px-(--cell-size)",
          defaultClassNames.month_caption,
        ),
        dropdowns: cn(
          "w-full flex items-center text-sm font-medium justify-center h-(--cell-size) gap-1.5",
          defaultClassNames.dropdowns,
        ),
        dropdown_root: cn(
          "relative has-focus:border-ring border border-input shadow-xs has-focus:ring-ring/50 has-focus:ring-[3px] rounded-md",
          defaultClassNames.dropdown_root,
        ),
        dropdown: cn("absolute bg-popover inset-0 opacity-0", defaultClassNames.dropdown),
        caption_label: cn(
          "select-none font-medium",
          captionLayout === "label"
            ? "text-sm"
            : "rounded-md pl-2 pr-1 flex items-center gap-1 text-sm h-8 [&>svg]:text-muted-foreground [&>svg]:size-3.5",
          defaultClassNames.caption_label,
        ),
        table: "w-full border-collapse",
        weekdays: cn("flex", defaultClassNames.weekdays),
        weekday: cn(
          "text-muted-foreground rounded-md flex-1 font-normal text-[0.8rem] select-none",
          defaultClassNames.weekday,
        ),
        week: cn("flex w-full mt-2", defaultClassNames.week),
        week_number_header: cn("select-none w-(--cell-size)", defaultClassNames.week_number_header),
        week_number: cn("text-[0.8rem] select-none text-muted-foreground", defaultClassNames.week_number),
        day: cn(
          "relative w-full h-full p-0 text-center [&:last-child[data-selected=true]_button]:rounded-r-md group/day aspect-square select-none",
          props.showWeekNumber
            ? "[&:nth-child(2)[data-selected=true]_button]:rounded-l-md"
            : "[&:first-child[data-selected=true]_button]:rounded-l-md",
          defaultClassNames.day,
        ),
        range_start: cn("rounded-l-md bg-accent", defaultClassNames.range_start),
        range_middle: cn("rounded-none", defaultClassNames.range_middle),
        range_end: cn("rounded-r-md bg-accent", defaultClassNames.range_end),
        today: cn(
          "bg-accent text-accent-foreground rounded-md data-[selected=true]:rounded-none",
          defaultClassNames.today,
        ),
        outside: cn("text-muted-foreground aria-selected:text-muted-foreground", defaultClassNames.outside),
        disabled: cn("text-muted-foreground opacity-50", defaultClassNames.disabled),
        hidden: cn("invisible", defaultClassNames.hidden),
        ...classNames,
      }}
      components={{
        Root: ({ className, rootRef, ...props }) => {
          return <div data-slot="calendar" ref={rootRef} className={cn(className)} {...props} />;
        },
        Chevron: ({ className, orientation, ...props }) => {
          if (orientation === "left") {
            return <ChevronLeftIcon className={cn("size-4", className)} {...props} />;
          }

          if (orientation === "right") {
            return <ChevronRightIcon className={cn("size-4", className)} {...props} />;
          }

          return <ChevronDownIcon className={cn("size-4", className)} {...props} />;
        },
        DayButton: CalendarDayButton,
        WeekNumber: ({ children, ...props }) => {
          return (
            <td {...props}>
              <div className="size-(--cell-size) flex items-center justify-center text-center">{children}</div>
            </td>
          );
        },
        ...components,
      }}
      {...props}
    />
  );
}

function CalendarDayButton({ className, day, modifiers, ...props }: React.ComponentProps<typeof DayButton>) {
  const defaultClassNames = getDefaultClassNames();

  const ref = React.useRef<HTMLButtonElement>(null);
  React.useEffect(() => {
    if (modifiers.focused) ref.current?.focus();
  }, [modifiers.focused]);

  return (
    <Button
      ref={ref}
      variant="ghost"
      size="icon"
      data-day={day.date.toLocaleDateString()}
      data-selected-single={
        modifiers.selected && !modifiers.range_start && !modifiers.range_end && !modifiers.range_middle
      }
      data-range-start={modifiers.range_start}
      data-range-end={modifiers.range_end}
      data-range-middle={modifiers.range_middle}
      className={cn(
        "data-[selected-single=true]:bg-primary data-[selected-single=true]:text-primary-foreground data-[range-middle=true]:bg-accent data-[range-middle=true]:text-accent-foreground data-[range-start=true]:bg-primary data-[range-start=true]:text-primary-foreground data-[range-end=true]:bg-primary data-[range-end=true]:text-primary-foreground group-data-[focused=true]/day:border-ring group-data-[focused=true]/day:ring-ring/50 dark:hover:text-accent-foreground min-w-(--cell-size) flex aspect-square size-auto w-full flex-col gap-1 font-normal leading-none data-[range-end=true]:rounded-md data-[range-middle=true]:rounded-none data-[range-start=true]:rounded-md data-[range-end=true]:rounded-r-md data-[range-start=true]:rounded-l-md group-data-[focused=true]/day:relative group-data-[focused=true]/day:z-10 group-data-[focused=true]/day:ring-[3px] [&>span]:text-xs [&>span]:opacity-70",
        defaultClassNames.day,
        className,
      )}
      {...props}
    />
  );
}

export { Calendar, CalendarDayButton };
````

## File: apps/moondesk-dash/src/components/ui/card.tsx
````typescript
import * as React from "react";

import { cn } from "@/lib/utils";

function Card({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card"
      className={cn("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm", className)}
      {...props}
    />
  );
}

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6 grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6",
        className,
      )}
      {...props}
    />
  );
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="card-title" className={cn("font-semibold leading-none", className)} {...props} />;
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="card-description" className={cn("text-muted-foreground text-sm", className)} {...props} />;
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn("col-start-2 row-span-2 row-start-1 self-start justify-self-end", className)}
      {...props}
    />
  );
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="card-content" className={cn("px-6", className)} {...props} />;
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="card-footer" className={cn("[.border-t]:pt-6 flex items-center px-6", className)} {...props} />
  );
}

export { Card, CardHeader, CardFooter, CardTitle, CardAction, CardDescription, CardContent };
````

## File: apps/moondesk-dash/src/components/ui/carousel.tsx
````typescript
"use client";

import * as React from "react";
import useEmblaCarousel, { type UseEmblaCarouselType } from "embla-carousel-react";
import { ArrowLeft, ArrowRight } from "lucide-react";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";

type CarouselApi = UseEmblaCarouselType[1];
type UseCarouselParameters = Parameters<typeof useEmblaCarousel>;
type CarouselOptions = UseCarouselParameters[0];
type CarouselPlugin = UseCarouselParameters[1];

type CarouselProps = {
  opts?: CarouselOptions;
  plugins?: CarouselPlugin;
  orientation?: "horizontal" | "vertical";
  setApi?: (api: CarouselApi) => void;
};

type CarouselContextProps = {
  carouselRef: ReturnType<typeof useEmblaCarousel>[0];
  api: ReturnType<typeof useEmblaCarousel>[1];
  scrollPrev: () => void;
  scrollNext: () => void;
  canScrollPrev: boolean;
  canScrollNext: boolean;
} & CarouselProps;

const CarouselContext = React.createContext<CarouselContextProps | null>(null);

function useCarousel() {
  const context = React.useContext(CarouselContext);

  if (!context) {
    throw new Error("useCarousel must be used within a <Carousel />");
  }

  return context;
}

function Carousel({
  orientation = "horizontal",
  opts,
  setApi,
  plugins,
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & CarouselProps) {
  const [carouselRef, api] = useEmblaCarousel(
    {
      ...opts,
      axis: orientation === "horizontal" ? "x" : "y",
    },
    plugins,
  );
  const [canScrollPrev, setCanScrollPrev] = React.useState(false);
  const [canScrollNext, setCanScrollNext] = React.useState(false);

  const onSelect = React.useCallback((api: CarouselApi) => {
    if (!api) return;
    setCanScrollPrev(api.canScrollPrev());
    setCanScrollNext(api.canScrollNext());
  }, []);

  const scrollPrev = React.useCallback(() => {
    api?.scrollPrev();
  }, [api]);

  const scrollNext = React.useCallback(() => {
    api?.scrollNext();
  }, [api]);

  const handleKeyDown = React.useCallback(
    (event: React.KeyboardEvent<HTMLDivElement>) => {
      if (event.key === "ArrowLeft") {
        event.preventDefault();
        scrollPrev();
      } else if (event.key === "ArrowRight") {
        event.preventDefault();
        scrollNext();
      }
    },
    [scrollPrev, scrollNext],
  );

  React.useEffect(() => {
    if (!api || !setApi) return;
    setApi(api);
  }, [api, setApi]);

  React.useEffect(() => {
    if (!api) return;
    onSelect(api);
    api.on("reInit", onSelect);
    api.on("select", onSelect);

    return () => {
      api?.off("select", onSelect);
    };
  }, [api, onSelect]);

  return (
    <CarouselContext.Provider
      value={{
        carouselRef,
        api: api,
        opts,
        orientation: orientation || (opts?.axis === "y" ? "vertical" : "horizontal"),
        scrollPrev,
        scrollNext,
        canScrollPrev,
        canScrollNext,
      }}
    >
      <div
        onKeyDownCapture={handleKeyDown}
        className={cn("relative", className)}
        role="region"
        aria-roledescription="carousel"
        data-slot="carousel"
        {...props}
      >
        {children}
      </div>
    </CarouselContext.Provider>
  );
}

function CarouselContent({ className, ...props }: React.ComponentProps<"div">) {
  const { carouselRef, orientation } = useCarousel();

  return (
    <div ref={carouselRef} className="overflow-hidden" data-slot="carousel-content">
      <div className={cn("flex", orientation === "horizontal" ? "-ml-4" : "-mt-4 flex-col", className)} {...props} />
    </div>
  );
}

function CarouselItem({ className, ...props }: React.ComponentProps<"div">) {
  const { orientation } = useCarousel();

  return (
    <div
      role="group"
      aria-roledescription="slide"
      data-slot="carousel-item"
      className={cn("min-w-0 shrink-0 grow-0 basis-full", orientation === "horizontal" ? "pl-4" : "pt-4", className)}
      {...props}
    />
  );
}

function CarouselPrevious({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollPrev, canScrollPrev } = useCarousel();

  return (
    <Button
      data-slot="carousel-previous"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "-left-12 top-1/2 -translate-y-1/2"
          : "-top-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollPrev}
      onClick={scrollPrev}
      {...props}
    >
      <ArrowLeft />
      <span className="sr-only">Previous slide</span>
    </Button>
  );
}

function CarouselNext({
  className,
  variant = "outline",
  size = "icon",
  ...props
}: React.ComponentProps<typeof Button>) {
  const { orientation, scrollNext, canScrollNext } = useCarousel();

  return (
    <Button
      data-slot="carousel-next"
      variant={variant}
      size={size}
      className={cn(
        "absolute size-8 rounded-full",
        orientation === "horizontal"
          ? "-right-12 top-1/2 -translate-y-1/2"
          : "-bottom-12 left-1/2 -translate-x-1/2 rotate-90",
        className,
      )}
      disabled={!canScrollNext}
      onClick={scrollNext}
      {...props}
    >
      <ArrowRight />
      <span className="sr-only">Next slide</span>
    </Button>
  );
}

export { type CarouselApi, Carousel, CarouselContent, CarouselItem, CarouselPrevious, CarouselNext };
````

## File: apps/moondesk-dash/src/components/ui/chart.tsx
````typescript
"use client";

import * as React from "react";
import * as RechartsPrimitive from "recharts";

import { cn } from "@/lib/utils";

// Format: { THEME_NAME: CSS_SELECTOR }
const THEMES = { light: "", dark: ".dark" } as const;

export type ChartConfig = {
  [k in string]: {
    label?: React.ReactNode;
    icon?: React.ComponentType;
  } & ({ color?: string; theme?: never } | { color?: never; theme: Record<keyof typeof THEMES, string> });
};

type ChartContextProps = {
  config: ChartConfig;
};

const ChartContext = React.createContext<ChartContextProps | null>(null);

function useChart() {
  const context = React.useContext(ChartContext);

  if (!context) {
    throw new Error("useChart must be used within a <ChartContainer />");
  }

  return context;
}

function ChartContainer({
  id,
  className,
  children,
  config,
  ...props
}: React.ComponentProps<"div"> & {
  config: ChartConfig;
  children: React.ComponentProps<typeof RechartsPrimitive.ResponsiveContainer>["children"];
}) {
  const uniqueId = React.useId();
  const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;

  return (
    <ChartContext.Provider value={{ config }}>
      <div
        data-slot="chart"
        data-chart={chartId}
        className={cn(
          "[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-surface]:outline-hidden flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-sector[stroke='#fff']]:stroke-transparent",
          className,
        )}
        {...props}
      >
        <ChartStyle id={chartId} config={config} />
        <RechartsPrimitive.ResponsiveContainer>{children}</RechartsPrimitive.ResponsiveContainer>
      </div>
    </ChartContext.Provider>
  );
}

const ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {
  const colorConfig = Object.entries(config).filter(([, config]) => config.theme || config.color);

  if (!colorConfig.length) {
    return null;
  }

  return (
    <style
      dangerouslySetInnerHTML={{
        __html: Object.entries(THEMES)
          .map(
            ([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
  .map(([key, itemConfig]) => {
    const color = itemConfig.theme?.[theme as keyof typeof itemConfig.theme] || itemConfig.color;
    return color ? `  --color-${key}: ${color};` : null;
  })
  .join("\n")}
}
`,
          )
          .join("\n"),
      }}
    />
  );
};

const ChartTooltip = RechartsPrimitive.Tooltip;

function ChartTooltipContent({
  active,
  payload,
  className,
  indicator = "dot",
  hideLabel = false,
  hideIndicator = false,
  label,
  labelFormatter,
  labelClassName,
  formatter,
  color,
  nameKey,
  labelKey,
}: React.ComponentProps<typeof RechartsPrimitive.Tooltip> &
  React.ComponentProps<"div"> & {
    hideLabel?: boolean;
    hideIndicator?: boolean;
    indicator?: "line" | "dot" | "dashed";
    nameKey?: string;
    labelKey?: string;
  }) {
  const { config } = useChart();

  const tooltipLabel = React.useMemo(() => {
    if (hideLabel || !payload?.length) {
      return null;
    }

    const [item] = payload;
    const key = `${labelKey || item?.dataKey || item?.name || "value"}`;
    const itemConfig = getPayloadConfigFromPayload(config, item, key);
    const value =
      !labelKey && typeof label === "string" ? config[label as keyof typeof config]?.label || label : itemConfig?.label;

    if (labelFormatter) {
      return <div className={cn("font-medium", labelClassName)}>{labelFormatter(value, payload)}</div>;
    }

    if (!value) {
      return null;
    }

    return <div className={cn("font-medium", labelClassName)}>{value}</div>;
  }, [label, labelFormatter, payload, hideLabel, labelClassName, config, labelKey]);

  if (!active || !payload?.length) {
    return null;
  }

  const nestLabel = payload.length === 1 && indicator !== "dot";

  return (
    <div
      className={cn(
        "border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl",
        className,
      )}
    >
      {!nestLabel ? tooltipLabel : null}
      <div className="grid gap-1.5">
        {payload
          .filter((item) => item.type !== "none")
          .map((item, index) => {
            const key = `${nameKey || item.name || item.dataKey || "value"}`;
            const itemConfig = getPayloadConfigFromPayload(config, item, key);
            const indicatorColor = color || item.payload.fill || item.color;

            return (
              <div
                key={item.dataKey}
                className={cn(
                  "[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5",
                  indicator === "dot" && "items-center",
                )}
              >
                {formatter && item?.value !== undefined && item.name ? (
                  formatter(item.value, item.name, item, index, item.payload)
                ) : (
                  <>
                    {itemConfig?.icon ? (
                      <itemConfig.icon />
                    ) : (
                      !hideIndicator && (
                        <div
                          className={cn("border-(--color-border) bg-(--color-bg) shrink-0 rounded-[2px]", {
                            "h-2.5 w-2.5": indicator === "dot",
                            "w-1": indicator === "line",
                            "w-0 border-[1.5px] border-dashed bg-transparent": indicator === "dashed",
                            "my-0.5": nestLabel && indicator === "dashed",
                          })}
                          style={
                            {
                              "--color-bg": indicatorColor,
                              "--color-border": indicatorColor,
                            } as React.CSSProperties
                          }
                        />
                      )
                    )}
                    <div
                      className={cn(
                        "flex flex-1 justify-between leading-none",
                        nestLabel ? "items-end" : "items-center",
                      )}
                    >
                      <div className="grid gap-1.5">
                        {nestLabel ? tooltipLabel : null}
                        <span className="text-muted-foreground">{itemConfig?.label || item.name}</span>
                      </div>
                      {item.value && (
                        <span className="text-foreground font-mono font-medium tabular-nums">
                          {item.value.toLocaleString()}
                        </span>
                      )}
                    </div>
                  </>
                )}
              </div>
            );
          })}
      </div>
    </div>
  );
}

const ChartLegend = RechartsPrimitive.Legend;

function ChartLegendContent({
  className,
  hideIcon = false,
  payload,
  verticalAlign = "bottom",
  nameKey,
}: React.ComponentProps<"div"> &
  Pick<RechartsPrimitive.LegendProps, "payload" | "verticalAlign"> & {
    hideIcon?: boolean;
    nameKey?: string;
  }) {
  const { config } = useChart();

  if (!payload?.length) {
    return null;
  }

  return (
    <div className={cn("flex items-center justify-center gap-4", verticalAlign === "top" ? "pb-3" : "pt-3", className)}>
      {payload
        .filter((item) => item.type !== "none")
        .map((item) => {
          const key = `${nameKey || item.dataKey || "value"}`;
          const itemConfig = getPayloadConfigFromPayload(config, item, key);

          return (
            <div
              key={item.value}
              className={cn("[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3")}
            >
              {itemConfig?.icon && !hideIcon ? (
                <itemConfig.icon />
              ) : (
                <div
                  className="h-2 w-2 shrink-0 rounded-[2px]"
                  style={{
                    backgroundColor: item.color,
                  }}
                />
              )}
              {itemConfig?.label}
            </div>
          );
        })}
    </div>
  );
}

// Helper to extract item config from a payload.
function getPayloadConfigFromPayload(config: ChartConfig, payload: unknown, key: string) {
  if (typeof payload !== "object" || payload === null) {
    return undefined;
  }

  const payloadPayload =
    "payload" in payload && typeof payload.payload === "object" && payload.payload !== null
      ? payload.payload
      : undefined;

  let configLabelKey: string = key;

  if (key in payload && typeof payload[key as keyof typeof payload] === "string") {
    configLabelKey = payload[key as keyof typeof payload] as string;
  } else if (
    payloadPayload &&
    key in payloadPayload &&
    typeof payloadPayload[key as keyof typeof payloadPayload] === "string"
  ) {
    configLabelKey = payloadPayload[key as keyof typeof payloadPayload] as string;
  }

  return configLabelKey in config ? config[configLabelKey] : config[key as keyof typeof config];
}

export { ChartContainer, ChartTooltip, ChartTooltipContent, ChartLegend, ChartLegendContent, ChartStyle };
````

## File: apps/moondesk-dash/src/components/ui/checkbox.tsx
````typescript
"use client";

import * as React from "react";
import { Checkbox as CheckboxPrimitive } from "radix-ui";
import { CheckIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Checkbox({ className, ...props }: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
  return (
    <CheckboxPrimitive.Root
      data-slot="checkbox"
      className={cn(
        "border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive shadow-xs peer size-4 shrink-0 rounded-[4px] border outline-none transition-shadow focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <CheckboxPrimitive.Indicator
        data-slot="checkbox-indicator"
        className="grid place-content-center text-current transition-none"
      >
        <CheckIcon className="size-3.5" />
      </CheckboxPrimitive.Indicator>
    </CheckboxPrimitive.Root>
  );
}

export { Checkbox };
````

## File: apps/moondesk-dash/src/components/ui/collapsible.tsx
````typescript
"use client";

import { Collapsible as CollapsiblePrimitive } from "radix-ui";

function Collapsible({ ...props }: React.ComponentProps<typeof CollapsiblePrimitive.Root>) {
  return <CollapsiblePrimitive.Root data-slot="collapsible" {...props} />;
}

function CollapsibleTrigger({ ...props }: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleTrigger>) {
  return <CollapsiblePrimitive.CollapsibleTrigger data-slot="collapsible-trigger" {...props} />;
}

function CollapsibleContent({ ...props }: React.ComponentProps<typeof CollapsiblePrimitive.CollapsibleContent>) {
  return <CollapsiblePrimitive.CollapsibleContent data-slot="collapsible-content" {...props} />;
}

export { Collapsible, CollapsibleTrigger, CollapsibleContent };
````

## File: apps/moondesk-dash/src/components/ui/command.tsx
````typescript
"use client";

import * as React from "react";
import { Command as CommandPrimitive } from "cmdk";
import { SearchIcon } from "lucide-react";

import { cn } from "@/lib/utils";
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle } from "@/components/ui/dialog";

function Command({ className, ...props }: React.ComponentProps<typeof CommandPrimitive>) {
  return (
    <CommandPrimitive
      data-slot="command"
      className={cn(
        "bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",
        className,
      )}
      {...props}
    />
  );
}

function CommandDialog({
  title = "Command Palette",
  description = "Search for a command to run...",
  children,
  className,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof Dialog> & {
  title?: string;
  description?: string;
  className?: string;
  showCloseButton?: boolean;
}) {
  return (
    <Dialog {...props}>
      <DialogHeader className="sr-only">
        <DialogTitle>{title}</DialogTitle>
        <DialogDescription>{description}</DialogDescription>
      </DialogHeader>
      <DialogContent className={cn("overflow-hidden p-0", className)} showCloseButton={showCloseButton}>
        <Command className="[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5">
          {children}
        </Command>
      </DialogContent>
    </Dialog>
  );
}

function CommandInput({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Input>) {
  return (
    <div data-slot="command-input-wrapper" className="flex h-9 items-center gap-2 border-b px-3">
      <SearchIcon className="size-4 shrink-0 opacity-50" />
      <CommandPrimitive.Input
        data-slot="command-input"
        className={cn(
          "placeholder:text-muted-foreground outline-hidden flex h-10 w-full rounded-md bg-transparent py-3 text-sm disabled:cursor-not-allowed disabled:opacity-50",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function CommandList({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.List>) {
  return (
    <CommandPrimitive.List
      data-slot="command-list"
      className={cn("max-h-[300px] scroll-py-1 overflow-y-auto overflow-x-hidden", className)}
      {...props}
    />
  );
}

function CommandEmpty({ ...props }: React.ComponentProps<typeof CommandPrimitive.Empty>) {
  return <CommandPrimitive.Empty data-slot="command-empty" className="py-6 text-center text-sm" {...props} />;
}

function CommandGroup({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Group>) {
  return (
    <CommandPrimitive.Group
      data-slot="command-group"
      className={cn(
        "text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",
        className,
      )}
      {...props}
    />
  );
}

function CommandSeparator({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Separator>) {
  return (
    <CommandPrimitive.Separator
      data-slot="command-separator"
      className={cn("bg-border -mx-1 h-px", className)}
      {...props}
    />
  );
}

function CommandItem({ className, ...props }: React.ComponentProps<typeof CommandPrimitive.Item>) {
  return (
    <CommandPrimitive.Item
      data-slot="command-item"
      className={cn(
        "data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function CommandShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="command-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

export {
  Command,
  CommandDialog,
  CommandInput,
  CommandList,
  CommandEmpty,
  CommandGroup,
  CommandItem,
  CommandShortcut,
  CommandSeparator,
};
````

## File: apps/moondesk-dash/src/components/ui/context-menu.tsx
````typescript
"use client";

import * as React from "react";
import { ContextMenu as ContextMenuPrimitive } from "radix-ui";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function ContextMenu({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Root>) {
  return <ContextMenuPrimitive.Root data-slot="context-menu" {...props} />;
}

function ContextMenuTrigger({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Trigger>) {
  return <ContextMenuPrimitive.Trigger data-slot="context-menu-trigger" {...props} />;
}

function ContextMenuGroup({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Group>) {
  return <ContextMenuPrimitive.Group data-slot="context-menu-group" {...props} />;
}

function ContextMenuPortal({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Portal>) {
  return <ContextMenuPrimitive.Portal data-slot="context-menu-portal" {...props} />;
}

function ContextMenuSub({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Sub>) {
  return <ContextMenuPrimitive.Sub data-slot="context-menu-sub" {...props} />;
}

function ContextMenuRadioGroup({ ...props }: React.ComponentProps<typeof ContextMenuPrimitive.RadioGroup>) {
  return <ContextMenuPrimitive.RadioGroup data-slot="context-menu-radio-group" {...props} />;
}

function ContextMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.SubTrigger
      data-slot="context-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm data-[inset]:pl-8 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto" />
    </ContextMenuPrimitive.SubTrigger>
  );
}

function ContextMenuSubContent({ className, ...props }: React.ComponentProps<typeof ContextMenuPrimitive.SubContent>) {
  return (
    <ContextMenuPrimitive.SubContent
      data-slot="context-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-context-menu-content-transform-origin) z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuContent({ className, ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Content>) {
  return (
    <ContextMenuPrimitive.Portal>
      <ContextMenuPrimitive.Content
        data-slot="context-menu-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-(--radix-context-menu-content-available-height) origin-(--radix-context-menu-content-transform-origin) z-50 min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </ContextMenuPrimitive.Portal>
  );
}

function ContextMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <ContextMenuPrimitive.Item
      data-slot="context-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled]:pointer-events-none data-[inset]:pl-8 data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function ContextMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.CheckboxItem>) {
  return (
    <ContextMenuPrimitive.CheckboxItem
      data-slot="context-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.CheckboxItem>
  );
}

function ContextMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.RadioItem>) {
  return (
    <ContextMenuPrimitive.RadioItem
      data-slot="context-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <ContextMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </ContextMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </ContextMenuPrimitive.RadioItem>
  );
}

function ContextMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof ContextMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <ContextMenuPrimitive.Label
      data-slot="context-menu-label"
      data-inset={inset}
      className={cn("text-foreground px-2 py-1.5 text-sm font-medium data-[inset]:pl-8", className)}
      {...props}
    />
  );
}

function ContextMenuSeparator({ className, ...props }: React.ComponentProps<typeof ContextMenuPrimitive.Separator>) {
  return (
    <ContextMenuPrimitive.Separator
      data-slot="context-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function ContextMenuShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="context-menu-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

export {
  ContextMenu,
  ContextMenuTrigger,
  ContextMenuContent,
  ContextMenuItem,
  ContextMenuCheckboxItem,
  ContextMenuRadioItem,
  ContextMenuLabel,
  ContextMenuSeparator,
  ContextMenuShortcut,
  ContextMenuGroup,
  ContextMenuPortal,
  ContextMenuSub,
  ContextMenuSubContent,
  ContextMenuSubTrigger,
  ContextMenuRadioGroup,
};
````

## File: apps/moondesk-dash/src/components/ui/dialog.tsx
````typescript
"use client";

import * as React from "react";
import { Dialog as DialogPrimitive } from "radix-ui";
import { XIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Dialog({ ...props }: React.ComponentProps<typeof DialogPrimitive.Root>) {
  return <DialogPrimitive.Root data-slot="dialog" {...props} />;
}

function DialogTrigger({ ...props }: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
  return <DialogPrimitive.Trigger data-slot="dialog-trigger" {...props} />;
}

function DialogPortal({ ...props }: React.ComponentProps<typeof DialogPrimitive.Portal>) {
  return <DialogPrimitive.Portal data-slot="dialog-portal" {...props} />;
}

function DialogClose({ ...props }: React.ComponentProps<typeof DialogPrimitive.Close>) {
  return <DialogPrimitive.Close data-slot="dialog-close" {...props} />;
}

function DialogOverlay({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
  return (
    <DialogPrimitive.Overlay
      data-slot="dialog-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DialogContent({
  className,
  children,
  showCloseButton = true,
  ...props
}: React.ComponentProps<typeof DialogPrimitive.Content> & {
  showCloseButton?: boolean;
}) {
  return (
    <DialogPortal data-slot="dialog-portal">
      <DialogOverlay />
      <DialogPrimitive.Content
        data-slot="dialog-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed left-[50%] top-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",
          className,
        )}
        {...props}
      >
        {children}
        {showCloseButton && (
          <DialogPrimitive.Close
            data-slot="dialog-close"
            className="ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground rounded-xs focus:outline-hidden absolute right-4 top-4 opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0"
          >
            <XIcon />
            <span className="sr-only">Close</span>
          </DialogPrimitive.Close>
        )}
      </DialogPrimitive.Content>
    </DialogPortal>
  );
}

function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-header"
      className={cn("flex flex-col gap-2 text-center sm:text-left", className)}
      {...props}
    />
  );
}

function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="dialog-footer"
      className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)}
      {...props}
    />
  );
}

function DialogTitle({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Title>) {
  return (
    <DialogPrimitive.Title
      data-slot="dialog-title"
      className={cn("text-lg font-semibold leading-none", className)}
      {...props}
    />
  );
}

function DialogDescription({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Description>) {
  return (
    <DialogPrimitive.Description
      data-slot="dialog-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Dialog,
  DialogClose,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogOverlay,
  DialogPortal,
  DialogTitle,
  DialogTrigger,
};
````

## File: apps/moondesk-dash/src/components/ui/drawer.tsx
````typescript
"use client";

import * as React from "react";
import { Drawer as DrawerPrimitive } from "vaul";

import { cn } from "@/lib/utils";

function Drawer({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Root>) {
  return <DrawerPrimitive.Root data-slot="drawer" {...props} />;
}

function DrawerTrigger({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {
  return <DrawerPrimitive.Trigger data-slot="drawer-trigger" {...props} />;
}

function DrawerPortal({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Portal>) {
  return <DrawerPrimitive.Portal data-slot="drawer-portal" {...props} />;
}

function DrawerClose({ ...props }: React.ComponentProps<typeof DrawerPrimitive.Close>) {
  return <DrawerPrimitive.Close data-slot="drawer-close" {...props} />;
}

function DrawerOverlay({ className, ...props }: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {
  return (
    <DrawerPrimitive.Overlay
      data-slot="drawer-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function DrawerContent({ className, children, ...props }: React.ComponentProps<typeof DrawerPrimitive.Content>) {
  return (
    <DrawerPortal data-slot="drawer-portal">
      <DrawerOverlay />
      <DrawerPrimitive.Content
        data-slot="drawer-content"
        className={cn(
          "group/drawer-content bg-background fixed z-50 flex h-auto flex-col",
          "data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b",
          "data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t",
          "data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm",
          "data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm",
          className,
        )}
        {...props}
      >
        <div className="bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block" />
        {children}
      </DrawerPrimitive.Content>
    </DrawerPortal>
  );
}

function DrawerHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="drawer-header"
      className={cn(
        "flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left",
        className,
      )}
      {...props}
    />
  );
}

function DrawerFooter({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="drawer-footer" className={cn("mt-auto flex flex-col gap-2 p-4", className)} {...props} />;
}

function DrawerTitle({ className, ...props }: React.ComponentProps<typeof DrawerPrimitive.Title>) {
  return (
    <DrawerPrimitive.Title
      data-slot="drawer-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function DrawerDescription({ className, ...props }: React.ComponentProps<typeof DrawerPrimitive.Description>) {
  return (
    <DrawerPrimitive.Description
      data-slot="drawer-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export {
  Drawer,
  DrawerPortal,
  DrawerOverlay,
  DrawerTrigger,
  DrawerClose,
  DrawerContent,
  DrawerHeader,
  DrawerFooter,
  DrawerTitle,
  DrawerDescription,
};
````

## File: apps/moondesk-dash/src/components/ui/dropdown-menu.tsx
````typescript
"use client";

import * as React from "react";
import { DropdownMenu as DropdownMenuPrimitive } from "radix-ui";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function DropdownMenu({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />;
}

function DropdownMenuPortal({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />;
}

function DropdownMenuTrigger({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return <DropdownMenuPrimitive.Trigger data-slot="dropdown-menu-trigger" {...props} />;
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-(--radix-dropdown-menu-content-available-height) origin-(--radix-dropdown-menu-content-transform-origin) z-50 min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  );
}

function DropdownMenuGroup({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />;
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled]:pointer-events-none data-[inset]:pl-8 data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  );
}

function DropdownMenuRadioGroup({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return <DropdownMenuPrimitive.RadioGroup data-slot="dropdown-menu-radio-group" {...props} />;
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  );
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8", className)}
      {...props}
    />
  );
}

function DropdownMenuSeparator({ className, ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function DropdownMenuShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

function DropdownMenuSub({ ...props }: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />;
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[inset]:pl-8 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  );
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-dropdown-menu-content-transform-origin) z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
};
````

## File: apps/moondesk-dash/src/components/ui/empty.tsx
````typescript
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

function Empty({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty"
      className={cn(
        "flex min-w-0 flex-1 flex-col items-center justify-center gap-6 text-balance rounded-lg border-dashed p-6 text-center md:p-12",
        className,
      )}
      {...props}
    />
  );
}

function EmptyHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty-header"
      className={cn("flex max-w-sm flex-col items-center gap-2 text-center", className)}
      {...props}
    />
  );
}

const emptyMediaVariants = cva(
  "flex shrink-0 items-center justify-center mb-2 [&_svg]:pointer-events-none [&_svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        icon: "bg-muted text-foreground flex size-10 shrink-0 items-center justify-center rounded-lg [&_svg:not([class*='size-'])]:size-6",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function EmptyMedia({
  className,
  variant = "default",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof emptyMediaVariants>) {
  return (
    <div
      data-slot="empty-icon"
      data-variant={variant}
      className={cn(emptyMediaVariants({ variant, className }))}
      {...props}
    />
  );
}

function EmptyTitle({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="empty-title" className={cn("text-lg font-medium tracking-tight", className)} {...props} />;
}

function EmptyDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <div
      data-slot="empty-description"
      className={cn(
        "text-muted-foreground [&>a:hover]:text-primary text-sm/relaxed [&>a]:underline [&>a]:underline-offset-4",
        className,
      )}
      {...props}
    />
  );
}

function EmptyContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="empty-content"
      className={cn("flex w-full min-w-0 max-w-sm flex-col items-center gap-4 text-balance text-sm", className)}
      {...props}
    />
  );
}

export { Empty, EmptyHeader, EmptyTitle, EmptyDescription, EmptyContent, EmptyMedia };
````

## File: apps/moondesk-dash/src/components/ui/field.tsx
````typescript
"use client";

import { useMemo } from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Label } from "@/components/ui/label";
import { Separator } from "@/components/ui/separator";

function FieldSet({ className, ...props }: React.ComponentProps<"fieldset">) {
  return (
    <fieldset
      data-slot="field-set"
      className={cn(
        "flex flex-col gap-6",
        "has-[>[data-slot=checkbox-group]]:gap-3 has-[>[data-slot=radio-group]]:gap-3",
        className,
      )}
      {...props}
    />
  );
}

function FieldLegend({
  className,
  variant = "legend",
  ...props
}: React.ComponentProps<"legend"> & { variant?: "legend" | "label" }) {
  return (
    <legend
      data-slot="field-legend"
      data-variant={variant}
      className={cn("mb-3 font-medium", "data-[variant=legend]:text-base", "data-[variant=label]:text-sm", className)}
      {...props}
    />
  );
}

function FieldGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-group"
      className={cn(
        "group/field-group @container/field-group flex w-full flex-col gap-7 data-[slot=checkbox-group]:gap-3 [&>[data-slot=field-group]]:gap-4",
        className,
      )}
      {...props}
    />
  );
}

const fieldVariants = cva("group/field flex w-full gap-3 data-[invalid=true]:text-destructive", {
  variants: {
    orientation: {
      vertical: ["flex-col [&>*]:w-full [&>.sr-only]:w-auto"],
      horizontal: [
        "flex-row items-center",
        "[&>[data-slot=field-label]]:flex-auto",
        "has-[>[data-slot=field-content]]:items-start has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px",
      ],
      responsive: [
        "flex-col [&>*]:w-full [&>.sr-only]:w-auto @md/field-group:flex-row @md/field-group:items-center @md/field-group:[&>*]:w-auto",
        "@md/field-group:[&>[data-slot=field-label]]:flex-auto",
        "@md/field-group:has-[>[data-slot=field-content]]:items-start @md/field-group:has-[>[data-slot=field-content]]:[&>[role=checkbox],[role=radio]]:mt-px",
      ],
    },
  },
  defaultVariants: {
    orientation: "vertical",
  },
});

function Field({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof fieldVariants>) {
  return (
    <div
      role="group"
      data-slot="field"
      data-orientation={orientation}
      className={cn(fieldVariants({ orientation }), className)}
      {...props}
    />
  );
}

function FieldContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-content"
      className={cn("group/field-content flex flex-1 flex-col gap-1.5 leading-snug", className)}
      {...props}
    />
  );
}

function FieldLabel({ className, ...props }: React.ComponentProps<typeof Label>) {
  return (
    <Label
      data-slot="field-label"
      className={cn(
        "group/field-label peer/field-label flex w-fit gap-2 leading-snug group-data-[disabled=true]/field:opacity-50",
        "has-[>[data-slot=field]]:w-full has-[>[data-slot=field]]:flex-col has-[>[data-slot=field]]:rounded-md has-[>[data-slot=field]]:border [&>*]:data-[slot=field]:p-4",
        "has-data-[state=checked]:bg-primary/5 has-data-[state=checked]:border-primary dark:has-data-[state=checked]:bg-primary/10",
        className,
      )}
      {...props}
    />
  );
}

function FieldTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="field-label"
      className={cn(
        "flex w-fit items-center gap-2 text-sm font-medium leading-snug group-data-[disabled=true]/field:opacity-50",
        className,
      )}
      {...props}
    />
  );
}

function FieldDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <p
      data-slot="field-description"
      className={cn(
        "text-muted-foreground text-sm font-normal leading-normal group-has-[[data-orientation=horizontal]]/field:text-balance",
        "nth-last-2:-mt-1 last:mt-0 [[data-variant=legend]+&]:-mt-1.5",
        "[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",
        className,
      )}
      {...props}
    />
  );
}

function FieldSeparator({
  children,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  children?: React.ReactNode;
}) {
  return (
    <div
      data-slot="field-separator"
      data-content={!!children}
      className={cn("relative -my-2 h-5 text-sm group-data-[variant=outline]/field-group:-mb-2", className)}
      {...props}
    >
      <Separator className="absolute inset-0 top-1/2" />
      {children && (
        <span
          className="bg-background text-muted-foreground relative mx-auto block w-fit px-2"
          data-slot="field-separator-content"
        >
          {children}
        </span>
      )}
    </div>
  );
}

function FieldError({
  className,
  children,
  errors,
  ...props
}: React.ComponentProps<"div"> & {
  errors?: Array<{ message?: string } | undefined>;
}) {
  const content = useMemo(() => {
    if (children) {
      return children;
    }

    if (!errors?.length) {
      return null;
    }

    const uniqueErrors = [...new Map(errors.map((error) => [error?.message, error])).values()];

    if (uniqueErrors?.length == 1) {
      return uniqueErrors[0]?.message;
    }

    return (
      <ul className="ml-4 flex list-disc flex-col gap-1">
        {uniqueErrors.map((error, index) => error?.message && <li key={index}>{error.message}</li>)}
      </ul>
    );
  }, [children, errors]);

  if (!content) {
    return null;
  }

  return (
    <div
      role="alert"
      data-slot="field-error"
      className={cn("text-destructive text-sm font-normal", className)}
      {...props}
    >
      {content}
    </div>
  );
}

export {
  Field,
  FieldLabel,
  FieldDescription,
  FieldError,
  FieldGroup,
  FieldLegend,
  FieldSeparator,
  FieldSet,
  FieldContent,
  FieldTitle,
};
````

## File: apps/moondesk-dash/src/components/ui/form.tsx
````typescript
"use client";

import * as React from "react";
import { Label as LabelPrimitive, Slot as SlotPrimitive } from "radix-ui";

import {
  Controller,
  FormProvider,
  useFormContext,
  useFormState,
  type ControllerProps,
  type FieldPath,
  type FieldValues,
} from "react-hook-form";

import { cn } from "@/lib/utils";
import { Label } from "@/components/ui/label";

const Form = FormProvider;

type FormFieldContextValue<
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
> = {
  name: TName;
};

const FormFieldContext = React.createContext<FormFieldContextValue>({} as FormFieldContextValue);

const FormField = <
  TFieldValues extends FieldValues = FieldValues,
  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>,
>({
  ...props
}: ControllerProps<TFieldValues, TName>) => {
  return (
    <FormFieldContext.Provider value={{ name: props.name }}>
      <Controller {...props} />
    </FormFieldContext.Provider>
  );
};

const useFormField = () => {
  const fieldContext = React.useContext(FormFieldContext);
  const itemContext = React.useContext(FormItemContext);
  const { getFieldState } = useFormContext();
  const formState = useFormState({ name: fieldContext.name });
  const fieldState = getFieldState(fieldContext.name, formState);

  if (!fieldContext) {
    throw new Error("useFormField should be used within <FormField>");
  }

  const { id } = itemContext;

  return {
    id,
    name: fieldContext.name,
    formItemId: `${id}-form-item`,
    formDescriptionId: `${id}-form-item-description`,
    formMessageId: `${id}-form-item-message`,
    ...fieldState,
  };
};

type FormItemContextValue = {
  id: string;
};

const FormItemContext = React.createContext<FormItemContextValue>({} as FormItemContextValue);

function FormItem({ className, ...props }: React.ComponentProps<"div">) {
  const id = React.useId();

  return (
    <FormItemContext.Provider value={{ id }}>
      <div data-slot="form-item" className={cn("grid gap-2", className)} {...props} />
    </FormItemContext.Provider>
  );
}

function FormLabel({ className, ...props }: React.ComponentProps<typeof LabelPrimitive.Root>) {
  const { error, formItemId } = useFormField();

  return (
    <Label
      data-slot="form-label"
      data-error={!!error}
      className={cn("data-[error=true]:text-destructive", className)}
      htmlFor={formItemId}
      {...props}
    />
  );
}

function FormControl({ ...props }: React.ComponentProps<typeof SlotPrimitive.Slot>) {
  const { error, formItemId, formDescriptionId, formMessageId } = useFormField();

  return (
    <SlotPrimitive.Slot
      data-slot="form-control"
      id={formItemId}
      aria-describedby={!error ? `${formDescriptionId}` : `${formDescriptionId} ${formMessageId}`}
      aria-invalid={!!error}
      {...props}
    />
  );
}

function FormDescription({ className, ...props }: React.ComponentProps<"p">) {
  const { formDescriptionId } = useFormField();

  return (
    <p
      data-slot="form-description"
      id={formDescriptionId}
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function FormMessage({ className, ...props }: React.ComponentProps<"p">) {
  const { error, formMessageId } = useFormField();
  const body = error ? String(error?.message ?? "") : props.children;

  if (!body) {
    return null;
  }

  return (
    <p data-slot="form-message" id={formMessageId} className={cn("text-destructive text-sm", className)} {...props}>
      {body}
    </p>
  );
}

export { useFormField, Form, FormItem, FormLabel, FormControl, FormDescription, FormMessage, FormField };
````

## File: apps/moondesk-dash/src/components/ui/hover-card.tsx
````typescript
"use client";

import * as React from "react";
import { HoverCard as HoverCardPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function HoverCard({ ...props }: React.ComponentProps<typeof HoverCardPrimitive.Root>) {
  return <HoverCardPrimitive.Root data-slot="hover-card" {...props} />;
}

function HoverCardTrigger({ ...props }: React.ComponentProps<typeof HoverCardPrimitive.Trigger>) {
  return <HoverCardPrimitive.Trigger data-slot="hover-card-trigger" {...props} />;
}

function HoverCardContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof HoverCardPrimitive.Content>) {
  return (
    <HoverCardPrimitive.Portal data-slot="hover-card-portal">
      <HoverCardPrimitive.Content
        data-slot="hover-card-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-hover-card-content-transform-origin) outline-hidden z-50 w-64 rounded-md border p-4 shadow-md",
          className,
        )}
        {...props}
      />
    </HoverCardPrimitive.Portal>
  );
}

export { HoverCard, HoverCardTrigger, HoverCardContent };
````

## File: apps/moondesk-dash/src/components/ui/input-group.tsx
````typescript
"use client";

import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";

function InputGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="input-group"
      role="group"
      className={cn(
        "group/input-group border-input dark:bg-input/30 shadow-xs relative flex w-full items-center rounded-md border outline-none transition-[color,box-shadow]",
        "h-9 min-w-0 has-[>textarea]:h-auto",

        // Variants based on alignment.
        "has-[>[data-align=inline-start]]:[&>input]:pl-2",
        "has-[>[data-align=inline-end]]:[&>input]:pr-2",
        "has-[>[data-align=block-start]]:h-auto has-[>[data-align=block-start]]:flex-col has-[>[data-align=block-start]]:[&>input]:pb-3",
        "has-[>[data-align=block-end]]:h-auto has-[>[data-align=block-end]]:flex-col has-[>[data-align=block-end]]:[&>input]:pt-3",

        // Focus state.
        "has-[[data-slot=input-group-control]:focus-visible]:border-ring has-[[data-slot=input-group-control]:focus-visible]:ring-ring/50 has-[[data-slot=input-group-control]:focus-visible]:ring-[3px]",

        // Error state.
        "has-[[data-slot][aria-invalid=true]]:ring-destructive/20 has-[[data-slot][aria-invalid=true]]:border-destructive dark:has-[[data-slot][aria-invalid=true]]:ring-destructive/40",

        className,
      )}
      {...props}
    />
  );
}

const inputGroupAddonVariants = cva(
  "text-muted-foreground flex h-auto cursor-text items-center justify-center gap-2 py-1.5 text-sm font-medium select-none [&>svg:not([class*='size-'])]:size-4 [&>kbd]:rounded-[calc(var(--radius)-5px)] group-data-[disabled=true]/input-group:opacity-50",
  {
    variants: {
      align: {
        "inline-start": "order-first pl-3 has-[>button]:ml-[-0.45rem] has-[>kbd]:ml-[-0.35rem]",
        "inline-end": "order-last pr-3 has-[>button]:mr-[-0.45rem] has-[>kbd]:mr-[-0.35rem]",
        "block-start":
          "order-first w-full justify-start px-3 pt-3 [.border-b]:pb-3 group-has-[>input]/input-group:pt-2.5",
        "block-end": "order-last w-full justify-start px-3 pb-3 [.border-t]:pt-3 group-has-[>input]/input-group:pb-2.5",
      },
    },
    defaultVariants: {
      align: "inline-start",
    },
  },
);

function InputGroupAddon({
  className,
  align = "inline-start",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof inputGroupAddonVariants>) {
  return (
    <div
      role="group"
      data-slot="input-group-addon"
      data-align={align}
      className={cn(inputGroupAddonVariants({ align }), className)}
      onClick={(e) => {
        if ((e.target as HTMLElement).closest("button")) {
          return;
        }
        e.currentTarget.parentElement?.querySelector("input")?.focus();
      }}
      {...props}
    />
  );
}

const inputGroupButtonVariants = cva("text-sm shadow-none flex gap-2 items-center", {
  variants: {
    size: {
      xs: "h-6 gap-1 px-2 rounded-[calc(var(--radius)-5px)] [&>svg:not([class*='size-'])]:size-3.5 has-[>svg]:px-2",
      sm: "h-8 px-2.5 gap-1.5 rounded-md has-[>svg]:px-2.5",
      "icon-xs": "size-6 rounded-[calc(var(--radius)-5px)] p-0 has-[>svg]:p-0",
      "icon-sm": "size-8 p-0 has-[>svg]:p-0",
    },
  },
  defaultVariants: {
    size: "xs",
  },
});

function InputGroupButton({
  className,
  type = "button",
  variant = "ghost",
  size = "xs",
  ...props
}: Omit<React.ComponentProps<typeof Button>, "size"> & VariantProps<typeof inputGroupButtonVariants>) {
  return (
    <Button
      type={type}
      data-size={size}
      variant={variant}
      className={cn(inputGroupButtonVariants({ size }), className)}
      {...props}
    />
  );
}

function InputGroupText({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      className={cn(
        "text-muted-foreground flex items-center gap-2 text-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none",
        className,
      )}
      {...props}
    />
  );
}

function InputGroupInput({ className, ...props }: React.ComponentProps<"input">) {
  return (
    <Input
      data-slot="input-group-control"
      className={cn(
        "flex-1 rounded-none border-0 bg-transparent shadow-none focus-visible:ring-0 dark:bg-transparent",
        className,
      )}
      {...props}
    />
  );
}

function InputGroupTextarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <Textarea
      data-slot="input-group-control"
      className={cn(
        "flex-1 resize-none rounded-none border-0 bg-transparent py-3 shadow-none focus-visible:ring-0 dark:bg-transparent",
        className,
      )}
      {...props}
    />
  );
}

export { InputGroup, InputGroupAddon, InputGroupButton, InputGroupText, InputGroupInput, InputGroupTextarea };
````

## File: apps/moondesk-dash/src/components/ui/input-otp.tsx
````typescript
"use client";

import * as React from "react";
import { OTPInput, OTPInputContext } from "input-otp";
import { MinusIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function InputOTP({
  className,
  containerClassName,
  ...props
}: React.ComponentProps<typeof OTPInput> & {
  containerClassName?: string;
}) {
  return (
    <OTPInput
      data-slot="input-otp"
      containerClassName={cn("flex items-center gap-2 has-disabled:opacity-50", containerClassName)}
      className={cn("disabled:cursor-not-allowed", className)}
      {...props}
    />
  );
}

function InputOTPGroup({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="input-otp-group" className={cn("flex items-center", className)} {...props} />;
}

function InputOTPSlot({
  index,
  className,
  ...props
}: React.ComponentProps<"div"> & {
  index: number;
}) {
  const inputOTPContext = React.useContext(OTPInputContext);
  const { char, hasFakeCaret, isActive } = inputOTPContext?.slots[index] ?? {};

  return (
    <div
      data-slot="input-otp-slot"
      data-active={isActive}
      className={cn(
        "data-[active=true]:border-ring data-[active=true]:ring-ring/50 data-[active=true]:aria-invalid:ring-destructive/20 dark:data-[active=true]:aria-invalid:ring-destructive/40 aria-invalid:border-destructive data-[active=true]:aria-invalid:border-destructive dark:bg-input/30 border-input shadow-xs relative flex h-9 w-9 items-center justify-center border-y border-r text-sm outline-none transition-all first:rounded-l-md first:border-l last:rounded-r-md data-[active=true]:z-10 data-[active=true]:ring-[3px]",
        className,
      )}
      {...props}
    >
      {char}
      {hasFakeCaret && (
        <div className="pointer-events-none absolute inset-0 flex items-center justify-center">
          <div className="animate-caret-blink bg-foreground h-4 w-px duration-1000" />
        </div>
      )}
    </div>
  );
}

function InputOTPSeparator({ ...props }: React.ComponentProps<"div">) {
  return (
    <div data-slot="input-otp-separator" role="separator" {...props}>
      <MinusIcon />
    </div>
  );
}

export { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator };
````

## File: apps/moondesk-dash/src/components/ui/input.tsx
````typescript
import * as React from "react";

import { cn } from "@/lib/utils";

function Input({ className, type, ...props }: React.ComponentProps<"input">) {
  return (
    <input
      type={type}
      data-slot="input"
      className={cn(
        "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input shadow-xs h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base outline-none transition-[color,box-shadow] file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
        "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
        className,
      )}
      {...props}
    />
  );
}

export { Input };
````

## File: apps/moondesk-dash/src/components/ui/item.tsx
````typescript
import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { Separator } from "@/components/ui/separator";

function ItemGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div role="list" data-slot="item-group" className={cn("group/item-group flex flex-col", className)} {...props} />
  );
}

function ItemSeparator({ className, ...props }: React.ComponentProps<typeof Separator>) {
  return <Separator data-slot="item-separator" orientation="horizontal" className={cn("my-0", className)} {...props} />;
}

const itemVariants = cva(
  "group/item flex items-center border border-transparent text-sm rounded-md transition-colors [a]:hover:bg-accent/50 [a]:transition-colors duration-100 flex-wrap outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline: "border-border",
        muted: "bg-muted/50",
      },
      size: {
        default: "p-4 gap-4 ",
        sm: "py-3 px-4 gap-2.5",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Item({
  className,
  variant = "default",
  size = "default",
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof itemVariants> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "div";
  return (
    <Comp
      data-slot="item"
      data-variant={variant}
      data-size={size}
      className={cn(itemVariants({ variant, size, className }))}
      {...props}
    />
  );
}

const itemMediaVariants = cva(
  "flex shrink-0 items-center justify-center gap-2 group-has-[[data-slot=item-description]]/item:self-start [&_svg]:pointer-events-none group-has-[[data-slot=item-description]]/item:translate-y-0.5",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        icon: "size-8 border rounded-sm bg-muted [&_svg:not([class*='size-'])]:size-4",
        image: "size-10 rounded-sm overflow-hidden [&_img]:size-full [&_img]:object-cover",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  },
);

function ItemMedia({
  className,
  variant = "default",
  ...props
}: React.ComponentProps<"div"> & VariantProps<typeof itemMediaVariants>) {
  return (
    <div
      data-slot="item-media"
      data-variant={variant}
      className={cn(itemMediaVariants({ variant, className }))}
      {...props}
    />
  );
}

function ItemContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-content"
      className={cn("flex flex-1 flex-col gap-1 [&+[data-slot=item-content]]:flex-none", className)}
      {...props}
    />
  );
}

function ItemTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-title"
      className={cn("flex w-fit items-center gap-2 text-sm font-medium leading-snug", className)}
      {...props}
    />
  );
}

function ItemDescription({ className, ...props }: React.ComponentProps<"p">) {
  return (
    <p
      data-slot="item-description"
      className={cn(
        "text-muted-foreground line-clamp-2 text-balance text-sm font-normal leading-normal",
        "[&>a:hover]:text-primary [&>a]:underline [&>a]:underline-offset-4",
        className,
      )}
      {...props}
    />
  );
}

function ItemActions({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="item-actions" className={cn("flex items-center gap-2", className)} {...props} />;
}

function ItemHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-header"
      className={cn("flex basis-full items-center justify-between gap-2", className)}
      {...props}
    />
  );
}

function ItemFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="item-footer"
      className={cn("flex basis-full items-center justify-between gap-2", className)}
      {...props}
    />
  );
}

export {
  Item,
  ItemMedia,
  ItemContent,
  ItemActions,
  ItemGroup,
  ItemSeparator,
  ItemTitle,
  ItemDescription,
  ItemHeader,
  ItemFooter,
};
````

## File: apps/moondesk-dash/src/components/ui/kbd.tsx
````typescript
import { cn } from "@/lib/utils";

function Kbd({ className, ...props }: React.ComponentProps<"kbd">) {
  return (
    <kbd
      data-slot="kbd"
      className={cn(
        "bg-muted text-muted-foreground pointer-events-none inline-flex h-5 w-fit min-w-5 select-none items-center justify-center gap-1 rounded-sm px-1 font-sans text-xs font-medium",
        "[&_svg:not([class*='size-'])]:size-3",
        "[[data-slot=tooltip-content]_&]:bg-background/20 [[data-slot=tooltip-content]_&]:text-background dark:[[data-slot=tooltip-content]_&]:bg-background/10",
        className,
      )}
      {...props}
    />
  );
}

function KbdGroup({ className, ...props }: React.ComponentProps<"div">) {
  return <kbd data-slot="kbd-group" className={cn("inline-flex items-center gap-1", className)} {...props} />;
}

export { Kbd, KbdGroup };
````

## File: apps/moondesk-dash/src/components/ui/label.tsx
````typescript
"use client";

import * as React from "react";
import { Label as LabelPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Label({ className, ...props }: React.ComponentProps<typeof LabelPrimitive.Root>) {
  return (
    <LabelPrimitive.Root
      data-slot="label"
      className={cn(
        "flex select-none items-center gap-2 text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-50 group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50",
        className,
      )}
      {...props}
    />
  );
}

export { Label };
````

## File: apps/moondesk-dash/src/components/ui/menubar.tsx
````typescript
"use client";

import * as React from "react";
import { Menubar as MenubarPrimitive } from "radix-ui";
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Menubar({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.Root>) {
  return (
    <MenubarPrimitive.Root
      data-slot="menubar"
      className={cn("bg-background shadow-xs flex h-9 items-center gap-1 rounded-md border p-1", className)}
      {...props}
    />
  );
}

function MenubarMenu({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Menu>) {
  return <MenubarPrimitive.Menu data-slot="menubar-menu" {...props} />;
}

function MenubarGroup({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Group>) {
  return <MenubarPrimitive.Group data-slot="menubar-group" {...props} />;
}

function MenubarPortal({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Portal>) {
  return <MenubarPrimitive.Portal data-slot="menubar-portal" {...props} />;
}

function MenubarRadioGroup({ ...props }: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {
  return <MenubarPrimitive.RadioGroup data-slot="menubar-radio-group" {...props} />;
}

function MenubarTrigger({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.Trigger>) {
  return (
    <MenubarPrimitive.Trigger
      data-slot="menubar-trigger"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground outline-hidden flex select-none items-center rounded-sm px-2 py-1 text-sm font-medium",
        className,
      )}
      {...props}
    />
  );
}

function MenubarContent({
  className,
  align = "start",
  alignOffset = -4,
  sideOffset = 8,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Content>) {
  return (
    <MenubarPortal>
      <MenubarPrimitive.Content
        data-slot="menubar-content"
        align={align}
        alignOffset={alignOffset}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-menubar-content-transform-origin) z-50 min-w-[12rem] overflow-hidden rounded-md border p-1 shadow-md",
          className,
        )}
        {...props}
      />
    </MenubarPortal>
  );
}

function MenubarItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Item> & {
  inset?: boolean;
  variant?: "default" | "destructive";
}) {
  return (
    <MenubarPrimitive.Item
      data-slot="menubar-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm data-[disabled]:pointer-events-none data-[inset]:pl-8 data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function MenubarCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.CheckboxItem>) {
  return (
    <MenubarPrimitive.CheckboxItem
      data-slot="menubar-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground rounded-xs outline-hidden relative flex cursor-default select-none items-center gap-2 py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.CheckboxItem>
  );
}

function MenubarRadioItem({ className, children, ...props }: React.ComponentProps<typeof MenubarPrimitive.RadioItem>) {
  return (
    <MenubarPrimitive.RadioItem
      data-slot="menubar-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground rounded-xs outline-hidden relative flex cursor-default select-none items-center gap-2 py-1.5 pl-8 pr-2 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <MenubarPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </MenubarPrimitive.ItemIndicator>
      </span>
      {children}
    </MenubarPrimitive.RadioItem>
  );
}

function MenubarLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.Label> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.Label
      data-slot="menubar-label"
      data-inset={inset}
      className={cn("px-2 py-1.5 text-sm font-medium data-[inset]:pl-8", className)}
      {...props}
    />
  );
}

function MenubarSeparator({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.Separator>) {
  return (
    <MenubarPrimitive.Separator
      data-slot="menubar-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function MenubarShortcut({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="menubar-shortcut"
      className={cn("text-muted-foreground ml-auto text-xs tracking-widest", className)}
      {...props}
    />
  );
}

function MenubarSub({ ...props }: React.ComponentProps<typeof MenubarPrimitive.Sub>) {
  return <MenubarPrimitive.Sub data-slot="menubar-sub" {...props} />;
}

function MenubarSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof MenubarPrimitive.SubTrigger> & {
  inset?: boolean;
}) {
  return (
    <MenubarPrimitive.SubTrigger
      data-slot="menubar-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[inset]:pl-8",
        className,
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto h-4 w-4" />
    </MenubarPrimitive.SubTrigger>
  );
}

function MenubarSubContent({ className, ...props }: React.ComponentProps<typeof MenubarPrimitive.SubContent>) {
  return (
    <MenubarPrimitive.SubContent
      data-slot="menubar-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-menubar-content-transform-origin) z-50 min-w-[8rem] overflow-hidden rounded-md border p-1 shadow-lg",
        className,
      )}
      {...props}
    />
  );
}

export {
  Menubar,
  MenubarPortal,
  MenubarMenu,
  MenubarTrigger,
  MenubarContent,
  MenubarGroup,
  MenubarSeparator,
  MenubarLabel,
  MenubarItem,
  MenubarShortcut,
  MenubarCheckboxItem,
  MenubarRadioGroup,
  MenubarRadioItem,
  MenubarSub,
  MenubarSubTrigger,
  MenubarSubContent,
};
````

## File: apps/moondesk-dash/src/components/ui/navigation-menu.tsx
````typescript
import * as React from "react";
import { NavigationMenu as NavigationMenuPrimitive } from "radix-ui";
import { cva } from "class-variance-authority";
import { ChevronDownIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function NavigationMenu({
  className,
  children,
  viewport = true,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Root> & {
  viewport?: boolean;
}) {
  return (
    <NavigationMenuPrimitive.Root
      data-slot="navigation-menu"
      data-viewport={viewport}
      className={cn("group/navigation-menu relative flex max-w-max flex-1 items-center justify-center", className)}
      {...props}
    >
      {children}
      {viewport && <NavigationMenuViewport />}
    </NavigationMenuPrimitive.Root>
  );
}

function NavigationMenuList({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.List>) {
  return (
    <NavigationMenuPrimitive.List
      data-slot="navigation-menu-list"
      className={cn("group flex flex-1 list-none items-center justify-center gap-1", className)}
      {...props}
    />
  );
}

function NavigationMenuItem({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.Item>) {
  return (
    <NavigationMenuPrimitive.Item data-slot="navigation-menu-item" className={cn("relative", className)} {...props} />
  );
}

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=open]:hover:bg-accent data-[state=open]:text-accent-foreground data-[state=open]:focus:bg-accent data-[state=open]:bg-accent/50 focus-visible:ring-ring/50 outline-none transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1",
);

function NavigationMenuTrigger({
  className,
  children,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Trigger>) {
  return (
    <NavigationMenuPrimitive.Trigger
      data-slot="navigation-menu-trigger"
      className={cn(navigationMenuTriggerStyle(), "group", className)}
      {...props}
    >
      {children}{" "}
      <ChevronDownIcon
        className="relative top-[1px] ml-1 size-3 transition duration-300 group-data-[state=open]:rotate-180"
        aria-hidden="true"
      />
    </NavigationMenuPrimitive.Trigger>
  );
}

function NavigationMenuContent({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.Content>) {
  return (
    <NavigationMenuPrimitive.Content
      data-slot="navigation-menu-content"
      className={cn(
        "data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 left-0 top-0 w-full p-2 pr-2.5 md:absolute md:w-auto",
        "group-data-[viewport=false]/navigation-menu:bg-popover group-data-[viewport=false]/navigation-menu:text-popover-foreground group-data-[viewport=false]/navigation-menu:data-[state=open]:animate-in group-data-[viewport=false]/navigation-menu:data-[state=closed]:animate-out group-data-[viewport=false]/navigation-menu:data-[state=closed]:zoom-out-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:zoom-in-95 group-data-[viewport=false]/navigation-menu:data-[state=open]:fade-in-0 group-data-[viewport=false]/navigation-menu:data-[state=closed]:fade-out-0 **:data-[slot=navigation-menu-link]:focus:ring-0 **:data-[slot=navigation-menu-link]:focus:outline-none group-data-[viewport=false]/navigation-menu:top-full group-data-[viewport=false]/navigation-menu:mt-1.5 group-data-[viewport=false]/navigation-menu:overflow-hidden group-data-[viewport=false]/navigation-menu:rounded-md group-data-[viewport=false]/navigation-menu:border group-data-[viewport=false]/navigation-menu:shadow group-data-[viewport=false]/navigation-menu:duration-200",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuViewport({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Viewport>) {
  return (
    <div className={cn("absolute left-0 top-full isolate z-50 flex justify-center")}>
      <NavigationMenuPrimitive.Viewport
        data-slot="navigation-menu-viewport"
        className={cn(
          "origin-top-center bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border shadow md:w-[var(--radix-navigation-menu-viewport-width)]",
          className,
        )}
        {...props}
      />
    </div>
  );
}

function NavigationMenuLink({ className, ...props }: React.ComponentProps<typeof NavigationMenuPrimitive.Link>) {
  return (
    <NavigationMenuPrimitive.Link
      data-slot="navigation-menu-link"
      className={cn(
        "data-[active=true]:focus:bg-accent data-[active=true]:hover:bg-accent data-[active=true]:bg-accent/50 data-[active=true]:text-accent-foreground hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus-visible:ring-ring/50 [&_svg:not([class*='text-'])]:text-muted-foreground flex flex-col gap-1 rounded-sm p-2 text-sm outline-none transition-all focus-visible:outline-1 focus-visible:ring-[3px] [&_svg:not([class*='size-'])]:size-4",
        className,
      )}
      {...props}
    />
  );
}

function NavigationMenuIndicator({
  className,
  ...props
}: React.ComponentProps<typeof NavigationMenuPrimitive.Indicator>) {
  return (
    <NavigationMenuPrimitive.Indicator
      data-slot="navigation-menu-indicator"
      className={cn(
        "data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden",
        className,
      )}
      {...props}
    >
      <div className="bg-border relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm shadow-md" />
    </NavigationMenuPrimitive.Indicator>
  );
}

export {
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
  navigationMenuTriggerStyle,
};
````

## File: apps/moondesk-dash/src/components/ui/pagination.tsx
````typescript
import * as React from "react";
import { ChevronLeftIcon, ChevronRightIcon, MoreHorizontalIcon } from "lucide-react";

import { cn } from "@/lib/utils";
import { Button, buttonVariants } from "@/components/ui/button";

function Pagination({ className, ...props }: React.ComponentProps<"nav">) {
  return (
    <nav
      role="navigation"
      aria-label="pagination"
      data-slot="pagination"
      className={cn("mx-auto flex w-full justify-center", className)}
      {...props}
    />
  );
}

function PaginationContent({ className, ...props }: React.ComponentProps<"ul">) {
  return <ul data-slot="pagination-content" className={cn("flex flex-row items-center gap-1", className)} {...props} />;
}

function PaginationItem({ ...props }: React.ComponentProps<"li">) {
  return <li data-slot="pagination-item" {...props} />;
}

type PaginationLinkProps = {
  isActive?: boolean;
} & Pick<React.ComponentProps<typeof Button>, "size"> &
  React.ComponentProps<"a">;

function PaginationLink({ className, isActive, size = "icon", ...props }: PaginationLinkProps) {
  return (
    <a
      aria-current={isActive ? "page" : undefined}
      data-slot="pagination-link"
      data-active={isActive}
      className={cn(
        buttonVariants({
          variant: isActive ? "outline" : "ghost",
          size,
        }),
        className,
      )}
      {...props}
    />
  );
}

function PaginationPrevious({ className, ...props }: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to previous page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pl-2.5", className)}
      {...props}
    >
      <ChevronLeftIcon />
      <span className="hidden sm:block">Previous</span>
    </PaginationLink>
  );
}

function PaginationNext({ className, ...props }: React.ComponentProps<typeof PaginationLink>) {
  return (
    <PaginationLink
      aria-label="Go to next page"
      size="default"
      className={cn("gap-1 px-2.5 sm:pr-2.5", className)}
      {...props}
    >
      <span className="hidden sm:block">Next</span>
      <ChevronRightIcon />
    </PaginationLink>
  );
}

function PaginationEllipsis({ className, ...props }: React.ComponentProps<"span">) {
  return (
    <span
      aria-hidden
      data-slot="pagination-ellipsis"
      className={cn("flex size-9 items-center justify-center", className)}
      {...props}
    >
      <MoreHorizontalIcon className="size-4" />
      <span className="sr-only">More pages</span>
    </span>
  );
}

export {
  Pagination,
  PaginationContent,
  PaginationLink,
  PaginationItem,
  PaginationPrevious,
  PaginationNext,
  PaginationEllipsis,
};
````

## File: apps/moondesk-dash/src/components/ui/popover.tsx
````typescript
"use client";

import * as React from "react";
import { Popover as PopoverPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Popover({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Root>) {
  return <PopoverPrimitive.Root data-slot="popover" {...props} />;
}

function PopoverTrigger({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
  return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />;
}

function PopoverContent({
  className,
  align = "center",
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof PopoverPrimitive.Content>) {
  return (
    <PopoverPrimitive.Portal>
      <PopoverPrimitive.Content
        data-slot="popover-content"
        align={align}
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-popover-content-transform-origin) outline-hidden z-50 w-72 rounded-md border p-4 shadow-md",
          className,
        )}
        {...props}
      />
    </PopoverPrimitive.Portal>
  );
}

function PopoverAnchor({ ...props }: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
  return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />;
}

export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor };
````

## File: apps/moondesk-dash/src/components/ui/progress.tsx
````typescript
"use client";

import * as React from "react";
import { Progress as ProgressPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Progress({ className, value, ...props }: React.ComponentProps<typeof ProgressPrimitive.Root>) {
  return (
    <ProgressPrimitive.Root
      data-slot="progress"
      className={cn("bg-primary/20 relative h-2 w-full overflow-hidden rounded-full", className)}
      {...props}
    >
      <ProgressPrimitive.Indicator
        data-slot="progress-indicator"
        className="bg-primary h-full w-full flex-1 transition-all"
        style={{ transform: `translateX(-${100 - (value || 0)}%)` }}
      />
    </ProgressPrimitive.Root>
  );
}

export { Progress };
````

## File: apps/moondesk-dash/src/components/ui/radio-group.tsx
````typescript
"use client";

import * as React from "react";
import { RadioGroup as RadioGroupPrimitive } from "radix-ui";
import { CircleIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function RadioGroup({ className, ...props }: React.ComponentProps<typeof RadioGroupPrimitive.Root>) {
  return <RadioGroupPrimitive.Root data-slot="radio-group" className={cn("grid gap-3", className)} {...props} />;
}

function RadioGroupItem({ className, ...props }: React.ComponentProps<typeof RadioGroupPrimitive.Item>) {
  return (
    <RadioGroupPrimitive.Item
      data-slot="radio-group-item"
      className={cn(
        "border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 shadow-xs aspect-square size-4 shrink-0 rounded-full border outline-none transition-[color,box-shadow] focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator
        data-slot="radio-group-indicator"
        className="relative flex items-center justify-center"
      >
        <CircleIcon className="fill-primary absolute left-1/2 top-1/2 size-2 -translate-x-1/2 -translate-y-1/2" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
}

export { RadioGroup, RadioGroupItem };
````

## File: apps/moondesk-dash/src/components/ui/resizable.tsx
````typescript
"use client";

import * as React from "react";
import { GripVerticalIcon } from "lucide-react";
import * as ResizablePrimitive from "react-resizable-panels";

import { cn } from "@/lib/utils";

function ResizablePanelGroup({ className, ...props }: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) {
  return (
    <ResizablePrimitive.PanelGroup
      data-slot="resizable-panel-group"
      className={cn("flex h-full w-full data-[panel-group-direction=vertical]:flex-col", className)}
      {...props}
    />
  );
}

function ResizablePanel({ ...props }: React.ComponentProps<typeof ResizablePrimitive.Panel>) {
  return <ResizablePrimitive.Panel data-slot="resizable-panel" {...props} />;
}

function ResizableHandle({
  withHandle,
  className,
  ...props
}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {
  withHandle?: boolean;
}) {
  return (
    <ResizablePrimitive.PanelResizeHandle
      data-slot="resizable-handle"
      className={cn(
        "bg-border focus-visible:ring-ring focus-visible:outline-hidden relative flex w-px items-center justify-center after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:ring-1 focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90",
        className,
      )}
      {...props}
    >
      {withHandle && (
        <div className="bg-border rounded-xs z-10 flex h-4 w-3 items-center justify-center border">
          <GripVerticalIcon className="size-2.5" />
        </div>
      )}
    </ResizablePrimitive.PanelResizeHandle>
  );
}

export { ResizablePanelGroup, ResizablePanel, ResizableHandle };
````

## File: apps/moondesk-dash/src/components/ui/scroll-area.tsx
````typescript
"use client";

import * as React from "react";
import { ScrollArea as ScrollAreaPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function ScrollArea({ className, children, ...props }: React.ComponentProps<typeof ScrollAreaPrimitive.Root>) {
  return (
    <ScrollAreaPrimitive.Root data-slot="scroll-area" className={cn("relative", className)} {...props}>
      <ScrollAreaPrimitive.Viewport
        data-slot="scroll-area-viewport"
        className="focus-visible:ring-ring/50 size-full rounded-[inherit] outline-none transition-[color,box-shadow] focus-visible:outline-1 focus-visible:ring-[3px]"
      >
        {children}
      </ScrollAreaPrimitive.Viewport>
      <ScrollBar />
      <ScrollAreaPrimitive.Corner />
    </ScrollAreaPrimitive.Root>
  );
}

function ScrollBar({
  className,
  orientation = "vertical",
  ...props
}: React.ComponentProps<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>) {
  return (
    <ScrollAreaPrimitive.ScrollAreaScrollbar
      data-slot="scroll-area-scrollbar"
      orientation={orientation}
      className={cn(
        "flex touch-none select-none p-px transition-colors",
        orientation === "vertical" && "h-full w-2.5 border-l border-l-transparent",
        orientation === "horizontal" && "h-2.5 flex-col border-t border-t-transparent",
        className,
      )}
      {...props}
    >
      <ScrollAreaPrimitive.ScrollAreaThumb
        data-slot="scroll-area-thumb"
        className="bg-border relative flex-1 rounded-full"
      />
    </ScrollAreaPrimitive.ScrollAreaScrollbar>
  );
}

export { ScrollArea, ScrollBar };
````

## File: apps/moondesk-dash/src/components/ui/select.tsx
````typescript
"use client";

import * as React from "react";
import { Select as SelectPrimitive } from "radix-ui";
import { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Select({ ...props }: React.ComponentProps<typeof SelectPrimitive.Root>) {
  return <SelectPrimitive.Root data-slot="select" {...props} />;
}

function SelectGroup({ ...props }: React.ComponentProps<typeof SelectPrimitive.Group>) {
  return <SelectPrimitive.Group data-slot="select-group" {...props} />;
}

function SelectValue({ ...props }: React.ComponentProps<typeof SelectPrimitive.Value>) {
  return <SelectPrimitive.Value data-slot="select-value" {...props} />;
}

function SelectTrigger({
  className,
  size = "default",
  children,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Trigger> & {
  size?: "sm" | "default";
}) {
  return (
    <SelectPrimitive.Trigger
      data-slot="select-trigger"
      data-size={size}
      className={cn(
        "border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 shadow-xs flex w-fit items-center justify-between gap-2 whitespace-nowrap rounded-md border bg-transparent px-3 py-2 text-sm outline-none transition-[color,box-shadow] focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      {children}
      <SelectPrimitive.Icon asChild>
        <ChevronDownIcon className="size-4 opacity-50" />
      </SelectPrimitive.Icon>
    </SelectPrimitive.Trigger>
  );
}

function SelectContent({
  className,
  children,
  position = "popper",
  align = "center",
  ...props
}: React.ComponentProps<typeof SelectPrimitive.Content>) {
  return (
    <SelectPrimitive.Portal>
      <SelectPrimitive.Content
        data-slot="select-content"
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 max-h-(--radix-select-content-available-height) origin-(--radix-select-content-transform-origin) relative z-50 min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border shadow-md",
          position === "popper" &&
            "data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",
          className,
        )}
        position={position}
        align={align}
        {...props}
      >
        <SelectScrollUpButton />
        <SelectPrimitive.Viewport
          className={cn(
            "p-1",
            position === "popper" &&
              "h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1",
          )}
        >
          {children}
        </SelectPrimitive.Viewport>
        <SelectScrollDownButton />
      </SelectPrimitive.Content>
    </SelectPrimitive.Portal>
  );
}

function SelectLabel({ className, ...props }: React.ComponentProps<typeof SelectPrimitive.Label>) {
  return (
    <SelectPrimitive.Label
      data-slot="select-label"
      className={cn("text-muted-foreground px-2 py-1.5 text-xs", className)}
      {...props}
    />
  );
}

function SelectItem({ className, children, ...props }: React.ComponentProps<typeof SelectPrimitive.Item>) {
  return (
    <SelectPrimitive.Item
      data-slot="select-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground outline-hidden *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2 relative flex w-full cursor-default select-none items-center gap-2 rounded-sm py-1.5 pl-2 pr-8 text-sm data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    >
      <span className="absolute right-2 flex size-3.5 items-center justify-center">
        <SelectPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </SelectPrimitive.ItemIndicator>
      </span>
      <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>
    </SelectPrimitive.Item>
  );
}

function SelectSeparator({ className, ...props }: React.ComponentProps<typeof SelectPrimitive.Separator>) {
  return (
    <SelectPrimitive.Separator
      data-slot="select-separator"
      className={cn("bg-border pointer-events-none -mx-1 my-1 h-px", className)}
      {...props}
    />
  );
}

function SelectScrollUpButton({ className, ...props }: React.ComponentProps<typeof SelectPrimitive.ScrollUpButton>) {
  return (
    <SelectPrimitive.ScrollUpButton
      data-slot="select-scroll-up-button"
      className={cn("flex cursor-default items-center justify-center py-1", className)}
      {...props}
    >
      <ChevronUpIcon className="size-4" />
    </SelectPrimitive.ScrollUpButton>
  );
}

function SelectScrollDownButton({
  className,
  ...props
}: React.ComponentProps<typeof SelectPrimitive.ScrollDownButton>) {
  return (
    <SelectPrimitive.ScrollDownButton
      data-slot="select-scroll-down-button"
      className={cn("flex cursor-default items-center justify-center py-1", className)}
      {...props}
    >
      <ChevronDownIcon className="size-4" />
    </SelectPrimitive.ScrollDownButton>
  );
}

export {
  Select,
  SelectContent,
  SelectGroup,
  SelectItem,
  SelectLabel,
  SelectScrollDownButton,
  SelectScrollUpButton,
  SelectSeparator,
  SelectTrigger,
  SelectValue,
};
````

## File: apps/moondesk-dash/src/components/ui/separator.tsx
````typescript
"use client";

import * as React from "react";
import { Separator as SeparatorPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Separator({
  className,
  orientation = "horizontal",
  decorative = true,
  ...props
}: React.ComponentProps<typeof SeparatorPrimitive.Root>) {
  return (
    <SeparatorPrimitive.Root
      data-slot="separator"
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=vertical]:h-full data-[orientation=horizontal]:w-full data-[orientation=vertical]:w-px",
        className,
      )}
      {...props}
    />
  );
}

export { Separator };
````

## File: apps/moondesk-dash/src/components/ui/sheet.tsx
````typescript
"use client";

import * as React from "react";
import { Dialog as SheetPrimitive } from "radix-ui";
import { XIcon } from "lucide-react";

import { cn } from "@/lib/utils";

function Sheet({ ...props }: React.ComponentProps<typeof SheetPrimitive.Root>) {
  return <SheetPrimitive.Root data-slot="sheet" {...props} />;
}

function SheetTrigger({ ...props }: React.ComponentProps<typeof SheetPrimitive.Trigger>) {
  return <SheetPrimitive.Trigger data-slot="sheet-trigger" {...props} />;
}

function SheetClose({ ...props }: React.ComponentProps<typeof SheetPrimitive.Close>) {
  return <SheetPrimitive.Close data-slot="sheet-close" {...props} />;
}

function SheetPortal({ ...props }: React.ComponentProps<typeof SheetPrimitive.Portal>) {
  return <SheetPrimitive.Portal data-slot="sheet-portal" {...props} />;
}

function SheetOverlay({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Overlay>) {
  return (
    <SheetPrimitive.Overlay
      data-slot="sheet-overlay"
      className={cn(
        "data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",
        className,
      )}
      {...props}
    />
  );
}

function SheetContent({
  className,
  children,
  side = "right",
  ...props
}: React.ComponentProps<typeof SheetPrimitive.Content> & {
  side?: "top" | "right" | "bottom" | "left";
}) {
  return (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        data-slot="sheet-content"
        className={cn(
          "bg-background data-[state=open]:animate-in data-[state=closed]:animate-out fixed z-50 flex flex-col gap-4 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500",
          side === "right" &&
            "data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right inset-y-0 right-0 h-full w-3/4 border-l sm:max-w-sm",
          side === "left" &&
            "data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left inset-y-0 left-0 h-full w-3/4 border-r sm:max-w-sm",
          side === "top" &&
            "data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top inset-x-0 top-0 h-auto border-b",
          side === "bottom" &&
            "data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom inset-x-0 bottom-0 h-auto border-t",
          className,
        )}
        {...props}
      >
        {children}
        <SheetPrimitive.Close className="ring-offset-background focus:ring-ring data-[state=open]:bg-secondary rounded-xs focus:outline-hidden absolute right-4 top-4 opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none">
          <XIcon className="size-4" />
          <span className="sr-only">Close</span>
        </SheetPrimitive.Close>
      </SheetPrimitive.Content>
    </SheetPortal>
  );
}

function SheetHeader({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="sheet-header" className={cn("flex flex-col gap-1.5 p-4", className)} {...props} />;
}

function SheetFooter({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="sheet-footer" className={cn("mt-auto flex flex-col gap-2 p-4", className)} {...props} />;
}

function SheetTitle({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Title>) {
  return (
    <SheetPrimitive.Title
      data-slot="sheet-title"
      className={cn("text-foreground font-semibold", className)}
      {...props}
    />
  );
}

function SheetDescription({ className, ...props }: React.ComponentProps<typeof SheetPrimitive.Description>) {
  return (
    <SheetPrimitive.Description
      data-slot="sheet-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

export { Sheet, SheetTrigger, SheetClose, SheetContent, SheetHeader, SheetFooter, SheetTitle, SheetDescription };
````

## File: apps/moondesk-dash/src/components/ui/sidebar.tsx
````typescript
"use client";

import * as React from "react";
import { Slot as SlotPrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";
import { PanelLeftIcon } from "lucide-react";

import { useIsMobile } from "@/hooks/use-mobile";
import { cn } from "@/lib/utils";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Separator } from "@/components/ui/separator";
import { Sheet, SheetContent, SheetDescription, SheetHeader, SheetTitle } from "@/components/ui/sheet";
import { Skeleton } from "@/components/ui/skeleton";
import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from "@/components/ui/tooltip";

const SIDEBAR_COOKIE_NAME = "sidebar_state";
const SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;
const SIDEBAR_WIDTH = "16rem";
const SIDEBAR_WIDTH_MOBILE = "18rem";
const SIDEBAR_WIDTH_ICON = "3rem";
const SIDEBAR_KEYBOARD_SHORTCUT = "b";

type SidebarContextProps = {
  state: "expanded" | "collapsed";
  open: boolean;
  setOpen: (open: boolean) => void;
  openMobile: boolean;
  setOpenMobile: (open: boolean) => void;
  isMobile: boolean;
  toggleSidebar: () => void;
};

const SidebarContext = React.createContext<SidebarContextProps | null>(null);

function useSidebar() {
  const context = React.useContext(SidebarContext);
  if (!context) {
    throw new Error("useSidebar must be used within a SidebarProvider.");
  }

  return context;
}

function SidebarProvider({
  defaultOpen = true,
  open: openProp,
  onOpenChange: setOpenProp,
  className,
  style,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  defaultOpen?: boolean;
  open?: boolean;
  onOpenChange?: (open: boolean) => void;
}) {
  const isMobile = useIsMobile();
  const [openMobile, setOpenMobile] = React.useState(false);

  // This is the internal state of the sidebar.
  // We use openProp and setOpenProp for control from outside the component.
  const [_open, _setOpen] = React.useState(defaultOpen);
  const open = openProp ?? _open;
  const setOpen = React.useCallback(
    (value: boolean | ((value: boolean) => boolean)) => {
      const openState = typeof value === "function" ? value(open) : value;
      if (setOpenProp) {
        setOpenProp(openState);
      } else {
        _setOpen(openState);
      }

      // This sets the cookie to keep the sidebar state.
      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;
    },
    [setOpenProp, open],
  );

  // Helper to toggle the sidebar.
  const toggleSidebar = React.useCallback(() => {
    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open);
  }, [isMobile, setOpen, setOpenMobile]);

  // Adds a keyboard shortcut to toggle the sidebar.
  React.useEffect(() => {
    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key === SIDEBAR_KEYBOARD_SHORTCUT && (event.metaKey || event.ctrlKey)) {
        event.preventDefault();
        toggleSidebar();
      }
    };

    window.addEventListener("keydown", handleKeyDown);
    return () => window.removeEventListener("keydown", handleKeyDown);
  }, [toggleSidebar]);

  // We add a state so that we can do data-state="expanded" or "collapsed".
  // This makes it easier to style the sidebar with Tailwind classes.
  const state = open ? "expanded" : "collapsed";

  const contextValue = React.useMemo<SidebarContextProps>(
    () => ({
      state,
      open,
      setOpen,
      isMobile,
      openMobile,
      setOpenMobile,
      toggleSidebar,
    }),
    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar],
  );

  return (
    <SidebarContext.Provider value={contextValue}>
      <TooltipProvider delayDuration={0}>
        <div
          data-slot="sidebar-wrapper"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH,
              "--sidebar-width-icon": SIDEBAR_WIDTH_ICON,
              ...style,
            } as React.CSSProperties
          }
          className={cn("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full", className)}
          {...props}
        >
          {children}
        </div>
      </TooltipProvider>
    </SidebarContext.Provider>
  );
}

function Sidebar({
  side = "left",
  variant = "sidebar",
  collapsible = "offcanvas",
  className,
  children,
  ...props
}: React.ComponentProps<"div"> & {
  side?: "left" | "right";
  variant?: "sidebar" | "floating" | "inset";
  collapsible?: "offcanvas" | "icon" | "none";
}) {
  const { isMobile, state, openMobile, setOpenMobile } = useSidebar();

  if (collapsible === "none") {
    return (
      <div
        data-slot="sidebar"
        className={cn("bg-sidebar text-sidebar-foreground w-(--sidebar-width) flex h-full flex-col", className)}
        {...props}
      >
        {children}
      </div>
    );
  }

  if (isMobile) {
    return (
      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>
        <SheetContent
          data-sidebar="sidebar"
          data-slot="sidebar"
          data-mobile="true"
          className="bg-sidebar text-sidebar-foreground w-(--sidebar-width) p-0 [&>button]:hidden"
          style={
            {
              "--sidebar-width": SIDEBAR_WIDTH_MOBILE,
            } as React.CSSProperties
          }
          side={side}
        >
          <SheetHeader className="sr-only">
            <SheetTitle>Sidebar</SheetTitle>
            <SheetDescription>Displays the mobile sidebar.</SheetDescription>
          </SheetHeader>
          <div className="flex h-full w-full flex-col">{children}</div>
        </SheetContent>
      </Sheet>
    );
  }

  return (
    <div
      className="text-sidebar-foreground group peer hidden md:block"
      data-state={state}
      data-collapsible={state === "collapsed" ? collapsible : ""}
      data-variant={variant}
      data-side={side}
      data-slot="sidebar"
    >
      {/* This is what handles the sidebar gap on desktop */}
      <div
        data-slot="sidebar-gap"
        className={cn(
          "w-(--sidebar-width) relative bg-transparent transition-[width] duration-200 ease-linear",
          "group-data-[collapsible=offcanvas]:w-0",
          "group-data-[side=right]:rotate-180",
          variant === "floating" || variant === "inset"
            ? "group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4)))]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon)",
        )}
      />
      <div
        data-slot="sidebar-container"
        className={cn(
          "w-(--sidebar-width) fixed inset-y-0 z-10 hidden h-svh transition-[left,right,width] duration-200 ease-linear md:flex",
          side === "left"
            ? "left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]"
            : "right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]",
          // Adjust the padding for floating and inset variants.
          variant === "floating" || variant === "inset"
            ? "p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+(--spacing(4))+2px)]"
            : "group-data-[collapsible=icon]:w-(--sidebar-width-icon) group-data-[side=left]:border-r group-data-[side=right]:border-l",
          className,
        )}
        {...props}
      >
        <div
          data-sidebar="sidebar"
          data-slot="sidebar-inner"
          className="bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm"
        >
          {children}
        </div>
      </div>
    </div>
  );
}

function SidebarTrigger({ className, onClick, ...props }: React.ComponentProps<typeof Button>) {
  const { toggleSidebar } = useSidebar();

  return (
    <Button
      data-sidebar="trigger"
      data-slot="sidebar-trigger"
      variant="ghost"
      size="icon"
      className={cn("size-7", className)}
      onClick={(event) => {
        onClick?.(event);
        toggleSidebar();
      }}
      {...props}
    >
      <PanelLeftIcon />
      <span className="sr-only">Toggle Sidebar</span>
    </Button>
  );
}

function SidebarRail({ className, ...props }: React.ComponentProps<"button">) {
  const { toggleSidebar } = useSidebar();

  return (
    <button
      data-sidebar="rail"
      data-slot="sidebar-rail"
      aria-label="Toggle Sidebar"
      tabIndex={-1}
      onClick={toggleSidebar}
      title="Toggle Sidebar"
      className={cn(
        "hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex",
        "in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize",
        "[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize",
        "hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full",
        "[[data-side=left][data-collapsible=offcanvas]_&]:-right-2",
        "[[data-side=right][data-collapsible=offcanvas]_&]:-left-2",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInset({ className, ...props }: React.ComponentProps<"main">) {
  return (
    <main
      data-slot="sidebar-inset"
      className={cn(
        "bg-background relative flex w-full flex-1 flex-col",
        "md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm",
        className,
      )}
      {...props}
    />
  );
}

function SidebarInput({ className, ...props }: React.ComponentProps<typeof Input>) {
  return (
    <Input
      data-slot="sidebar-input"
      data-sidebar="input"
      className={cn("bg-background h-8 w-full shadow-none", className)}
      {...props}
    />
  );
}

function SidebarHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-header"
      data-sidebar="header"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-footer"
      data-sidebar="footer"
      className={cn("flex flex-col gap-2 p-2", className)}
      {...props}
    />
  );
}

function SidebarSeparator({ className, ...props }: React.ComponentProps<typeof Separator>) {
  return (
    <Separator
      data-slot="sidebar-separator"
      data-sidebar="separator"
      className={cn("bg-sidebar-border mx-2 w-auto", className)}
      {...props}
    />
  );
}

function SidebarContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-content"
      data-sidebar="content"
      className={cn(
        "flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroup({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group"
      data-sidebar="group"
      className={cn("relative flex w-full min-w-0 flex-col p-2", className)}
      {...props}
    />
  );
}

function SidebarGroupLabel({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"div"> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "div";

  return (
    <Comp
      data-slot="sidebar-group-label"
      data-sidebar="group-label"
      className={cn(
        "text-sidebar-foreground/70 ring-sidebar-ring outline-hidden flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        "group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupAction({
  className,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> & { asChild?: boolean }) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";

  return (
    <Comp
      data-slot="sidebar-group-action"
      data-sidebar="group-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground outline-hidden absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarGroupContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-group-content"
      data-sidebar="group-content"
      className={cn("w-full text-sm", className)}
      {...props}
    />
  );
}

function SidebarMenu({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu"
      data-sidebar="menu"
      className={cn("flex w-full min-w-0 flex-col gap-1", className)}
      {...props}
    />
  );
}

function SidebarMenuItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-item"
      data-sidebar="menu-item"
      className={cn("group/menu-item relative", className)}
      {...props}
    />
  );
}

const sidebarMenuButtonVariants = cva(
  "peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:size-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
  {
    variants: {
      variant: {
        default: "hover:bg-sidebar-accent hover:text-sidebar-accent-foreground",
        outline:
          "bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]",
      },
      size: {
        default: "h-8 text-sm",
        sm: "h-7 text-xs",
        lg: "h-12 text-sm group-data-[collapsible=icon]:p-0!",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function SidebarMenuButton({
  asChild = false,
  isActive = false,
  variant = "default",
  size = "default",
  tooltip,
  className,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  isActive?: boolean;
  tooltip?: string | React.ComponentProps<typeof TooltipContent>;
} & VariantProps<typeof sidebarMenuButtonVariants>) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";
  const { isMobile, state } = useSidebar();

  const button = (
    <Comp
      data-slot="sidebar-menu-button"
      data-sidebar="menu-button"
      data-size={size}
      data-active={isActive}
      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}
      {...props}
    />
  );

  if (!tooltip) {
    return button;
  }

  if (typeof tooltip === "string") {
    tooltip = {
      children: tooltip,
    };
  }

  return (
    <Tooltip>
      <TooltipTrigger asChild>{button}</TooltipTrigger>
      <TooltipContent side="right" align="center" hidden={state !== "collapsed" || isMobile} {...tooltip} />
    </Tooltip>
  );
}

function SidebarMenuAction({
  className,
  asChild = false,
  showOnHover = false,
  ...props
}: React.ComponentProps<"button"> & {
  asChild?: boolean;
  showOnHover?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "button";

  return (
    <Comp
      data-slot="sidebar-menu-action"
      data-sidebar="menu-action"
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground outline-hidden absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0",
        // Increases the hit area of the button on mobile.
        "after:absolute after:-inset-2 md:after:hidden",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        showOnHover &&
          "peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuBadge({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="sidebar-menu-badge"
      data-sidebar="menu-badge"
      className={cn(
        "text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums",
        "peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground",
        "peer-data-[size=sm]/menu-button:top-1",
        "peer-data-[size=default]/menu-button:top-1.5",
        "peer-data-[size=lg]/menu-button:top-2.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSkeleton({
  className,
  showIcon = false,
  ...props
}: React.ComponentProps<"div"> & {
  showIcon?: boolean;
}) {
  // Random width between 50 to 90%.
  const width = React.useMemo(() => {
    return `${Math.floor(Math.random() * 40) + 50}%`;
  }, []);

  return (
    <div
      data-slot="sidebar-menu-skeleton"
      data-sidebar="menu-skeleton"
      className={cn("flex h-8 items-center gap-2 rounded-md px-2", className)}
      {...props}
    >
      {showIcon && <Skeleton className="size-4 rounded-md" data-sidebar="menu-skeleton-icon" />}
      <Skeleton
        className="max-w-(--skeleton-width) h-4 flex-1"
        data-sidebar="menu-skeleton-text"
        style={
          {
            "--skeleton-width": width,
          } as React.CSSProperties
        }
      />
    </div>
  );
}

function SidebarMenuSub({ className, ...props }: React.ComponentProps<"ul">) {
  return (
    <ul
      data-slot="sidebar-menu-sub"
      data-sidebar="menu-sub"
      className={cn(
        "border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

function SidebarMenuSubItem({ className, ...props }: React.ComponentProps<"li">) {
  return (
    <li
      data-slot="sidebar-menu-sub-item"
      data-sidebar="menu-sub-item"
      className={cn("group/menu-sub-item relative", className)}
      {...props}
    />
  );
}

function SidebarMenuSubButton({
  asChild = false,
  size = "md",
  isActive = false,
  className,
  ...props
}: React.ComponentProps<"a"> & {
  asChild?: boolean;
  size?: "sm" | "md";
  isActive?: boolean;
}) {
  const Comp = asChild ? SlotPrimitive.Slot : "a";

  return (
    <Comp
      data-slot="sidebar-menu-sub-button"
      data-sidebar="menu-sub-button"
      data-size={size}
      data-active={isActive}
      className={cn(
        "text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground outline-hidden flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0",
        "data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground",
        size === "sm" && "text-xs",
        size === "md" && "text-sm",
        "group-data-[collapsible=icon]:hidden",
        className,
      )}
      {...props}
    />
  );
}

export {
  Sidebar,
  SidebarContent,
  SidebarFooter,
  SidebarGroup,
  SidebarGroupAction,
  SidebarGroupContent,
  SidebarGroupLabel,
  SidebarHeader,
  SidebarInput,
  SidebarInset,
  SidebarMenu,
  SidebarMenuAction,
  SidebarMenuBadge,
  SidebarMenuButton,
  SidebarMenuItem,
  SidebarMenuSkeleton,
  SidebarMenuSub,
  SidebarMenuSubButton,
  SidebarMenuSubItem,
  SidebarProvider,
  SidebarRail,
  SidebarSeparator,
  SidebarTrigger,
  useSidebar,
};
````

## File: apps/moondesk-dash/src/components/ui/skeleton.tsx
````typescript
import { cn } from "@/lib/utils";

function Skeleton({ className, ...props }: React.ComponentProps<"div">) {
  return <div data-slot="skeleton" className={cn("bg-accent animate-pulse rounded-md", className)} {...props} />;
}

export { Skeleton };
````

## File: apps/moondesk-dash/src/components/ui/slider.tsx
````typescript
"use client";

import * as React from "react";
import { Slider as SliderPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Slider({
  className,
  defaultValue,
  value,
  min = 0,
  max = 100,
  ...props
}: React.ComponentProps<typeof SliderPrimitive.Root>) {
  const _values = React.useMemo(
    () => (Array.isArray(value) ? value : Array.isArray(defaultValue) ? defaultValue : [min, max]),
    [value, defaultValue, min, max],
  );

  return (
    <SliderPrimitive.Root
      data-slot="slider"
      defaultValue={defaultValue}
      value={value}
      min={min}
      max={max}
      className={cn(
        "relative flex w-full touch-none select-none items-center data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col data-[disabled]:opacity-50",
        className,
      )}
      {...props}
    >
      <SliderPrimitive.Track
        data-slot="slider-track"
        className={cn(
          "bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=vertical]:h-full data-[orientation=horizontal]:w-full data-[orientation=vertical]:w-1.5",
        )}
      >
        <SliderPrimitive.Range
          data-slot="slider-range"
          className={cn("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")}
        />
      </SliderPrimitive.Track>
      {Array.from({ length: _values.length }, (_, index) => (
        <SliderPrimitive.Thumb
          data-slot="slider-thumb"
          key={index}
          className="border-primary ring-ring/50 focus-visible:outline-hidden block size-4 shrink-0 rounded-full border bg-white shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 disabled:pointer-events-none disabled:opacity-50"
        />
      ))}
    </SliderPrimitive.Root>
  );
}

export { Slider };
````

## File: apps/moondesk-dash/src/components/ui/sonner.tsx
````typescript
"use client";

import { CircleCheckIcon, InfoIcon, Loader2Icon, OctagonXIcon, TriangleAlertIcon } from "lucide-react";
import { useTheme } from "next-themes";
import { Toaster as Sonner, type ToasterProps } from "sonner";

const Toaster = ({ ...props }: ToasterProps) => {
  const { theme = "system" } = useTheme();

  return (
    <Sonner
      theme={theme as ToasterProps["theme"]}
      className="toaster group"
      icons={{
        success: <CircleCheckIcon className="size-4" />,
        info: <InfoIcon className="size-4" />,
        warning: <TriangleAlertIcon className="size-4" />,
        error: <OctagonXIcon className="size-4" />,
        loading: <Loader2Icon className="size-4 animate-spin" />,
      }}
      style={
        {
          "--normal-bg": "var(--popover)",
          "--normal-text": "var(--popover-foreground)",
          "--normal-border": "var(--border)",
          "--border-radius": "var(--radius)",
        } as React.CSSProperties
      }
      {...props}
    />
  );
};

export { Toaster };
````

## File: apps/moondesk-dash/src/components/ui/spinner.tsx
````typescript
import { Loader2Icon } from "lucide-react";

import { cn } from "@/lib/utils";

function Spinner({ className, ...props }: React.ComponentProps<"svg">) {
  return <Loader2Icon role="status" aria-label="Loading" className={cn("size-4 animate-spin", className)} {...props} />;
}

export { Spinner };
````

## File: apps/moondesk-dash/src/components/ui/switch.tsx
````typescript
"use client";

import * as React from "react";
import { Switch as SwitchPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Switch({ className, ...props }: React.ComponentProps<typeof SwitchPrimitive.Root>) {
  return (
    <SwitchPrimitive.Root
      data-slot="switch"
      className={cn(
        "data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 shadow-xs peer inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent outline-none transition-all focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
        className,
      )}
      {...props}
    >
      <SwitchPrimitive.Thumb
        data-slot="switch-thumb"
        className={cn(
          "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0",
        )}
      />
    </SwitchPrimitive.Root>
  );
}

export { Switch };
````

## File: apps/moondesk-dash/src/components/ui/table.tsx
````typescript
"use client";

import * as React from "react";

import { cn } from "@/lib/utils";

function Table({ className, ...props }: React.ComponentProps<"table">) {
  return (
    <div data-slot="table-container" className="relative w-full overflow-x-auto">
      <table data-slot="table" className={cn("w-full caption-bottom text-sm", className)} {...props} />
    </div>
  );
}

function TableHeader({ className, ...props }: React.ComponentProps<"thead">) {
  return <thead data-slot="table-header" className={cn("[&_tr]:border-b", className)} {...props} />;
}

function TableBody({ className, ...props }: React.ComponentProps<"tbody">) {
  return <tbody data-slot="table-body" className={cn("[&_tr:last-child]:border-0", className)} {...props} />;
}

function TableFooter({ className, ...props }: React.ComponentProps<"tfoot">) {
  return (
    <tfoot
      data-slot="table-footer"
      className={cn("bg-muted/50 border-t font-medium [&>tr]:last:border-b-0", className)}
      {...props}
    />
  );
}

function TableRow({ className, ...props }: React.ComponentProps<"tr">) {
  return (
    <tr
      data-slot="table-row"
      className={cn("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors", className)}
      {...props}
    />
  );
}

function TableHead({ className, ...props }: React.ComponentProps<"th">) {
  return (
    <th
      data-slot="table-head"
      className={cn(
        "text-foreground h-10 whitespace-nowrap px-2 text-left align-middle font-medium [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCell({ className, ...props }: React.ComponentProps<"td">) {
  return (
    <td
      data-slot="table-cell"
      className={cn(
        "whitespace-nowrap p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",
        className,
      )}
      {...props}
    />
  );
}

function TableCaption({ className, ...props }: React.ComponentProps<"caption">) {
  return (
    <caption data-slot="table-caption" className={cn("text-muted-foreground mt-4 text-sm", className)} {...props} />
  );
}

export { Table, TableHeader, TableBody, TableFooter, TableHead, TableRow, TableCell, TableCaption };
````

## File: apps/moondesk-dash/src/components/ui/tabs.tsx
````typescript
"use client";

import * as React from "react";
import { Tabs as TabsPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function Tabs({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.Root>) {
  return <TabsPrimitive.Root data-slot="tabs" className={cn("flex flex-col gap-2", className)} {...props} />;
}

function TabsList({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.List>) {
  return (
    <TabsPrimitive.List
      data-slot="tabs-list"
      className={cn(
        "bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",
        className,
      )}
      {...props}
    />
  );
}

function TabsTrigger({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.Trigger>) {
  return (
    <TabsPrimitive.Trigger
      data-slot="tabs-trigger"
      className={cn(
        "data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 whitespace-nowrap rounded-md border border-transparent px-2 py-1 text-sm font-medium transition-[color,box-shadow] focus-visible:outline-1 focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",
        className,
      )}
      {...props}
    />
  );
}

function TabsContent({ className, ...props }: React.ComponentProps<typeof TabsPrimitive.Content>) {
  return <TabsPrimitive.Content data-slot="tabs-content" className={cn("flex-1 outline-none", className)} {...props} />;
}

export { Tabs, TabsList, TabsTrigger, TabsContent };
````

## File: apps/moondesk-dash/src/components/ui/textarea.tsx
````typescript
import * as React from "react";

import { cn } from "@/lib/utils";

function Textarea({ className, ...props }: React.ComponentProps<"textarea">) {
  return (
    <textarea
      data-slot="textarea"
      className={cn(
        "border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 field-sizing-content shadow-xs flex min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base outline-none transition-[color,box-shadow] focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className,
      )}
      {...props}
    />
  );
}

export { Textarea };
````

## File: apps/moondesk-dash/src/components/ui/toggle-group.tsx
````typescript
"use client";

import * as React from "react";
import { ToggleGroup as ToggleGroupPrimitive } from "radix-ui";
import { type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";
import { toggleVariants } from "@/components/ui/toggle";

const ToggleGroupContext = React.createContext<
  VariantProps<typeof toggleVariants> & {
    spacing?: number;
  }
>({
  size: "default",
  variant: "default",
  spacing: 0,
});

function ToggleGroup({
  className,
  variant,
  size,
  spacing = 0,
  children,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Root> &
  VariantProps<typeof toggleVariants> & {
    spacing?: number;
  }) {
  return (
    <ToggleGroupPrimitive.Root
      data-slot="toggle-group"
      data-variant={variant}
      data-size={size}
      data-spacing={spacing}
      style={{ "--gap": spacing } as React.CSSProperties}
      className={cn(
        "group/toggle-group data-[spacing=default]:data-[variant=outline]:shadow-xs flex w-fit items-center gap-[--spacing(var(--gap))] rounded-md",
        className,
      )}
      {...props}
    >
      <ToggleGroupContext.Provider value={{ variant, size, spacing }}>{children}</ToggleGroupContext.Provider>
    </ToggleGroupPrimitive.Root>
  );
}

function ToggleGroupItem({
  className,
  children,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof ToggleGroupPrimitive.Item> & VariantProps<typeof toggleVariants>) {
  const context = React.useContext(ToggleGroupContext);

  return (
    <ToggleGroupPrimitive.Item
      data-slot="toggle-group-item"
      data-variant={context.variant || variant}
      data-size={context.size || size}
      data-spacing={context.spacing}
      className={cn(
        toggleVariants({
          variant: context.variant || variant,
          size: context.size || size,
        }),
        "w-auto min-w-0 shrink-0 px-3 focus:z-10 focus-visible:z-10",
        "data-[spacing=0]:rounded-none data-[spacing=0]:data-[variant=outline]:border-l-0 data-[spacing=0]:shadow-none data-[spacing=0]:first:rounded-l-md data-[spacing=0]:data-[variant=outline]:first:border-l data-[spacing=0]:last:rounded-r-md",
        className,
      )}
      {...props}
    >
      {children}
    </ToggleGroupPrimitive.Item>
  );
}

export { ToggleGroup, ToggleGroupItem };
````

## File: apps/moondesk-dash/src/components/ui/toggle.tsx
````typescript
"use client";

import * as React from "react";
import { Toggle as TogglePrimitive } from "radix-ui";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const toggleVariants = cva(
  "inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium hover:bg-muted hover:text-muted-foreground disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:shrink-0 focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] outline-none transition-[color,box-shadow] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive whitespace-nowrap",
  {
    variants: {
      variant: {
        default: "bg-transparent",
        outline: "border border-input bg-transparent shadow-xs hover:bg-accent hover:text-accent-foreground",
      },
      size: {
        default: "h-9 px-2 min-w-9",
        sm: "h-8 px-1.5 min-w-8",
        lg: "h-10 px-2.5 min-w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  },
);

function Toggle({
  className,
  variant,
  size,
  ...props
}: React.ComponentProps<typeof TogglePrimitive.Root> & VariantProps<typeof toggleVariants>) {
  return (
    <TogglePrimitive.Root data-slot="toggle" className={cn(toggleVariants({ variant, size, className }))} {...props} />
  );
}

export { Toggle, toggleVariants };
````

## File: apps/moondesk-dash/src/components/ui/tooltip.tsx
````typescript
"use client";

import * as React from "react";
import { Tooltip as TooltipPrimitive } from "radix-ui";

import { cn } from "@/lib/utils";

function TooltipProvider({ delayDuration = 0, ...props }: React.ComponentProps<typeof TooltipPrimitive.Provider>) {
  return <TooltipPrimitive.Provider data-slot="tooltip-provider" delayDuration={delayDuration} {...props} />;
}

function Tooltip({ ...props }: React.ComponentProps<typeof TooltipPrimitive.Root>) {
  return (
    <TooltipProvider>
      <TooltipPrimitive.Root data-slot="tooltip" {...props} />
    </TooltipProvider>
  );
}

function TooltipTrigger({ ...props }: React.ComponentProps<typeof TooltipPrimitive.Trigger>) {
  return <TooltipPrimitive.Trigger data-slot="tooltip-trigger" {...props} />;
}

function TooltipContent({
  className,
  sideOffset = 0,
  children,
  ...props
}: React.ComponentProps<typeof TooltipPrimitive.Content>) {
  return (
    <TooltipPrimitive.Portal>
      <TooltipPrimitive.Content
        data-slot="tooltip-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-foreground text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-(--radix-tooltip-content-transform-origin) z-50 w-fit text-balance rounded-md px-3 py-1.5 text-xs",
          className,
        )}
        {...props}
      >
        {children}
        <TooltipPrimitive.Arrow className="bg-foreground fill-foreground z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]" />
      </TooltipPrimitive.Content>
    </TooltipPrimitive.Portal>
  );
}

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider };
````

## File: apps/moondesk-dash/eslint.config.mjs
````javascript
// TODO: Fix linting issues in this package. Linting is currently disabled in package.json to prevent CI hangs.
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";
import pluginJs from "@eslint/js";
import pluginImport from "eslint-plugin-import";
import globals from "globals";
import tseslint from "typescript-eslint";
import securityPlugin from "eslint-plugin-security";
import prettier from "eslint-plugin-prettier";
import unicorn from "eslint-plugin-unicorn";
import sonarjs from "eslint-plugin-sonarjs";

export default defineConfig([
  ...nextVitals,
  ...nextTs,
  { files: ["**/*.{js,mjs,cjs,ts,jsx,tsx}"] },
  {
    languageOptions: {
      globals: globals.browser,
      parser: "@typescript-eslint/parser",
      parserOptions: {
        project: "./tsconfig.json",
      },
    },
    plugins: {
      import: pluginImport,
      security: securityPlugin,
      prettier: prettier,
      unicorn: unicorn,
      sonarjs: sonarjs,
    },
  },
  pluginJs.configs.recommended,
  securityPlugin.configs.recommended,
  ...tseslint.configs.recommended,
  {
    rules: {
      // Prettier integration rules
      "prettier/prettier": "warn",

      // File Naming
      "unicorn/filename-case": [
        "error",
        {
          case: "kebabCase",
          ignore: ["^.*\\.config\\.(js|ts|mjs)$", "^.*\\.d\\.ts$"],
        },
      ],

      // Custom Rules (Not covered by plugins)
      "spaced-comment": ["error", "always", { exceptions: ["-", "+"] }],
      "key-spacing": ["error", { beforeColon: false, afterColon: true }],
      "no-useless-rename": "error",

      // Import/Export Rules
      "import/no-mutable-exports": "error",
      "import/order": [
        "error",
        {
          groups: ["builtin", "external", "internal", "parent", "sibling", "index"],
          pathGroups: [
            {
              pattern: "react",
              group: "external",
              position: "before",
            },
            {
              pattern: "{next,next/**}",
              group: "external",
              position: "before",
            },
          ],
          pathGroupsExcludedImportTypes: [],
          "newlines-between": "always",
          alphabetize: {
            order: "asc",
            caseInsensitive: true,
          },
        },
      ],
      "import/newline-after-import": "error",
      "import/no-unresolved": [
        "error",
        {
          caseSensitive: true,
        },
      ],
      "no-duplicate-imports": ["error", { includeExports: true }],
      "import/no-cycle": ["error", { maxDepth: 2 }],

      // Whitespace and Punctuation (Style Rules)
      "no-trailing-spaces": "error",
      "no-multiple-empty-lines": ["error", { max: 1, maxEOF: 1 }],
      "space-before-function-paren": [
        "error",
        {
          anonymous: "always",
          named: "never",
          asyncArrow: "always",
        },
      ],
      "space-in-parens": ["error", "never"],
      "array-bracket-spacing": ["error", "never"],
      "object-curly-spacing": ["error", "always"],
      "func-call-spacing": ["error", "never"],
      "computed-property-spacing": ["error", "never"],

      // Naming Conventions
      "no-underscore-dangle": ["error", { allow: ["_id", "__dirname"] }],

      // Complexity
      complexity: ["error", { max: 10 }],
      "max-lines": ["error", { max: 300, skipBlankLines: true, skipComments: true }],
      "max-depth": ["error", 4],

      // TypeScript-Specific Rules (customized)
      "@typescript-eslint/prefer-nullish-coalescing": "error",
      "@typescript-eslint/no-unnecessary-type-assertion": "warn",
      "@typescript-eslint/no-unnecessary-condition": "warn",
      "@typescript-eslint/no-explicit-any": "warn",
      "@typescript-eslint/no-unused-vars": ["warn"],

      // React unnecessary import rules
      "react/jsx-no-useless-fragment": ["warn", { allowExpressions: true }],

      // React JSX Pascal Case Rule
      "react/jsx-pascal-case": [
        "error",
        {
          allowAllCaps: false,
          ignore: [],
        },
      ],

      // React: Prevent nesting component definitions inside another component
      "react/no-unstable-nested-components": ["error", { allowAsProps: true }],

      // React: Prevent re-renders by ensuring context values are memoized
      "react/jsx-no-constructed-context-values": "error",

      // React: Disallow array index as key in JSX
      "react/no-array-index-key": "warn",

      // SonarJS: Detect commented-out code
      "sonarjs/no-commented-code": "warn",
    },
  },
  globalIgnores([
    ".github/",
    ".husky/",
    "node_modules/",
    ".next/**",
    "out/**",
    "build/**",
    "dist/**",
    "coverage/**",
    "next-env.d.ts",
    "src/components/ui",
    "*.config.ts",
    "*.mjs",
  ]),
]);
````

## File: apps/moondesk-dash/README.md
````markdown
# Moondesk - Industrial IoT Dashboard

**Moondesk** is a modern Industrial IoT dashboard for monitoring and managing industrial assets in real-time.

## Features

- **Device Management**: Provision and monitor industrial devices (Solar Panels, PLCs, Sensors)
- **Real-time Monitoring**: Track telemetry data and device status
- **Multi-tenancy**: Secure organization-based access control via Clerk
- **Customizable Themes**: Multiple theme presets (default, brutalist, soft-pop, tangerine)
- **Responsive Design**: Mobile-first, works on all devices
- **Type-Safe**: Built with TypeScript for reliability

## Tech Stack

- **Framework**: Next.js 16 (App Router), TypeScript, Tailwind CSS v4
- **UI Components**: shadcn/ui (New York style)
- **Authentication**: Clerk
- **State Management**: Zustand
- **Data Fetching**: TanStack Query (React Query)
- **Forms**: React Hook Form + Zod validation
- **Charts**: Recharts
- **Icons**: Lucide React

## Getting Started

### Prerequisites

- Node.js 18+ and pnpm
- Clerk account for authentication

### Installation

1. **Clone the repository**

   ```bash
   git clone <repository-url>
   cd moondesk/apps/moondesk-dash
   ```

2. **Install dependencies**

   ```bash
   pnpm install
   ```

3. **Set up environment variables**

   Copy `.env.local.example` to `.env.local` and add your Clerk keys:

   ```bash
   cp .env.local.example .env.local
   ```

4. **Start the development server**
   ```bash
   pnpm dev
   ```

Your app will be running at [http://localhost:3000](http://localhost:3000)

## Project Structure

```
src/
├── app/                    # Next.js App Router pages
│   ├── (external)/         # Public pages (landing)
│   ├── (main)/             # Protected pages (dashboard)
│   ├── sign-in/            # Custom sign-in page
│   ├── sign-up/            # Custom sign-up page
│   └── organization/       # Organization management
├── components/
│   ├── ui/                 # shadcn/ui components
│   └── data-table/         # Reusable table components
├── config/                 # App configuration
├── hooks/                  # Custom React hooks
├── lib/                    # Utility functions
├── navigation/             # Navigation configuration
├── server/                 # Server actions
├── services/               # API clients
├── stores/                 # Zustand stores
├── styles/                 # Theme presets
└── types/                  # TypeScript types
```

## Available Scripts

- `pnpm dev` - Start development server
- `pnpm build` - Build for production
- `pnpm start` - Start production server
- `pnpm lint` - Run ESLint
- `pnpm format` - Format code with Prettier
- `pnpm check-types` - Type check with TypeScript

## Theme Customization

Moondesk includes multiple theme presets:

- **default** - Neutral gray theme
- **brutalist** - Bold orange/red with hard shadows
- **soft-pop** - Purple/violet theme
- **tangerine** - Orange theme

Switch themes in the app settings or create custom presets in `src/styles/presets/`.

## License

MIT
````

## File: apps/mqtt-worker/src/api-broadcaster.test.ts
````typescript
import { vi, describe, it, expect, beforeEach, afterEach } from "vitest";
import {
  connectToApi,
  broadcastToApi,
  disconnectFromApi,
} from "./api-broadcaster";
import { io } from "socket.io-client";

vi.mock("socket.io-client", () => ({
  io: vi.fn(),
}));

vi.mock("@moondesk/config", () => ({
  getEnv: vi.fn(() => ({
    HOST: "localhost",
    PORT: 3001,
    DATABASE_URL: "postgresql://user:password@host:port/db",
  })),
}));

describe("api-broadcaster", () => {
  let socketMock: any;

  beforeEach(() => {
    socketMock = {
      on: vi.fn(),
      emit: vi.fn(),
      disconnect: vi.fn(),
      connected: false,
    };
    (io as any).mockReturnValue(socketMock);
  });

  afterEach(() => {
    vi.clearAllMocks();
    disconnectFromApi();
  });

  describe("connectToApi", () => {
    it("should connect to the API and resolve on successful connection", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: () => void) => {
          if (event === "connect") {
            callback();
          }
        },
      );

      await connectToApi();

      expect(io).toHaveBeenCalled();
      expect(socketMock.on).toHaveBeenCalledWith(
        "connect",
        expect.any(Function),
      );
    });

    it("should resolve even if the connection fails", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: (error: Error) => void) => {
          if (event === "connect_error") {
            callback(new Error("Connection failed"));
          }
        },
      );

      await connectToApi();

      expect(io).toHaveBeenCalled();
      expect(socketMock.on).toHaveBeenCalledWith(
        "connect_error",
        expect.any(Function),
      );
    });
  });

  describe("broadcastToApi", () => {
    it("should emit an event if the socket is connected", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: () => void) => {
          if (event === "connect") {
            socketMock.connected = true;
            callback();
          }
        },
      );

      await connectToApi();
      await broadcastToApi("reading", {
        sensorId: 1,
        assetId: 1,
        organizationId: "org1",
        timestamp: new Date(),
        value: 10,
        parameter: "temp",
        quality: "good",
      });

      expect(socketMock.emit).toHaveBeenCalledWith(
        "worker:reading",
        expect.any(Object),
      );
    });

    it("should not emit an event if the socket is not connected", async () => {
      await broadcastToApi("reading", {
        sensorId: 1,
        assetId: 1,
        organizationId: "org1",
        timestamp: new Date(),
        value: 10,
        parameter: "temp",
        quality: "good",
      });

      expect(socketMock.emit).not.toHaveBeenCalled();
    });
  });

  describe("disconnectFromApi", () => {
    it("should disconnect the socket", async () => {
      socketMock.on.mockImplementation(
        (event: string, callback: () => void) => {
          if (event === "connect") {
            callback();
          }
        },
      );

      await connectToApi();
      disconnectFromApi();

      expect(socketMock.disconnect).toHaveBeenCalled();
    });
  });
});
````

## File: apps/mqtt-worker/src/api-broadcaster.ts
````typescript
import { io, Socket } from "socket.io-client";
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";

const logger = createLogger("api-broadcaster");

let socket: Socket | null = null;

interface ReadingPayload {
  sensorId: number;
  assetId: number;
  organizationId: string;
  timestamp: Date;
  value: number;
  parameter: string;
  quality: string;
}

interface AlertPayload {
  id: number;
  sensorId: number;
  assetId: number;
  organizationId: string;
  severity: string;
  message: string;
  value: number;
  threshold: number;
  createdAt: Date;
}

interface CommandStatusPayload {
  id: number;
  sensorId: number;
  organizationId: string;
  status: string;
  result: string | null;
  completedAt: Date;
}

type BroadcastType = "reading" | "reading-batch" | "alert" | "command-status";
type BroadcastPayload =
  | ReadingPayload
  | ReadingPayload[]
  | AlertPayload
  | CommandStatusPayload;

/**
 * Connect to the API's internal broadcast endpoint
 * In production, this would use Redis pub/sub for horizontal scaling
 */
export async function connectToApi(): Promise<void> {
  const env = getEnv();
  const apiUrl = process.env["API_URL"] || `http://${env.HOST}:${env.PORT}`;

  return new Promise((resolve, reject) => {
    logger.info({ apiUrl }, "Connecting to API for broadcasting");

    socket = io(apiUrl, {
      autoConnect: true,
      reconnection: true,
      reconnectionDelay: 1000,
      reconnectionAttempts: 10,
      // Use internal service token for worker-to-API communication
      auth: {
        token: process.env["INTERNAL_SERVICE_TOKEN"] ?? "",
        isWorker: true,
      },
    });

    socket.on("connect", () => {
      logger.info("Connected to API for broadcasting");
      resolve();
    });

    socket.on("connect_error", (error) => {
      logger.error({ error: error.message }, "Failed to connect to API");
      // Don't reject - we can operate without broadcasting
      resolve();
    });

    socket.on("disconnect", (reason) => {
      logger.warn({ reason }, "Disconnected from API");
    });
  });
}

/**
 * Broadcast an event to the API server
 * The API server will then broadcast to connected clients
 */
export async function broadcastToApi(
  type: BroadcastType,
  payload: BroadcastPayload,
): Promise<void> {
  if (!socket?.connected) {
    logger.debug({ type }, "Cannot broadcast - not connected to API");
    return;
  }

  try {
    socket.emit(`worker:${type}`, payload);
    logger.debug({ type }, "Broadcasted event to API");
  } catch (error) {
    logger.error({ error, type }, "Failed to broadcast to API");
  }
}

/**
 * Disconnect from API
 */
export function disconnectFromApi(): void {
  if (socket) {
    socket.disconnect();
    socket = null;
    logger.info("Disconnected from API broadcaster");
  }
}
````

## File: apps/mqtt-worker/src/index.ts
````typescript
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";
import {
  connectMqtt,
  subscribeToTopics,
  setMessageHandler,
  disconnectMqtt,
} from "./mqtt-client";
import { handleMessage, refreshAllSensorThresholds } from "./ingestion-handler";
import { connectToApi, disconnectFromApi } from "./api-broadcaster";

const logger = createLogger("mqtt-worker");
const THRESHOLD_REFRESH_INTERVAL_MS = 5 * 60 * 1000; // 5 minutes

async function main(): Promise<void> {
  logger.info("Starting MQTT Worker...");

  try {
    getEnv();

    // Connect to API for broadcasting (optional - worker can run without it)
    await connectToApi();

    // Connect to MQTT broker
    await connectMqtt();

    // Set up message handler
    setMessageHandler(handleMessage);

    // Subscribe to all organization sensor topics
    await subscribeToTopics();

    // Periodically refresh sensor thresholds
    await refreshAllSensorThresholds();
    setInterval(refreshAllSensorThresholds, THRESHOLD_REFRESH_INTERVAL_MS);

    logger.info(`✅ MQTT Worker running`);
    logger.info(`📡 Subscribed to sensor topics`);
    logger.info(`🔗 Connected to API for broadcasting`);
  } catch (error) {
    logger.error({ error }, "Failed to start MQTT Worker");
    process.exit(1);
  }
}

// Graceful shutdown
async function shutdown(signal: string): Promise<void> {
  logger.info({ signal }, "Shutting down MQTT Worker...");

  disconnectFromApi();
  await disconnectMqtt();

  logger.info("MQTT Worker stopped");
  process.exit(0);
}

process.on("SIGINT", () => shutdown("SIGINT"));
process.on("SIGTERM", () => shutdown("SIGTERM"));

// Handle uncaught errors
process.on("uncaughtException", (error) => {
  logger.error({ error }, "Uncaught exception");
  process.exit(1);
});

process.on("unhandledRejection", (reason) => {
  logger.error({ reason }, "Unhandled rejection");
  process.exit(1);
});

main();
````

## File: apps/mqtt-worker/src/ingestion-handler.test.ts
````typescript
import { vi, describe, it, expect, beforeEach } from "vitest";

vi.mock("@moondesk/database");
vi.mock("./api-broadcaster");
vi.mock("./parser");

import {
  handleMessage,
  refreshAllSensorThresholds,
  clearThresholdCache,
} from "./ingestion-handler";
import { ReadingRepository, SensorRepository } from "@moondesk/database";
import { broadcastToApi } from "./api-broadcaster";
import { parseMessage, parseTopic } from "./parser";

describe("Ingestion Handler", () => {
  beforeEach(() => {
    vi.resetAllMocks();
    clearThresholdCache();
  });

  describe("handleMessage", () => {
    it('should call handleSingleReading for "readings" action', async () => {
      const readingRepo = new ReadingRepository();
      vi.mocked(parseTopic).mockReturnValue({
        organizationId: "test-org",
        sensorId: 1,
        action: "readings",
      });
      vi.mocked(parseMessage).mockReturnValue({ value: 25, sensorId: 1 });
      vi.mocked(readingRepo.insert).mockResolvedValue({
        id: 1,
        value: 25,
        timestamp: new Date(),
      } as any);

      await handleMessage("org/test-org/sensor/1/readings", Buffer.from(""));

      expect(readingRepo.insert).toHaveBeenCalled();
      expect(broadcastToApi).toHaveBeenCalledWith(
        "reading",
        expect.any(Object),
      );
    });

    it("should handle errors in handleSingleReading gracefully", async () => {
      const readingRepo = new ReadingRepository();
      vi.mocked(parseTopic).mockReturnValue({
        organizationId: "test-org",
        sensorId: 1,
        action: "readings",
      });
      vi.mocked(parseMessage).mockReturnValue({ value: 25, sensorId: 1 });
      vi.mocked(readingRepo.insert).mockRejectedValue(new Error("DB Error"));

      await handleMessage("org/test-org/sensor/1/readings", Buffer.from(""));

      expect(readingRepo.insert).toHaveBeenCalled();
    });
  });

  describe("refreshAllSensorThresholds", () => {
    it("should fetch all sensors and update the cache", async () => {
      const sensorRepo = new SensorRepository();
      const sensors = [
        { id: 1, thresholdLow: 10, thresholdHigh: 30 },
        { id: 2, thresholdLow: null, thresholdHigh: 50 },
      ];
      vi.mocked(sensorRepo.getAllSystemSensors).mockResolvedValue(
        sensors as any,
      );

      await refreshAllSensorThresholds();

      expect(sensorRepo.getAllSystemSensors).toHaveBeenCalled();
    });
  });
});
````

## File: apps/mqtt-worker/src/ingestion-handler.ts
````typescript
import { createLogger } from "@moondesk/logger";
import {
  ReadingRepository,
  SensorRepository,
  AlertRepository,
} from "@moondesk/database";
import {
  AlertSeverity,
  Parameter,
  Protocol,
  ReadingQuality,
} from "@moondesk/domain";
import type { CreateReadingInput, CreateAlertInput } from "@moondesk/domain";
import {
  parseTopic,
  parseMessage,
  type MqttReading,
  type MqttBatch,
  type MqttCommandResponse,
} from "./parser";
import { broadcastToApi } from "./api-broadcaster";

const logger = createLogger("ingestion");

const readingRepository = new ReadingRepository();
const sensorRepository = new SensorRepository();
const alertRepository = new AlertRepository();

// Cache for sensor thresholds (refreshed periodically)
const sensorThresholdCache = new Map<
  number,
  { min: number | null; max: number | null }
>();

/**
 * Main message handler for incoming MQTT messages
 */
export async function handleMessage(
  topic: string,
  payload: Buffer,
): Promise<void> {
  const parsed = parseTopic(topic);
  if (!parsed) {
    logger.warn({ topic }, "Unable to parse topic");
    return;
  }

  const { organizationId, sensorId, action } = parsed;

  switch (action) {
    case "readings":
      try {
        await handleSingleReading(organizationId, sensorId, payload);
      } catch (error) {
        logger.error(
          { error, topic, organizationId, sensorId },
          "Error processing single reading",
        );
      }
      break;
    case "batch":
      try {
        await handleBatchReadings(organizationId, sensorId, payload);
      } catch (error) {
        logger.error(
          { error, topic, organizationId, sensorId },
          "Error processing batch readings",
        );
      }
      break;
    case "command-response":
      try {
        await handleCommandResponse(organizationId, sensorId, payload);
      } catch (error) {
        logger.error(
          { error, topic, organizationId, sensorId },
          "Error processing command response",
        );
      }
      break;
    default:
      logger.debug({ topic, action }, "Unhandled action type");
  }
}

/**
 * Handle a single reading message
 */
async function handleSingleReading(
  organizationId: string,
  sensorId: number,
  payload: Buffer,
): Promise<void> {
  const message = parseMessage(payload, "readings") as MqttReading | null;

  if (!message) {
    logger.warn({ organizationId, sensorId }, "Invalid reading message");
    return;
  }

  const input: CreateReadingInput = {
    sensorId,
    organizationId,
    timestamp: message.timestamp ? new Date(message.timestamp) : new Date(),
    value: message.value,
    parameter: message.parameter ?? Parameter.None,
    protocol: Protocol.Mqtt,
    quality: message.quality ?? ReadingQuality.Good,
    metadata: message.metadata ?? {},
  };

  // Insert reading
  const reading = await readingRepository.insert(input);

  logger.debug({ sensorId, value: reading.value }, "Reading ingested");

  // Check for alert thresholds
  await checkThresholds(organizationId, sensorId, message.value);

  // Broadcast to API via Socket.io
  await broadcastToApi("reading", {
    sensorId,
    assetId: 0, // Would need to lookup
    organizationId,
    timestamp: reading.timestamp,
    value: reading.value,
    parameter: reading.parameter,
    quality: reading.quality,
  });
}

/**
 * Handle a batch of readings
 */
async function handleBatchReadings(
  organizationId: string,
  sensorId: number,
  payload: Buffer,
): Promise<void> {
  const message = parseMessage(payload, "batch") as MqttBatch | null;

  if (!message || !message.readings.length) {
    logger.warn({ organizationId, sensorId }, "Invalid or empty batch message");
    return;
  }

  const inputs: CreateReadingInput[] = message.readings.map(
    (r: MqttReading) => ({
      sensorId: r.sensorId || sensorId,
      organizationId,
      timestamp: r.timestamp ? new Date(r.timestamp) : new Date(),
      value: r.value,
      parameter: r.parameter ?? Parameter.None,
      protocol: Protocol.Mqtt,
      quality: r.quality ?? ReadingQuality.Good,
      metadata: r.metadata ?? {},
    }),
  );

  // Bulk insert readings
  await readingRepository.bulkInsert(inputs);

  logger.info({ sensorId, count: inputs.length }, "Batch readings ingested");

  // Check thresholds for each reading
  for (const input of inputs) {
    await checkThresholds(organizationId, input.sensorId, input.value);
  }

  // Broadcast batch to API
  await broadcastToApi(
    "reading-batch",
    inputs.map((r) => ({
      sensorId: r.sensorId,
      assetId: 0,
      organizationId,
      timestamp: r.timestamp ?? new Date(),
      value: r.value,
      parameter: r.parameter ?? Parameter.None,
      quality: r.quality ?? ReadingQuality.Good,
    })),
  );
}

/**
 * Handle command response from edge device
 */
async function handleCommandResponse(
  organizationId: string,
  sensorId: number,
  payload: Buffer,
): Promise<void> {
  const message = parseMessage(
    payload,
    "command-response",
  ) as MqttCommandResponse | null;

  if (!message) {
    logger.warn({ organizationId, sensorId }, "Invalid command response");
    return;
  }

  // Would update command status in database
  logger.info(
    { sensorId, commandId: message.commandId, status: message.status },
    "Command response received",
  );

  // Broadcast command status update
  await broadcastToApi("command-status", {
    id: message.commandId,
    sensorId,
    organizationId,
    status: message.status,
    result: message.result ?? null,
    completedAt: new Date(),
  });
}

/**
 * Check reading value against thresholds and create alerts if needed
 */
async function checkThresholds(
  organizationId: string,
  sensorId: number,
  value: number,
): Promise<void> {
  // Get cached thresholds or fetch from database
  let thresholds = sensorThresholdCache.get(sensorId);

  if (!thresholds) {
    const sensor = await sensorRepository.getById(sensorId, organizationId);
    if (sensor) {
      thresholds = { min: sensor.thresholdLow, max: sensor.thresholdHigh };
      sensorThresholdCache.set(sensorId, thresholds);
    } else {
      return;
    }
  }

  let alertSeverity: AlertSeverity | null = null;
  let alertMessage = "";
  let thresholdValue: number | null = null;

  if (thresholds.max !== null && value > thresholds.max) {
    alertSeverity = AlertSeverity.Critical;
    alertMessage = `Value ${value} exceeds maximum threshold ${thresholds.max}`;
    thresholdValue = thresholds.max;
  } else if (thresholds.min !== null && value < thresholds.min) {
    alertSeverity = AlertSeverity.Warning;
    alertMessage = `Value ${value} below minimum threshold ${thresholds.min}`;
    thresholdValue = thresholds.min;
  }

  if (alertSeverity) {
    const alertInput: CreateAlertInput = {
      sensorId,
      organizationId,
      severity: alertSeverity,
      message: alertMessage,
      triggerValue: value,
      thresholdValue,
      protocol: Protocol.Mqtt,
      metadata: {},
    };

    const alert = await alertRepository.create(alertInput);

    logger.info(
      { sensorId, alertId: alert.id, severity: alertSeverity },
      "Alert created",
    );

    // Broadcast alert
    await broadcastToApi("alert", {
      id: alert.id,
      sensorId,
      assetId: 0,
      organizationId,
      severity: alert.severity,
      message: alert.message,
      value: alert.triggerValue,
      threshold: alert.thresholdValue ?? 0,
      createdAt: alert.timestamp,
    });
  }
}

/**
 * Refresh threshold cache for all sensors in the system.
 * This should be called periodically.
 */
export async function refreshAllSensorThresholds(): Promise<void> {
  const sensors = await sensorRepository.getAllSystemSensors();
  for (const sensor of sensors) {
    sensorThresholdCache.set(sensor.id, {
      min: sensor.thresholdLow,
      max: sensor.thresholdHigh,
    });
  }
  logger.info({ count: sensors.length }, "Refreshed sensor threshold cache");
}

/**
 * Clear threshold cache
 */
export function clearThresholdCache(): void {
  sensorThresholdCache.clear();
}
````

## File: apps/mqtt-worker/src/mqtt-client.ts
````typescript
import mqtt, { MqttClient, IClientOptions } from "mqtt";
import { createLogger } from "@moondesk/logger";
import { getEnv } from "@moondesk/config";

const logger = createLogger("mqtt-client");

export type MessageHandler = (topic: string, payload: Buffer) => void;

let client: MqttClient | null = null;
let messageHandler: MessageHandler | null = null;

/**
 * Initialize MQTT client connection
 */
export async function connectMqtt(): Promise<MqttClient> {
  const env = getEnv();

  const options: IClientOptions = {
    host: env.MQTT_HOST ?? "localhost",
    port: env.MQTT_PORT ?? 1883,
    username: env.MQTT_USERNAME,
    password: env.MQTT_PASSWORD,
    clientId: `moondesk-worker-${process.pid}`,
    reconnectPeriod: 5000,
    connectTimeout: 30000,
    clean: true,
  };

  return new Promise((resolve, reject) => {
    logger.info(
      { host: options.host, port: options.port },
      "Connecting to MQTT broker",
    );

    client = mqtt.connect(options);

    client.on("connect", () => {
      logger.info("Connected to MQTT broker");
      resolve(client!);
    });

    client.on("error", (error) => {
      logger.error({ error }, "MQTT connection error");
      reject(error);
    });

    client.on("reconnect", () => {
      logger.info("Reconnecting to MQTT broker");
    });

    client.on("offline", () => {
      logger.warn("MQTT client offline");
    });

    client.on("close", () => {
      logger.info("MQTT connection closed");
    });

    client.on("message", (topic, payload) => {
      if (messageHandler) {
        messageHandler(topic, payload);
      }
    });
  });
}

/**
 * Subscribe to organization topics
 */
export async function subscribeToTopics(
  organizationIds?: string[],
): Promise<void> {
  if (!client) {
    throw new Error("MQTT client not connected");
  }

  // Subscribe to all organizations or specific ones
  const topicPattern = organizationIds
    ? organizationIds.map((id) => `moondesk/${id}/sensors/+/#`)
    : ["moondesk/+/sensors/+/#"];

  for (const topic of topicPattern) {
    await new Promise<void>((resolve, reject) => {
      client!.subscribe(topic, { qos: 1 }, (error) => {
        if (error) {
          logger.error({ error, topic }, "Failed to subscribe to topic");
          reject(error);
        } else {
          logger.info({ topic }, "Subscribed to topic");
          resolve();
        }
      });
    });
  }
}

/**
 * Set the message handler for incoming MQTT messages
 */
export function setMessageHandler(handler: MessageHandler): void {
  messageHandler = handler;
}

/**
 * Publish a command to a sensor
 */
export async function publishCommand(
  organizationId: string,
  sensorId: number,
  commandPayload: Record<string, unknown>,
): Promise<void> {
  if (!client) {
    throw new Error("MQTT client not connected");
  }

  const topic = `moondesk/${organizationId}/sensors/${sensorId}/commands`;
  const payload = JSON.stringify(commandPayload);

  await new Promise<void>((resolve, reject) => {
    client!.publish(topic, payload, { qos: 1 }, (error) => {
      if (error) {
        logger.error({ error, topic }, "Failed to publish command");
        reject(error);
      } else {
        logger.debug({ topic, sensorId }, "Published command");
        resolve();
      }
    });
  });
}

/**
 * Disconnect from MQTT broker
 */
export async function disconnectMqtt(): Promise<void> {
  if (client) {
    await new Promise<void>((resolve) => {
      client!.end(false, {}, () => {
        logger.info("Disconnected from MQTT broker");
        resolve();
      });
    });
    client = null;
  }
}

/**
 * Get the MQTT client instance
 */
export function getMqttClient(): MqttClient | null {
  return client;
}
````

## File: apps/mqtt-worker/src/parser.ts
````typescript
import { z } from "zod";
import { Parameter, Protocol, ReadingQuality } from "@moondesk/domain";

/**
 * Expected MQTT message format from edge devices
 * Topic format: moondesk/{organizationId}/sensors/{sensorId}/readings
 */
export const mqttReadingSchema = z.object({
  // Sensor identification
  sensorId: z.number(),

  // Reading data
  value: z.number(),
  timestamp: z.string().datetime().optional(),

  // Optional metadata
  parameter: z.nativeEnum(Parameter).optional(),
  quality: z.nativeEnum(ReadingQuality).optional(),
  metadata: z.record(z.string()).optional(),
});

export type MqttReading = z.infer<typeof mqttReadingSchema>;

/**
 * Batch message for multiple readings
 */
export const mqttBatchSchema = z.object({
  readings: z.array(mqttReadingSchema),
});

export type MqttBatch = z.infer<typeof mqttBatchSchema>;

/**
 * Alert threshold configuration message
 */
export const mqttAlertConfigSchema = z.object({
  sensorId: z.number(),
  minValue: z.number().optional(),
  maxValue: z.number().optional(),
  enabled: z.boolean().default(true),
});

export type MqttAlertConfig = z.infer<typeof mqttAlertConfigSchema>;

/**
 * Command response from edge device
 */
export const mqttCommandResponseSchema = z.object({
  commandId: z.number(),
  status: z.enum(["completed", "failed", "timeout"]),
  result: z.string().optional(),
  error: z.string().optional(),
});

export type MqttCommandResponse = z.infer<typeof mqttCommandResponseSchema>;

/**
 * Parse topic to extract organization and sensor IDs
 * Format: moondesk/{organizationId}/sensors/{sensorId}/{action}
 */
export interface ParsedTopic {
  organizationId: string;
  sensorId: number;
  action: "readings" | "batch" | "status" | "command-response";
}

export function parseTopic(topic: string): ParsedTopic | null {
  const parts = topic.split("/");

  // Expected: moondesk/{orgId}/sensors/{sensorId}/{action}
  if (parts.length < 5 || parts[0] !== "moondesk" || parts[2] !== "sensors") {
    return null;
  }

  const organizationId = parts[1];
  const sensorId = parseInt(parts[3] ?? "", 10);
  const action = parts[4] as ParsedTopic["action"];

  if (!organizationId || isNaN(sensorId)) {
    return null;
  }

  const validActions = ["readings", "batch", "status", "command-response"];
  if (!validActions.includes(action)) {
    return null;
  }

  return { organizationId, sensorId, action };
}

/**
 * Parse and validate MQTT message payload
 */
export function parseMessage(
  payload: Buffer,
  action: ParsedTopic["action"],
): MqttReading | MqttBatch | MqttCommandResponse | null {
  try {
    const data = JSON.parse(payload.toString());

    switch (action) {
      case "readings":
        return mqttReadingSchema.parse(data);
      case "batch":
        return mqttBatchSchema.parse(data);
      case "command-response":
        return mqttCommandResponseSchema.parse(data);
      default:
        return null;
    }
  } catch (error) {
    return null;
  }
}
````

## File: apps/mqtt-worker/package.json
````json
{
  "name": "@moondesk/mqtt-worker",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "tsx watch src/index.ts",
    "build": "tsup",
    "start": "node dist/index.js",
    "check-types": "tsc --noEmit",
    "lint": "eslint src/",
    "test": "vitest run"
  },
  "dependencies": {
    "@moondesk/config": "workspace:*",
    "@moondesk/database": "workspace:*",
    "@moondesk/domain": "workspace:*",
    "@moondesk/logger": "workspace:*",
    "mqtt": "^5.14.1",
    "socket.io-client": "^4.8.1",
    "zod": "^3.24.2"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:^",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "tsup": "^8.5.1",
    "tsx": "^4.19.4",
    "typescript": "5.8.3",
    "vitest": "^2.0.5"
  }
}
````

## File: apps/mqtt-worker/tsup.config.ts
````typescript
import { defineConfig } from "tsup";

export default defineConfig({
  entry: ["src/index.ts"],
  format: ["esm"],
  clean: true,
  outDir: "dist",
  noExternal: [/^@moondesk\/.*/],
  sourcemap: true,
  banner: {
    js: "import { createRequire } from 'module';const require = createRequire(import.meta.url);",
  },
});
````

## File: packages/config/src/app.ts
````typescript
import { z } from "zod";
import { getEnv } from "./env";

const appConfigSchema = z.object({
  isProduction: z.boolean(),
  clerk: z.object({
    secretKey: z.string().optional(),
    publishableKey: z.string().optional(),
  }),
});

let appConfig: z.infer<typeof appConfigSchema> | null = null;

export function getAppConfig() {
  if (appConfig) {
    return appConfig;
  }

  const env = getEnv();
  const isProduction = env.NODE_ENV === "production";

  const clerkSecretKey = env.CLERK_SECRET_KEY;
  const clerkPublishableKey = env.CLERK_PUBLISHABLE_KEY;

  if (isProduction && (!clerkSecretKey || !clerkPublishableKey)) {
    throw new Error(
      "CLERK_SECRET_KEY and CLERK_PUBLISHABLE_KEY are required in production",
    );
  }

  appConfig = {
    isProduction,
    clerk: {
      secretKey: clerkSecretKey,
      publishableKey: clerkPublishableKey,
    },
  };

  return appConfig;
}
````

## File: packages/config/src/database.ts
````typescript
import { getEnv } from "./env";

/**
 * Database configuration
 */
export function getDatabaseConfig() {
  const env = getEnv();

  return {
    connectionString: env.DATABASE_URL,
    pool: {
      max: 20,
      idleTimeoutMillis: 30000,
      connectionTimeoutMillis: 5000,
    },
  };
}
````

## File: packages/config/src/env.ts
````typescript
import { z } from "zod";
import "dotenv/config";

/**
 * Environment variable schema with validation
 */
const envSchema = z
  .object({
    // Node environment
    NODE_ENV: z
      .enum(["development", "production", "test"])
      .default("development"),

    // Server
    PORT: z.string().transform(Number).default("5008"),
    HOST: z.string().default("0.0.0.0"),

    // Database
    DATABASE_URL: z.string().min(1, "DATABASE_URL is required"),

    // Clerk authentication
    CLERK_SECRET_KEY: z.string().optional(),
    CLERK_PUBLISHABLE_KEY: z.string().optional(),
    CLERK_WEBHOOK_SECRET: z.string().optional(),

    // MQTT
    MQTT_HOST: z.string().optional(),
    MQTT_PORT: z.string().transform(Number).optional(),
    MQTT_USERNAME: z.string().optional(),
    MQTT_PASSWORD: z.string().optional(),

    // Encryption
    ENCRYPTION_KEY: z.string().min(32).optional(),
    INTERNAL_SERVICE_TOKEN: z.string().optional(),

    // Logging
    LOG_LEVEL: z.enum(["debug", "info", "warn", "error"]).default("info"),
  })
  .transform((env) => ({
    ...env,
    isProduction: env.NODE_ENV === "production",
  }));

export type Env = z.infer<typeof envSchema>;

let env: Env | null = null;

/**
 * Get validated environment variables
 * @throws Error if validation fails
 */
export function getEnv(): Env {
  if (!env) {
    const result = envSchema.safeParse(process.env);

    if (!result.success) {
      console.error("❌ Invalid environment variables:");
      console.error(result.error.format());
      throw new Error("Invalid environment variables");
    }

    env = result.data;
  }

  return env;
}
````

## File: packages/config/src/index.ts
````typescript
// @moondesk/config - Shared configuration

export { getEnv, type Env } from "./env";
export { getAppConfig } from "./app";
export { getDatabaseConfig } from "./database";
export { getMqttConfig } from "./mqtt";
````

## File: packages/config/src/mqtt.ts
````typescript
import { getEnv } from "./env";

/**
 * MQTT configuration
 */
export function getMqttConfig() {
  const env = getEnv();

  return {
    host: env.MQTT_HOST ?? "localhost",
    port: env.MQTT_PORT ?? 1883,
    username: env.MQTT_USERNAME,
    password: env.MQTT_PASSWORD,
    clientIdPrefix: "moondesk-",
    topics: {
      telemetry: "+/+/telemetry", // {org_id}/{device_id}/telemetry
      commands: "+/+/cmd", // {org_id}/{device_id}/cmd
    },
  };
}
````

## File: packages/config/package.json
````json
{
    "name": "@moondesk/config",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "main": "./src/index.ts",
    "types": "./src/index.ts",
    "exports": {
        ".": {
            "types": "./src/index.ts",
            "default": "./src/index.ts"
        }
    },
    "scripts": {
        "check-types": "tsc --noEmit",
        "lint": "eslint src/"
    },
    "dependencies": {
        "dotenv": "^17.2.3",
        "zod": "^3.24.2"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:*",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "eslint": "^9.15.0",
        "typescript": "5.9.2"
    }
}
````

## File: packages/config/README.md
````markdown
# @moondesk/config

This package provides a centralized and validated way to manage configuration and environment variables across the Moondesk monorepo. It uses Zod for schema validation to ensure that all services start with a valid configuration, preventing runtime errors due to missing or invalid environment variables.

## Core Concepts

The configuration is split into multiple files, each responsible for a specific domain:

- `env.ts`: Handles base environment variables, such as `NODE_ENV`, `PORT`, and `DATABASE_URL`. It also exports a `isProduction` flag for environment-specific logic.
- `app.ts`: Manages application-level configurations, such as Clerk keys. It ensures that required variables are present in production environments.
- `database.ts`: Provides the database connection configuration.
- `mqtt.ts`: Provides the MQTT connection configuration.

## Usage

To access configuration variables, import the appropriate getter function from this package.

### Environment Variables

The `getEnv()` function returns a validated object with the base environment variables.

```typescript
import { getEnv } from "@moondesk/config";

const env = getEnv();

console.log("Node environment:", env.NODE_ENV);
console.log("Is production:", env.isProduction);
```

### Application Configuration

The `getAppConfig()` function returns application-specific configurations, such as Clerk keys.

```typescript
import { getAppConfig } from "@moondesk/config";

const appConfig = getAppConfig();

if (appConfig.isProduction) {
  console.log("Clerk Secret Key:", appConfig.clerk.secretKey);
}
```

## Validation

The environment variable schemas are defined using Zod. If any required environment variables are missing or invalid, the application will throw an error on startup, preventing it from running with an invalid configuration.

## Adding New Configuration

To add new configuration variables, follow these steps:

1.  **Determine the scope**: Decide whether the variable belongs in `env.ts` (base environment), `app.ts` (application-level), or a new domain-specific file.
2.  **Update the schema**: Add the new variable to the Zod schema in the appropriate file.
3.  **Update the getter function**: If necessary, update the corresponding getter function to include the new variable.
4.  **Access the variable**: Import the getter function in the service that requires the new variable.
````

## File: packages/database/src/repositories/alert.repository.ts
````typescript
import { eq, and, desc, gte, lte, sql } from "drizzle-orm";
import type {
  Alert,
  CreateAlertInput,
  AcknowledgeAlertInput,
  AlertQueryParams,
  IAlertRepository,
  AlertStats,
} from "@moondesk/domain";
import { getDb } from "../client";
import { alerts } from "../schema/index";
import type { AlertSeverity, Protocol } from "@moondesk/domain";

/**
 * Alert repository implementation using Drizzle ORM
 */
export class AlertRepository implements IAlertRepository {
  private db = getDb();

  async getAll(organizationId: string, limit = 100): Promise<Alert[]> {
    const results = await this.db
      .select()
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId))
      .orderBy(desc(alerts.timestamp))
      .limit(limit);

    return results.map(this.mapToAlert);
  }

  async getStats(organizationId: string): Promise<AlertStats> {
    // Total count
    const totalResult = await this.db
      .select({ count: sql<number>`count(*)` })
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId));
    const total = Number(totalResult[0]?.count ?? 0);

    // Group by severity
    const bySeverityResult = await this.db
      .select({
        severity: alerts.severity,
        count: sql<number>`count(*)`,
      })
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId))
      .groupBy(alerts.severity);

    const bySeverity: Record<AlertSeverity, number> = {
      info: 0,
      warning: 0,
      critical: 0,
      emergency: 0,
    };

    bySeverityResult.forEach((row) => {
      if (row.severity) {
        bySeverity[row.severity as AlertSeverity] = Number(row.count);
      }
    });

    // Group by acknowledged
    const byStatusResult = await this.db
      .select({
        acknowledged: alerts.acknowledged,
        count: sql<number>`count(*)`,
      })
      .from(alerts)
      .where(eq(alerts.organizationId, organizationId))
      .groupBy(alerts.acknowledged);

    const byStatus = {
      acknowledged: 0,
      unacknowledged: 0,
    };

    byStatusResult.forEach((row) => {
      if (row.acknowledged) {
        byStatus.acknowledged = Number(row.count);
      } else {
        byStatus.unacknowledged = Number(row.count);
      }
    });

    // Recent trend (last 7 days)
    const sevenDaysAgo = new Date();
    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

    const trendResult = await this.db
      .select({
        date: sql<string>`to_char(${alerts.timestamp}, 'YYYY-MM-DD')`,
        severity: alerts.severity,
        count: sql<number>`count(*)`,
      })
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          gte(alerts.timestamp, sevenDaysAgo),
        ),
      )
      .groupBy(sql`to_char(${alerts.timestamp}, 'YYYY-MM-DD')`, alerts.severity)
      .orderBy(sql`to_char(${alerts.timestamp}, 'YYYY-MM-DD')`);

    const recentTrend = trendResult.map((row) => ({
      date: row.date!, // Assuming date is never null due to grouping
      count: Number(row.count),
      severity: row.severity as AlertSeverity,
    }));

    // Calculate trends based on real DB data
    // Group recentTrend by date to get daily totals
    const dailyTotals: Record<string, number> = {};
    const criticalDailyTotals: Record<string, number> = {};

    recentTrend.forEach((item) => {
      dailyTotals[item.date] = (dailyTotals[item.date] || 0) + item.count;
      if (item.severity === "critical" || item.severity === "emergency") {
        criticalDailyTotals[item.date] =
          (criticalDailyTotals[item.date] || 0) + item.count;
      }
    });

    const dates = Object.keys(dailyTotals).sort();
    const lastDate = dates[dates.length - 1]; // Most recent day (today/yesterday)
    const prevDate = dates[dates.length - 2]; // The day before

    // Helper to calculate percentage change
    const calcTrend = (now: number, before: number) => {
      if (before === 0) return now > 0 ? 100 : 0;
      return Math.round(((now - before) / before) * 100);
    };

    const dailyTrend = calcTrend(
      lastDate ? (dailyTotals[lastDate] ?? 0) : 0,
      prevDate ? (dailyTotals[prevDate] ?? 0) : 0,
    );

    const criticalTrend = calcTrend(
      lastDate ? criticalDailyTotals[lastDate] || 0 : 0,
      prevDate ? criticalDailyTotals[prevDate] || 0 : 0,
    );

    // Calculate weekly trend
    const now = new Date();
    const oneWeekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
    const twoWeeksAgo = new Date(now.getTime() - 14 * 24 * 60 * 60 * 1000);

    const currentWeekCountResult = await this.db
      .select({ count: sql<number>`count(*)` })
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          gte(alerts.timestamp, oneWeekAgo),
        ),
      );
    const currentWeekCount = Number(currentWeekCountResult[0]?.count ?? 0);

    const previousWeekCountResult = await this.db
      .select({ count: sql<number>`count(*)` })
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          gte(alerts.timestamp, twoWeeksAgo),
          lte(alerts.timestamp, oneWeekAgo),
        ),
      );
    const previousWeekCount = Number(previousWeekCountResult[0]?.count ?? 0);

    const weeklyTrend = calcTrend(currentWeekCount, previousWeekCount);

    return {
      total,
      bySeverity,
      byStatus,
      trends: {
        daily: dailyTrend,
        weekly: weeklyTrend,
        critical: criticalTrend,
      },
      recentTrend,
    };
  }

  async query(params: AlertQueryParams): Promise<Alert[]> {
    let query = this.db
      .select()
      .from(alerts)
      .where(eq(alerts.organizationId, params.organizationId))
      .$dynamic();

    if (params.sensorId !== undefined) {
      query = query.where(eq(alerts.sensorId, params.sensorId));
    }
    if (params.severity !== undefined) {
      query = query.where(eq(alerts.severity, params.severity));
    }
    if (params.acknowledged !== undefined) {
      query = query.where(eq(alerts.acknowledged, params.acknowledged));
    }
    if (params.startTime !== undefined) {
      query = query.where(gte(alerts.timestamp, params.startTime));
    }
    if (params.endTime !== undefined) {
      query = query.where(lte(alerts.timestamp, params.endTime));
    }

    const results = await query
      .orderBy(desc(alerts.timestamp))
      .limit(params.limit ?? 100);

    return results.map(this.mapToAlert);
  }

  async getById(id: number, organizationId: string): Promise<Alert | null> {
    const results = await this.db
      .select()
      .from(alerts)
      .where(and(eq(alerts.id, id), eq(alerts.organizationId, organizationId)))
      .limit(1);

    return results[0] ? this.mapToAlert(results[0]) : null;
  }

  async getUnacknowledged(organizationId: string): Promise<Alert[]> {
    const results = await this.db
      .select()
      .from(alerts)
      .where(
        and(
          eq(alerts.organizationId, organizationId),
          eq(alerts.acknowledged, false),
        ),
      )
      .orderBy(desc(alerts.timestamp));

    return results.map(this.mapToAlert);
  }

  async create(input: CreateAlertInput): Promise<Alert> {
    const results = await this.db
      .insert(alerts)
      .values({
        sensorId: input.sensorId,
        organizationId: input.organizationId,
        severity: input.severity,
        message: input.message,
        triggerValue: input.triggerValue,
        thresholdValue: input.thresholdValue,
        protocol: input.protocol,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToAlert(results[0]!);
  }

  async acknowledge(
    id: number,
    organizationId: string,
    input: AcknowledgeAlertInput,
  ): Promise<Alert | null> {
    const results = await this.db
      .update(alerts)
      .set({
        acknowledged: true,
        acknowledgedAt: new Date(),
        acknowledgedBy: input.acknowledgedBy,
        notes: input.notes,
      })
      .where(and(eq(alerts.id, id), eq(alerts.organizationId, organizationId)))
      .returning();

    return results[0] ? this.mapToAlert(results[0]) : null;
  }

  private mapToAlert(record: typeof alerts.$inferSelect): Alert {
    return {
      id: record.id,
      sensorId: record.sensorId,
      organizationId: record.organizationId,
      timestamp: record.timestamp,
      severity: record.severity as AlertSeverity,
      message: record.message,
      triggerValue: record.triggerValue,
      thresholdValue: record.thresholdValue,
      acknowledged: record.acknowledged,
      acknowledgedAt: record.acknowledgedAt,
      acknowledgedBy: record.acknowledgedBy,
      notes: record.notes,
      protocol: record.protocol as Protocol,
      metadata: record.metadata ?? {},
    };
  }
}
````

## File: packages/database/src/repositories/command.repository.ts
````typescript
import { eq, and, desc } from "drizzle-orm";
import type {
  Command,
  CreateCommandInput,
  UpdateCommandStatusInput,
  ICommandRepository,
} from "@moondesk/domain";
import { CommandStatus } from "@moondesk/domain";
import { getDb } from "../client";
import { commands } from "../schema/index";
import type { Protocol } from "@moondesk/domain";

/**
 * Command repository implementation using Drizzle ORM
 */
export class CommandRepository implements ICommandRepository {
  private db = getDb();

  async getAll(organizationId: string, limit = 100): Promise<Command[]> {
    const results = await this.db
      .select()
      .from(commands)
      .where(eq(commands.organizationId, organizationId))
      .orderBy(desc(commands.createdAt))
      .limit(limit);

    return results.map(this.mapToCommand);
  }

  async getBySensorId(
    sensorId: number,
    organizationId: string,
  ): Promise<Command[]> {
    const results = await this.db
      .select()
      .from(commands)
      .where(
        and(
          eq(commands.sensorId, sensorId),
          eq(commands.organizationId, organizationId),
        ),
      )
      .orderBy(desc(commands.createdAt));

    return results.map(this.mapToCommand);
  }

  async getById(id: number, organizationId: string): Promise<Command | null> {
    const results = await this.db
      .select()
      .from(commands)
      .where(
        and(eq(commands.id, id), eq(commands.organizationId, organizationId)),
      )
      .limit(1);

    return results[0] ? this.mapToCommand(results[0]) : null;
  }

  async getPending(organizationId: string): Promise<Command[]> {
    const results = await this.db
      .select()
      .from(commands)
      .where(
        and(
          eq(commands.organizationId, organizationId),
          eq(commands.status, CommandStatus.Pending),
        ),
      )
      .orderBy(desc(commands.createdAt));

    return results.map(this.mapToCommand);
  }

  async create(input: CreateCommandInput): Promise<Command> {
    const results = await this.db
      .insert(commands)
      .values({
        sensorId: input.sensorId,
        organizationId: input.organizationId,
        userId: input.userId,
        action: input.action,
        parameters: input.parameters ?? {},
        status: CommandStatus.Pending,
        protocol: input.protocol,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToCommand(results[0]!);
  }

  async updateStatus(
    id: number,
    organizationId: string,
    input: UpdateCommandStatusInput,
  ): Promise<Command | null> {
    const updateData: Record<string, unknown> = {
      status: input.status,
    };

    if (input.status === CommandStatus.Sent) {
      updateData["sentAt"] = new Date();
    } else if (
      input.status === CommandStatus.Completed ||
      input.status === CommandStatus.Failed
    ) {
      updateData["completedAt"] = new Date();
      if (input.errorMessage) {
        updateData["errorMessage"] = input.errorMessage;
      }
    }

    const results = await this.db
      .update(commands)
      .set(updateData)
      .where(
        and(eq(commands.id, id), eq(commands.organizationId, organizationId)),
      )
      .returning();

    return results[0] ? this.mapToCommand(results[0]) : null;
  }

  private mapToCommand(record: typeof commands.$inferSelect): Command {
    return {
      id: record.id,
      sensorId: record.sensorId,
      organizationId: record.organizationId,
      userId: record.userId,
      action: record.action,
      parameters: (record.parameters as Record<string, unknown>) ?? {},
      status: record.status as import("@moondesk/domain").CommandStatus,
      protocol: record.protocol as Protocol,
      createdAt: record.createdAt,
      sentAt: record.sentAt,
      completedAt: record.completedAt,
      errorMessage: record.errorMessage,
      metadata: record.metadata ?? {},
    };
  }
}
````

## File: packages/database/src/repositories/connection-credential.repository.ts
````typescript
import { eq, and, desc } from "drizzle-orm";
import type {
  ConnectionCredential,
  UpdateCredentialInput,
  IConnectionCredentialRepository,
} from "@moondesk/domain";
import type { Protocol } from "@moondesk/domain";
import { getDb } from "../client";
import { connectionCredentials } from "../schema/index";

/**
 * Internal create input type with already-encrypted password
 * The encryption is handled by the service layer before calling the repository
 */
export interface CreateCredentialDbInput {
  organizationId: string;
  name: string;
  protocol: Protocol;
  endpointUri: string;
  username: string;
  encryptedPassword: string;
  encryptionIV: string;
  clientId?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Internal update input type with optional encrypted password
 */
export interface UpdateCredentialDbInput {
  name?: string;
  endpointUri?: string;
  username?: string;
  encryptedPassword?: string;
  encryptionIV?: string;
  clientId?: string | null;
  isActive?: boolean;
  metadata?: Record<string, string>;
}

/**
 * ConnectionCredential repository implementation using Drizzle ORM
 * Note: This repository expects already-encrypted password data.
 * Use the CredentialService to handle encryption before calling create/update.
 */
export class ConnectionCredentialRepository implements Omit<
  IConnectionCredentialRepository,
  "create" | "update"
> {
  private db = getDb();

  async getAll(organizationId: string): Promise<ConnectionCredential[]> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(eq(connectionCredentials.organizationId, organizationId))
      .orderBy(desc(connectionCredentials.createdAt));

    return results.map(this.mapToCredential);
  }

  async getByProtocol(
    protocol: Protocol,
    organizationId: string,
  ): Promise<ConnectionCredential[]> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.organizationId, organizationId),
          eq(connectionCredentials.protocol, protocol),
        ),
      )
      .orderBy(desc(connectionCredentials.createdAt));

    return results.map(this.mapToCredential);
  }

  async getById(
    id: number,
    organizationId: string,
  ): Promise<ConnectionCredential | null> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.id, id),
          eq(connectionCredentials.organizationId, organizationId),
        ),
      )
      .limit(1);

    return results[0] ? this.mapToCredential(results[0]) : null;
  }

  async getActive(organizationId: string): Promise<ConnectionCredential[]> {
    const results = await this.db
      .select()
      .from(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.organizationId, organizationId),
          eq(connectionCredentials.isActive, true),
        ),
      )
      .orderBy(desc(connectionCredentials.createdAt));

    return results.map(this.mapToCredential);
  }

  async create(input: CreateCredentialDbInput): Promise<ConnectionCredential> {
    const results = await this.db
      .insert(connectionCredentials)
      .values({
        organizationId: input.organizationId,
        name: input.name,
        protocol: input.protocol,
        endpointUri: input.endpointUri,
        username: input.username,
        encryptedPassword: input.encryptedPassword,
        encryptionIV: input.encryptionIV,
        clientId: input.clientId,
        isActive: true,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToCredential(results[0]!);
  }

  async update(
    id: number,
    organizationId: string,
    input: UpdateCredentialDbInput,
  ): Promise<ConnectionCredential | null> {
    const updateData: Record<string, unknown> = { updatedAt: new Date() };

    if (input.name !== undefined) updateData["name"] = input.name;
    if (input.endpointUri !== undefined)
      updateData["endpointUri"] = input.endpointUri;
    if (input.username !== undefined) updateData["username"] = input.username;
    if (input.encryptedPassword !== undefined)
      updateData["encryptedPassword"] = input.encryptedPassword;
    if (input.encryptionIV !== undefined)
      updateData["encryptionIV"] = input.encryptionIV;
    if (input.clientId !== undefined) updateData["clientId"] = input.clientId;
    if (input.isActive !== undefined) updateData["isActive"] = input.isActive;
    if (input.metadata !== undefined) updateData["metadata"] = input.metadata;

    const results = await this.db
      .update(connectionCredentials)
      .set(updateData)
      .where(
        and(
          eq(connectionCredentials.id, id),
          eq(connectionCredentials.organizationId, organizationId),
        ),
      )
      .returning();

    return results[0] ? this.mapToCredential(results[0]) : null;
  }

  async delete(id: number, organizationId: string): Promise<boolean> {
    const result = await this.db
      .delete(connectionCredentials)
      .where(
        and(
          eq(connectionCredentials.id, id),
          eq(connectionCredentials.organizationId, organizationId),
        ),
      )
      .returning({ id: connectionCredentials.id });

    return result.length > 0;
  }

  private mapToCredential(
    record: typeof connectionCredentials.$inferSelect,
  ): ConnectionCredential {
    return {
      id: record.id,
      organizationId: record.organizationId,
      name: record.name,
      protocol: record.protocol as Protocol,
      endpointUri: record.endpointUri,
      username: record.username,
      encryptedPassword: record.encryptedPassword,
      encryptionIV: record.encryptionIV,
      clientId: record.clientId,
      isActive: record.isActive,
      metadata: record.metadata ?? {},
      createdAt: record.createdAt,
      updatedAt: record.updatedAt,
    };
  }
}
````

## File: packages/database/src/repositories/index.ts
````typescript
// Repositories barrel export
export { AssetRepository } from "./asset.repository";
export { SensorRepository } from "./sensor.repository";
export { ReadingRepository } from "./reading.repository";
export { AlertRepository } from "./alert.repository";
export { CommandRepository } from "./command.repository";
export { UserRepository } from "./user.repository";
export {
  OrganizationRepository,
  OrganizationMembershipRepository,
} from "./organization.repository";
export {
  ConnectionCredentialRepository,
  type CreateCredentialDbInput,
  type UpdateCredentialDbInput,
} from "./connection-credential.repository";

// Re-export repository interfaces from domain
export type {
  IAssetRepository,
  ISensorRepository,
  IReadingRepository,
  IAlertRepository,
  ICommandRepository,
  IUserRepository,
  IOrganizationRepository,
  IOrganizationMembershipRepository,
  IConnectionCredentialRepository,
} from "@moondesk/domain";
````

## File: packages/database/src/repositories/organization.repository.ts
````typescript
import { eq, and } from "drizzle-orm";
import type {
  Organization,
  OrganizationMembership,
  UpsertOrganizationInput,
  UpsertMembershipInput,
  IOrganizationRepository,
  IOrganizationMembershipRepository,
} from "@moondesk/domain";
import type { UserRole } from "@moondesk/domain";
import { getDb } from "../client";
import { organizations, organizationMemberships } from "../schema/index";

/**
 * Organization repository implementation using Drizzle ORM
 */
export class OrganizationRepository implements IOrganizationRepository {
  private db = getDb();

  async getById(id: string): Promise<Organization | null> {
    const results = await this.db
      .select()
      .from(organizations)
      .where(eq(organizations.id, id))
      .limit(1);

    return results[0] ? this.mapToOrganization(results[0]) : null;
  }

  async getAll(): Promise<Organization[]> {
    const results = await this.db.select().from(organizations);

    return results.map(this.mapToOrganization);
  }

  async upsert(input: UpsertOrganizationInput): Promise<Organization> {
    const results = await this.db
      .insert(organizations)
      .values({
        id: input.id,
        name: input.name,
        slug: input.slug,
        imageUrl: input.imageUrl,
        ownerId: input.ownerId,
      })
      .onConflictDoUpdate({
        target: organizations.id,
        set: {
          name: input.name,
          slug: input.slug,
          imageUrl: input.imageUrl,
          ownerId: input.ownerId,
          updatedAt: new Date(),
        },
      })
      .returning();

    return this.mapToOrganization(results[0]!);
  }

  async delete(id: string): Promise<boolean> {
    const result = await this.db
      .delete(organizations)
      .where(eq(organizations.id, id))
      .returning({ id: organizations.id });

    return result.length > 0;
  }

  private mapToOrganization(
    record: typeof organizations.$inferSelect,
  ): Organization {
    return {
      id: record.id,
      name: record.name,
      slug: record.slug,
      imageUrl: record.imageUrl,
      ownerId: record.ownerId,
      createdAt: record.createdAt,
      updatedAt: record.updatedAt,
    };
  }
}

/**
 * OrganizationMembership repository implementation using Drizzle ORM
 */
export class OrganizationMembershipRepository implements IOrganizationMembershipRepository {
  private db = getDb();

  async getByUserId(userId: string): Promise<OrganizationMembership[]> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(eq(organizationMemberships.userId, userId));

    return results.map(this.mapToMembership);
  }

  async getByOrganizationId(
    organizationId: string,
  ): Promise<OrganizationMembership[]> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(eq(organizationMemberships.organizationId, organizationId));

    return results.map(this.mapToMembership);
  }

  async isMember(userId: string, organizationId: string): Promise<boolean> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(
        and(
          eq(organizationMemberships.userId, userId),
          eq(organizationMemberships.organizationId, organizationId),
        ),
      )
      .limit(1);

    return results.length > 0;
  }

  async getByUserAndOrg(
    userId: string,
    organizationId: string,
  ): Promise<OrganizationMembership | null> {
    const results = await this.db
      .select()
      .from(organizationMemberships)
      .where(
        and(
          eq(organizationMemberships.userId, userId),
          eq(organizationMemberships.organizationId, organizationId),
        ),
      )
      .limit(1);

    return results[0] ? this.mapToMembership(results[0]) : null;
  }

  async upsert(input: UpsertMembershipInput): Promise<OrganizationMembership> {
    const results = await this.db
      .insert(organizationMemberships)
      .values({
        userId: input.userId,
        organizationId: input.organizationId,
        role: input.role,
      })
      .onConflictDoUpdate({
        target: [
          organizationMemberships.userId,
          organizationMemberships.organizationId,
        ],
        set: {
          role: input.role,
        },
      })
      .returning();

    return this.mapToMembership(results[0]!);
  }

  async delete(userId: string, organizationId: string): Promise<boolean> {
    const result = await this.db
      .delete(organizationMemberships)
      .where(
        and(
          eq(organizationMemberships.userId, userId),
          eq(organizationMemberships.organizationId, organizationId),
        ),
      )
      .returning({
        userId: organizationMemberships.userId,
      });

    return result.length > 0;
  }

  private mapToMembership(
    record: typeof organizationMemberships.$inferSelect,
  ): OrganizationMembership {
    return {
      userId: record.userId,
      organizationId: record.organizationId,
      role: record.role as UserRole,
      createdAt: record.createdAt,
    };
  }
}
````

## File: packages/database/src/repositories/reading.repository.ts
````typescript
import { eq, and, desc, sql } from "drizzle-orm";
import type {
  Reading,
  CreateReadingInput,
  ReadingQueryParams,
  AggregatedReading,
} from "@moondesk/domain";
import type { IReadingRepository } from "@moondesk/domain";
import { getDb } from "../client";
import { readings } from "../schema/index";
import {
  Parameter,
  Protocol,
  ReadingQuality,
  ReadingStats,
} from "@moondesk/domain";

/**
 * Reading repository implementation optimized for time-series data
 */
export class ReadingRepository implements IReadingRepository {
  private db = getDb();

  async getRecent(
    organizationId: string,
    sensorId: number,
    limit = 100,
  ): Promise<Reading[]> {
    const results = await this.db
      .select()
      .from(readings)
      .where(
        and(
          eq(readings.organizationId, organizationId),
          eq(readings.sensorId, sensorId),
        ),
      )
      .orderBy(desc(readings.timestamp))
      .limit(limit);

    return results.map(this.mapToReading);
  }

  async query(params: ReadingQueryParams): Promise<Reading[]> {
    // Build dynamic query based on params
    let query = this.db
      .select()
      .from(readings)
      .where(eq(readings.organizationId, params.organizationId))
      .$dynamic();

    // Note: For production, would add more sophisticated filtering
    // This is simplified for initial implementation
    const results = await query
      .orderBy(desc(readings.timestamp))
      .limit(params.limit ?? 1000);

    return results.map(this.mapToReading);
  }

  async getAggregated(
    params: ReadingQueryParams,
  ): Promise<AggregatedReading[]> {
    // TimescaleDB time_bucket aggregation would go here
    // For now, return empty array - requires raw SQL for time_bucket
    console.warn(
      "getAggregated requires TimescaleDB time_bucket - not yet implemented",
    );
    return [];
  }

  async getLatestBySensor(
    organizationId: string,
    sensorIds: number[],
  ): Promise<Map<number, Reading>> {
    const result = new Map<number, Reading>();

    // Get latest reading for each sensor
    // This could be optimized with a window function in production
    for (const sensorId of sensorIds) {
      const latest = await this.db
        .select()
        .from(readings)
        .where(
          and(
            eq(readings.organizationId, organizationId),
            eq(readings.sensorId, sensorId),
          ),
        )
        .orderBy(desc(readings.timestamp))
        .limit(1);

      if (latest[0]) {
        result.set(sensorId, this.mapToReading(latest[0]));
      }
    }

    return result;
  }

  async bulkInsert(inputs: CreateReadingInput[]): Promise<void> {
    if (inputs.length === 0) return;

    const values = inputs.map((input) => ({
      sensorId: input.sensorId,
      organizationId: input.organizationId,
      timestamp: input.timestamp ?? new Date(),
      value: input.value,
      parameter: input.parameter ?? Parameter.None,
      protocol: input.protocol ?? Protocol.Mqtt,
      quality: input.quality ?? ReadingQuality.Good,
      notes: input.notes,
      metadata: input.metadata ?? {},
    }));

    await this.db.insert(readings).values(values);
  }

  async insert(input: CreateReadingInput): Promise<Reading> {
    const results = await this.db
      .insert(readings)
      .values({
        sensorId: input.sensorId,
        organizationId: input.organizationId,
        timestamp: input.timestamp ?? new Date(),
        value: input.value,
        parameter: input.parameter ?? Parameter.None,
        protocol: input.protocol ?? Protocol.Mqtt,
        quality: input.quality ?? ReadingQuality.Good,
        notes: input.notes,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToReading(results[0]!);
  }

  private mapToReading(record: typeof readings.$inferSelect): Reading {
    return {
      sensorId: record.sensorId,
      organizationId: record.organizationId,
      timestamp: record.timestamp,
      value: record.value,
      parameter: record.parameter as import("@moondesk/domain").Parameter,
      protocol: record.protocol as import("@moondesk/domain").Protocol,
      quality: record.quality as import("@moondesk/domain").ReadingQuality,
      notes: record.notes,
      metadata: record.metadata ?? {},
    };
  }

  async getStats(organizationId: string): Promise<ReadingStats> {
    // Query 1: Total count
    // Note: Using Drizzle's `sql` operator for raw queries
    const totalResult = await this.db.execute(
      sql`SELECT count(*) as count FROM ${readings} WHERE ${readings.organizationId} = ${organizationId}`,
    );
    const total = Number(totalResult.rows[0]?.count || 0);

    // Query 2: Daily trend for last 7 days
    // Using TimescaleDB time_bucket
    const trendResult = this.db.execute(
      sql`
                SELECT time_bucket('1 day', ${readings.timestamp}) AS bucket, count(*) 
                FROM ${readings} 
                WHERE ${readings.organizationId} = ${organizationId} 
                AND ${readings.timestamp} > NOW() - INTERVAL '7 days' 
                GROUP BY bucket 
                ORDER BY bucket ASC
            `,
    );

    const trends = (await trendResult).rows.map((row: any) => ({
      bucket: new Date(row.bucket).toISOString(),
      count: Number(row.count),
    }));

    // Calculate dailyTrend
    let dailyTrend = 0;
    if (trends.length >= 2) {
      const last = trends[trends.length - 1]!.count;
      const prev = trends[trends.length - 2]!.count;
      if (prev > 0) {
        dailyTrend = Math.round(((last - prev) / prev) * 100);
      } else if (last > 0) {
        dailyTrend = 100;
      }
    }

    // Query 3: Quality Score (percentage of 'good' readings)
    const qualityResult = await this.db.execute(
      sql`SELECT count(*) as count FROM ${readings} WHERE ${readings.organizationId} = ${organizationId} AND ${readings.quality} = 'good'`,
    );
    const goodCount = Number(qualityResult.rows[0]?.count || 0);
    const qualityScore =
      total > 0 ? Math.round((goodCount / total) * 100) : 100;

    return { total, dailyTrend, qualityScore, trends };
  }
}
````

## File: packages/database/src/repositories/sensor.repository.ts
````typescript
import { eq, and, desc, getTableColumns } from "drizzle-orm";
import type {
  Sensor,
  CreateSensorInput,
  UpdateSensorInput,
  ISensorRepository,
} from "@moondesk/domain";
import { getDb } from "../client";
import { assets, sensors } from "../schema/index";
import type { SensorType, Parameter, Protocol } from "@moondesk/domain";

/**
 * Sensor repository implementation using Drizzle ORM
 */
export class SensorRepository implements ISensorRepository {
  private db = getDb();
  private fullSensor = {
    ...getTableColumns(sensors),
    organizationId: assets.organizationId,
  };

  async getAll(organizationId: string): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(eq(assets.organizationId, organizationId))
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async getAllSystemSensors(): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async getByAssetId(
    assetId: number,
    organizationId: string,
  ): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(
        and(
          eq(sensors.assetId, assetId),
          eq(assets.organizationId, organizationId),
        ),
      )
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async getById(id: number, organizationId: string): Promise<Sensor | null> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(and(eq(sensors.id, id), eq(assets.organizationId, organizationId)))
      .limit(1);

    return results[0] ? this.mapToSensor(results[0]) : null;
  }

  async getActive(organizationId: string): Promise<Sensor[]> {
    const results = await this.db
      .select(this.fullSensor)
      .from(sensors)
      .innerJoin(assets, eq(sensors.assetId, assets.id))
      .where(
        and(
          eq(assets.organizationId, organizationId),
          eq(sensors.isActive, true),
        ),
      )
      .orderBy(desc(sensors.createdAt));

    return results.map(this.mapToSensor);
  }

  async create(input: CreateSensorInput): Promise<Sensor> {
    const asset = await this.db.query.assets.findFirst({
      where: and(
        eq(assets.id, input.assetId),
        eq(assets.organizationId, input.organizationId),
      ),
    });

    if (!asset) {
      throw new Error("Asset not found or does not belong to the organization");
    }

    const results = await this.db
      .insert(sensors)
      .values({
        assetId: input.assetId,
        name: input.name,
        type: input.type,
        parameter: input.parameter,
        unit: input.unit,
        thresholdLow: input.thresholdLow,
        thresholdHigh: input.thresholdHigh,
        minValue: input.minValue,
        maxValue: input.maxValue,
        samplingIntervalMs: input.samplingIntervalMs ?? 1000,
        isActive: true,
        protocol: input.protocol,
        description: input.description,
        metadata: input.metadata ?? {},
      })
      .returning({ id: sensors.id });

    const newSensor = await this.getById(results[0]!.id, input.organizationId);
    return newSensor!;
  }

  async update(
    id: number,
    organizationId: string,
    input: UpdateSensorInput,
  ): Promise<Sensor | null> {
    const sensor = await this.getById(id, organizationId);

    if (!sensor) {
      return null;
    }

    await this.db
      .update(sensors)
      .set({
        ...input,
        updatedAt: new Date(),
      })
      .where(eq(sensors.id, id));

    return this.getById(id, organizationId);
  }

  async delete(id: number, organizationId: string): Promise<boolean> {
    const sensor = await this.getById(id, organizationId);

    if (!sensor) {
      return false;
    }

    const result = await this.db
      .delete(sensors)
      .where(eq(sensors.id, id))
      .returning({ id: sensors.id });

    return result.length > 0;
  }

  private mapToSensor(
    record: Omit<typeof sensors.$inferSelect, "organizationId"> & {
      organizationId: string;
    },
  ): Sensor {
    return {
      id: record.id,
      assetId: record.assetId,
      organizationId: record.organizationId,
      name: record.name,
      type: record.type as SensorType,
      parameter: record.parameter as Parameter,
      unit: record.unit,
      thresholdLow: record.thresholdLow,
      thresholdHigh: record.thresholdHigh,
      minValue: record.minValue,
      maxValue: record.maxValue,
      samplingIntervalMs: record.samplingIntervalMs,
      isActive: record.isActive,
      protocol: record.protocol as Protocol,
      description: record.description,
      metadata: record.metadata ?? {},
    };
  }
}
````

## File: packages/database/src/repositories/user.repository.ts
````typescript
import { eq } from "drizzle-orm";
import type { User, UpsertUserInput, IUserRepository } from "@moondesk/domain";
import { getDb } from "../client";
import { users } from "../schema/index";

/**
 * User repository implementation using Drizzle ORM
 */
export class UserRepository implements IUserRepository {
  private db = getDb();

  async getById(id: string): Promise<User | null> {
    const results = await this.db
      .select()
      .from(users)
      .where(eq(users.id, id))
      .limit(1);

    return results[0] ? this.mapToUser(results[0]) : null;
  }

  async getByEmail(email: string): Promise<User | null> {
    const results = await this.db
      .select()
      .from(users)
      .where(eq(users.email, email))
      .limit(1);

    return results[0] ? this.mapToUser(results[0]) : null;
  }

  async upsert(input: UpsertUserInput): Promise<User> {
    const results = await this.db
      .insert(users)
      .values({
        id: input.id,
        email: input.email,
        username: input.username,
        firstName: input.firstName,
        lastName: input.lastName,
        imageUrl: input.imageUrl,
      })
      .onConflictDoUpdate({
        target: users.id,
        set: {
          email: input.email,
          username: input.username,
          firstName: input.firstName,
          lastName: input.lastName,
          imageUrl: input.imageUrl,
          updatedAt: new Date(),
        },
      })
      .returning();

    return this.mapToUser(results[0]!);
  }

  async delete(id: string): Promise<boolean> {
    const result = await this.db
      .delete(users)
      .where(eq(users.id, id))
      .returning({ id: users.id });

    return result.length > 0;
  }

  private mapToUser(record: typeof users.$inferSelect): User {
    return {
      id: record.id,
      email: record.email,
      username: record.username,
      firstName: record.firstName,
      lastName: record.lastName,
      imageUrl: record.imageUrl,
      createdAt: record.createdAt,
      updatedAt: record.updatedAt,
    };
  }
}
````

## File: packages/database/src/schema/alerts.ts
````typescript
import {
  pgTable,
  serial,
  text,
  timestamp,
  boolean,
  integer,
  doublePrecision,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Alerts table - threshold violation notifications
 */
export const alerts = pgTable(
  "alerts",
  {
    id: serial("id").primaryKey(),
    sensorId: integer("sensor_id")
      .notNull()
      .references(() => sensors.id, { onDelete: "cascade" }),
    organizationId: text("organization_id").notNull(),
    timestamp: timestamp("timestamp", { withTimezone: true })
      .notNull()
      .defaultNow(),
    severity: text("severity").notNull().default("info"),
    message: text("message").notNull(),
    triggerValue: doublePrecision("trigger_value").notNull(),
    thresholdValue: doublePrecision("threshold_value"),
    acknowledged: boolean("acknowledged").notNull().default(false),
    acknowledgedAt: timestamp("acknowledged_at", { withTimezone: true }),
    acknowledgedBy: text("acknowledged_by"),
    notes: text("notes"),
    protocol: text("protocol").notNull().default("mqtt"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
  },
  (table) => [
    index("idx_alerts_org_acknowledged_time").on(
      table.organizationId,
      table.acknowledged,
      table.timestamp,
    ),
    index("idx_alerts_org_sensor").on(table.organizationId, table.sensorId),
  ],
);

/**
 * Alert relations
 */
export const alertsRelations = relations(alerts, ({ one }) => ({
  sensor: one(sensors, {
    fields: [alerts.sensorId],
    references: [sensors.id],
  }),
}));

export type AlertRecord = typeof alerts.$inferSelect;
export type NewAlertRecord = typeof alerts.$inferInsert;
````

## File: packages/database/src/schema/assets.ts
````typescript
import {
  pgTable,
  serial,
  text,
  timestamp,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Assets table - represents industrial equipment being monitored
 */
export const assets = pgTable(
  "assets",
  {
    id: serial("id").primaryKey(),
    organizationId: text("organization_id").notNull(),
    name: text("name").notNull(),
    type: text("type").notNull(),
    location: text("location").notNull().default(""),
    status: text("status").notNull().default("unknown"),
    lastSeen: timestamp("last_seen", { withTimezone: true }),
    description: text("description"),
    manufacturer: text("manufacturer"),
    modelNumber: text("model_number"),
    installationDate: timestamp("installation_date", { withTimezone: true }),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [
    index("idx_assets_organization_id").on(table.organizationId),
    index("idx_assets_status").on(table.organizationId, table.status),
  ],
);

/**
 * Asset relations
 */
export const assetsRelations = relations(assets, ({ many }) => ({
  sensors: many(sensors),
}));

export type AssetRecord = typeof assets.$inferSelect;
export type NewAssetRecord = typeof assets.$inferInsert;
````

## File: packages/database/src/schema/commands.ts
````typescript
import {
  pgTable,
  serial,
  text,
  timestamp,
  integer,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Commands table - device control commands
 */
export const commands = pgTable(
  "commands",
  {
    id: serial("id").primaryKey(),
    sensorId: integer("sensor_id")
      .notNull()
      .references(() => sensors.id, { onDelete: "cascade" }),
    organizationId: text("organization_id").notNull(),
    userId: text("user_id").notNull(),
    action: text("action").notNull(),
    parameters: jsonb("parameters")
      .$type<Record<string, unknown>>()
      .default({}),
    status: text("status").notNull().default("pending"),
    protocol: text("protocol").notNull().default("mqtt"),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    sentAt: timestamp("sent_at", { withTimezone: true }),
    completedAt: timestamp("completed_at", { withTimezone: true }),
    errorMessage: text("error_message"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
  },
  (table) => [
    index("idx_commands_org_status_time").on(
      table.organizationId,
      table.status,
      table.createdAt,
    ),
    index("idx_commands_org_user").on(table.organizationId, table.userId),
  ],
);

/**
 * Command relations
 */
export const commandsRelations = relations(commands, ({ one }) => ({
  sensor: one(sensors, {
    fields: [commands.sensorId],
    references: [sensors.id],
  }),
}));

export type CommandRecord = typeof commands.$inferSelect;
export type NewCommandRecord = typeof commands.$inferInsert;
````

## File: packages/database/src/schema/connection-credentials.ts
````typescript
import {
  pgTable,
  serial,
  text,
  timestamp,
  boolean,
  jsonb,
  index,
} from "drizzle-orm/pg-core";

/**
 * Connection credentials table - secure storage for MQTT/OPC-UA credentials
 */
export const connectionCredentials = pgTable(
  "connection_credentials",
  {
    id: serial("id").primaryKey(),
    organizationId: text("organization_id").notNull(),
    name: text("name").notNull(),
    protocol: text("protocol").notNull(),
    endpointUri: text("endpoint_uri").notNull(),
    username: text("username").notNull(),
    encryptedPassword: text("encrypted_password").notNull(),
    encryptionIV: text("encryption_iv").notNull(),
    clientId: text("client_id"),
    isActive: boolean("is_active").notNull().default(true),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [
    index("idx_credentials_org_protocol").on(
      table.organizationId,
      table.protocol,
    ),
    index("idx_credentials_org_active").on(
      table.organizationId,
      table.isActive,
    ),
  ],
);

export type ConnectionCredentialRecord =
  typeof connectionCredentials.$inferSelect;
export type NewConnectionCredentialRecord =
  typeof connectionCredentials.$inferInsert;
````

## File: packages/database/src/schema/index.ts
````typescript
// Schema barrel export
export * from "./assets";
export * from "./sensors";
export * from "./readings";
export * from "./alerts";
export * from "./commands";
export * from "./users";
export * from "./organizations";
export * from "./connection-credentials";
````

## File: packages/database/src/schema/organizations.ts
````typescript
import {
  pgTable,
  text,
  timestamp,
  primaryKey,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { users } from "./users";

/**
 * Organizations table - synced from Clerk
 */
export const organizations = pgTable(
  "organizations",
  {
    id: text("id").primaryKey(), // Clerk organization ID
    name: text("name").notNull(),
    slug: text("slug").unique(),
    imageUrl: text("image_url"),
    ownerId: text("owner_id").notNull(),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [index("idx_organizations_owner").on(table.ownerId)],
);

/**
 * Organization memberships - many-to-many between users and organizations
 */
export const organizationMemberships = pgTable(
  "organization_memberships",
  {
    userId: text("user_id")
      .notNull()
      .references(() => users.id, { onDelete: "cascade" }),
    organizationId: text("organization_id")
      .notNull()
      .references(() => organizations.id, { onDelete: "cascade" }),
    role: text("role").notNull().default("member"),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [primaryKey({ columns: [table.userId, table.organizationId] })],
);

/**
 * Organization relations
 */
export const organizationsRelations = relations(organizations, ({ many }) => ({
  memberships: many(organizationMemberships),
}));

/**
 * Membership relations
 */
export const organizationMembershipsRelations = relations(
  organizationMemberships,
  ({ one }) => ({
    user: one(users, {
      fields: [organizationMemberships.userId],
      references: [users.id],
    }),
    organization: one(organizations, {
      fields: [organizationMemberships.organizationId],
      references: [organizations.id],
    }),
  }),
);

export type OrganizationRecord = typeof organizations.$inferSelect;
export type NewOrganizationRecord = typeof organizations.$inferInsert;
export type OrganizationMembershipRecord =
  typeof organizationMemberships.$inferSelect;
export type NewOrganizationMembershipRecord =
  typeof organizationMemberships.$inferInsert;
````

## File: packages/database/src/schema/readings.ts
````typescript
import {
  pgTable,
  text,
  timestamp,
  doublePrecision,
  jsonb,
  index,
  integer,
  primaryKey,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { sensors } from "./sensors";

/**
 * Readings table - time-series sensor data
 * Optimized for TimescaleDB hypertable (composite primary key on sensorId + timestamp)
 */
export const readings = pgTable(
  "readings",
  {
    sensorId: integer("sensor_id")
      .notNull()
      .references(() => sensors.id, { onDelete: "cascade" }),
    organizationId: text("organization_id").notNull(),
    timestamp: timestamp("timestamp", { withTimezone: true })
      .notNull()
      .defaultNow(),
    value: doublePrecision("value").notNull(),
    parameter: text("parameter").notNull().default("none"),
    protocol: text("protocol").notNull().default("mqtt"),
    quality: text("quality").notNull().default("good"),
    notes: text("notes"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
  },
  (table) => [
    // Composite primary key for TimescaleDB
    primaryKey({ columns: [table.sensorId, table.timestamp] }),
    // Critical indexes for time-series queries
    index("idx_readings_org_sensor_time").on(
      table.organizationId,
      table.sensorId,
      table.timestamp,
    ),
    index("idx_readings_org_time").on(table.organizationId, table.timestamp),
  ],
);

/**
 * Reading relations
 */
export const readingsRelations = relations(readings, ({ one }) => ({
  sensor: one(sensors, {
    fields: [readings.sensorId],
    references: [sensors.id],
  }),
}));

export type ReadingRecord = typeof readings.$inferSelect;
export type NewReadingRecord = typeof readings.$inferInsert;
````

## File: packages/database/src/schema/sensors.ts
````typescript
import {
  pgTable,
  serial,
  text,
  timestamp,
  boolean,
  integer,
  doublePrecision,
  jsonb,
  index,
} from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { assets } from "./assets";
import { readings } from "./readings";
import { alerts } from "./alerts";
import { commands } from "./commands";

/**
 * Sensors table - represents measurement devices attached to assets
 */
export const sensors = pgTable(
  "sensors",
  {
    id: serial("id").primaryKey(),
    assetId: integer("asset_id")
      .notNull()
      .references(() => assets.id, { onDelete: "cascade" }),
    name: text("name").notNull(),
    type: text("type").notNull(),
    parameter: text("parameter").notNull().default("none"),
    unit: text("unit").notNull(),
    thresholdLow: doublePrecision("threshold_low"),
    thresholdHigh: doublePrecision("threshold_high"),
    minValue: doublePrecision("min_value"),
    maxValue: doublePrecision("max_value"),
    samplingIntervalMs: integer("sampling_interval_ms").notNull().default(1000),
    isActive: boolean("is_active").notNull().default(true),
    protocol: text("protocol").notNull().default("mqtt"),
    description: text("description"),
    metadata: jsonb("metadata").$type<Record<string, string>>().default({}),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [index("idx_sensors_asset_id").on(table.assetId)],
);

/**
 * Sensor relations
 */
export const sensorsRelations = relations(sensors, ({ one, many }) => ({
  asset: one(assets, {
    fields: [sensors.assetId],
    references: [assets.id],
  }),
  readings: many(readings),
  alerts: many(alerts),
  commands: many(commands),
}));

export type SensorRecord = typeof sensors.$inferSelect;
export type NewSensorRecord = typeof sensors.$inferInsert;
````

## File: packages/database/src/schema/users.ts
````typescript
import { pgTable, text, timestamp, index } from "drizzle-orm/pg-core";
import { relations } from "drizzle-orm";
import { organizationMemberships } from "./organizations";

/**
 * Users table - synced from Clerk
 */
export const users = pgTable(
  "users",
  {
    id: text("id").primaryKey(), // Clerk user ID
    email: text("email").notNull().unique(),
    username: text("username").unique(),
    firstName: text("first_name"),
    lastName: text("last_name"),
    imageUrl: text("image_url"),
    createdAt: timestamp("created_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
    updatedAt: timestamp("updated_at", { withTimezone: true })
      .notNull()
      .defaultNow(),
  },
  (table) => [index("idx_users_email").on(table.email)],
);

/**
 * User relations
 */
export const usersRelations = relations(users, ({ many }) => ({
  memberships: many(organizationMemberships),
}));

export type UserRecord = typeof users.$inferSelect;
export type NewUserRecord = typeof users.$inferInsert;
````

## File: packages/database/src/client.ts
````typescript
import { drizzle } from "drizzle-orm/node-postgres";
import pg from "pg";
import * as schema from "./schema/index";

const { Pool } = pg;

let pool: pg.Pool | null = null;
let db: ReturnType<typeof drizzle<typeof schema>> | null = null;

/**
 * Get or create the database connection pool
 */
export function getPool(): pg.Pool {
  if (!pool) {
    const connectionString = process.env["DATABASE_URL"];
    if (!connectionString) {
      throw new Error("DATABASE_URL environment variable is required");
    }

    pool = new Pool({
      connectionString,
      max: 20, // Maximum connections in pool
      idleTimeoutMillis: 30000,
      connectionTimeoutMillis: 5000,
    });

    pool.on("error", (err) => {
      console.error("Unexpected database pool error:", err);
    });
  }

  return pool;
}

/**
 * Get or create the Drizzle database instance
 */
export function getDb() {
  if (!db) {
    db = drizzle(getPool(), { schema });
  }
  return db;
}

/**
 * Close the database connection pool
 */
export async function closeDb(): Promise<void> {
  if (pool) {
    await pool.end();
    pool = null;
    db = null;
  }
}

// Export schema and types
export * from "./schema/index";
export { schema };
````

## File: packages/database/src/index.ts
````typescript
// @moondesk/database - Data access layer with Drizzle ORM

// Database client
export { getDb, getPool, closeDb } from "./client";

// Schema
export * from "./schema/index";

// Repositories
export * from "./repositories/index";
````

## File: packages/database/drizzle.config.ts
````typescript
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  schema: "./src/schema/index.ts",
  out: "./src/migrations",
  dialect: "postgresql",
  dbCredentials: {
    url: process.env["DATABASE_URL"]!,
  },
  verbose: true,
  strict: true,
});
````

## File: packages/domain/src/enums/alert-severity.ts
````typescript
/**
 * Represents the severity level of an alert
 */
export const AlertSeverity = {
  Info: "info",
  Warning: "warning",
  Critical: "critical",
  Emergency: "emergency",
} as const;

export type AlertSeverity = (typeof AlertSeverity)[keyof typeof AlertSeverity];
````

## File: packages/domain/src/enums/asset-status.ts
````typescript
/**
 * Represents the operational status of an asset
 */
export const AssetStatus = {
  Online: "online",
  Offline: "offline",
  Maintenance: "maintenance",
  Error: "error",
  Unknown: "unknown",
} as const;

export type AssetStatus = (typeof AssetStatus)[keyof typeof AssetStatus];
````

## File: packages/domain/src/enums/command-status.ts
````typescript
/**
 * Represents the status of a command sent to a device
 */
export const CommandStatus = {
  Pending: "pending",
  Sent: "sent",
  Acknowledged: "acknowledged",
  Completed: "completed",
  Failed: "failed",
  Timeout: "timeout",
} as const;

export type CommandStatus = (typeof CommandStatus)[keyof typeof CommandStatus];
````

## File: packages/domain/src/enums/index.ts
````typescript
// Enums barrel export
export { AssetStatus } from "./asset-status";
export { AlertSeverity } from "./alert-severity";
export { SensorType } from "./sensor-type";
export { Protocol } from "./protocol";
export { Parameter } from "./parameter";
export { ReadingQuality } from "./reading-quality";
export { CommandStatus } from "./command-status";
export { UserRole } from "./user-role";
````

## File: packages/domain/src/enums/parameter.ts
````typescript
/**
 * Represents the water quality parameter being measured
 */
export const Parameter = {
  None: "none",
  // Chemical parameters
  pH: "ph",
  Chlorine: "chlorine",
  Fluoride: "fluoride",
  DissolvedOxygen: "dissolved_oxygen",

  // Physical parameters
  Turbidity: "turbidity",
  Temperature: "temperature",
  Conductivity: "conductivity",
  TDS: "tds",

  // Hydraulic parameters
  Flow: "flow",
  Pressure: "pressure",
  Level: "level",
  Vibration: "vibration",

  // Energy parameters
  Voltage: "voltage",
  Current: "current",
  Power: "power",
  Energy: "energy",
} as const;

export type Parameter = (typeof Parameter)[keyof typeof Parameter];
````

## File: packages/domain/src/enums/protocol.ts
````typescript
/**
 * Represents the communication protocol used by a sensor or device
 */
export const Protocol = {
  Mqtt: "mqtt",
  OpcUa: "opc_ua",
  Modbus: "modbus",
  Http: "http",
  BACnet: "bacnet",
} as const;

export type Protocol = (typeof Protocol)[keyof typeof Protocol];
````

## File: packages/domain/src/enums/reading-quality.ts
````typescript
/**
 * Represents the quality/reliability of a sensor reading
 */
export const ReadingQuality = {
  Good: "good",
  Uncertain: "uncertain",
  Bad: "bad",
  Simulated: "simulated",
} as const;

export type ReadingQuality =
  (typeof ReadingQuality)[keyof typeof ReadingQuality];
````

## File: packages/domain/src/enums/sensor-type.ts
````typescript
/**
 * Represents the type of sensor
 */
export const SensorType = {
  // Chemical sensors
  pH: "ph",
  FreeChlorine: "free_chlorine",
  TotalChlorine: "total_chlorine",
  Fluoride: "fluoride",
  DissolvedOxygen: "dissolved_oxygen",

  // Physical sensors
  Turbidity: "turbidity",
  Temperature: "temperature",
  Conductivity: "conductivity",
  TotalDissolvedSolids: "total_dissolved_solids",

  // Hydraulic sensors
  FlowRate: "flow_rate",
  Pressure: "pressure",
  Level: "level",
  Vibration: "vibration",

  // Energy sensors
  VoltageMeter: "voltage_meter",
  CurrentMeter: "current_meter",
  PowerMeter: "power_meter",
  EnergyMeter: "energy_meter",

  // General
  Generic: "generic",
} as const;

export type SensorType = (typeof SensorType)[keyof typeof SensorType];
````

## File: packages/domain/src/enums/user-role.ts
````typescript
/**
 * Represents the role of a user within an organization
 */
export const UserRole = {
  Admin: "admin",
  Member: "member",
  Viewer: "viewer",
} as const;

export type UserRole = (typeof UserRole)[keyof typeof UserRole];
````

## File: packages/domain/src/errors/index.ts
````typescript
/**
 * Base error class for domain errors
 */
export class DomainError extends Error {
  constructor(
    message: string,
    public readonly code: string,
    public readonly statusCode: number = 500,
  ) {
    super(message);
    this.name = "DomainError";
  }
}

/**
 * Error thrown when a resource is not found
 */
export class NotFoundError extends DomainError {
  constructor(resource: string, id: string | number) {
    super(`${resource} with id '${id}' not found`, "NOT_FOUND", 404);
    this.name = "NotFoundError";
  }
}

/**
 * Error thrown when validation fails
 */
export class ValidationError extends DomainError {
  constructor(
    message: string,
    public readonly field?: string,
  ) {
    super(message, "VALIDATION_ERROR", 400);
    this.name = "ValidationError";
  }
}

/**
 * Error thrown when user is not authorized
 */
export class UnauthorizedError extends DomainError {
  constructor(message = "Unauthorized") {
    super(message, "UNAUTHORIZED", 401);
    this.name = "UnauthorizedError";
  }
}

/**
 * Error thrown when user doesn't have permission
 */
export class ForbiddenError extends DomainError {
  constructor(message = "Access forbidden") {
    super(message, "FORBIDDEN", 403);
    this.name = "ForbiddenError";
  }
}

/**
 * Error thrown when a conflict occurs (e.g., duplicate entry)
 */
export class ConflictError extends DomainError {
  constructor(message: string) {
    super(message, "CONFLICT", 409);
    this.name = "ConflictError";
  }
}
````

## File: packages/domain/src/interfaces/repositories/alert.repository.ts
````typescript
import type {
  Alert,
  CreateAlertInput,
  AcknowledgeAlertInput,
  AlertQueryParams,
  AlertStats,
} from "../../models/alert";

/**
 * Repository interface for Alert operations
 */
export interface IAlertRepository {
  /**
   * Get all alerts for an organization
   */
  getAll(organizationId: string, limit?: number): Promise<Alert[]>;

  /**
   * Get alert statistics for an organization
   */
  getStats(organizationId: string): Promise<AlertStats>;

  /**
   * Query alerts with filters
   */
  query(params: AlertQueryParams): Promise<Alert[]>;

  /**
   * Get a single alert by ID
   */
  getById(id: number, organizationId: string): Promise<Alert | null>;

  /**
   * Get unacknowledged alerts
   */
  getUnacknowledged(organizationId: string): Promise<Alert[]>;

  /**
   * Create a new alert
   */
  create(input: CreateAlertInput): Promise<Alert>;

  /**
   * Acknowledge an alert
   */
  acknowledge(
    id: number,
    organizationId: string,
    input: AcknowledgeAlertInput,
  ): Promise<Alert | null>;
}
````

## File: packages/domain/src/interfaces/repositories/asset.repository.ts
````typescript
import type {
  Asset,
  CreateAssetInput,
  UpdateAssetInput,
} from "../../models/asset";

/**
 * Repository interface for Asset operations
 */
export interface IAssetRepository {
  /**
   * Get all assets for an organization
   */
  getAll(organizationId: string): Promise<Asset[]>;

  /**
   * Get a single asset by ID
   */
  getById(id: number, organizationId: string): Promise<Asset | null>;

  /**
   * Get an asset with its sensors
   */
  getByIdWithSensors(id: number, organizationId: string): Promise<Asset | null>;

  /**
   * Create a new asset
   */
  create(input: CreateAssetInput): Promise<Asset>;

  /**
   * Update an existing asset
   */
  update(
    id: number,
    organizationId: string,
    input: UpdateAssetInput,
  ): Promise<Asset | null>;

  /**
   * Delete an asset
   */
  delete(id: number, organizationId: string): Promise<boolean>;

  /**
   * Update the lastSeen timestamp for an asset
   */
  updateLastSeen(id: number, organizationId: string): Promise<void>;
}
````

## File: packages/domain/src/interfaces/repositories/command.repository.ts
````typescript
import type {
  Command,
  CreateCommandInput,
  UpdateCommandStatusInput,
} from "../../models/command";

/**
 * Repository interface for Command operations
 */
export interface ICommandRepository {
  /**
   * Get all commands for an organization
   */
  getAll(organizationId: string, limit?: number): Promise<Command[]>;

  /**
   * Get commands for a specific sensor
   */
  getBySensorId(sensorId: number, organizationId: string): Promise<Command[]>;

  /**
   * Get a single command by ID
   */
  getById(id: number, organizationId: string): Promise<Command | null>;

  /**
   * Get pending commands
   */
  getPending(organizationId: string): Promise<Command[]>;

  /**
   * Create a new command
   */
  create(input: CreateCommandInput): Promise<Command>;

  /**
   * Update command status
   */
  updateStatus(
    id: number,
    organizationId: string,
    input: UpdateCommandStatusInput,
  ): Promise<Command | null>;
}
````

## File: packages/domain/src/interfaces/repositories/connection-credential.repository.ts
````typescript
import type {
  ConnectionCredential,
  CreateCredentialInput,
  UpdateCredentialInput,
} from "../../models/connection-credential";
import type { Protocol } from "../../enums/protocol";

/**
 * Repository interface for ConnectionCredential operations
 */
export interface IConnectionCredentialRepository {
  /**
   * Get all credentials for an organization
   */
  getAll(organizationId: string): Promise<ConnectionCredential[]>;

  /**
   * Get credentials by protocol
   */
  getByProtocol(
    protocol: Protocol,
    organizationId: string,
  ): Promise<ConnectionCredential[]>;

  /**
   * Get a single credential by ID
   */
  getById(
    id: number,
    organizationId: string,
  ): Promise<ConnectionCredential | null>;

  /**
   * Get active credentials
   */
  getActive(organizationId: string): Promise<ConnectionCredential[]>;

  /**
   * Create a new credential
   */
  create(input: CreateCredentialInput): Promise<ConnectionCredential>;

  /**
   * Update an existing credential
   */
  update(
    id: number,
    organizationId: string,
    input: UpdateCredentialInput,
  ): Promise<ConnectionCredential | null>;

  /**
   * Delete a credential
   */
  delete(id: number, organizationId: string): Promise<boolean>;
}
````

## File: packages/domain/src/interfaces/repositories/index.ts
````typescript
// Repository interfaces barrel export
export type { IAssetRepository } from "./asset.repository";
export type { ISensorRepository } from "./sensor.repository";
export type { IReadingRepository } from "./reading.repository";
export type { IAlertRepository } from "./alert.repository";
export type { ICommandRepository } from "./command.repository";
export type { IUserRepository } from "./user.repository";
export type {
  IOrganizationRepository,
  IOrganizationMembershipRepository,
} from "./organization.repository";
export type { IConnectionCredentialRepository } from "./connection-credential.repository";
````

## File: packages/domain/src/interfaces/repositories/organization.repository.ts
````typescript
import type {
  Organization,
  OrganizationMembership,
  UpsertOrganizationInput,
  UpsertMembershipInput,
} from "../../models/organization";

/**
 * Repository interface for Organization operations
 */
export interface IOrganizationRepository {
  /**
   * Get an organization by ID
   */
  getById(id: string): Promise<Organization | null>;

  /**
   * Get all organizations
   */
  getAll(): Promise<Organization[]>;

  /**
   * Upsert an organization (from Clerk webhook)
   */
  upsert(input: UpsertOrganizationInput): Promise<Organization>;

  /**
   * Delete an organization
   */
  delete(id: string): Promise<boolean>;
}

/**
 * Repository interface for OrganizationMembership operations
 */
export interface IOrganizationMembershipRepository {
  /**
   * Get all memberships for a user
   */
  getByUserId(userId: string): Promise<OrganizationMembership[]>;

  /**
   * Get all memberships for an organization
   */
  getByOrganizationId(
    organizationId: string,
  ): Promise<OrganizationMembership[]>;

  /**
   * Check if user is member of organization
   */
  isMember(userId: string, organizationId: string): Promise<boolean>;

  /**
   * Upsert a membership
   */
  upsert(input: UpsertMembershipInput): Promise<OrganizationMembership>;

  /**
   * Delete a membership
   */
  delete(userId: string, organizationId: string): Promise<boolean>;
}
````

## File: packages/domain/src/interfaces/repositories/reading.repository.ts
````typescript
import type {
  Reading,
  CreateReadingInput,
  ReadingQueryParams,
  AggregatedReading,
  ReadingStats,
} from "../../models/reading";

/**
 * Repository interface for Reading operations
 * Optimized for high-volume time-series data
 */
export interface IReadingRepository {
  /**
   * Get recent readings for a sensor
   */
  getRecent(
    organizationId: string,
    sensorId: number,
    limit?: number,
  ): Promise<Reading[]>;

  /**
   * Query readings with filters and optional aggregation
   */
  query(params: ReadingQueryParams): Promise<Reading[]>;

  /**
   * Get aggregated readings (for dashboards)
   */
  getAggregated(params: ReadingQueryParams): Promise<AggregatedReading[]>;

  /**
   * Get the latest reading for each sensor
   */
  getLatestBySensor(
    organizationId: string,
    sensorIds: number[],
  ): Promise<Map<number, Reading>>;

  /**
   * Bulk insert readings (for MQTT ingestion)
   */
  bulkInsert(readings: CreateReadingInput[]): Promise<void>;

  /**
   * Insert a single reading
   */
  insert(reading: CreateReadingInput): Promise<Reading>;

  /**
   * Get reading statistics (total count and trends)
   */
  getStats(organizationId: string): Promise<ReadingStats>;
}
````

## File: packages/domain/src/interfaces/repositories/sensor.repository.ts
````typescript
import type {
  Sensor,
  CreateSensorInput,
  UpdateSensorInput,
} from "../../models/sensor";

/**
 * Repository interface for Sensor operations
 */
export interface ISensorRepository {
  /**
   * Get all sensors for an organization
   */
  getAll(organizationId: string): Promise<Sensor[]>;

  /**
   * Get all sensors in the system (across all organizations)
   * Used for background workers
   */
  getAllSystemSensors(): Promise<Sensor[]>;

  /**
   * Get all sensors for a specific asset
   */
  getByAssetId(assetId: number, organizationId: string): Promise<Sensor[]>;

  /**
   * Get a single sensor by ID
   */
  getById(id: number, organizationId: string): Promise<Sensor | null>;

  /**
   * Get sensors that are active
   */
  getActive(organizationId: string): Promise<Sensor[]>;

  /**
   * Create a new sensor
   */
  create(input: CreateSensorInput): Promise<Sensor>;

  /**
   * Update an existing sensor
   */
  update(
    id: number,
    organizationId: string,
    input: UpdateSensorInput,
  ): Promise<Sensor | null>;

  /**
   * Delete a sensor
   */
  delete(id: number, organizationId: string): Promise<boolean>;
}
````

## File: packages/domain/src/interfaces/repositories/user.repository.ts
````typescript
import type { User, UpsertUserInput } from "../../models/user";

/**
 * Repository interface for User operations
 */
export interface IUserRepository {
  /**
   * Get a user by ID
   */
  getById(id: string): Promise<User | null>;

  /**
   * Get a user by email
   */
  getByEmail(email: string): Promise<User | null>;

  /**
   * Upsert a user (from Clerk webhook)
   */
  upsert(input: UpsertUserInput): Promise<User>;

  /**
   * Delete a user
   */
  delete(id: string): Promise<boolean>;
}
````

## File: packages/domain/src/interfaces/services/encryption.service.ts
````typescript
/**
 * Service interface for encrypting/decrypting sensitive data
 */
export interface IEncryptionService {
  /**
   * Encrypt a plain text value
   * @returns Object containing the encrypted value and IV
   */
  encrypt(plainText: string): { encryptedValue: string; iv: string };

  /**
   * Decrypt an encrypted value
   */
  decrypt(encryptedValue: string, iv: string): string;
}
````

## File: packages/domain/src/interfaces/services/index.ts
````typescript
// Service interfaces barrel export
export type { INotificationService } from "./notification.service";
export type { IEncryptionService } from "./encryption.service";
````

## File: packages/domain/src/interfaces/services/notification.service.ts
````typescript
import type { Alert } from "../../models/alert";
import type { Reading } from "../../models/reading";

/**
 * Service interface for sending real-time notifications via WebSocket
 */
export interface INotificationService {
  /**
   * Send a sensor reading update to connected clients
   */
  sendSensorReading(reading: Reading, organizationId: string): Promise<void>;

  /**
   * Send an alert notification to connected clients
   */
  sendAlert(alert: Alert, organizationId: string): Promise<void>;

  /**
   * Send device status change notification
   */
  sendDeviceStatus(
    deviceId: number,
    status: string,
    organizationId: string,
  ): Promise<void>;
}
````

## File: packages/domain/src/interfaces/index.ts
````typescript
// Interfaces barrel export
export * from "./repositories/index";
export * from "./services/index";
````

## File: packages/domain/src/models/alert.ts
````typescript
import type { AlertSeverity } from "../enums/alert-severity";
import type { Protocol } from "../enums/protocol";
import type { Sensor } from "./sensor";

/**
 * Represents an alert triggered when sensor readings exceed thresholds
 */
export interface Alert {
  id: number;
  sensorId: number;
  organizationId: string;
  timestamp: Date;
  severity: AlertSeverity;
  message: string;
  triggerValue: number;
  thresholdValue: number | null;
  acknowledged: boolean;
  acknowledgedAt: Date | null;
  acknowledgedBy: string | null;
  notes: string | null;
  protocol: Protocol;
  metadata: Record<string, string>;

  // Navigation property
  sensor?: Sensor;
}

/**
 * Input type for creating a new alert
 */
export interface CreateAlertInput {
  sensorId: number;
  organizationId: string;
  severity: AlertSeverity;
  message: string;
  triggerValue: number;
  thresholdValue?: number | null;
  protocol?: Protocol;
  metadata?: Record<string, string>;
}

/**
 * Input type for acknowledging an alert
 */
export interface AcknowledgeAlertInput {
  acknowledgedBy: string;
  notes?: string | null;
}

/**
 * Query parameters for fetching alerts
 */
export interface AlertQueryParams {
  organizationId: string;
  sensorId?: number;
  severity?: AlertSeverity;
  acknowledged?: boolean;
  startTime?: Date;
  endTime?: Date;
  limit?: number;
}

/**
 * Statistics for alerts
 */
export interface AlertStats {
  total: number;
  bySeverity: Record<AlertSeverity, number>;
  byStatus: {
    acknowledged: number;
    unacknowledged: number;
  };
  trends: {
    daily: number; // Percentage change vs yesterday
    weekly: number; // Percentage change vs last week
    critical: number; // Percentage change for critical/emergency vs yesterday
  };
  recentTrend: {
    date: string;
    count: number;
    severity: AlertSeverity;
  }[];
}
````

## File: packages/domain/src/models/asset.ts
````typescript
import type { AssetStatus } from "../enums/asset-status";
import type { Sensor } from "./sensor";

/**
 * Represents an industrial asset (machine, equipment, facility) being monitored
 */
export interface Asset {
  id: number;
  organizationId: string;
  name: string;
  type: string; // e.g., "Pump", "Tank", "Valve", "Compressor"
  location: string;
  status: AssetStatus;
  lastSeen: Date | null;
  description: string | null;
  manufacturer: string | null;
  modelNumber: string | null;
  installationDate: Date | null;
  metadata: Record<string, string>;

  // Navigation property
  sensors?: Sensor[];
}

/**
 * Input type for creating a new asset
 */
export interface CreateAssetInput {
  organizationId: string;
  name: string;
  type: string;
  location?: string;
  status?: AssetStatus;
  description?: string | null;
  manufacturer?: string | null;
  modelNumber?: string | null;
  installationDate?: Date | null;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating an existing asset
 */
export interface UpdateAssetInput {
  name?: string;
  type?: string;
  location?: string;
  status?: AssetStatus;
  description?: string | null;
  manufacturer?: string | null;
  modelNumber?: string | null;
  installationDate?: Date | null;
  metadata?: Record<string, string>;
}
````

## File: packages/domain/src/models/command.ts
````typescript
import type { CommandStatus } from "../enums/command-status";
import type { Protocol } from "../enums/protocol";
import type { Sensor } from "./sensor";

/**
 * Represents a command sent to a device/sensor
 */
export interface Command {
  id: number;
  sensorId: number;
  organizationId: string;
  userId: string;
  action: string; // e.g., "TURN_ON", "TURN_OFF", "SET_INTERVAL", "CALIBRATE"
  parameters: Record<string, unknown>;
  status: CommandStatus;
  protocol: Protocol;
  createdAt: Date;
  sentAt: Date | null;
  completedAt: Date | null;
  errorMessage: string | null;
  metadata: Record<string, string>;

  // Navigation property
  sensor?: Sensor;
}

/**
 * Input type for creating a new command
 */
export interface CreateCommandInput {
  sensorId: number;
  organizationId: string;
  userId: string;
  action: string;
  parameters?: Record<string, unknown>;
  protocol?: Protocol;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating command status
 */
export interface UpdateCommandStatusInput {
  status: CommandStatus;
  errorMessage?: string | null;
}
````

## File: packages/domain/src/models/connection-credential.ts
````typescript
import type { Protocol } from "../enums/protocol";

/**
 * Represents connection credentials for external services (MQTT brokers, etc.)
 */
export interface ConnectionCredential {
  id: number;
  organizationId: string;
  name: string;
  protocol: Protocol;
  endpointUri: string;
  username: string;
  encryptedPassword: string;
  encryptionIV: string;
  clientId: string | null;
  isActive: boolean;
  createdAt: Date;
  updatedAt: Date;
  metadata: Record<string, string>;
}

/**
 * Input type for creating connection credentials
 */
export interface CreateCredentialInput {
  organizationId: string;
  name: string;
  protocol: Protocol;
  endpointUri: string;
  username: string;
  password: string; // Plain text, will be encrypted
  clientId?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating connection credentials
 */
export interface UpdateCredentialInput {
  name?: string;
  endpointUri?: string;
  username?: string;
  password?: string; // Plain text, will be encrypted
  clientId?: string | null;
  isActive?: boolean;
  metadata?: Record<string, string>;
}
````

## File: packages/domain/src/models/index.ts
````typescript
// Models barrel export
export type { Asset, CreateAssetInput, UpdateAssetInput } from "./asset";

export type { Sensor, CreateSensorInput, UpdateSensorInput } from "./sensor";

export type {
  Reading,
  CreateReadingInput,
  ReadingStats,
  ReadingQueryParams,
  AggregatedReading,
} from "./reading";

export type {
  Alert,
  CreateAlertInput,
  AcknowledgeAlertInput,
  AlertQueryParams,
  AlertStats,
} from "./alert";

export type {
  Command,
  CreateCommandInput,
  UpdateCommandStatusInput,
} from "./command";

export type { User, UpsertUserInput } from "./user";

export type {
  Organization,
  OrganizationMembership,
  UpsertOrganizationInput,
  UpsertMembershipInput,
} from "./organization";

export type {
  ConnectionCredential,
  CreateCredentialInput,
  UpdateCredentialInput,
} from "./connection-credential";
````

## File: packages/domain/src/models/organization.ts
````typescript
import type { UserRole } from "../enums/user-role";
import type { User } from "./user";

/**
 * Represents an organization (synced from Clerk)
 */
export interface Organization {
  id: string; // Clerk organization ID
  name: string;
  slug: string | null;
  imageUrl: string | null;
  ownerId: string;
  createdAt: Date;
  updatedAt: Date;

  // Navigation property
  memberships?: OrganizationMembership[];
}

/**
 * Represents a user's membership in an organization
 */
export interface OrganizationMembership {
  userId: string;
  organizationId: string;
  role: UserRole;
  createdAt: Date;

  // Navigation properties
  user?: User;
  organization?: Organization;
}

/**
 * Input type for creating/updating an organization (from Clerk webhook)
 */
export interface UpsertOrganizationInput {
  id: string;
  name: string;
  slug?: string | null;
  imageUrl?: string | null;
  ownerId: string;
}

/**
 * Input type for managing organization membership
 */
export interface UpsertMembershipInput {
  userId: string;
  organizationId: string;
  role: UserRole;
}
````

## File: packages/domain/src/models/reading.ts
````typescript
import type { Parameter } from "../enums/parameter";
import type { Protocol } from "../enums/protocol";
import type { ReadingQuality } from "../enums/reading-quality";
import type { Sensor } from "./sensor";

/**
 * Represents a single time-series reading from a sensor
 */
export interface Reading {
  sensorId: number;
  organizationId: string;
  timestamp: Date;
  value: number;
  parameter: Parameter;
  protocol: Protocol;
  quality: ReadingQuality;
  notes: string | null;
  metadata: Record<string, string>;

  // Navigation property
  sensor?: Sensor;
}

/**
 * Input type for creating a new reading (from MQTT ingestion)
 */
export interface CreateReadingInput {
  sensorId: number;
  organizationId: string;
  timestamp?: Date;
  value: number;
  parameter: Parameter;
  protocol: Protocol;
  quality?: ReadingQuality;
  notes?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Query parameters for fetching readings
 */
export interface ReadingQueryParams {
  sensorId?: number;
  organizationId: string;
  startTime?: Date;
  endTime?: Date;
  limit?: number;
  aggregation?: "raw" | "avg" | "min" | "max" | "count";
  bucketInterval?: string; // e.g., '1 hour', '1 day'
}

/**
 * Aggregated reading result
 */
export interface AggregatedReading {
  bucket: Date;
  sensorId: number;
  avg: number | null;
  min: number | null;
  max: number | null;
  count: number;
}

/**
 * Readings statistics
 */
export interface ReadingStats {
  total: number;
  dailyTrend: number; // Percentage change vs yesterday
  qualityScore: number; // Percentage of 'good' readings (0-100)
  trends: {
    bucket: string;
    count: number;
  }[];
}
````

## File: packages/domain/src/models/sensor.ts
````typescript
import type { SensorType } from "../enums/sensor-type";
import type { Parameter } from "../enums/parameter";
import type { Protocol } from "../enums/protocol";
import type { Asset } from "./asset";
import type { Reading } from "./reading";
import type { Alert } from "./alert";
import type { Command } from "./command";

/**
 * Represents a sensor attached to an asset
 */
export interface Sensor {
  id: number;
  assetId: number;
  organizationId: string;
  name: string;
  type: SensorType;
  parameter: Parameter;
  unit: string; // e.g., "°C", "PSI", "Hz", "L/min"
  thresholdLow: number | null;
  thresholdHigh: number | null;
  minValue: number | null;
  maxValue: number | null;
  samplingIntervalMs: number; // Default 1000 (1 second)
  isActive: boolean;
  protocol: Protocol;
  description: string | null;
  metadata: Record<string, string>;

  // Navigation properties
  asset?: Asset;
  readings?: Reading[];
  alerts?: Alert[];
  commands?: Command[];
}

/**
 * Input type for creating a new sensor
 */
export interface CreateSensorInput {
  assetId: number;
  organizationId: string;
  name: string;
  type: SensorType;
  parameter: Parameter;
  unit: string;
  thresholdLow?: number | null;
  thresholdHigh?: number | null;
  minValue?: number | null;
  maxValue?: number | null;
  samplingIntervalMs?: number;
  isActive?: boolean;
  protocol: Protocol;
  description?: string | null;
  metadata?: Record<string, string>;
}

/**
 * Input type for updating an existing sensor
 */
export interface UpdateSensorInput {
  name?: string;
  type?: SensorType;
  parameter?: Parameter;
  unit?: string;
  thresholdLow?: number | null;
  thresholdHigh?: number | null;
  minValue?: number | null;
  maxValue?: number | null;
  samplingIntervalMs?: number;
  isActive?: boolean;
  protocol?: Protocol;
  description?: string | null;
  metadata?: Record<string, string>;
}
````

## File: packages/domain/src/models/user.ts
````typescript
import type { OrganizationMembership } from "./organization";

/**
 * Represents a user in the system (synced from Clerk)
 */
export interface User {
  id: string; // Clerk user ID
  email: string;
  username: string | null;
  firstName: string | null;
  lastName: string | null;
  imageUrl: string | null;
  createdAt: Date;
  updatedAt: Date;

  // Navigation property
  memberships?: OrganizationMembership[];
}

/**
 * Input type for creating/updating a user (from Clerk webhook)
 */
export interface UpsertUserInput {
  id: string;
  email: string;
  username?: string | null;
  firstName?: string | null;
  lastName?: string | null;
  imageUrl?: string | null;
}
````

## File: packages/domain/src/schemas/index.ts
````typescript
import { z } from "zod";
import { Parameter } from "../enums/parameter";
import { Protocol } from "../enums/protocol";
import { SensorType } from "../enums/sensor-type";
import { ReadingQuality } from "../enums/reading-quality";
import { AssetStatus } from "../enums/asset-status";

// Common schemas
export const IdParamSchema = z.object({
  id: z
    .string()
    .refine((val) => !isNaN(parseInt(val, 10)), {
      message: "ID must be a number",
    })
    .transform((val) => parseInt(val, 10)),
});

export const AssetIdParamSchema = z.object({
  assetId: z
    .string()
    .refine((val) => !isNaN(parseInt(val, 10)), {
      message: "Asset ID must be a number",
    })
    .transform((val) => parseInt(val, 10)),
});

// Asset schemas
export const CreateAssetSchema = z.object({
  name: z.string().min(1, "Name is required"),
  type: z.string().min(1, "Type is required"),
  location: z.string().optional(),
  status: z.nativeEnum(AssetStatus).optional(),
  description: z.string().nullable().optional(),
  manufacturer: z.string().nullable().optional(),
  modelNumber: z.string().nullable().optional(),
  installationDate: z
    .string()
    .datetime()
    .optional()
    .transform((v) => (v ? new Date(v) : undefined)),
  metadata: z.record(z.string()).optional(),
});

export const UpdateAssetSchema = z.object({
  name: z.string().min(1, "Name is required").optional(),
  type: z.string().optional(),
  location: z.string().optional(),
  status: z.nativeEnum(AssetStatus).optional(),
  description: z.string().nullable().optional(),
  manufacturer: z.string().nullable().optional(),
  modelNumber: z.string().nullable().optional(),
  installationDate: z
    .string()
    .datetime()
    .optional()
    .transform((v) => (v ? new Date(v) : undefined)),
  metadata: z.record(z.string()).optional(),
});

// Sensor schemas
export const CreateSensorSchema = z.object({
  assetId: z.number().int().positive(),
  name: z.string().min(1, "Name is required"),
  type: z.nativeEnum(SensorType),
  parameter: z.nativeEnum(Parameter),
  unit: z.string().min(1, "Unit is required"),
  thresholdLow: z.number().nullable().optional(),
  thresholdHigh: z.number().nullable().optional(),
  minValue: z.number().nullable().optional(),
  maxValue: z.number().nullable().optional(),
  samplingIntervalMs: z.number().int().positive().default(1000),
  isActive: z.boolean().default(true),
  protocol: z.nativeEnum(Protocol),
  description: z.string().nullable().optional(),
  metadata: z.record(z.string()).optional(),
});

export const UpdateSensorSchema = z.object({
  name: z.string().min(1).optional(),
  type: z.nativeEnum(SensorType).optional(),
  parameter: z.nativeEnum(Parameter).optional(),
  unit: z.string().optional(),
  thresholdLow: z.number().nullable().optional(),
  thresholdHigh: z.number().nullable().optional(),
  minValue: z.number().nullable().optional(),
  maxValue: z.number().nullable().optional(),
  samplingIntervalMs: z.number().int().positive().optional(),
  isActive: z.boolean().optional(),
  protocol: z.nativeEnum(Protocol).optional(),
  description: z.string().nullable().optional(),
  metadata: z.record(z.string()).optional(),
});

// Reading schemas
export const CreateReadingSchema = z.object({
  sensorId: z.number().int().positive(),
  timestamp: z
    .string()
    .datetime()
    .optional()
    .transform((v) => (v ? new Date(v) : undefined)),
  value: z.number(),
  parameter: z.nativeEnum(Parameter),
  protocol: z.nativeEnum(Protocol),
  quality: z.nativeEnum(ReadingQuality).optional(),
  notes: z.string().nullable().optional(),
  metadata: z.record(z.string()).optional(),
});
````

## File: packages/domain/src/index.ts
````typescript
// @moondesk/domain - Core domain package
// Pure TypeScript types, interfaces, and business logic with no external dependencies

// Enums
export * from "./enums/index";

// Models
export * from "./models/index";

// Interfaces (repositories & services)
export * from "./interfaces/index";

// Schemas (Zod)
export * from "./schemas/index";

// Errors
export * from "./errors/index";
````

## File: packages/domain/package.json
````json
{
  "name": "@moondesk/domain",
  "version": "0.0.1",
  "private": true,
  "type": "module",
  "main": "./src/index.ts",
  "types": "./src/index.ts",
  "exports": {
    ".": {
      "types": "./src/index.ts",
      "default": "./src/index.ts"
    },
    "./models": {
      "types": "./src/models/index.ts",
      "default": "./src/models/index.ts"
    },
    "./enums": {
      "types": "./src/enums/index.ts",
      "default": "./src/enums/index.ts"
    },
    "./interfaces": {
      "types": "./src/interfaces/index.ts",
      "default": "./src/interfaces/index.ts"
    }
  },
  "scripts": {
    "check-types": "tsc --noEmit",
    "lint": "eslint src/"
  },
  "devDependencies": {
    "@moondesk/eslint-config": "workspace:*",
    "@moondesk/typescript-config": "workspace:*",
    "@types/node": "^22.15.3",
    "eslint": "^9.15.0",
    "typescript": "5.9.2"
  },
  "dependencies": {
    "zod": "^3.24.2"
  }
}
````

## File: packages/logger/src/index.ts
````typescript
import pino, { type Logger } from "pino";

const isDevelopment = process.env["NODE_ENV"] !== "production";

/**
 * Create a Pino logger instance with appropriate configuration
 */
export function createLogger(name: string): Logger {
  return pino({
    name,
    level: process.env["LOG_LEVEL"] ?? (isDevelopment ? "debug" : "info"),
    transport: isDevelopment
      ? {
          target: "pino-pretty",
          options: {
            colorize: true,
            translateTime: "SYS:standard",
            ignore: "pid,hostname",
          },
        }
      : undefined,
    formatters: {
      level: (label: string) => ({ level: label }),
    },
    base: {
      env: process.env["NODE_ENV"] ?? "development",
    },
  });
}

/**
 * Default application logger
 */
export const logger = createLogger("moondesk");

/**
 * Create a child logger with additional context
 */
export function createChildLogger(
  parent: Logger,
  context: Record<string, unknown>,
): Logger {
  return parent.child(context);
}

// Re-export pino types
export type { Logger } from "pino";
````

## File: packages/logger/package.json
````json
{
    "name": "@moondesk/logger",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "main": "./src/index.ts",
    "types": "./src/index.ts",
    "exports": {
        ".": {
            "types": "./src/index.ts",
            "default": "./src/index.ts"
        }
    },
    "scripts": {
        "check-types": "tsc --noEmit",
        "lint": "eslint src/"
    },
    "dependencies": {
        "pino": "^10.1.0",
        "pino-pretty": "^13.1.3"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:*",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "eslint": "^9.15.0",
        "typescript": "5.9.2"
    }
}
````

## File: README.md
````markdown
# Moondesk

Moondesk is a comprehensive IoT Dashboard and Edge Simulation platform built as a monorepo using [Turborepo](https://turbo.build/repo). It provides a full stack solution for managing, monitoring, and simulating IoT devices.

## Architecture

The project is structured as a monorepo with the following components:

### Apps (`/apps`)

- **`moondesk-dash`**: The main dashboard application built with [Next.js](https://nextjs.org/). It provides the user interface for monitoring assets, managing organizations, and visualizing data.
- **`@moondesk/api`**: The backend API service (Node.js/Fastify) that handles data ingestion, user management, and communication with the database and message broker.
- **`edge-simulator`**: A CLI/Service built with TypeScript that simulates edge devices, generating telemetry data for testing and development.
- **`mqtt-worker`**: A dedicated worker service for handling high-throughput MQTT messages and processing telemetry data.
- **`docs`**: Project documentation site built with Next.js.

### Packages (`/packages`)

Shared libraries used across the applications:

- **`@moondesk/database`**: Database schema, migrations (Prisma/TimescaleDB), and repository patterns.
- **`@moondesk/domain`**: Shared domain types, interfaces, and business logic definitions.
- **`@moondesk/config`**: Centralized configuration management.
- **`@moondesk/logger`**: shared logging utilities.
- **`@moondesk/ui`**: Shared UI component library.
- **`@moondesk/eslint-config`**: Shared ESLint configurations.
- **`@moondesk/typescript-config`**: Shared TSConfig bases.

## Prerequisites

- **Node.js**: >= 18
- **pnpm**: >= 9
- **Docker & Docker Compose**: For running infrastructure services (TimescaleDB, Mosquitto, Redis).

## Getting Started

1. **Clone the repository:**

   ```bash
   git clone <repository-url>
   cd moondesk
   ```

2. **Install dependencies:**

   ```bash
   pnpm install
   ```

3. **Start Infrastructure:**
   Spin up the required database and message broker services using Docker Compose.

   ```bash
   docker-compose up -d
   ```

4. **Run Development Server:**
   Start all applications in development mode.

   ```bash
   pnpm dev
   ```

   - Dashboard: [http://localhost:3000](http://localhost:3000)
   - API: [http://localhost:3001](http://localhost:3001) (check logs for exact port)
   - Documentation: [http://localhost:3002](http://localhost:3002)

## Common Commands

- **Build**: `pnpm build` - Builds all apps and packages.
- **Lint**: `pnpm lint` - Lints all workspaces.
- **Test**: `pnpm test` - Runs tests across the monorepo.
- **Development**: `pnpm dev` - Starts the development environment.

## Environment Variables

Check `.env.example` in respective applications for required environment variables. Ensure `globalEnv` in `turbo.json` is updated if adding new shared environment variables.

## License

Not set yet
````

## File: turbo.json
````json
{
  "$schema": "https://turborepo.com/schema.json",
  "ui": "tui",
  "globalEnv": [
    "NODE_ENV",
    "LOG_LEVEL",
    "DATABASE_URL",
    "CORS_ORIGINS",
    "API_URL",
    "INTERNAL_SERVICE_TOKEN"
  ],
  "tasks": {
    "build": {
      "dependsOn": [
        "^build"
      ],
      "inputs": [
        "$TURBO_DEFAULT$",
        ".env*"
      ],
      "outputs": [
        "dist/**",
        ".next/**",
        "!.next/cache/**"
      ]
    },
    "lint": {
      "dependsOn": [
        "^lint"
      ]
    },
    "test": {
      "dependsOn": [
        "^build"
      ]
    },
    "check-types": {
      "dependsOn": [
        "^check-types"
      ]
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
````

## File: packages/database/src/repositories/asset.repository.ts
````typescript
import { eq, and, desc } from "drizzle-orm";
import type {
  Asset,
  CreateAssetInput,
  UpdateAssetInput,
} from "@moondesk/domain";
import type { IAssetRepository } from "@moondesk/domain";
import { getDb } from "../client";
import { assets, sensors } from "../schema/index";
import { AssetStatus } from "@moondesk/domain";

/**
 * Asset repository implementation using Drizzle ORM
 */
export class AssetRepository implements IAssetRepository {
  private db = getDb();

  async getAll(organizationId: string): Promise<Asset[]> {
    const results = await this.db
      .select()
      .from(assets)
      .where(eq(assets.organizationId, organizationId))
      .orderBy(desc(assets.createdAt));

    return results.map(this.mapToAsset);
  }

  async getById(id: number, organizationId: string): Promise<Asset | null> {
    const results = await this.db
      .select()
      .from(assets)
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)))
      .limit(1);

    return results[0] ? this.mapToAsset(results[0]) : null;
  }

  async getByIdWithSensors(
    id: number,
    organizationId: string,
  ): Promise<Asset | null> {
    const asset = await this.getById(id, organizationId);
    if (!asset) return null;

    const sensorResults = await this.db
      .select()
      .from(sensors)
      .where(eq(sensors.assetId, id));

    return {
      ...asset,
      sensors: sensorResults.map((s) => ({
        id: s.id,
        assetId: s.assetId,
        organizationId,
        name: s.name,
        type: s.type as import("@moondesk/domain").SensorType,
        parameter: s.parameter as import("@moondesk/domain").Parameter,
        unit: s.unit,
        thresholdLow: s.thresholdLow,
        thresholdHigh: s.thresholdHigh,
        minValue: s.minValue,
        maxValue: s.maxValue,
        samplingIntervalMs: s.samplingIntervalMs,
        isActive: s.isActive,
        protocol: s.protocol as import("@moondesk/domain").Protocol,
        description: s.description,
        metadata: s.metadata ?? {},
      })),
    };
  }

  async create(input: CreateAssetInput): Promise<Asset> {
    const results = await this.db
      .insert(assets)
      .values({
        organizationId: input.organizationId,
        name: input.name,
        type: input.type,
        location: input.location,
        status: input.status ?? AssetStatus.Unknown,
        description: input.description,
        manufacturer: input.manufacturer,
        modelNumber: input.modelNumber,
        installationDate: input.installationDate,
        metadata: input.metadata ?? {},
      })
      .returning();

    return this.mapToAsset(results[0]!);
  }

  async update(
    id: number,
    organizationId: string,
    input: UpdateAssetInput,
  ): Promise<Asset | null> {
    const results = await this.db
      .update(assets)
      .set({
        ...input,
        updatedAt: new Date(),
      })
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)))
      .returning();

    return results[0] ? this.mapToAsset(results[0]) : null;
  }

  async delete(id: number, organizationId: string): Promise<boolean> {
    const result = await this.db
      .delete(assets)
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)))
      .returning({ id: assets.id });

    return result.length > 0;
  }

  async updateLastSeen(id: number, organizationId: string): Promise<void> {
    await this.db
      .update(assets)
      .set({
        lastSeen: new Date(),
        status: AssetStatus.Online,
        updatedAt: new Date(),
      })
      .where(and(eq(assets.id, id), eq(assets.organizationId, organizationId)));
  }

  private mapToAsset(record: typeof assets.$inferSelect): Asset {
    return {
      id: record.id,
      organizationId: record.organizationId,
      name: record.name,
      type: record.type,
      location: record.location,
      status: record.status as import("@moondesk/domain").AssetStatus,
      lastSeen: record.lastSeen,
      description: record.description,
      manufacturer: record.manufacturer,
      modelNumber: record.modelNumber,
      installationDate: record.installationDate,
      metadata: record.metadata ?? {},
    };
  }
}
````

## File: packages/database/package.json
````json
{
    "name": "@moondesk/database",
    "version": "0.0.1",
    "private": true,
    "type": "module",
    "main": "./src/index.ts",
    "types": "./src/index.ts",
    "exports": {
        ".": {
            "types": "./src/index.ts",
            "default": "./src/index.ts"
        },
        "./schema": {
            "types": "./src/schema/index.ts",
            "default": "./src/schema/index.ts"
        },
        "./repositories": {
            "types": "./src/repositories/index.ts",
            "default": "./src/repositories/index.ts"
        }
    },
    "scripts": {
        "check-types": "tsc --noEmit",
        "lint": "eslint src/",
        "db:generate": "drizzle-kit generate",
        "db:migrate": "drizzle-kit migrate",
        "db:push": "drizzle-kit push",
        "db:studio": "drizzle-kit studio"
    },
    "dependencies": {
        "@moondesk/domain": "workspace:*",
        "@types/pg": "^8.16.0",
        "drizzle-orm": "^0.45.0",
        "pg": "^8.16.3"
    },
    "devDependencies": {
        "@moondesk/eslint-config": "workspace:*",
        "@moondesk/typescript-config": "workspace:*",
        "@types/node": "^22.15.3",
        "drizzle-kit": "^0.30.1",
        "eslint": "^9.15.0",
        "typescript": "5.9.2"
    }
}
````

## File: package.json
````json
{
  "name": "moondesk",
  "private": true,
  "scripts": {
    "build": "turbo run build",
    "dev": "turbo run dev",
    "lint": "turbo run lint",
    "test": "turbo run test",
    "format": "prettier --write \"**/*.{ts,tsx,md}\"",
    "format:check": "prettier --check \"**/*.{ts,tsx,md}\"",
    "check-types": "turbo run check-types",
    "prepare": "husky"
  },
  "devDependencies": {
    "husky": "^9.1.7",
    "prettier": "^3.7.4",
    "turbo": "^2.6.3",
    "typescript": "5.9.3"
  },
  "packageManager": "pnpm@9.0.0",
  "engines": {
    "node": ">=18"
  }
}
````

## File: .gitignore
````
# Binaries
bin/
dist/
.turbo
.vscode

# Modules
node_modules/

# OS Specific
.DS_Store
Thumbs.db

# Editors
.vscode/
.idea/
*.swp
.cursor/
.cursorrules

# Env
.env
api

# Legacy (Merged)
# Dependencies
.pnp
.pnp.js

# Local env files
.env.local
.env.development.local
.env.test.local
.env.production.local

**/.env
**/.env.local
**/.env.development.local
**/.env.test.local
**/.env.production.local

# Testing
coverage

# Turbo
.turbo

# Vercel
.vercel

# Build Outputs
.next/
out/
build
.kiro

# Debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
*.log
*.pem
````

## File: AGENTS.md
````markdown
# Moondesk Agent Guidelines (TypeScript)

This document provides comprehensive instructions and conventions for AI agents (and human developers) working on the Moondesk TypeScript codebase.

## 1. Project Overview

Moondesk is a scalable, protocol-agnostic IoT platform designed to handle high-throughput data ingestion, real-time analytics, and device management.

## 2. Environment & Setup

- **Runtime**: Node.js (v20+), strictly TypeScript.
- **Package Manager**: `pnpm` (Corepack enabled).
- **Build System**: `turbo` for task orchestration, `tsup` for backend bundling.
- **Database**: PostgreSQL with TimescaleDB extension.
- **ORM**: Drizzle ORM.
- **Infrastructure**: Docker Compose for local development (Redis, Postgres, Mosquitto).

### Common Commands

- **Setup**: `corepack enable && pnpm install`
- **Dev**: `turbo run dev` (starts apps)
- **Docker**: `docker compose up -d` (starts infra + backend services)
- **Build**: `turbo run build`
- **Lint**: `turbo run lint`
- **Check Types**: `turbo run check-types`

## 3. Git Workflow & Linear Integration

Strict Git hooks (Husky) are enforced. Agents MUST follow these rules to successfully push code.

- **Branch Naming**:
  - Format: `mndsk-<ticket-id>-<title-kebab-case>`
  - Example: `mndsk-39-initial-commit` or `mndsk-42-fix-sensor-reading`
  - **Restriction**: You CANNOT commit directly to `main` or `master`.
- **Linear Integration**:
  - The project uses a `commit-msg` hook.
  - It automatically prepends the Linear Ticket ID (e.g., `MNDSK-39`) from the branch name to your commit message.
  - You do not need to manually type `MNDSK-39` in the commit message.
- **Pushing**:
  - Direct pushes to `main` are blocked.
  - You must push to your feature branch and open a Pull Request.

## 4. Repository Structure

This is a **Monorepo** managed by **Turbo** and **pnpm** workspaces.

### `apps/`

- **`api`**: Fastify backend. Main entry point for REST/WS.
- **`mqtt-worker`**: Node.js worker. Handles high-velocity MQTT traffic.
- **`edge-simulator`**: Tool to generate synthetic load for testing.
- **`moondesk-dash`**: Next.js 14+ frontend application.
- **`docs`**: Documentation site.

### `packages/`

- **`config`**: Shared configuration (env vars, schemas, constants).
- **`database`**: Drizzle ORM schemas and repositories.
- **`domain`**: Shared interfaces, types, Models, and Enums. No side effects.
- **`logger`**: Standardized Pino logger configuration.
- **`ui`**: Shared React UI components (shadcn/ui based).
- **`typescript-config`**: Shared `tsconfig.json` bases.

## 5. Architecture & Key Patterns

### System Architecture

1.  **Edge Devices**: Simulate or real devices sending data via MQTT.
2.  **Broker (Mosquitto)**: Handles MQTT messsaging.
3.  **Worker (MQTT Worker)**: Subscribes to broker, processes ingestion, and broadcasts "hot" data to API.
4.  **API (Fastify)**: REST & WebSocket API for frontend clients.
5.  **Storage**: TimescaleDB (Postgres) & Redis.

### Key Patterns

- **Ingestion Flow**: Device -> MQTT -> Mosquitto -> Worker -> Database + API (Broadcast).
- **Internal Auth**: The MQ worker talks to the API using a shared `INTERNAL_SERVICE_TOKEN`.
- **Bundling**: Backend apps use `tsup` to bundle local workspace packages into a single entry point for Docker.

## 6. Development Philosophy

1.  **Strict Types**: We do NOT use `any`. All types should be defined in `@moondesk/domain` if shared.
2.  **Docker First**: The entire backend stack runs in Docker.
3.  **Environment Variables**: Strictly validated using Zod in `@moondesk/config`.

## 7. Pre-Push Verification

**CRITICAL**: Before pushing ANY code, you MUST ensure these pass:

1.  `pnpm lint` (0 exit code)
2.  `pnpm check-types` (or `pnpm typecheck`)
3.  `pnpm build`

**If any of these fail, you MUST fix the errors before pushing.**

## 8. Commit Conventions

Every commit message should provide context. The Linear ID will be auto-prepended.

1.  **Summary Line**: `feat: implement user login flow`
2.  **Detailed Description**: List changed files and why.

Example:

```text
feat: implement user login flow

- apps/api/src/controllers/auth.controller.ts: Added login endpoint handler.
- packages/domain/src/schemas/auth.schema.ts: Added Zod schema.
```
````